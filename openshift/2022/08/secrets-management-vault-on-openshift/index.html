<!doctype html><html lang=en class="js csstransforms3d"><head><meta name=google-site-verification content="yq2Ib3doJVHVlEW2wtHap5WY54JhS2CCvI40y30F0FI"><meta name=color-scheme content="dark light"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.141.0"><meta name=description content="Secrets Management with HashiCorp Vault"><meta name=author content="Toni Schmidbauer & Thomas Jungbauer"><meta name=keywords content="OCP,Day-2,OpenShift,Vault,Secrets"><meta name=title content="Secrets Management - Vault on OpenShift"><meta name=robots content="index, follow"><meta charset=utf-8><meta name=language content="English"><link rel=canonical href=https://blog.stderr.at/openshift/2022/08/secrets-management-vault-on-openshift/><meta property="og:title" content="Secrets Management - Vault on OpenShift"><meta property="og:description" content="Secrets Management with HashiCorp Vault"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.stderr.at/openshift/2022/08/secrets-management-vault-on-openshift/"><meta property="og:site_name" content="TechBlog about OpenShift/Ansible/Satellite and much more"><meta property="article:published_time" content="2022-08-16T00:00:00Z"><meta property="article:modified_time" content="2024-05-08T06:59:13+02:00"><meta property="article:section" content="OpenShift"><meta property="article:tag" content="OCP"><meta property="article:tag" content="Day-2"><meta property="article:tag" content="OpenShift"><meta property="article:tag" content="Vault"><meta property="article:tag" content="Secrets"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Secrets Management - Vault on OpenShift"><meta name=twitter:description content="Secrets Management with HashiCorp Vault"><meta name=article:author content="Toni Schmidbauer & Thomas Jungbauer"><meta name=article:tag content="technical blog, OpenShift, Security"><script type=application/ld+json>{"@context":"https://schema.org","@type":"TechArticle","headline":"Secrets Management - Vault on OpenShift","description":"Secrets Management with HashiCorp Vault","url":"https:\/\/blog.stderr.at\/openshift\/2022\/08\/secrets-management-vault-on-openshift\/","datePublished":"2022-08-16T00:00:00Z","dateModified":"2024-05-08T06:59:13\u002b02:00","author":{"@type":"Person","name":"Toni Schmidbauer \u0026 Thomas Jungbauer"},"about":["OpenShift","Security"],"publisher":{"@type":"Organization","name":"TechBlog about OpenShift\/Ansible\/Satellite and much more","url":"https:\/\/blog.stderr.at\/"}}</script><link rel=icon href=/images/favicon.ico type=image/png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-180x180.png><link rel=apple-touch-icon sizes=128x128 href=/images/apple-touch-icon-128x128.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-touch-icon-72x72.png><link rel=apple-touch-icon href=/images/apple-touch-icon-57x57.png><link rel="shortcut icon" href=/images/favicon.ico><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><title>Secrets Management - Vault on OpenShift :: TechBlog about OpenShift/Ansible/Satellite and much more</title>
<link rel=manifest href=/manifest.json><meta name=theme-color content="#317EFB"><link href=/css/nucleus.min.css?1752853234 rel=stylesheet><link href=/css/fontawesome-all.min.css?1752853234 rel=stylesheet><link href=/css/featherlight.min.css?1752853234 rel=stylesheet><link href=/css/theme.min.css?1752853234 rel=stylesheet><link href=/css/hugo-theme.css?1752853234 rel=stylesheet><link href=/css/theme-yaub.css?1752853234 rel=stylesheet><script src=/js/jquery-3.7.1.min.js?1752853234></script><script src=/js/jquery.waypoints.min.js?1752853234></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/openshift/2022/08/secrets-management-vault-on-openshift/><button onclick=scrollTopAnimated() id=myBtn class="top-btn button fa fa-arrow-up" title="Go to top"></button>
<span class=read-progress></span><nav id=sidebar><div id=header-wrapper><div id=header><svg class="logo" width="200" height="100" viewBox="0 0 200 136.34417133812047"><defs id="SvgjsDefs3490"/><g id="SvgjsG3491" featurekey="symbolFeature-0" transform="matrix(0.8888888888888888,0,0,0.8888888888888888,55.55511135525174,-24.034717135959202)" fill="#d2d2d2"><g xmlns="http://www.w3.org/2000/svg"><g><g><g><path fill="#d2d2d2" d="M75.195 72.96c-.619.0-1.241-.21-1.75-.64-1.146-.967-1.291-2.681-.324-3.827L88.73 50 73.122 31.507c-.967-1.146-.822-2.859.324-3.827 1.146-.968 2.859-.823 3.827.323L94.36 48.248c.854 1.012.854 2.492.0 3.503L77.272 71.995C76.735 72.632 75.968 72.96 75.195 72.96z"/></g></g></g><g><g><g><path fill="#d2d2d2" d="M24.805 72.96c-.772.0-1.539-.328-2.076-.964L5.641 51.752c-.854-1.012-.854-2.492.0-3.503l17.088-20.245c.967-1.146 2.681-1.291 3.827-.324 1.146.967 1.291 2.681.324 3.827L11.269 50.001l15.609 18.492c.967 1.146.823 2.859-.323 3.827C26.045 72.749 25.423 72.96 24.805 72.96z"/></g></g></g><g><path fill="#d2d2d2" d="M37.325 72.96c-.492.0-.99-.134-1.438-.414-1.271-.796-1.657-2.471-.861-3.742L60.37 28.315c.796-1.271 2.472-1.656 3.743-.861 1.271.796 1.657 2.471.861 3.742L39.63 71.685C39.115 72.508 38.23 72.96 37.325 72.96z"/></g></g></g><g id="SvgjsG3492" featurekey="nameFeature-0" transform="matrix(1.6473784183020483,0,0,1.6473784183020483,0.5930603781937029,42.15399158589206)" fill="#d2d2d2"><path d="m6.72 11.44 6.68 11.28 6.64-11.28h7l-10.6 17.6V40h-6.28V28.88l-10.52-17.44h7.08zm38.535.0L55.935 40h-6.52l-2.16-6.36h-10.68L34.335 40h-6.36l10.84-28.56h6.44zM41.935 18.48l-3.72 10.48h7.4l-3.6-10.48h-.08zm27.175-7.04-39062e-9 17.88c0 2.1067.47332 3.6467 1.42 4.62s2.4334 1.46 4.46 1.46c2.1867.0 3.72-.48668 4.6-1.46s1.32-2.5133 1.32-4.62V11.44h6.28v17.88c0 3.5733-1.02 6.36-3.06 8.36s-5.0868 3-9.14 3c-4.1332.0-7.1932-1-9.18-3s-2.98-4.7868-2.98-8.36V11.44h6.28zm41.495.0c6.0532.0 9.08 2.3466 9.08 7.04.0 2.6933-1.2933 4.6932-3.88 6 1.76.50668 3.0733 1.3934 3.94 2.66s1.3 2.7934 1.3 4.58c0 2.56-.92668 4.58-2.78 6.06s-4.2868 2.22-7.3 2.22h-13.84V11.44h13.48zM109.80499999999999 23c2.5333.0 3.8-1.1333 3.8-3.4.0-2.1867-1.4133-3.28-4.24-3.28h-5.96V23h6.4zm.359999999999999 12.12c3.0667.0 4.6-1.2533 4.6-3.76.0-2.72-1.4933-4.08-4.48-4.08h-6.88v7.84h6.76z"/></g></svg><div class=inline-flex><span class="animate-typewriter overflow-hidden whitespace-nowrap">Yet another useless blog<span class="ml-2 -translate-y-2 animate-blink">_</span></span></div></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1752853234></script><script type=text/javascript src=/js/auto-complete.js?1752853234></script><script type=text/javascript>var baseurl="https://blog.stderr.at/"</script><script type=text/javascript src=/js/search.js?1752853234></script></div><div class=highlightable><ul class=topics><li data-nav-id=/gitopscollection/ title="GitOps Episodes" class=dd-item><a href=/gitopscollection/>GitOps Episodes</a><ul><li data-nav-id=/gitopscollection/2025-07-17-common-template-application/ title="Reusable Argo CD Application Helm Template" class=dd-item><a href=/gitopscollection/2025-07-17-common-template-application/>Reusable Argo CD Application Helm Template</a></li><li data-nav-id=/gitopscollection/2025-04-17-applicationset-defining-namespaces/ title="Using ApplicationSet with Matrix Generator and define individual Namespaces" class=dd-item><a href=/gitopscollection/2025-04-17-applicationset-defining-namespaces/>Using ApplicationSet with Matrix Generator and define individual Namespaces</a></li><li data-nav-id=/gitopscollection/2024-10-13-using-post-renderer/ title="Using Kustomize to post render a Helm Chart" class=dd-item><a href=/gitopscollection/2024-10-13-using-post-renderer/>Using Kustomize to post render a Helm Chart</a></li><li data-nav-id=/gitopscollection/2024-07-04-managing-certificates-with-gitops/ title="Managing Certificates using GitOps approach" class=dd-item><a href=/gitopscollection/2024-07-04-managing-certificates-with-gitops/>Managing Certificates using GitOps approach</a></li><li data-nav-id=/gitopscollection/2024-06-07-update-cluster-version-with-gitops/ title="Update Cluster Version using GitOps approach" class=dd-item><a href=/gitopscollection/2024-06-07-update-cluster-version-with-gitops/>Update Cluster Version using GitOps approach</a></li><li data-nav-id=/gitopscollection/2024-06-02-multisources-for-application-in-argocd/ title="Multiple Sources for Applications in Argo CD" class=dd-item><a href=/gitopscollection/2024-06-02-multisources-for-application-in-argocd/>Multiple Sources for Applications in Argo CD</a></li><li data-nav-id=/gitopscollection/2024-05-24-install-openshift-logging/ title="Installing OpenShift Logging using GitOps" class=dd-item><a href=/gitopscollection/2024-05-24-install-openshift-logging/>Installing OpenShift Logging using GitOps</a></li><li data-nav-id=/gitopscollection/2024-05-17-configure-minio-buckets/ title="Configure Buckets in MinIO using GitOps" class=dd-item><a href=/gitopscollection/2024-05-17-configure-minio-buckets/>Configure Buckets in MinIO using GitOps</a></li><li data-nav-id=/gitopscollection/2024-04-28-installing-advanced-cluster-security/ title="Setup & Configure Advanced Cluster Security using GitOps" class=dd-item><a href=/gitopscollection/2024-04-28-installing-advanced-cluster-security/>Setup & Configure Advanced Cluster Security using GitOps</a></li><li data-nav-id=/gitopscollection/2024-04-25-installing-compliance-operator/ title="Setup & Configure Compliance Operator using GitOps" class=dd-item><a href=/gitopscollection/2024-04-25-installing-compliance-operator/>Setup & Configure Compliance Operator using GitOps</a></li><li data-nav-id=/gitopscollection/2024-04-02-configure_app_of_apps/ title="Configure App-of-Apps" class=dd-item><a href=/gitopscollection/2024-04-02-configure_app_of_apps/>Configure App-of-Apps</a></li><li data-nav-id=/gitopscollection/2024-02-02-setup-argocd/ title="Setup OpenShift GitOps/Argo CD" class=dd-item><a href=/gitopscollection/2024-02-02-setup-argocd/>Setup OpenShift GitOps/Argo CD</a></li><li data-nav-id=/gitopscollection/2023-12-28-gitops-repostructure/ title="GitOps - Choosing the right Git repository structure" class=dd-item><a href=/gitopscollection/2023-12-28-gitops-repostructure/>GitOps - Choosing the right Git repository structure</a></li><li data-nav-id=/gitopscollection/2023-12-11-gitops-intro/ title="Introducing the GitOps Approach" class=dd-item><a href=/gitopscollection/2023-12-11-gitops-intro/>Introducing the GitOps Approach</a></li></ul></li><li data-nav-id=/openshift/ title=OpenShift class="dd-item
parent"><a href=/openshift/>OpenShift</a><ul><li data-nav-id=/openshift/2025/06/cert-manager-policy-approver-in-openshift/ title="Cert-Manager Policy Approver in OpenShift" class=dd-item><a href=/openshift/2025/06/cert-manager-policy-approver-in-openshift/>Cert-Manager Policy Approver in OpenShift</a></li><li data-nav-id=/openshift/2025/05/single-log-out-from-keycloak-and-openshift/ title="Single log out from Keycloak and OpenShift" class=dd-item><a href=/openshift/2025/05/single-log-out-from-keycloak-and-openshift/>Single log out from Keycloak and OpenShift</a></li><li data-nav-id=/openshift/2025/05/step-by-step-using-keycloak-authentication-in-openshift/ title="Step by Step - Using Keycloak Authentication in OpenShift" class=dd-item><a href=/openshift/2025/05/step-by-step-using-keycloak-authentication-in-openshift/>Step by Step - Using Keycloak Authentication in OpenShift</a></li><li data-nav-id=/openshift/2024/11/introducing-adminnetworkpolicies/ title="Introducing AdminNetworkPolicies" class=dd-item><a href=/openshift/2024/11/introducing-adminnetworkpolicies/>Introducing AdminNetworkPolicies</a></li><li data-nav-id=/openshift/2024/02/openshift-data-foundation-noobaa-bucket-data-retention-lifecycle/ title="OpenShift Data Foundation - Noobaa Bucket Data Retention (Lifecycle)" class=dd-item><a href=/openshift/2024/02/openshift-data-foundation-noobaa-bucket-data-retention-lifecycle/>OpenShift Data Foundation - Noobaa Bucket Data Retention (Lifecycle)</a></li><li data-nav-id=/openshift/2023/11/running-falco-on-openshift-4.12/ title="Running Falco on OpenShift 4.12" class=dd-item><a href=/openshift/2023/11/running-falco-on-openshift-4.12/>Running Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023/11/quay-deployment-and-configuration-using-gitops/ title="Quay Deployment and Configuration using GitOps" class=dd-item><a href=/openshift/2023/11/quay-deployment-and-configuration-using-gitops/>Quay Deployment and Configuration using GitOps</a></li><li data-nav-id=/openshift/2023/10/setting-up-falco-on-openshift-4.12/ title="Setting up Falco on OpenShift 4.12" class=dd-item><a href=/openshift/2023/10/setting-up-falco-on-openshift-4.12/>Setting up Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023/10/how-to-force-a-machineconfig-rollout/ title="How to force a MachineConfig rollout" class=dd-item><a href=/openshift/2023/10/how-to-force-a-machineconfig-rollout/>How to force a MachineConfig rollout</a></li><li data-nav-id=/openshift/2023/03/operator-installation-with-argo-cd/ title="Operator installation with Argo CD" class=dd-item><a href=/openshift/2023/03/operator-installation-with-argo-cd/>Operator installation with Argo CD</a></li><li data-nav-id=/openshift/2023/02/ssl-certificate-management-for-openshift-on-aws/ title="SSL Certificate Management for OpenShift on AWS" class=dd-item><a href=/openshift/2023/02/ssl-certificate-management-for-openshift-on-aws/>SSL Certificate Management for OpenShift on AWS</a></li><li data-nav-id=/openshift/2022/11/using-serversideapply-with-argocd/ title="Using ServerSideApply with ArgoCD" class=dd-item><a href=/openshift/2022/11/using-serversideapply-with-argocd/>Using ServerSideApply with ArgoCD</a></li><li data-nav-id=/openshift/2022/08/secrets-management-vault-on-openshift/ title="Secrets Management - Vault on OpenShift" class="dd-item active"><a href=/openshift/2022/08/secrets-management-vault-on-openshift/>Secrets Management - Vault on OpenShift</a></li><li data-nav-id=/openshift/2022/04/overview-of-red-hats-multi-cloud-gateway-noobaa/ title="Overview of Red Hat's Multi Cloud Gateway (Noobaa)" class=dd-item><a href=/openshift/2022/04/overview-of-red-hats-multi-cloud-gateway-noobaa/>Overview of Red Hat's Multi Cloud Gateway (Noobaa)</a></li><li data-nav-id=/openshift/2021/09/secure-your-secrets-with-sealed-secrets/ title="Secure your secrets with Sealed Secrets" class=dd-item><a href=/openshift/2021/09/secure-your-secrets-with-sealed-secrets/>Secure your secrets with Sealed Secrets</a></li><li data-nav-id=/openshift/2021/02/understanding-rwo-block-device-handling-in-openshift/ title="Understanding RWO block device handling in OpenShift" class=dd-item><a href=/openshift/2021/02/understanding-rwo-block-device-handling-in-openshift/>Understanding RWO block device handling in OpenShift</a></li><li data-nav-id=/openshift/2021/01/writing-operator-using-ansible/ title="Writing Operator using Ansible" class=dd-item><a href=/openshift/2021/01/writing-operator-using-ansible/>Writing Operator using Ansible</a></li><li data-nav-id=/openshift/2020/12/thanos-querier-vs-thanos-querier/ title="Thanos Querier vs Thanos Querier" class=dd-item><a href=/openshift/2020/12/thanos-querier-vs-thanos-querier/>Thanos Querier vs Thanos Querier</a></li><li data-nav-id=/openshift/2020/08/gitops-argo-cd/ title="GitOps - Argo CD" class=dd-item><a href=/openshift/2020/08/gitops-argo-cd/>GitOps - Argo CD</a></li><li data-nav-id=/openshift/2020/04/openshift-pipelines-tekton-introduction/ title="OpenShift Pipelines - Tekton Introduction" class=dd-item><a href=/openshift/2020/04/openshift-pipelines-tekton-introduction/>OpenShift Pipelines - Tekton Introduction</a></li><li data-nav-id=/openshift/2020/04/helpful-oc-/-kubectl-commands/ title="Helpful oc / kubectl commands" class=dd-item><a href=/openshift/2020/04/helpful-oc-/-kubectl-commands/>Helpful oc / kubectl commands</a></li></ul></li><li data-nav-id=/day-2/ title="OpenShift Day-2" class=dd-item><a href=/day-2/>OpenShift Day-2</a><ul><li data-nav-id=/day-2/etcd/ title=etcd class=dd-item><a href=/day-2/etcd/>etcd</a><ul><li data-nav-id=/day-2/etcd/2022-01-29-automatedetcdbackup/ title="Automated ETCD Backup" class=dd-item><a href=/day-2/etcd/2022-01-29-automatedetcdbackup/>Automated ETCD Backup</a></li></ul></li><li data-nav-id=/day-2/labels_environmets/ title="Labels & Environments" class=dd-item><a href=/day-2/labels_environmets/>Labels & Environments</a><ul><li data-nav-id=/day-2/labels_environmets/2022-01-12-creatingenvironment/ title="Working with Environments" class=dd-item><a href=/day-2/labels_environmets/2022-01-12-creatingenvironment/>Working with Environments</a></li></ul></li><li data-nav-id=/day-2/pod-placement/ title="Pod Placement" class=dd-item><a href=/day-2/pod-placement/>Pod Placement</a><ul><li data-nav-id=/day-2/pod-placement/2021-08-26-podplacement-intro/ title=Introduction class=dd-item><a href=/day-2/pod-placement/2021-08-26-podplacement-intro/>Introduction</a></li><li data-nav-id=/day-2/pod-placement/2021-08-29-node-affinity/ title="Node Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-29-node-affinity/>Node Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-27-podplacement/ title=NodeSelector class=dd-item><a href=/day-2/pod-placement/2021-08-27-podplacement/>NodeSelector</a></li><li data-nav-id=/day-2/pod-placement/2021-08-28-affinity/ title="Pod Affinity/Anti-Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-28-affinity/>Pod Affinity/Anti-Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-30-taints/ title="Taints and Tolerations" class=dd-item><a href=/day-2/pod-placement/2021-08-30-taints/>Taints and Tolerations</a></li><li data-nav-id=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/ title="Topology Spread Constraints" class=dd-item><a href=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/>Topology Spread Constraints</a></li><li data-nav-id=/day-2/pod-placement/2021-09-01-descheduler/ title="Using Descheduler" class=dd-item><a href=/day-2/pod-placement/2021-09-01-descheduler/>Using Descheduler</a></li></ul></li></ul></li><li data-nav-id=/securesupplychain/ title="Secure Supply Chain" class=dd-item><a href=/securesupplychain/>Secure Supply Chain</a><ul><li data-nav-id=/securesupplychain/2023-06-15-securesupplychain-intro/ title="Introduction to a Secure Supply Chain" class=dd-item><a href=/securesupplychain/2023-06-15-securesupplychain-intro/>Introduction to a Secure Supply Chain</a></li><li data-nav-id=/securesupplychain/2023-06-16-securesupplychain-step1/ title="Step 1 - Listen to Events" class=dd-item><a href=/securesupplychain/2023-06-16-securesupplychain-step1/>Step 1 - Listen to Events</a></li><li data-nav-id=/securesupplychain/2023-06-17-securesupplychain-step2/ title="Step 2 - Pipelines" class=dd-item><a href=/securesupplychain/2023-06-17-securesupplychain-step2/>Step 2 - Pipelines</a></li><li data-nav-id=/securesupplychain/2023-06-18-securesupplychain-step3/ title="Step 3 - SonarQube" class=dd-item><a href=/securesupplychain/2023-06-18-securesupplychain-step3/>Step 3 - SonarQube</a></li><li data-nav-id=/securesupplychain/2023-06-19-securesupplychain-step4/ title="Step 4 - Verify Git Commit" class=dd-item><a href=/securesupplychain/2023-06-19-securesupplychain-step4/>Step 4 - Verify Git Commit</a></li><li data-nav-id=/securesupplychain/2023-06-20-securesupplychain-step5/ title="Step 5 - Build and Sign Image" class=dd-item><a href=/securesupplychain/2023-06-20-securesupplychain-step5/>Step 5 - Build and Sign Image</a></li><li data-nav-id=/securesupplychain/2023-06-21-securesupplychain-step6/ title="Step 6 - Scanning with ACS" class=dd-item><a href=/securesupplychain/2023-06-21-securesupplychain-step6/>Step 6 - Scanning with ACS</a></li><li data-nav-id=/securesupplychain/2023-06-22-securesupplychain-step7/ title="Step 7 - Generating a SBOM" class=dd-item><a href=/securesupplychain/2023-06-22-securesupplychain-step7/>Step 7 - Generating a SBOM</a></li><li data-nav-id=/securesupplychain/2023-06-23-securesupplychain-step8/ title="Step 8 - Updating Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-23-securesupplychain-step8/>Step 8 - Updating Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-24-securesupplychain-step9/ title="Step 9 - Linting Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-24-securesupplychain-step9/>Step 9 - Linting Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-25-securesupplychain-step10/ title="Step 10 - The Example Application" class=dd-item><a href=/securesupplychain/2023-06-25-securesupplychain-step10/>Step 10 - The Example Application</a></li><li data-nav-id=/securesupplychain/2023-06-26-securesupplychain-step11/ title="Step 11 - ACS Deployment Check" class=dd-item><a href=/securesupplychain/2023-06-26-securesupplychain-step11/>Step 11 - ACS Deployment Check</a></li><li data-nav-id=/securesupplychain/2023-06-27-securesupplychain-step12/ title="Step 12 - Verify TLog Signature" class=dd-item><a href=/securesupplychain/2023-06-27-securesupplychain-step12/>Step 12 - Verify TLog Signature</a></li><li data-nav-id=/securesupplychain/2023-06-28-securesupplychain-step13/ title="Step 13 - Bring it to Production" class=dd-item><a href=/securesupplychain/2023-06-28-securesupplychain-step13/>Step 13 - Bring it to Production</a></li></ul></li><li data-nav-id=/compliance/ title=Compliance class=dd-item><a href=/compliance/>Compliance</a><ul><li data-nav-id=/compliance/2021/07/oc-compliance-command-line-plugin/ title="oc compliance command line plugin" class=dd-item><a href=/compliance/2021/07/oc-compliance-command-line-plugin/>oc compliance command line plugin</a></li><li data-nav-id=/compliance/2021/07/compliance-operator/ title="Compliance Operator" class=dd-item><a href=/compliance/2021/07/compliance-operator/>Compliance Operator</a></li></ul></li><li data-nav-id=/service-mesh/ title="Service Mesh" class=dd-item><a href=/service-mesh/>Service Mesh</a><ul><li data-nav-id=/service-mesh/2020/05/enable-automatic-route-creation/ title="Enable Automatic Route Creation" class=dd-item><a href=/service-mesh/2020/05/enable-automatic-route-creation/>Enable Automatic Route Creation</a></li><li data-nav-id=/service-mesh/2020/05/authorization-rbac/ title="Authorization (RBAC)" class=dd-item><a href=/service-mesh/2020/05/authorization-rbac/>Authorization (RBAC)</a></li><li data-nav-id=/service-mesh/2020/04/deploy-example-bookinfo-application/ title="Deploy Example Bookinfo Application" class=dd-item><a href=/service-mesh/2020/04/deploy-example-bookinfo-application/>Deploy Example Bookinfo Application</a></li><li data-nav-id=/service-mesh/2020/04/service-mesh-1.1-released/ title="Service Mesh 1.1 released" class=dd-item><a href=/service-mesh/2020/04/service-mesh-1.1-released/>Service Mesh 1.1 released</a></li><li data-nav-id=/service-mesh/2020/04/authentication-jwt/ title="Authentication JWT" class=dd-item><a href=/service-mesh/2020/04/authentication-jwt/>Authentication JWT</a></li><li data-nav-id=/service-mesh/2020/04/mutual-tls-authentication/ title="Mutual TLS Authentication" class=dd-item><a href=/service-mesh/2020/04/mutual-tls-authentication/>Mutual TLS Authentication</a></li><li data-nav-id=/service-mesh/2020/04/fault-injection/ title="Fault Injection" class=dd-item><a href=/service-mesh/2020/04/fault-injection/>Fault Injection</a></li><li data-nav-id=/service-mesh/2020/04/limit-egress/external-traffic/ title="Limit Egress/External Traffic" class=dd-item><a href=/service-mesh/2020/04/limit-egress/external-traffic/>Limit Egress/External Traffic</a></li><li data-nav-id=/service-mesh/2020/04/advanced-routing-example/ title="Advanced Routing Example" class=dd-item><a href=/service-mesh/2020/04/advanced-routing-example/>Advanced Routing Example</a></li><li data-nav-id=/service-mesh/2020/04/routing-example/ title="Routing Example" class=dd-item><a href=/service-mesh/2020/04/routing-example/>Routing Example</a></li><li data-nav-id=/service-mesh/2020/03/ingress-with-custom-domain/ title="Ingress with custom domain" class=dd-item><a href=/service-mesh/2020/03/ingress-with-custom-domain/>Ingress with custom domain</a></li><li data-nav-id=/service-mesh/2020/03/ingress-traffic/ title="Ingress Traffic" class=dd-item><a href=/service-mesh/2020/03/ingress-traffic/>Ingress Traffic</a></li><li data-nav-id=/service-mesh/2020/03/deploy-microservices/ title="Deploy Microservices" class=dd-item><a href=/service-mesh/2020/03/deploy-microservices/>Deploy Microservices</a></li><li data-nav-id=/service-mesh/2020/03/installation/ title=Installation class=dd-item><a href=/service-mesh/2020/03/installation/>Installation</a></li></ul></li><li data-nav-id=/general/ title=General class=dd-item><a href=/general/>General</a><ul><li data-nav-id=/general/2020/05/basic-usage-of-git/ title="Basic usage of git" class=dd-item><a href=/general/2020/05/basic-usage-of-git/>Basic usage of git</a></li><li data-nav-id=/general/2020/04/red-hat-satellite-cheat-sheet/ title="Red Hat Satellite Cheat Sheet" class=dd-item><a href=/general/2020/04/red-hat-satellite-cheat-sheet/>Red Hat Satellite Cheat Sheet</a></li></ul></li><li data-nav-id=/ansible/ title=Ansible class=dd-item><a href=/ansible/>Ansible</a><ul><li data-nav-id=/ansible/2021/11/ansible-style-guide/ title="Ansible Style Guide" class=dd-item><a href=/ansible/2021/11/ansible-style-guide/>Ansible Style Guide</a></li><li data-nav-id=/ansible/2021/10/automation-controller-and-ldap-authentication/ title="Automation Controller and LDAP Authentication" class=dd-item><a href=/ansible/2021/10/automation-controller-and-ldap-authentication/>Automation Controller and LDAP Authentication</a></li><li data-nav-id=/ansible/2021/07/ansible-tower-and-downloading-collections/ title="Ansible Tower and downloading collections" class=dd-item><a href=/ansible/2021/07/ansible-tower-and-downloading-collections/>Ansible Tower and downloading collections</a></li><li data-nav-id=/ansible/2020/04/ansible-azure-resource-manager-example/ title="Ansible - Azure Resource Manager Example" class=dd-item><a href=/ansible/2020/04/ansible-azure-resource-manager-example/>Ansible - Azure Resource Manager Example</a></li><li data-nav-id=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/ title="DO410 Ansible and Ansible Tower training notes" class=dd-item><a href=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/>DO410 Ansible and Ansible Tower training notes</a></li></ul></li><li data-nav-id=/acs/ title="Advanced Cluster Security" class=dd-item><a href=/acs/>Advanced Cluster Security</a><ul><li data-nav-id=/acs/2021-12-11-acsauth/ title="Advanced Cluster Security - Authentication" class=dd-item><a href=/acs/2021-12-11-acsauth/>Advanced Cluster Security - Authentication</a></li></ul></li><li data-nav-id=/azure/ title=Azure class=dd-item><a href=/azure/>Azure</a><ul><li data-nav-id=/azure/2021-10-29-private-aro/ title="Stumbling into Azure Part II: Setting up a private ARO cluster" class=dd-item><a href=/azure/2021-10-29-private-aro/>Stumbling into Azure Part II: Setting up a private ARO cluster</a></li><li data-nav-id=/azure/2021-10-17-s2s-vpn/ title="Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing" class=dd-item><a href=/azure/2021-10-17-s2s-vpn/>Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing</a></li></ul></li><li data-nav-id=/java/ title=Java class=dd-item><a href=/java/>Java</a><ul><li data-nav-id=/java/2022-02-25-jpa-disconnected-entity/ title="Adventures in Java Land: JPA disconnected entities" class=dd-item><a href=/java/2022-02-25-jpa-disconnected-entity/>Adventures in Java Land: JPA disconnected entities</a></li></ul></li><li data-nav-id=/quay/ title=Quay class=dd-item><a href=/quay/>Quay</a><ul><li data-nav-id=/quay/2021-09-07-quay-upgrade-3.4/ title="Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator" class=dd-item><a href=/quay/2021-09-07-quay-upgrade-3.4/>Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator</a></li><li data-nav-id=/quay/2020-05-13-quay-tutorial1/ title="Red Hat Quay Registry - Overview and Installation" class=dd-item><a href=/quay/2020-05-13-quay-tutorial1/>Red Hat Quay Registry - Overview and Installation</a></li></ul></li><li data-nav-id=/legaldisclosure/ title="Legal Disclosure" class=dd-item><a href=/legaldisclosure/>Legal Disclosure</a></li><li data-nav-id=/rss/ title="RSS Feeds" class=dd-item><a href=/rss/>RSS Feeds</a></li></ul><section id=footer></section></div></nav><section id=body class=post-content><div id=overlay></div><aside id=toc-field class="hidden lg:block tableOfContentContainer"><header id=TableOfContentsHeader>What's on this Page</header><nav id=TableOfContents><ul><li><a href=#_hashicorp_vault>HashiCorp Vault</a></li><li><a href=#_installing_vault>Installing Vault</a></li><li><a href=#_raft_storage>Raft Storage</a></li><li><a href=#_initialize_and_unseal_vault>Initialize and Unseal Vault</a></li><li><a href=#_verify_vault_cluster>Verify Vault Cluster</a></li><li><a href=#_configure_kubernetes_authentication>Configure Kubernetes Authentication</a></li><li><a href=#_configure_a_secret>Configure a Secret</a></li><li><a href=#_configuring_policies>Configuring policies</a></li><li><a href=#_lets_start_an_application>Let’s start an Application</a></li><li><a href=#_tip_using_vault_cli_on_your_local_environment>TIP: Using vault CLI on your local environment</a></li><li><a href=#_thanks>Thanks</a></li></ul></nav><div id=navigation><a class=nav-prev href=/openshift/2022/11/using-serversideapply-with-argocd/ title="Using ServerSideApply with ArgoCD"><i class="fa fa-chevron-left"></i></a>
<a class=nav-next href=/openshift/2022/04/overview-of-red-hats-multi-cloud-gateway-noobaa/ title="Overview of Red Hat's Multi Cloud Gateway (Noobaa)" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></aside><div class="padding highlightable"><header><div id=top-nav class=margin-bottom-15><section id=homelinks class=text-align-center><ul class="list-no-style margin-0 padding-0 overflow-hidden text-align-left vertical-align-middle"><li class="list-horizontal padding-left-15 padding-right-15"><a class=padding-topnav href=/><i class='fas fa-home'></i> Home</a></li><li class="dropdown list-horizontal left padding-left-15 padding-right-15"><div class="submenu left static inline-block"><a class=padding-topnav href=https://blog.stderr.at/authors><svg stroke="currentcolor" fill="#d2d2d2" stroke-width="0" viewBox="0 0 17 17" class="relative z-20 h-6 w-6" height="1em" width="1em"><g/><path d="M16.499 1.843 15.096.44c-.566-.566-1.555-.566-2.122.0L5.438 7.976l-1.722 5.287 5.249-1.765 7.534-7.534c.283-.283.439-.66.439-1.061s-.156-.777-.439-1.06zM5.584 10.758l.638-1.957 1.92 1.919-1.942.653-.616-.615zM6.832 7.996l3.986-3.986 2.11 2.11-3.986 3.986-2.11-2.11zm4.693-4.693.729-.729 2.11 2.11-.729.729-2.11-2.11zM15.792 3.257l-.72.721-2.11-2.11.72-.721c.19-.189.519-.189.707.0l1.403 1.403c.094.095.146.22.146.354s-.052.258-.146.353zM15 7.5h1V17H0V2h7.5v1H1v13h14V7.5z"/></svg> About Us<i class='fa fa-chevron-down padding-left-25rem' '></i></a><div class="absolute submenu-div"><a href=/authors/thomas-jungbauer class="submenu-style submenu-link display-block"><i></i>Thomas Jungbauer</a>
<a href=/authors/toni-schmidbauer class="submenu-style submenu-link display-block"><i></i>Toni Schmidbauer</a>
<a href=/legaldisclosure class="submenu-style submenu-link display-block"><i></i>Legal Disclosure</a></div></div></li><li class="list-horizontal left padding-left-15 padding-right-15"><a class=padding-topnav href=https://blog.stderr.at/categories><i class='far fa-bookmark padding-right-25rem'></i> Catagories</a></li><li class="list-horizontal left padding-left-15 padding-right-15"><a class=padding-topnav href=https://blog.stderr.at/tags><i class='fas fa-tags padding-right-25rem'></i> Tags</a></li><li class="list-horizontal left padding-left-15 padding-right-15"><a class=padding-topnav href=https://blog.stderr.at/archive><i class='fas fa-box padding-right-25rem'></i> History</a></li><li class="list-horizontal right padding-left-15 padding-right-15"><a class=padding-topnav href=https://charts.stderr.at/><svg class="list-horizontal padding-right-25rem" fill="#d2d2d2" width="28" height="28" viewBox="0 0 256 297" class="mr-3 h-7 w-7 fill-current text-omega-500"><path d="m60.349 70.537-.811-.767a77.726 77.726.0 01-.278-.266c-7.589-7.29-13.462-15.721-17.01-25.685-.951-2.673-1.68-5.397-1.621-8.262l.012-.375c.012-.285.011-.571.031-.856.268-3.877 2.863-5.836 6.652-4.918 1.195.31 2.351.753 3.447 1.321 4.007 2.01 7.297 4.948 10.317 8.185l.312.336a67.685 67.685.0 0113.066 20.108c.068.177.146.35.234.518a.308.308.0 00.061.074l.212.181.064.057a106.079 106.079.0 0148.733-14.954l-.043-.218-.112-.585a11.87 11.87.0 00-.073-.35l-.041-.17a67.666 67.666.0 01-1.596-22.23 50.571 50.571.0 012.674-13.09 18.838 18.838.0 013.294-6.118 9.436 9.436.0 011.902-1.697 4.226 4.226.0 014.832-.034 10.393 10.393.0 013.513 4.049 31.912 31.912.0 013.165 8.828 67.672 67.672.0 011.277 19.852 57.502 57.502.0 01-2.1 11.976c.714.132 1.428.258 2.14.382l3.2.552c2.481.43 4.946.88 7.38 1.458a112.29 112.29.0 0112.296 3.611c4.059 1.49 8.03 3.211 11.891 5.155 2.227 1.11 4.39 2.346 6.564 3.612l1.866 1.09c.936.548 1.877 1.096 2.829 1.637l.08-.163.178-.354c.06-.125.118-.254.167-.387a65.359 65.359.0 0119.79-28.128 22.711 22.711.0 017.11-4.14c.717-.25 1.46-.42 2.213-.508 3.768-.431 5.35 1.94 5.628 4.771a18.011 18.011.0 01-.465 6.228 52.875 52.875.0 01-6.147 14.357l-.308.493c-3.982 6.435-8.69 12.247-14.633 16.98l-.46.362a2.62 2.62.0 00-.12.1l-.192.177-.24.228-.098.09a106.935 106.935.0 0115.996 18.576 6.594 6.594.0 01-1.016.179c-6.373.01-12.746-.011-19.12.028a2.408 2.408.0 01-1.908-1.017 88.947 88.947.0 00-53.039-27.999 86.23 86.23.0 00-17.453-.75l-.76.047a88.064 88.064.0 00-49.207 18.785l-.44.349a84.25 84.25.0 00-10.21 9.529 2.844 2.844.0 01-2.324 1.057 1482.46 1482.46.0 00-10.958-.026l-8.6.005c.029-.111.077-.245.144-.398l.09-.193a7.07 7.07.0 01.107-.211l.123-.23.14-.245.157-.262.171-.277.186-.292.306-.464.337-.493.241-.343.384-.535.134-.183.419-.564.292-.386.302-.394.472-.604.491-.616.338-.418.346-.42.352-.425.36-.426.365-.428.558-.644.378-.43.382-.428.386-.426.39-.425c1.896-2.049 3.859-4.036 5.86-6.045l2.013-2.019c.675-.677 1.353-1.36 2.033-2.052zm155.187 136.407a106.248 106.248.0 01-14.42 16.339l1.12.933a65.151 65.151.0 0120.26 28.96 20.823 20.823.0 011.325 8.673 8.954 8.954.0 01-.363 1.95l-.087.271a4.335 4.335.0 01-4.907 3.021 13.373 13.373.0 01-4.067-1.206 30.816 30.816.0 01-5.523-3.498 64.717 64.717.0 01-19.627-27.589l-.262-.713-.357-.922a117.082 117.082.0 01-15.045 8.426 109.274 109.274.0 01-16.052 5.85 112.816 112.816.0 01-17.025 3.24l.078.41.07.373c.023.12.047.234.073.348l.042.168a65.667 65.667.0 011.787 21.92 48.604 48.604.0 01-2.66 13.52 47.067 47.067.0 01-2.505 5.26 8.054 8.054.0 01-1.407 1.788c-2.394 2.471-5.253 2.492-7.586-.045a16.409 16.409.0 01-2.35-3.379c-1.85-3.474-2.803-7.252-3.483-11.104a70.293 70.293.0 01-.818-15.918 56.83 56.83.0 011.568-10.873l.167-.667c.085-.32.162-.644.224-.969a.292.292.0 00-.015-.132l-.067-.23a3.701 3.701.0 01-.021-.082A105.937 105.937.0 0174.9 236.033l-.56 1.24-.102.231a66.452 66.452.0 01-18.164 24.56l-.423.355a22.954 22.954.0 01-7.247 4.186 7.272 7.272.0 01-3.919.42 4.282 4.282.0 01-3.19-2.55l-.06-.15c-.783-1.894-.718-3.859-.478-5.815l.067-.51a33.355 33.355.0 012.59-8.572 67.669 67.669.0 0115.947-22.714l.556-.52c.093-.086.184-.173.275-.262.086-.124.16-.256.22-.394A107.611 107.611.0 0143.287 206.7l.19-.017.65-.062c.193-.018.369-.03.545-.03 5.06-.005 10.12.009 15.179-.008l3.794-.018a2.83 2.83.0 012.228.978 88.388 88.388.0 0023.1 17.07l.6.304a84.178 84.178.0 0029.898 8.887c28.343 2.755 52.723-5.838 73.142-25.777a4.599 4.599.0 013.605-1.47c2.947.036 5.896.044 8.844.042l5.896-.01 2.949-.002h1.523l.106.356zm-26.342-90.316c.373.0.742.006 1.109.013l1.093.022c.724.013 1.439.015 2.148-.026l.531-.039c1.802-.163 3.091.481 4.405 1.692 6.323 5.826 12.7 11.592 19.071 17.364l3.966 3.595.45.4.675.595.799-.68c.171-.147.339-.293.503-.443a19230.8 19230.8.0 0023.608-21.525 3.277 3.277.0 012.362-.995l.167.005c1.21.049 2.422.045 3.66.036l1.498-.011c.252-.002.506-.003.761-.003v63.38a.948.948.0 01-.097.021l-.14.02-.18.02-.22.02-.255.017-.447.026-.897.037-1.06.032-1.188.025-1.817.025-1.639.01-1.653.002-1.082-.005-1.3-.013-.978-.015-.686-.015-.637-.017-.762-.028-.496-.024-.424-.027-.239-.02-.2-.02a4.685 4.685.0 01-.087-.012l-.141-.022v-32.098l-.323-.153-16.383 14.942-16.516-14.879-.316.116-.007 2.679v29.509h-16.497c-.016-.053-.031-.251-.046-.58l-.017-.455-.017-.575-.024-1.076-.023-1.314-.03-2.093-.033-3.101-.047-5.884-.032-5.84-.027-7.156-.017-8.245-.002-5.379.009-6.732.013-3.813.023-4.033.025-2.81.025-1.825.022-1.095.015-.588.017-.47.018-.345c.003-.046.006-.088.01-.124zm-152.24.073h16.398c.013.042.026.18.039.406l.018.404.018.53.016.652.025 1.19.036 2.508.027 2.424.028 3.479.037 6.391.017 4.372.018 8.267.003 5.583-.006 6.347-.01 4.294-.02 4.749-.022 3.515-.035 3.555-.02 1.461-.014.844-.016.732-.017.616-.017.494-.018.365c-.01.15-.02.25-.03.295H36.996a277.08 277.08.0 01-.048-6.9l.009-3.445-.001-1.722-.004-1.707-.002-3.422.003-6.924H16.63v23.904a1.2 1.2.0 01-.116.027l-.162.026-.205.024-.383.035-.303.021-.706.04-.61.025-.904.03-.737.02-1.043.02-1.66.022-1.716.01H6.66l-1.384-.009-1.551-.022-.939-.02-.84-.027-.553-.024-.329-.017-.293-.019-.367-.03a7.294 7.294.0 01-.103-.011l-.172-.023a1.687 1.687.0 01-.128-.024v-63.324h16.564v22.37a.972.972.0 00.096.02l.138.021.177.02.336.028.415.026.665.033.576.022.635.02 1.423.036 1.864.032 1.135.014 1.761.014 1.789.006 2.343-.005 1.395-.01 1.308-.017 1.193-.022 1.05-.028.88-.035.433-.023.357-.026.192-.02a.93.93.0 00.08-.009l.133-.02.012-4.084.003-1.375.002-2.853-.002-14.142zm36.054 63.45v-63.262c.03-.01.09-.02.18-.028l.22-.018.14-.01.525-.025.682-.025.826-.024 1.308-.029 1.52-.027 1.704-.025 4.374-.046 2.123-.016 5.002-.026 3.952-.01 4.384.002 3.563.012 2.737.019 1.99.022 1.67.028.567.013.732.021.58.024.296.017.22.018.08.01v13.482c-.528.038-1.073.11-1.619.111l-9.63.007-11.413-.002v10.487h20.058v13.95h-19.88a3.407 3.407.0 00-.078.448l-.03.255-.026.294-.037.505-.023.375-.03.615-.026.666-.027.951-.016.747-.01.764-.008 1.028.003 1.264.008.73.009.467.01.45.021.632.026.573.02.345.022.311.025.274.014.122c.508.035 1.052.102 1.597.103l9.63.007 11.415-.002v13.426h-39.38zm58.17.024a5.015 5.015.0 01-.035-.479l-.016-.437-.015-.562-.014-.68-.02-1.231-.018-1.466-.03-3.56-.02-3.516-.019-5.581-.01-7.949.006-10.192.022-8.11.03-6.587.03-4.327.03-3.08.026-2.056.014-.877.022-1.109.016-.594.016-.472.017-.343c.009-.138.017-.226.026-.26h16.338v46.775l.503.03.46.028.431.023c.14.005.279.009.417.009l9.701.005 11.45-.001v16.6h-39.358z"/></svg> Helm Charts</a></li></ul></section><div class=sub-top-nav><div id=breadcrumbs class="display-inline float-unset" itemscope itemtype=http://schema.org/BreadcrumbList><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"><p class=hide>&nbsp;navi</p></i></a></span><span id=toc-menu><i class="fas fa-list-alt"><span class=hidden-toc>navigation</span></i></span>
<span class=links><span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/><span itemprop=name>YAUB Yet Another Useless Blog</span><meta itemprop=position content='1'></a></span> > <span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/openshift/><span itemprop=name>OpenShift</span><meta itemprop=position content='2'></a></span> > Secrets Management - Vault on OpenShift</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#_hashicorp_vault>HashiCorp Vault</a></li><li><a href=#_installing_vault>Installing Vault</a></li><li><a href=#_raft_storage>Raft Storage</a></li><li><a href=#_initialize_and_unseal_vault>Initialize and Unseal Vault</a></li><li><a href=#_verify_vault_cluster>Verify Vault Cluster</a></li><li><a href=#_configure_kubernetes_authentication>Configure Kubernetes Authentication</a></li><li><a href=#_configure_a_secret>Configure a Secret</a></li><li><a href=#_configuring_policies>Configuring policies</a></li><li><a href=#_lets_start_an_application>Let’s start an Application</a></li><li><a href=#_tip_using_vault_cli_on_your_local_environment>TIP: Using vault CLI on your local environment</a></li><li><a href=#_thanks>Thanks</a></li></ul></nav></div></div><div class=social><a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2022%2f08%2fsecrets-management-vault-on-openshift%2f" class="facebook no-highlight" aria-label="share on Facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-facebook" width="24" height="24" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a href="https://twitter.com/intent/tweet?hashtags=codingnconcepts&amp;url=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2022%2f08%2fsecrets-management-vault-on-openshift%2f&amp;text=Secrets%20Management%20-%20Vault%20on%20OpenShift" class="twitter no-highlight" aria-label="share on Twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-x" width="100" height="100" viewBox="0 0 30 30"><path d="M26.37 26l-8.795-12.822.015.012L25.52 4h-2.65l-6.46 7.48L11.28 4H4.33l8.211 11.971L12.54 15.97 3.88 26h2.65l7.182-8.322L19.42 26h6.95zM10.23 6l12.34 18h-2.1L8.12 6h2.11z"/></svg></div></div></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2022%2f08%2fsecrets-management-vault-on-openshift%2f&amp;source=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2022%2f08%2fsecrets-management-vault-on-openshift%2f&amp;title=Secrets%20Management%20-%20Vault%20on%20OpenShift&amp;summary=Secrets%20Management%20-%20Vault%20on%20OpenShift" class="linkedin no-highlight" aria-label="share on Linkedin"><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg></div></div></a><a href="whatsapp://send?text=Secrets%20Management%20-%20Vault%20on%20OpenShift%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0aSecrets%20Management%20with%20HashiCorp%20Vault%0a%0ahttps%3a%2f%2fblog.stderr.at%2fopenshift%2f2022%2f08%2fsecrets-management-vault-on-openshift%2f%0a" class="whatsapp no-highlight" aria-label="share on Whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-whatsapp" width="24" height="24" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a><a href="mailto:?subject=TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more - Secrets%20Management%20-%20Vault%20on%20OpenShift.&amp;body=Secrets%20Management%20-%20Vault%20on%20OpenShift%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0aSecrets%20Management%20with%20HashiCorp%20Vault%0a%0ahttps%3a%2f%2fblog.stderr.at%2fopenshift%2f2022%2f08%2fsecrets-management-vault-on-openshift%2f%0a" class="email no-highlight" aria-label="share on Email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg></div></div></a><a href=/rss/ class="rss no-highlight" aria-label=RSS><div class="resp-sharing-button resp-sharing-button--rss resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 455.731 455.731"><g><rect x="0" y="0" style="fill:transparent" width="455.731" height="455.731"/><g><path style="" d="M296.208 159.16C234.445 97.397 152.266 63.382 64.81 63.382v64.348c70.268.0 136.288 27.321 185.898 76.931 49.609 49.61 76.931 115.63 76.931 185.898h64.348C391.986 303.103 357.971 220.923 296.208 159.16z"/><path style="" d="M64.143 172.273v64.348c84.881.0 153.938 69.056 153.938 153.939h64.348c0-120.364-97.922-218.287-218.286-218.287z"/><circle style="" cx="109.833" cy="346.26" r="46.088"/></g></g></svg></div></div></a></div></div></div></header><div id=head-tags><div class=tags><a class=tag-link href=/tags/ocp>OCP</a>
<a class=tag-link href=/tags/day-2>Day-2</a>
<a class=tag-link href=/tags/openshift>OpenShift</a>
<a class=tag-link href=/tags/vault>Vault</a>
<a class=tag-link href=/tags/secrets>Secrets</a></div></div><div id=body-inner><h1 class="gradient-header article">Secrets Management - Vault on OpenShift</h1><div class="catagories tracked"><a id=textElement class="category-link no-highlight" href=/categories/openshift>OpenShift</a>
<a id=textElement class="category-link no-highlight" href=/categories/security>Security</a></div><p class=tracked><time class="f6 mv4 dib tracked" datetime=2022-08-16T00:00:00Z><strong>August 16, 2022</strong>
</time><span class=divider>-
</span><span class=author><a href=/authors/thomas-jungbauer><img class=avatar src=/img/authors/thomas-jungbauer.png alt="Thomas Jungbauer">
Thomas Jungbauer
</a>( Lastmod: 2024-05-08 )
</span><span class=divider>-
</span><span class=readtime><strong>10 min read</strong></span></p><div class=paragraph><p>Sensitive information in OpenShift or Kubernetes is stored as a so-called Secret. The management of these Secrets is one of the most important questions,
when it comes to OpenShift. Secrets in Kubernetes are encoded in base64. This is <strong>not</strong> an encryption format.
Even if etcd is encrypted at rest, everybody can decode a given base64 string which is stored in the Secret.</p></div><div class=paragraph><p>For example: The string <code>Thomas</code> encoded as base64 is <code>VGhvbWFzCg==</code>. This is simply a masked plain text and it is not secure to share these values, especially not on Git.
To make your CI/CD pipelines or Gitops process secure, you need to think of a secure way to manage your Secrets. Thus, your Secret objects must be encrypted somehow. HashiCorp Vault is one option to achieve this requirement.</p></div><div class=sect1><h2 id=_hashicorp_vault>HashiCorp Vault</h2><div class=sectionbody><div class=paragraph><p>HashiCorp Vault is a solution to solve our Secret management problem. It stores and encrypts our sensitive information at rest and in transit and enables you to create fine grained access
controls (ACL). This defines who has access to a specific secret. Application A should only get access to secret A and so on. However, that is just the tip of the iceberg. Vault can do much more.
If you are interested in further details, check out the introduction video by Armon, the Co-Founder of Hashicorp Vault at: <a href="https://learn.hashicorp.com/tutorials/vault/getting-started-intro?in=vault/getting-started" class=bare>https://learn.hashicorp.com/tutorials/vault/getting-started-intro?in=vault/getting-started</a></p></div><div class=paragraph><p>For this article we will keep it simple and cover:</p></div><div class=ulist><ul><li><p>Installing HashiCorp Vault to OpenShift</p></li><li><p>Integrating the plugin "Kubernetes Authentication" to access the Secrets</p></li><li><p>Accessing a static secret stored in HashiCorp Vault by an example application</p></li></ul></div></div></div><div class=sect1><h2 id=_installing_vault>Installing Vault</h2><div class=sectionbody><div class=paragraph><p>The easiest way to install Vault is by using the supported Helm chart.</p></div><div class=paragraph><p>Add the Helm repository to your repo:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>helm repo add hashicorp https://helm.releases.hashicorp.com</code></pre></div></div><div class=paragraph><p>Update the repository to get the latest updates.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>helm repo update</code></pre></div></div><div class=paragraph><p>Before we install Vault, we need to create a values file to set certain variables. Let’s create a file called "overwrite-values.yaml" with the following content</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>global:
  openshift: true

server:
  ha:
    enabled: true
    replicas: 3
    raft:
      enabled: true</code></pre></div></div><div class=paragraph><p>This will tell HashiCorp Vault the environment we are going to install is (OpenShift), enables high availability with 3 replicas and enables RAFT (see below for some introduction).</p></div><div class=paragraph><p>Finally, let us deploy HashiCorp Vault into the namespace <strong>vault</strong> using the values file we have created in the previous step:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>helm upgrade --install vault hashicorp/vault --values bootstrap/vault/overwrite-values.yaml --namespace=vault --create-namespace</code></pre></div></div><div class=paragraph><p>This will start the agent-injector and 3 vault-pods:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc get pods -n vault

NAME                                    READY   STATUS    RESTARTS   AGE
vault-0                                 0/1     Running   0          36s
vault-1                                 0/1     Running   0          36s
vault-2                                 0/1     Running   0          36s
vault-agent-injector-74c848f67b-sq4dq   1/1     Running   0          37s</code></pre></div></div><div class=ulist><ul><li><p>vault agent injector: detecting applications with annotations that require vault agent which will get injected</p></li><li><p>vault-0: vault server</p></li></ul></div><div class=paragraph><p>The vault servers remain in <strong>not-ready</strong> state until Vault has been unsealed by you.</p></div><div class=paragraph><p>When you check the logs of one of the pods you will see:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc logs vault-0 -n vault
...
2022-08-11T12:31:22.497Z [INFO]  core: security barrier not initialized
2022-08-11T12:31:22.497Z [INFO]  core: seal configuration missing, not initialized</code></pre></div></div><div class=paragraph><p>Vault always starts uninitialized and sealed, to protect the secrets. You need to give at least three different unseal-keys in order to be able to use Vault.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>Vault’s seal mechanism uses <a href=https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing target=_blank rel=noopener>Shamir’s secret sharing</a>. This is a manual process to secure the cluster if it restarts. You can use auto-unseal for specific cloud providers to bypass the manual requirement.</td></tr></tbody></table></div></div></div><div class=sect1><h2 id=_raft_storage>Raft Storage</h2><div class=sectionbody><div class=paragraph><p>During the deployment we have enabled Raft which is the integrated HA storage for Vault. Vault can use several different styles of storage backends, but when it comes to HA and Kubernetes, Raft is
easiest one since it has no other dependencies, and it is well known inside OpenShift. Etcd is using Raft as well. It is a distributed Consensus Algorithm where multiple members form a cluster and elect one leader. The leader has the responsibility to replicate everything to the followers. Since this leader election requires a majority an odd number of cluster members must be available to ensure there is a minimum number left if a member is failing.</p></div></div></div><div class=sect1><h2 id=_initialize_and_unseal_vault>Initialize and Unseal Vault</h2><div class=sectionbody><div class=paragraph><p>As mentioned, the Vault Pods are not fully available yet, since Vault it currently sealed and cannot be used. The first thing to do is to initialize and unseal it.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>The following commands will login into one Pod and execute commands from there.</td></tr></tbody></table></div><div class=paragraph><p>Let’s get the status of our Vault fist:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc -n vault exec -it vault-0 -- vault operator init -status</code></pre></div></div><div class=paragraph><p>This will return the message:
<code>Vault is not initialized</code></p></div><div class=paragraph><p>The following command will initialize Vault for further usage:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc exec -ti -n vault vault-0 -- vault operator init -format=json &gt; unseal.json</code></pre></div></div><div class=paragraph><p>This will create the file <strong>unseal.json</strong> locally on your machine. <strong>Keep this file secure</strong> It contains by default 5 key shards and the root token you will need to unseal Vault and authenticate as root.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content>Keep this file secure, it contains keys to unseal Vault and the root_token to authenticate against.</td></tr></tbody></table></div><div class=paragraph><p>Never share this file. It will look like this:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-json data-lang=json>{
  &#34;unseal_keys_b64&#34;: [
    &#34;key_1&#34;,
    &#34;key_2&#34;,
    &#34;key_3&#34;,
    &#34;key_4&#34;,
    &#34;key_5&#34;
  ],
  &#34;unseal_keys_hex&#34;: [
    &#34;key_hex_1&#34;,
    &#34;key_hex_2&#34;,
    &#34;key_hex_3&#34;,
    &#34;key_hex_4&#34;,
    &#34;key_hex_5&#34;
  ],
  &#34;unseal_shares&#34;: 5,
  &#34;unseal_threshold&#34;: 3,
  &#34;recovery_keys_b64&#34;: [],
  &#34;recovery_keys_hex&#34;: [],
  &#34;recovery_keys_shares&#34;: 5,
  &#34;recovery_keys_threshold&#34;: 3,
  &#34;root_token&#34;: &#34;root.token&#34;
}</code></pre></div></div><div class=paragraph><p>With the initialization in place Vault is put into a sealed mode. This means Vault cannot decrypt secrets at this moment.
To unseal Vault you need the unseal key, which is split into multiple shards using <a href=https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing target=_blank rel=noopener>Shamir’s secret sharing</a>. A certain number of individual shards (default 3) must be provided to reconstruct the unseal key.</p></div><div class=paragraph><p>To unseal Vault lets login to our Pod "vault-0" and unseal it. Use the following command and provide one of the keys:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc exec -ti -n vault vault-0 -- vault operator unseal

Unseal Key (will be hidden):
Key                Value
---                -----
Seal Type          shamir
Initialized        true <i class=conum data-value=1></i><b>(1)</b>
Sealed             true <i class=conum data-value=2></i><b>(2)</b>
Total Shares       5
Threshold          3
Unseal Progress    1/3 <i class=conum data-value=3></i><b>(3)</b>
Unseal Nonce       08b01535-be15-e865-251c-f948ed0661c9
Version            1.11.2
Build Date         2022-07-29T09:48:47Z
Storage Type       raft
HA Enabled         true</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Vault is initialized</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Vault is still sealed</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>The unseal progress: Currently 1 out of 3 keys have been provided</td></tr></tbody></table></div><div class=paragraph><p>Use the same command another 2 times using <strong>different</strong> keys to complete the unseal process:</p></div><div class=paragraph><p>At the end the following output should be shown:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>Unseal Key (will be hidden):
Key                     Value
---                     -----
Seal Type               shamir
Initialized             true
Sealed                  false <i class=conum data-value=1></i><b>(1)</b>
Total Shares            5
Threshold               3
Version                 1.11.2
Build Date              2022-07-29T09:48:47Z
Storage Type            raft
Cluster Name            vault-cluster-f7402e5b <i class=conum data-value=2></i><b>(2)</b>
Cluster ID              aff648f0-b3a2-1fdd-12f6-492842b08b2b
HA Enabled              true
HA Cluster              https://vault-0.vault-internal:8201
HA Mode                 active <i class=conum data-value=3></i><b>(3)</b>
Active Since            2022-08-16T07:20:45.828215961Z
Raft Committed Index    36
Raft Applied Index      36</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Vault is now unsealed</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Name of our cluster</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>High availability is enabled</td></tr></tbody></table></div><div class=paragraph><p><strong>Vault-0</strong> is now initialized, but there are 2 other members in our HA cluster which must be added.
Let <strong>vault-1</strong> and <strong>vault-2</strong> join the cluster and perform the same unseal process as previously: use 3 different keys:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc exec -ti vault-1 -n vault -- vault operator raft join http://vault-0.vault-internal:8200

# 3 times....
oc exec -ti vault-1 -n vault -- vault operator unseal

oc exec -ti vault-2 -n vault -- vault operator raft join http://vault-0.vault-internal:8200

# 3 times...
oc exec -ti vault-2 -n vault -- vault operator unseal</code></pre></div></div></div></div><div class=sect1><h2 id=_verify_vault_cluster>Verify Vault Cluster</h2><div class=sectionbody><div class=paragraph><p>To verify if the Raft cluster has successfully been initialized, run the following.</p></div><div class=paragraph><p>First, login using the <strong>root_token</strong>, that was created above, on the vault-0 pod.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc exec -ti vault-0 -n vault -- vault login

Token (will be hidden): &lt;root_token&gt;</code></pre></div></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc exec -ti vault-0 -n vault -- vault operator raft list-peers</code></pre></div></div><div class=paragraph><p>This should return:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>Node                                    Address                        State       Voter
----                                    -------                        -----       -----
16ec7490-f621-42ea-976d-5f054cfaeecc    vault-0.vault-internal:8201    leader      true
60ba2885-432a-c7d3-d280-a824f0acce42    vault-1.vault-internal:8201    follower    true
bcc4f551-79bc-47e5-d01b-97fc12d1afa5    vault-2.vault-internal:8201    follower    true</code></pre></div></div><div class=paragraph><p>As you can see Vault-0 is the leader while the other two members are followers.</p></div></div></div><div class=sect1><h2 id=_configure_kubernetes_authentication>Configure Kubernetes Authentication</h2><div class=sectionbody><div class=paragraph><p>There are multiple ways how an application can interact with Vault. One example is to use Tokens. This is quite easy but has the disadvantage that it does require additional steps of managing the life cycle of such token, moreover they might be shared, which is not what we want.</p></div><div class=paragraph><p>HashiCorp Vault supports different authentication methods. One of which is the <strong>Kubernetes Auth Method</strong> that must be enabled before we can use.
The Kubernetes Auth Method makes use of Jason Web Tokens (JWT)s that are bound to a Service Account. When we tell Vault that a Service Account is fine to authenticate, then a Deployment using this account is able to authenticate and
request Secrets.</p></div><div class=paragraph><p>Vault has a plugin ecosystem, which allows to enable certain plugins. To enable <strong>Kubernetes Auth Method</strong> use the following process:</p></div><div class="olist arabic"><ol class=arabic><li><p>Login vault-0 pods
<code>oc exec -it vault-0 -n vault — /bin/sh</code></p></li><li><p>execute the command:
<code>vault auth enable kubernetes</code> which returns:
<em>Success! Enabled kubernetes auth method at: kubernetes/</em></p></li><li><p>Set up the Kubernetes configuration to use Vault’s service account JWT.</p></li></ol></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>the address to the OpenShift API (KUBERNETES_PORT_443_TCP_ADDR) is automatically available via an environment variable.</td></tr></tbody></table></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>vault write auth/kubernetes/config issuer=&#34;&#34; \
 	token_reviewer_jwt=&#34;$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)&#34; \
 	kubernetes_host=&#34;https://$KUBERNETES_PORT_443_TCP_ADDR:443&#34; \
 	kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt

Success! Data written to: auth/kubernetes/config</code></pre></div></div><div class=paragraph><p>With this step authentication against OpenShift is enabled.</p></div></div></div><div class=sect1><h2 id=_configure_a_secret>Configure a Secret</h2><div class=sectionbody><div class=paragraph><p>With the Kubernetes Auth Method in place we can configure a secret to test our setup. We will use an example application called <strong>expenses</strong> that has a MySQL database.
The static password to bootstrap this database shall be stored in Vault. A plugin called <strong>key-value secrets</strong> engine will be used to achieve this.</p></div><div class=paragraph><p>There are other plugins that are specifically designed to automatically rotate secrets. For example, it is possible to dynamically create user credentials für MySQL.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>You can list available engines by using the command: <code>oc -n vault exec -it vault-0 — vault secrets list</code></td></tr></tbody></table></div><div class=paragraph><p>There are currently two versions of this key/value engine:</p></div><div class=ulist><ul><li><p>KV Version 1: does not versionize the key/values, thus updates will overwrite the old values.</p></li><li><p>KV Version 2: does versionize the key/value pairs</p></li></ul></div><div class=paragraph><p>In our example we will use version 2.</p></div><div class=paragraph><p>Like the authentication method, we need to enable the secrets engine:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc -n vault exec -it vault-0 -- vault secrets enable \
  -path=expense/static \ <i class=conum data-value=1></i><b>(1)</b>
  -version=2 \ <i class=conum data-value=2></i><b>(2)</b>
  kv <i class=conum data-value=3></i><b>(3)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>API path where our secrets are stored</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Version 2</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>name of our engine</td></tr></tbody></table></div><div class=paragraph><p>You can list the enabled engines with the following command:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc -n vault exec -it vault-0 -- vault secrets list

Path                Type         Accessor              Description
----                ----         --------              -----------
cubbyhole/          cubbyhole    cubbyhole_f1e955f9    per-token private secret storage
expense/static/    kv           kv_6db09e5d           n/a
identity/           identity     identity_ca05e6ab     identity store <i class=conum data-value=1></i><b>(1)</b>
sys/                system       system_e34a76c3       system endpoints used for control, policy and debugging</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Enabled KV secrets engine using the path <strong>expense/static/</strong></td></tr></tbody></table></div><div class=paragraph><p>Now lets put a secret into our store. We will store our super-secure MySQL password into <strong>expense/static/mysql</strong></p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>MYSQL_DB_PASSWORD=mysuperpassword$

oc -n vault exec -it vault-0 -- vault kv put expense/static/mysql db_login_password=${MYSQL_DB_PASSWORD}</code></pre></div></div><div class=paragraph><p>This command will store the key <strong>db_login_password</strong> with the database as value. We can get the secret by calling:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc -n vault exec -it vault-0 -- vault kv get expense/static/mysql

====== Secret Path ======
expense/static/data/mysql <i class=conum data-value=1></i><b>(1)</b>

======= Metadata =======
Key                Value
---                -----
created_time       2022-08-17T06:08:05.839663508Z
custom_metadata    &lt;nil&gt;
deletion_time      n/a
destroyed          false
version            1

========== Data ==========
Key                  Value
---                  -----
db_login_password    mysuperpassword$ <i class=conum data-value=2></i><b>(2)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>The data path of our secret</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>our password</td></tr></tbody></table></div></div></div><div class=sect1><h2 id=_configuring_policies>Configuring policies</h2><div class=sectionbody><div class=paragraph><p>The Secret is now stored at <strong>expense/static/mysql</strong> but there is no policy in place. Everybody who is authenticated and is calling this path will get to see the secrets.
Luckily, one or more policies can be assigned to the authentication method. A policy defines capabilities that allow you to perform certain actions.</p></div><div class=paragraph><p>The following capabilities are known:</p></div><div class=ulist><ul><li><p><strong>create</strong> - to create new data</p></li><li><p><strong>read</strong> - to read data</p></li><li><p><strong>delete</strong> - to delete data</p></li><li><p><strong>list</strong> - to list data</p></li></ul></div><div class=paragraph><p>Policies can be written either in JSON or HCL (HashiCorp Configuration Language). Let’s create a file with the following content:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-json data-lang=json>path &#34;expense/static/data/mysql&#34; {
  capabilities = [&#34;read&#34;, &#34;list&#34;]
}</code></pre></div></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content>KV Version2 stores the secrets in a path with the prefix <code>data/</code></td></tr></tbody></table></div><div class=paragraph><p>This will limit my access to <strong>read</strong> and <strong>list</strong> only.</p></div><div class=paragraph><p>Write the policy:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>cat my-policy.hcl | oc -n vault exec -it vault-0 -- vault policy write expense-db-mysql -</code></pre></div></div><div class=paragraph><p>Next, we are going to bind the Vault secret to a service account and a namespace. Both objects will be created later, when we deploy the application.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc -n vault exec -it vault-0 -- vault write auth/kubernetes/role/expense-db-mysql \ <i class=conum data-value=1></i><b>(1)</b>
bound_service_account_names=expense-db-mysql \ <i class=conum data-value=2></i><b>(2)</b>
bound_service_account_namespaces=expenses \ <i class=conum data-value=3></i><b>(3)</b>
policies=expense-db-mysql \ <i class=conum data-value=4></i><b>(4)</b>
ttl=1h <i class=conum data-value=5></i><b>(5)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Path or our new role</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Name of the service account we will create and that will be used by the application</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Name of the namespace we will create</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Name of the policy we created earlier</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>The token is valid for 1 hour, after this period the service account must re-authenticate</td></tr></tbody></table></div></div></div><div class=sect1><h2 id=_lets_start_an_application>Let’s start an Application</h2><div class=sectionbody><div class=paragraph><p>Now we will create our MySQL application into the namespace <strong>expenses</strong>. Use the following command to create the namespace and the application containing the objects Deployment, ServiceAccount (expense-db-mysql) and Service.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>See at the <a href=https://raw.githubusercontent.com/joatmon08/vault-argocd/part-1/database/deployment.yaml target=_blank rel=noopener>Github Page</a> for a full yaml specification of the three objects.</td></tr></tbody></table></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc new-project expenses

oc apply -f https://raw.githubusercontent.com/joatmon08/vault-argocd/part-1/database/deployment.yaml</code></pre></div></div><div class=paragraph><p>The deployment will start a Pod with a sidecar container <strong>vault-agent</strong>. This sidecar is automatically created and must not be defined inside the Deployment specification.
Instead, some annotations in the Deployment define what the container should be automatically injected and also where to find our secret:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>      annotations:
        vault.hashicorp.com/agent-inject: &#34;true&#34; <i class=conum data-value=1></i><b>(1)</b>
        vault.hashicorp.com/role: &#34;expense-db-mysql&#34; <i class=conum data-value=2></i><b>(2)</b>
        vault.hashicorp.com/agent-inject-secret-db: &#34;expense/static/data/mysql&#34; <i class=conum data-value=3></i><b>(3)</b>
        vault.hashicorp.com/agent-inject-template-db: | <i class=conum data-value=4></i><b>(4)</b>
          {{ with secret &#34;expense/static/data/mysql&#34; -}}
          export MYSQL_ROOT_PASSWORD=&#34;{{ .Data.data.db_login_password }}&#34;
          {{- end }}
    ...
    spec:
      serviceAccountName: expense-db-mysql <i class=conum data-value=5></i><b>(5)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Defines that the <strong>vault-agent</strong> side car container shall be automatically injected. This is the most important annotation.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Name of the role that was created created previously</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>The agent will inject the data from <strong>expense/static/data/mysql</strong> and stores it in a file <strong>db</strong> The file name is everything that comes after <strong>vault.hashicorp.com/agent-inject-secret-</strong></td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Configuration…​ the template that defines how the secret will be rendered</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>The service account name we bound our secret to, using the Consul language. In this case the MySQL password is simply exported</td></tr></tbody></table></div><div class=paragraph><p>The vault-agent is requesting the database password from Vault and provides it to the application where it is stored at <code>/vault/secrets/db</code></p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc -n expenses exec -it $(oc get pods -l=app=expense-db-mysql -o jsonpath=&#39;{.items[0].metadata.name}&#39;) -c expense-db-mysql -- cat /vault/secrets/db

# output
export MYSQL_ROOT_PASSWORD=&#34;mysuperpassword$&#34;</code></pre></div></div><div class=paragraph><p>The Deployment sources this file when it starts and MySQL will take this information to configure itself.</p></div></div></div><div class=sect1><h2 id=_tip_using_vault_cli_on_your_local_environment>TIP: Using vault CLI on your local environment</h2><div class=sectionbody><div class=paragraph><p>All above commands that are dealing with Vault commands, first login to a pod and then execure the commands from there.</p></div><div class=paragraph><p>If you have the <a href=https://www.vaultproject.io/docs/install target=_blank rel=noopener>Vault CLI</a> installed on your local machine, you can open a port forwarding to your Vault cluster at OpenShift and execute the commands locally:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc port-forward -n vault svc/vault 8200

export VAULT_ADDR=http://localhost:8200

vault login
...</code></pre></div></div></div></div><div class=sect1><h2 id=_thanks>Thanks</h2><div class=sectionbody><div class=paragraph><p>Thanks to the wonderful Rosemary Wang and her Github repository: <a href=https://github.com/joatmon08/vault-argocd/tree/part-1 class=bare>https://github.com/joatmon08/vault-argocd/tree/part-1</a></p></div><div class=paragraph><p>Also check out the Youtube Video: <a href="https://www.youtube.com/watch?v=Bce_0qa6ias" target=_blank rel=noopener>GitOps Guide to the Galaxy (Ep 31) | GitOps With Vault Part 1</a> in which Rosemary and Christian discuss this setup</p></div></div></div><hr class=related><div class=related-content><h3>See Also:</h3><ul><li class=related><a href=/gitopscollection/2025-07-17-common-template-application/>Reusable Argo CD Application Helm Template</a>
&ndash;
<time datetime=2025-07-17T00:00:00+0000><i>Jul 17, 2025</i></time><br><small><p class=related>When working with Argo CD at scale, you often find yourself creating similar Application manifests repeatedly. Each application needs the same basic structure but with different configurations for source repositories, destinations, and sync policies. Additionally, managing namespace metadata becomes tricky when you need to conditionally control whether Argo CD should manage namespace metadata based on sync options.
In this article, I’ll walk you through a reusable Helm template that solves these challenges by providing a flexible, DRY (Don’t Repeat Yourself) approach to creating Argo CD Applications. This template is available in my public Helm Chart library and can easily be used by anyone.</p></small></li><li class=related><a href=/openshift/2025/06/cert-manager-policy-approver-in-openshift/>Cert-Manager Policy Approver in OpenShift</a>
&ndash;
<time datetime=2025-06-03T00:00:00+0000><i>Jun 3, 2025</i></time><br><small><p class=related>One of the most commonly deployed operators in OpenShift environments is the Cert-Manager Operator. It automates the management of TLS certificates for applications running within the cluster, including their issuance and renewal.
The tool supports a variety of certificate issuers by default, including ACME, Vault, and self-signed certificates. Whenever a certificate is needed, Cert-Manager will automatically create a CertificateRequest resource that contains the details of the certificate. This resource is then processed by the appropriate issuer to generate the actual TLS certificate. The approval process in this case is usually fully automated, meaning that the certificate is issued without any manual intervention.
But what if you want to have more control? What if certificate issuance must follow strict organizational policies, such as requiring a specifc country code or organization name? This is where the CertificateRequestPolicy resource, a resource provided by the Approver Policy, comes into play.
This article walks through configuring the Cert-Manager Approver Policy in OpenShift to enforce granular policies on certificate requests.</p></small></li><li class=related><a href=/openshift/2025/05/single-log-out-from-keycloak-and-openshift/>Single log out from Keycloak and OpenShift</a>
&ndash;
<time datetime=2025-05-22T00:00:00+0000><i>May 22, 2025</i></time><br><small><p class=related>The following 1-minute article is a follow-up to my previous article about how to use Keycloak as an authentication provider for OpenShift. In this article, I will show you how to configure Keycloak and OpenShift for Single Log Out (SLO). This means that when you log out from Keycloak, you will also be logged out from OpenShift automatically. This requires some additional configuration in Keycloak and OpenShift, but it is not too complicated.</p></small></li><li class=related><a href=/openshift/2025/05/step-by-step-using-keycloak-authentication-in-openshift/>Step by Step - Using Keycloak Authentication in OpenShift</a>
&ndash;
<time datetime=2025-05-17T00:00:00+0000><i>May 17, 2025</i></time><br><small><p class=related>I was recently asked about how to use Keycloak as an authentication provider for OpenShift. How to install Keycloak using the Operator and how to configure Keycloak and OpenShift so that users can log in to OpenShift using OpenID. I have to admit that the exact steps are not easy to find, so I decided to write a blog post about it, describing each step in detail. This time I will not use GitOps, but the OpenShift and Keycloak Web Console to show the steps, because before we put it into GitOps, we need to understand what is actually happening.
This article tries to explain every step required so that a user can authenticate to OpenShift using Keycloak as an Identity Provider (IDP) and that Groups from Keycloak are imported into OpenShift. This article does not cover a production grade installation of Keycloak, but only a test installation, so you can see how it works. For production, you might want to consider a proper database (maybe external, but at least with a backup), high availability, etc.).</p></small></li><li class=related><a href=/gitopscollection/2025-04-17-applicationset-defining-namespaces/>Using ApplicationSet with Matrix Generator and define individual Namespaces</a>
&ndash;
<time datetime=2025-04-17T00:00:00+0000><i>Apr 17, 2025</i></time><br><small><p class=related>During my day-to-day business, I am discussing the following setup with many customers: Configure App-of-Apps. Here I try to explain how I use an ApplicationSet that watches over a folder in Git and automatically adds a new Argo CD Application whenever a new folder is found. This works great, but there is a catch: The ApplicationSet uses the same Namespace default for all Applications. This is not always desired, especially when you have different teams working on different Applications.
Recently I was asked by the customer if this can be fixed and if it is possible to define different Namespaces for each Application. The answer is yes, and I would like to show you how to do this.</p></small></li></ul></div><footer class=footline></footer></div></div><div id=navigation-bottom><a class="readme-a margin-right-5 margin-bottom-2 inline-flex relative no-highlight" href=/openshift/2022/11/using-serversideapply-with-argocd/ title="Using ServerSideApply with ArgoCD"><div class="w-100 h-100 readmore-btn transition-transform hover:translate-x-2 hover:translate-y-2"><i class="fa fa-chevron-left btn-bottom-prev"></i>
<span class=btn-bottom-text></span> Using ServerSideApply with ArgoCD</div><div class="absolute w-100 h-100 top-2 left-2 to-beta from-alpha via-alpha btn-gradient-background"></div></a><a class="readme-a inline-flex relative no-highlight" href=/openshift/2022/04/overview-of-red-hats-multi-cloud-gateway-noobaa/ title="Overview of Red Hat's Multi Cloud Gateway (Noobaa)" style=margin-right:0><div class="w-100 h-100 readmore-btn transition-transform hover:translate-x-2 hover:translate-y-2"><i class="fa fa-chevron-right btn-bottom-next"></i>
<span class=btn-bottom-text></span> Overview of Red Hat's Multi Cloud Gateway (Noobaa)</div><div class="absolute w-100 h-100 top-2 left-2 to-beta from-alpha via-alpha btn-gradient-background"></div></a></div><div class=copyright><p>Copyright &copy; 2020 - 2025 Toni Schmidbauer & Thomas Jungbauer</p></div></section><script>(function(){$("document").ready(function(){var s=$(".read-progress").waypoint({handler:function(e){e=="down"?($(".read-progress").addClass("position-fixed"),$(".read-progress").css("top",0)):($(".read-progress").removeClass("position-fixed"),$(".read-progress").css("top"))}}),t=$(window).height(),e=$(".post-content").height();$(window).on("scroll",n),$(window).on("resize",function(){t=$(window).height(),e=$(".post-content").height(),n()});function n(){var s=$(this).scrollTop(),o=$(".post-content").offset().top,i=e-(e-(t-(o-s))),n=i/e*100,n=n>100?100:n;$(".read-progress").width(n+"%")}})})()</script><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1752853235></script><script src=/js/perfect-scrollbar.jquery.min.js?1752853235></script><script src=/js/jquery.sticky.js?1752853235></script><script src=/js/featherlight.min.js?1752853235></script><script src=/js/highlight.pack.js?1752853235></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1752853235></script><script src=/js/learn.js?1752853235></script><script src=/js/hugo-learn.js?1752853235></script><script src=/js/yaub.js?1752853235></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.getAttribute("id");e.intersectionRatio>0&&(clearActiveStatesInTableOfContents(),document.querySelector(`aside nav li a[href="#${t}"]`).parentElement.classList.add("active"))})});document.querySelectorAll("h1[id],h2[id],h3[id]").forEach(t=>{e.observe(t)})});function clearActiveStatesInTableOfContents(){document.querySelectorAll("aside nav li").forEach(e=>{e.classList.remove("active")})}</script><script type=text/javascript>function scrollTopAnimated(){$("html, body").animate({scrollTop:"0"},500)}</script><script>function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}$(".article-box").click(function(){return window.location=$(this).attr("href"),$this.stopPropagation(),!1})</script><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll("a.category-link");e.forEach(function(e){var t=e.textContent.trim().toLowerCase();t==="openshift"&&e.classList.add("openshift"),t==="compliance"&&e.classList.add("compliance"),t==="service mesh"&&e.classList.add("mesh"),t==="security"&&e.classList.add("security"),t==="other"&&e.classList.add("other"),t==="ansible"&&e.classList.add("ansible"),t==="supply chain"&&e.classList.add("cicd"),t==="gitops"&&e.classList.add("gitops"),t==="advanced cluster security"&&e.classList.add("acs")})})</script></body></html>