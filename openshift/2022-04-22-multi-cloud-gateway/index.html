<!doctype html><html lang=en class="js csstransforms3d"><head><meta name=google-site-verification content="yq2Ib3doJVHVlEW2wtHap5WY54JhS2CCvI40y30F0FI"><meta charset=utf-8><meta name=color-scheme content="dark light"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.101.0"><meta name=description content="TechBlog about OpenShift/Ansible/Satellite and much more"><meta name=author content="Toni Schmidbauer & Thomas Jungbauer"><meta name=keywords content><link rel=canonical href=https://blog.stderr.at/openshift/2022-04-22-multi-cloud-gateway/><link rel=icon href=/images/favicon.ico type=image/png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-180x180.png><link rel=apple-touch-icon sizes=128x128 href=/images/apple-touch-icon-128x128.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-touch-icon-72x72.png><link rel=apple-touch-icon href=/images/apple-touch-icon-57x57.png><link rel="shortcut icon" href=/images/favicon.ico><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><title>Overview of Red Hat's Multi Cloud Gateway (Noobaa) :: TechBlog about OpenShift/Ansible/Satellite and much more</title><link rel=manifest href=/manifest.json><meta name=theme-color content="#317EFB"><link href=/css/nucleus.min.css?1714202728 rel=stylesheet><link href=/css/fontawesome-all.min.css?1714202728 rel=stylesheet><link href=/css/font-awesome-animation.min.css?1714202728 rel=stylesheet><link href=/css/hybrid.css?1714202728 rel=stylesheet><link href=/css/featherlight.min.css?1714202728 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1714202728 rel=stylesheet><link href=/css/auto-complete.css?1714202728 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1714202728 rel=stylesheet><link href=/css/theme.min.css?1714202728 rel=stylesheet><link href=/css/hugo-theme.css?1714202728 rel=stylesheet><link href=/css/theme-yaub.css?1714202728 rel=stylesheet><script src=/js/jquery-3.6.0.min.js?1714202728></script>
<script src=/js/jquery.waypoints.min.js?1714202728></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/openshift/2022-04-22-multi-cloud-gateway/><button onclick=scrollTopAnimated() id=myBtn class="top-btn button fa fa-arrow-up" title="Go to top"></button>
<span class=read-progress></span><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><p class="fa fa-cloud-upload-alt faa-float animated"></p><span class=text>YAUB</span><p class=logoarea><span class="text small">Yet another Useless Blog</span></p></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1714202728></script>
<script type=text/javascript src=/js/auto-complete.js?1714202728></script>
<script type=text/javascript>var baseurl="https://blog.stderr.at/"</script><script type=text/javascript src=/js/search.js?1714202728></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/gitopscollection/ title="GitOps Episodes" class=dd-item><a href=/gitopscollection/>GitOps Episodes</a><ul><li data-nav-id=/gitopscollection/2024-04-25-installing-compliance-operator/ title="Setup & Configure Compliance Operator using GitOps" class=dd-item><a href=/gitopscollection/2024-04-25-installing-compliance-operator/>Setup & Configure Compliance Operator using GitOps</a></li><li data-nav-id=/gitopscollection/2024-04-02-configure_app_of_apps/ title="Configure App-of-Apps" class=dd-item><a href=/gitopscollection/2024-04-02-configure_app_of_apps/>Configure App-of-Apps</a></li><li data-nav-id=/gitopscollection/2024-02-02-setup-argocd/ title="Setup OpenShift GitOps/Argo CD" class=dd-item><a href=/gitopscollection/2024-02-02-setup-argocd/>Setup OpenShift GitOps/Argo CD</a></li><li data-nav-id=/gitopscollection/2023-12-28-gitops-repostructure/ title="GitOps - Choosing the right Git repository structure" class=dd-item><a href=/gitopscollection/2023-12-28-gitops-repostructure/>GitOps - Choosing the right Git repository structure</a></li><li data-nav-id=/gitopscollection/2023-12-11-gitops-intro/ title="Introducing the GitOps Approach" class=dd-item><a href=/gitopscollection/2023-12-11-gitops-intro/>Introducing the GitOps Approach</a></li></ul></li><li data-nav-id=/openshift/ title=OpenShift class="dd-item
parent"><a href=/openshift/>OpenShift</a><ul><li data-nav-id=/openshift/2024-02-12-bucket-data-retention/ title="OpenShift Data Foundation - Noobaa Bucket Data Retention (Lifecycle)" class=dd-item><a href=/openshift/2024-02-12-bucket-data-retention/>OpenShift Data Foundation - Noobaa Bucket Data Retention (Lifecycle)</a></li><li data-nav-id=/openshift/2023-11-26-running-falco/ title="Running Falco on OpenShift 4.12" class=dd-item><a href=/openshift/2023-11-26-running-falco/>Running Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023-11-03-quay-deployment-with-gitops/ title="Quay Deployment and Configuration using GitOps" class=dd-item><a href=/openshift/2023-11-03-quay-deployment-with-gitops/>Quay Deployment and Configuration using GitOps</a></li><li data-nav-id=/openshift/2023-10-23-openshift-falco/ title="Setting up Falco on OpenShift 4.12" class=dd-item><a href=/openshift/2023-10-23-openshift-falco/>Setting up Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023-10-18-force-machineconfig-rollout/ title="How to force a MachineConfig rollout" class=dd-item><a href=/openshift/2023-10-18-force-machineconfig-rollout/>How to force a MachineConfig rollout</a></li><li data-nav-id=/openshift/2023-03-20-operator-installation-with-argocd/ title="Operator installation with Argo CD" class=dd-item><a href=/openshift/2023-03-20-operator-installation-with-argocd/>Operator installation with Argo CD</a></li><li data-nav-id=/openshift/2023-02-16-ssl-certificate-management/ title="SSL Certificate Management for OpenShift on AWS" class=dd-item><a href=/openshift/2023-02-16-ssl-certificate-management/>SSL Certificate Management for OpenShift on AWS</a></li><li data-nav-id=/openshift/2022-11-04-argocd-and-serversideapply/ title="Using ServerSideApply with ArgoCD" class=dd-item><a href=/openshift/2022-11-04-argocd-and-serversideapply/>Using ServerSideApply with ArgoCD</a></li><li data-nav-id=/openshift/2022-08-16-hashicorp-vault/ title="Secrets Management - Vault on OpenShift" class=dd-item><a href=/openshift/2022-08-16-hashicorp-vault/>Secrets Management - Vault on OpenShift</a></li><li data-nav-id=/openshift/2022-04-22-multi-cloud-gateway/ title="Overview of Red Hat's Multi Cloud Gateway (Noobaa)" class="dd-item active"><a href=/openshift/2022-04-22-multi-cloud-gateway/>Overview of Red Hat's Multi Cloud Gateway (Noobaa)</a></li><li data-nav-id=/openshift/2021-09-25-sealed_secrets/ title="Secure your secrets with Sealed Secrets" class=dd-item><a href=/openshift/2021-09-25-sealed_secrets/>Secure your secrets with Sealed Secrets</a></li><li data-nav-id=/openshift/2021-02-27-understanding-block-devices/ title="Understanding RWO block device handling in OpenShift" class=dd-item><a href=/openshift/2021-02-27-understanding-block-devices/>Understanding RWO block device handling in OpenShift</a></li><li data-nav-id=/openshift/2021-01-27-writingoperatoransible/ title="Writing Operator using Ansible" class=dd-item><a href=/openshift/2021-01-27-writingoperatoransible/>Writing Operator using Ansible</a></li><li data-nav-id=/openshift/2020-12-10-thanos-vs-thanos/ title="Thanos Querier vs Thanos Querier" class=dd-item><a href=/openshift/2020-12-10-thanos-vs-thanos/>Thanos Querier vs Thanos Querier</a></li><li data-nav-id=/openshift/2020-08-06-argocd/ title="GitOps - Argo CD" class=dd-item><a href=/openshift/2020-08-06-argocd/>GitOps - Argo CD</a></li><li data-nav-id=/openshift/2020-04-16-tekton/ title="OpenShift Pipelines - Tekton Introduction" class=dd-item><a href=/openshift/2020-04-16-tekton/>OpenShift Pipelines - Tekton Introduction</a></li><li data-nav-id=/openshift/2020-04-01-oc-commands/ title="Helpful oc / kubectl commands" class=dd-item><a href=/openshift/2020-04-01-oc-commands/>Helpful oc / kubectl commands</a></li></ul></li><li data-nav-id=/day-2/ title="OpenShift Day-2" class=dd-item><a href=/day-2/>OpenShift Day-2</a><ul><li data-nav-id=/day-2/etcd/ title=etcd class=dd-item><a href=/day-2/etcd/>etcd</a><ul><li data-nav-id=/day-2/etcd/2022-01-29-automatedetcdbackup/ title="Automated ETCD Backup" class=dd-item><a href=/day-2/etcd/2022-01-29-automatedetcdbackup/>Automated ETCD Backup</a></li></ul></li><li data-nav-id=/day-2/labels_environmets/ title="Labels & Environments" class=dd-item><a href=/day-2/labels_environmets/>Labels & Environments</a><ul><li data-nav-id=/day-2/labels_environmets/2022-01-12-creatingenvironment/ title="Working with Environments" class=dd-item><a href=/day-2/labels_environmets/2022-01-12-creatingenvironment/>Working with Environments</a></li></ul></li><li data-nav-id=/day-2/pod-placement/ title="Pod Placement" class=dd-item><a href=/day-2/pod-placement/>Pod Placement</a><ul><li data-nav-id=/day-2/pod-placement/2021-08-26-podplacement-intro/ title=Introduction class=dd-item><a href=/day-2/pod-placement/2021-08-26-podplacement-intro/>Introduction</a></li><li data-nav-id=/day-2/pod-placement/2021-08-29-node-affinity/ title="Node Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-29-node-affinity/>Node Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-27-podplacement/ title=NodeSelector class=dd-item><a href=/day-2/pod-placement/2021-08-27-podplacement/>NodeSelector</a></li><li data-nav-id=/day-2/pod-placement/2021-08-28-affinity/ title="Pod Affinity/Anti-Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-28-affinity/>Pod Affinity/Anti-Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-30-taints/ title="Taints and Tolerations" class=dd-item><a href=/day-2/pod-placement/2021-08-30-taints/>Taints and Tolerations</a></li><li data-nav-id=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/ title="Topology Spread Constraints" class=dd-item><a href=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/>Topology Spread Constraints</a></li><li data-nav-id=/day-2/pod-placement/2021-09-01-descheduler/ title="Using Descheduler" class=dd-item><a href=/day-2/pod-placement/2021-09-01-descheduler/>Using Descheduler</a></li></ul></li></ul></li><li data-nav-id=/securesupplychain/ title="Secure Supply Chain" class=dd-item><a href=/securesupplychain/>Secure Supply Chain</a><ul><li data-nav-id=/securesupplychain/2023-06-15-securesupplychain-intro/ title="Introduction to a Secure Supply Chain" class=dd-item><a href=/securesupplychain/2023-06-15-securesupplychain-intro/>Introduction to a Secure Supply Chain</a></li><li data-nav-id=/securesupplychain/2023-06-16-securesupplychain-step1/ title="Step 1 - Listen to Events" class=dd-item><a href=/securesupplychain/2023-06-16-securesupplychain-step1/>Step 1 - Listen to Events</a></li><li data-nav-id=/securesupplychain/2023-06-17-securesupplychain-step2/ title="Step 2 - Pipelines" class=dd-item><a href=/securesupplychain/2023-06-17-securesupplychain-step2/>Step 2 - Pipelines</a></li><li data-nav-id=/securesupplychain/2023-06-18-securesupplychain-step3/ title="Step 3 - SonarQube" class=dd-item><a href=/securesupplychain/2023-06-18-securesupplychain-step3/>Step 3 - SonarQube</a></li><li data-nav-id=/securesupplychain/2023-06-19-securesupplychain-step4/ title="Step 4 - Verify Git Commit" class=dd-item><a href=/securesupplychain/2023-06-19-securesupplychain-step4/>Step 4 - Verify Git Commit</a></li><li data-nav-id=/securesupplychain/2023-06-20-securesupplychain-step5/ title="Step 5 - Build and Sign Image" class=dd-item><a href=/securesupplychain/2023-06-20-securesupplychain-step5/>Step 5 - Build and Sign Image</a></li><li data-nav-id=/securesupplychain/2023-06-21-securesupplychain-step6/ title="Step 6 - Scanning with ACS" class=dd-item><a href=/securesupplychain/2023-06-21-securesupplychain-step6/>Step 6 - Scanning with ACS</a></li><li data-nav-id=/securesupplychain/2023-06-22-securesupplychain-step7/ title="Step 7 - Generating a SBOM" class=dd-item><a href=/securesupplychain/2023-06-22-securesupplychain-step7/>Step 7 - Generating a SBOM</a></li><li data-nav-id=/securesupplychain/2023-06-23-securesupplychain-step8/ title="Step 8 - Updating Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-23-securesupplychain-step8/>Step 8 - Updating Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-24-securesupplychain-step9/ title="Step 9 - Linting Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-24-securesupplychain-step9/>Step 9 - Linting Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-25-securesupplychain-step10/ title="Step 10 - The Example Application" class=dd-item><a href=/securesupplychain/2023-06-25-securesupplychain-step10/>Step 10 - The Example Application</a></li><li data-nav-id=/securesupplychain/2023-06-26-securesupplychain-step11/ title="Step 11 - ACS Deployment Check" class=dd-item><a href=/securesupplychain/2023-06-26-securesupplychain-step11/>Step 11 - ACS Deployment Check</a></li><li data-nav-id=/securesupplychain/2023-06-27-securesupplychain-step12/ title="Step 12 - Verify TLog Signature" class=dd-item><a href=/securesupplychain/2023-06-27-securesupplychain-step12/>Step 12 - Verify TLog Signature</a></li><li data-nav-id=/securesupplychain/2023-06-28-securesupplychain-step13/ title="Step 13 - Bring it to Production" class=dd-item><a href=/securesupplychain/2023-06-28-securesupplychain-step13/>Step 13 - Bring it to Production</a></li></ul></li><li data-nav-id=/compliance/ title=Compliance class=dd-item><a href=/compliance/>Compliance</a><ul><li data-nav-id=/compliance/2021/07/oc-compliance-command-line-plugin/ title="oc compliance command line plugin" class=dd-item><a href=/compliance/2021/07/oc-compliance-command-line-plugin/>oc compliance command line plugin</a></li><li data-nav-id=/compliance/2021/07/compliance-operator/ title="Compliance Operator" class=dd-item><a href=/compliance/2021/07/compliance-operator/>Compliance Operator</a></li></ul></li><li data-nav-id=/service-mesh/ title="Service Mesh" class=dd-item><a href=/service-mesh/>Service Mesh</a><ul><li data-nav-id=/service-mesh/2020/05/enable-automatic-route-creation/ title="Enable Automatic Route Creation" class=dd-item><a href=/service-mesh/2020/05/enable-automatic-route-creation/>Enable Automatic Route Creation</a></li><li data-nav-id=/service-mesh/2020/05/authorization-rbac/ title="Authorization (RBAC)" class=dd-item><a href=/service-mesh/2020/05/authorization-rbac/>Authorization (RBAC)</a></li><li data-nav-id=/service-mesh/2020/04/deploy-example-bookinfo-application/ title="Deploy Example Bookinfo Application" class=dd-item><a href=/service-mesh/2020/04/deploy-example-bookinfo-application/>Deploy Example Bookinfo Application</a></li><li data-nav-id=/service-mesh/2020/04/service-mesh-1.1-released/ title="Service Mesh 1.1 released" class=dd-item><a href=/service-mesh/2020/04/service-mesh-1.1-released/>Service Mesh 1.1 released</a></li><li data-nav-id=/service-mesh/2020/04/authentication-jwt/ title="Authentication JWT" class=dd-item><a href=/service-mesh/2020/04/authentication-jwt/>Authentication JWT</a></li><li data-nav-id=/service-mesh/2020/04/mutual-tls-authentication/ title="Mutual TLS Authentication" class=dd-item><a href=/service-mesh/2020/04/mutual-tls-authentication/>Mutual TLS Authentication</a></li><li data-nav-id=/service-mesh/2020/04/fault-injection/ title="Fault Injection" class=dd-item><a href=/service-mesh/2020/04/fault-injection/>Fault Injection</a></li><li data-nav-id=/service-mesh/2020/04/limit-egress/external-traffic/ title="Limit Egress/External Traffic" class=dd-item><a href=/service-mesh/2020/04/limit-egress/external-traffic/>Limit Egress/External Traffic</a></li><li data-nav-id=/service-mesh/2020/04/advanced-routing-example/ title="Advanced Routing Example" class=dd-item><a href=/service-mesh/2020/04/advanced-routing-example/>Advanced Routing Example</a></li><li data-nav-id=/service-mesh/2020/04/routing-example/ title="Routing Example" class=dd-item><a href=/service-mesh/2020/04/routing-example/>Routing Example</a></li><li data-nav-id=/service-mesh/2020/03/ingress-with-custom-domain/ title="Ingress with custom domain" class=dd-item><a href=/service-mesh/2020/03/ingress-with-custom-domain/>Ingress with custom domain</a></li><li data-nav-id=/service-mesh/2020/03/ingress-traffic/ title="Ingress Traffic" class=dd-item><a href=/service-mesh/2020/03/ingress-traffic/>Ingress Traffic</a></li><li data-nav-id=/service-mesh/2020/03/deploy-microservices/ title="Deploy Microservices" class=dd-item><a href=/service-mesh/2020/03/deploy-microservices/>Deploy Microservices</a></li><li data-nav-id=/service-mesh/2020/03/installation/ title=Installation class=dd-item><a href=/service-mesh/2020/03/installation/>Installation</a></li></ul></li><li data-nav-id=/general/ title=General class=dd-item><a href=/general/>General</a><ul><li data-nav-id=/general/2020/05/basic-usage-of-git/ title="Basic usage of git" class=dd-item><a href=/general/2020/05/basic-usage-of-git/>Basic usage of git</a></li><li data-nav-id=/general/2020/04/red-hat-satellite-cheat-sheet/ title="Red Hat Satellite Cheat Sheet" class=dd-item><a href=/general/2020/04/red-hat-satellite-cheat-sheet/>Red Hat Satellite Cheat Sheet</a></li></ul></li><li data-nav-id=/ansible/ title=Ansible class=dd-item><a href=/ansible/>Ansible</a><ul><li data-nav-id=/ansible/2021/11/ansible-style-guide/ title="Ansible Style Guide" class=dd-item><a href=/ansible/2021/11/ansible-style-guide/>Ansible Style Guide</a></li><li data-nav-id=/ansible/2021/10/automation-controller-and-ldap-authentication/ title="Automation Controller and LDAP Authentication" class=dd-item><a href=/ansible/2021/10/automation-controller-and-ldap-authentication/>Automation Controller and LDAP Authentication</a></li><li data-nav-id=/ansible/2021/07/ansible-tower-and-downloading-collections/ title="Ansible Tower and downloading collections" class=dd-item><a href=/ansible/2021/07/ansible-tower-and-downloading-collections/>Ansible Tower and downloading collections</a></li><li data-nav-id=/ansible/2020/04/ansible-azure-resource-manager-example/ title="Ansible - Azure Resource Manager Example" class=dd-item><a href=/ansible/2020/04/ansible-azure-resource-manager-example/>Ansible - Azure Resource Manager Example</a></li><li data-nav-id=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/ title="DO410 Ansible and Ansible Tower training notes" class=dd-item><a href=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/>DO410 Ansible and Ansible Tower training notes</a></li></ul></li><li data-nav-id=/acs/ title="Advanced Cluster Security" class=dd-item><a href=/acs/>Advanced Cluster Security</a><ul><li data-nav-id=/acs/2021-12-11-acsauth/ title="Advanced Cluster Security - Authentication" class=dd-item><a href=/acs/2021-12-11-acsauth/>Advanced Cluster Security - Authentication</a></li></ul></li><li data-nav-id=/azure/ title=Azure class=dd-item><a href=/azure/>Azure</a><ul><li data-nav-id=/azure/2021-10-29-private-aro/ title="Stumbling into Azure Part II: Setting up a private ARO cluster" class=dd-item><a href=/azure/2021-10-29-private-aro/>Stumbling into Azure Part II: Setting up a private ARO cluster</a></li><li data-nav-id=/azure/2021-10-17-s2s-vpn/ title="Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing" class=dd-item><a href=/azure/2021-10-17-s2s-vpn/>Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing</a></li></ul></li><li data-nav-id=/java/ title=Java class=dd-item><a href=/java/>Java</a><ul><li data-nav-id=/java/2022-02-25-jpa-disconnected-entity/ title="Adventures in Java Land: JPA disconnected entities" class=dd-item><a href=/java/2022-02-25-jpa-disconnected-entity/>Adventures in Java Land: JPA disconnected entities</a></li></ul></li><li data-nav-id=/quay/ title=Quay class=dd-item><a href=/quay/>Quay</a><ul><li data-nav-id=/quay/2021-09-07-quay-upgrade-3.4/ title="Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator" class=dd-item><a href=/quay/2021-09-07-quay-upgrade-3.4/>Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator</a></li><li data-nav-id=/quay/2020-05-13-quay-tutorial1/ title="Red Hat Quay Registry - Overview and Installation" class=dd-item><a href=/quay/2020-05-13-quay-tutorial1/>Red Hat Quay Registry - Overview and Installation</a></li></ul></li><li data-nav-id=/legaldisclosure/ title="Legal Disclosure" class=dd-item><a href=/legaldisclosure/>Legal Disclosure</a></li><li data-nav-id=/rss/ title="RSS Feeds" class=dd-item><a href=/rss/>RSS Feeds</a></li></ul><section id=shortcuts><h3 class=shortcut-title>More</h3><ul><li><a class=padding href=https://blog.stderr.at/tags><i class='fas fa-tags'></i> Tags</a></li><li><a class=padding href=https://blog.stderr.at/categories><i class='far fa-bookmark'></i> Catagories</a></li><li><a class=padding href=https://blog.stderr.at/archive><i class='fas fa-box'></i> Archive</a></li><li><a class=padding href=https://charts.stderr.at/><i class='fas fa-book'></i> Helm Charts</a></li><li><a class=padding href=https://www.redhat.com><i class='fab fa-redhat'></i> Red Hat</a></li></ul></section><section id=footer></section></div></nav><section id=body class=post-content><div id=overlay></div><aside id=toc-field class="hidden lg:block tableOfContentContainer"><header id=TableOfContentsHeader>What's on this Page</header><nav id=TableOfContents><ul><li><a href=#headline-1>Overview</a></li><li><a href=#headline-2>Setup</a></li><li><a href=#headline-3>Command line interface</a></li><li><a href=#headline-4>Resources</a></li><li><a href=#headline-5>Buckets</a><ul><li><a href=#headline-6>Required K8s objects</a></li><li><a href=#headline-7>BucketClass</a></li><li><a href=#headline-8>StorageClass</a></li><li><a href=#headline-9>ObjectBucketClaim</a></li></ul></li></ul></nav><div id=navigation><a class=nav-prev href=/openshift/2022-08-16-hashicorp-vault/ title="Secrets Management - Vault on OpenShift"><i class="fa fa-chevron-left"></i></a>
<a class=nav-next href=/openshift/2021-09-25-sealed_secrets/ title="Secure your secrets with Sealed Secrets" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></aside><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://schema.org/BreadcrumbList><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/><span itemprop=name>YAUB Yet Another Useless Blog</span><meta itemprop=position content="1"></a></span>> <span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/openshift/><span itemprop=name>OpenShift</span><meta itemprop=position content="2"></a></span>> Overview of Red Hat's Multi Cloud Gateway (Noobaa)</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#headline-1>Overview</a></li><li><a href=#headline-2>Setup</a></li><li><a href=#headline-3>Command line interface</a></li><li><a href=#headline-4>Resources</a></li><li><a href=#headline-5>Buckets</a><ul><li><a href=#headline-6>Required K8s objects</a></li><li><a href=#headline-7>BucketClass</a></li><li><a href=#headline-8>StorageClass</a></li><li><a href=#headline-9>ObjectBucketClaim</a></li></ul></li></ul></nav></div></div><div class=social><a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2022-04-22-multi-cloud-gateway%2f" class="facebook no-highlight" aria-label="share on Facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-facebook" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a href="https://twitter.com/intent/tweet?hashtags=codingnconcepts&url=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2022-04-22-multi-cloud-gateway%2f&text=Overview%20of%20Red%20Hat%27s%20Multi%20Cloud%20Gateway%20%28Noobaa%29" class="twitter no-highlight" aria-label="share on Twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5.0-78.8 35.3-78.8 78.8.0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3C20 26 16.1 39.6 16.1 54c0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1.0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4.0-12.6-.4-18.8-1.1C34.9 299 76.3 312 120.8 312c144.9.0 224.1-120 224.1-224.1.0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg></div></div></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2022-04-22-multi-cloud-gateway%2f&source=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2022-04-22-multi-cloud-gateway%2f&title=Overview%20of%20Red%20Hat%27s%20Multi%20Cloud%20Gateway%20%28Noobaa%29&summary=Overview%20of%20Red%20Hat%27s%20Multi%20Cloud%20Gateway%20%28Noobaa%29" class="linkedin no-highlight" aria-label="share on Linkedin"><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg></div></div></a><a href="whatsapp://send?text=Overview%20of%20Red%20Hat%27s%20Multi%20Cloud%20Gateway%20%28Noobaa%29%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0a%3cnil%3e%0a%0ahttps%3a%2f%2fblog.stderr.at%2fopenshift%2f2022-04-22-multi-cloud-gateway%2f%0a" class="whatsapp no-highlight" aria-label="share on Whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-whatsapp" width="24" height="24" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a><a href="mailto:?subject=TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more - Overview%20of%20Red%20Hat%27s%20Multi%20Cloud%20Gateway%20%28Noobaa%29.&body=Overview%20of%20Red%20Hat%27s%20Multi%20Cloud%20Gateway%20%28Noobaa%29%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0a%3cnil%3e%0a%0ahttps%3a%2f%2fblog.stderr.at%2fopenshift%2f2022-04-22-multi-cloud-gateway%2f%0a" class="email no-highlight" aria-label="share on Email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg></div></div></a></div></div></div><div id=head-tags></div><div id=body-inner><h1>Overview of Red Hat's Multi Cloud Gateway (Noobaa)</h1><p class=tracked><time class="f6 mv4 dib tracked" datetime=2022-04-22T00:00:00Z><strong>April 22, 2022</strong></time>
- By:
Toni Schmidbauer
( Lastmod: 2022-05-02 ) - <span class=readtime><strong>5 min read</strong></span></p><p>This is my personal summary of experimenting with Red Hat's Multi
Cloud Gateway (MCG) based on the upstream <a href=https://www.noobaa.io/>Noobaa</a> project. MCG is part
of Red Hat's OpenShift Data Foundation (ODF). ODF bundles the upstream
projects <a href=https://ceph.io/en/>Ceph</a> and <a href=https://noobaa.io>Noobaa</a>.</p><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Overview</h2><div id=outline-text-headline-1 class=outline-text-2><p>Noobaa, or the Multicloud Gateway (MCG), is a S3 based data federation
tool. It allows you to use S3 backends from various sources and</p><ul><li>sync</li><li>replicate</li><li>or simply use existing</li></ul><p>S3 buckets. Currently the following sources, or backing stores are supported:</p><ul><li>AWS S3</li><li>Azure Blob</li><li>Google Cloud Storage</li><li><p>Any other S3 compatible storage, for example</p><ul><li>Ceph</li><li>Minio</li></ul></li></ul><p>Noobaa also supports using a local file system as a backing store for S3.</p><p>The main purpose is to provide a single API endpoint for applications
using various S3 backends.</p><p>One of the main features of Noobaa is the storage pipeline. With a
standard Noobaa S3 bucket, when storing a new Object Noobaa executes
the following steps:</p><ul><li>Chunking of the Object</li><li>De-duplication</li><li>Compression</li><li>and Encryption</li></ul><p>This means that data stored in public cloud S3 offerings is
automatically encrypted. Noobaa also supports using Hashicorp <a href=https://www.hashicorp.com/products/vault>Vault</a>
for storing and retrieving encryption keys.</p><p>If you need to skip the storage pipeline, Noobaa also supports
namespace buckets. For example these type of buckets allow you to
write directly to AWS S3 and retrieve Objects via Noobaa. Or it could
be used to migrate buckets from one cloud provider to another.</p><p>Noobaa also has support for triggering JavaScript based function when</p><ul><li>creating new objects</li><li>reading existing objects</li><li>deleting objects</li></ul></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Setup</h2><div id=outline-text-headline-2 class=outline-text-2><p>With OpenShift Plus or an OpenShift Data Foundation subscription you
can use the OpenShift Data Foundation Operator.</p><p>For testing Noobaa we used the standalone installation method
<span style=text-decoration:underline>without</span> setting up Ceph storage (see <a href=https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.10/html/deploying_openshift_data_foundation_using_amazon_web_services/deploy-standalone-multicloud-object-gateway>here</a>). OpenShift was running in
AWS for testing.</p><p>If you would like to use the upstream version you can use the Noobaa
operator (<a href=https://github.com/noobaa/noobaa-operator>https://github.com/noobaa/noobaa-operator</a>). This is what the
OpenShift Data Foundation (ODF) is using as well.</p></div></div><div id=outline-container-headline-3 class=outline-2><h2 id=headline-3>Command line interface</h2><div id=outline-text-headline-3 class=outline-text-2><p>Noobaa also comes with a command line interface <code>noobaa</code>. It's
available via an ODF subscription or can be installed separately. See
the noobaa-operator <a href=https://github.com/noobaa/noobaa-operator/blob/master/README.md>readme</a> for more information.</p></div></div><div id=outline-container-headline-4 class=outline-2><h2 id=headline-4>Resources</h2><div id=outline-text-headline-4 class=outline-text-2><p>Before using an S3 object store with Noobaa we need to create so
called <span style=text-decoration:underline>Resources</span>. This can be done via the Noobaa user interface or
via the command line. For example the following commands create a new
Resource using an AWS S3 bucket as a backing store</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># create an S3 bucket in eu-north-1</span>
</span></span><span style=display:flex><span>aws s3api create-bucket <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --region eu-north-1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --bucket tosmi-eu-north-1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --create-bucket-configuration LocationConstraint<span style=color:#f92672>=</span>eu-north-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create an S3 bucket in eu-north-1</span>
</span></span><span style=display:flex><span>aws s3api create-bucket <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --region eu-west-1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --bucket tosmi-eu-west-1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --create-bucket-configuration LocationConstraint<span style=color:#f92672>=</span>eu-west-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create Noobaa backing store using the tosmi-eu-north-1 bucket above</span>
</span></span><span style=display:flex><span>noobaa backingstore create aws-s3 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       --region eu-north-1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       --target-bucket tosmi-eu-north-1 aws-eu-north
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create Noobaa backing store using the tosmi-eu-west-1 bucket above</span>
</span></span><span style=display:flex><span>noobaa backingstore create aws-s3 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       --region eu-west-1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       --target-bucket tosmi-eu-west-1 aws-eu-west</span></span></code></pre></div></div><p>Or if we would like to use Azure blob</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># create two resource groups for storage</span>
</span></span><span style=display:flex><span>az group create --location northeurope -g mcg-northeurope
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create two storage accounts</span>
</span></span><span style=display:flex><span>az storage account create --name mcgnortheurope -g mcg-northeurope --location northeurope --sku Standard_LRS --kind StorageV2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create containers for storing blobs</span>
</span></span><span style=display:flex><span>az storage container create --account-name mcgnortheurope -n mcg-northeurope
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># list storage account keys for noobaa</span>
</span></span><span style=display:flex><span>az storage account list
</span></span><span style=display:flex><span>az storage account show -g mcg-northeurope -n mcgnortheurope
</span></span><span style=display:flex><span>az storage account keys list -g mcg-westeurope -n mcgwesteurope
</span></span><span style=display:flex><span>az storage account keys list -g mcg-northeurope -n mcgnortheurope
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>noobaa backingstore create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       azure-blob azure-northeurope <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       --account-key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;the key&gt;&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       --account-name<span style=color:#f92672>=</span>mcgnortheurope <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       --target-blob-container<span style=color:#f92672>=</span>mcg-northeurope</span></span></code></pre></div></div><p>Using</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>noobaa backingstore list</span></span></code></pre></div></div><p>we are able to confirm that our stores were created successfully.</p></div></div><div id=outline-container-headline-5 class=outline-2><h2 id=headline-5>Buckets</h2><div id=outline-text-headline-5 class=outline-text-2><p>After creating the backend stores we are able to create Buckets and define the
layout of backends.</p><p>There are two ways how to create buckets, either directly via the Noobaa UI,
or using Kubernetes (K8s) objects.</p><p>We will focus on using K8s objects in this post.</p><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Required K8s objects</h3><div id=outline-text-headline-6 class=outline-text-3><p>The Noobaa operator provides the following Custom Resource Definitions:</p><ul><li><code>BackingStore</code>: we already created <code>BackingStores</code> in the Resources
section</li><li><code>BucketClass</code>: a bucket class defines the layout of our bucket
(single, mirrored or tiered)</li><li><code>StorageClass</code>: a standard K8s <code>StorageClass</code> referencing the <code>BucketClass</code></li><li><code>ObjectBucketClaim</code>: A OBC or <code>ObjectBucketClaim</code> creates the bucket
for us in Noobaa. Additionally the Noobaa operator creates a
<code>ConfigMap</code> and a <code>Secret</code> with the same name as the Bucket, storing
access details (<code>ConfigMap</code>) and credentials (<code>Secret</code>) for accessing
the bucket.</li></ul></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>BucketClass</h3><div id=outline-text-headline-7 class=outline-text-3><p>Let's create a example <code>BucketClass</code> which mirrors objects between the
AWS S3 buckets eu-west-1 and eu-north-1.</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>noobaa.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>BucketClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>noobaa</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-mirrored-bucket-class</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>openshift-storage</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>placementPolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>tiers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>backingStores</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>aws-eu-north</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>aws-eu-west</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>placement</span>: <span style=color:#ae81ff>Mirror</span></span></span></code></pre></div></div><p>So we are defining a <code>BucketClass</code> <span style=text-decoration:underline>aws-mirrored-bucket-class</span> that
has the following placement policy:</p><ul><li>A single tier with one backing store</li><li><p>The backing store uses two AWS buckets</p><ul><li>aws-eu-north</li><li>aws-eu-west</li></ul></li><li>The placement policy is mirror, so all objects uploaded to buckets
using this <code>BucketClass</code> will be mirrored between <span style=text-decoration:underline>aws-eu-north</span> and
<span style=text-decoration:underline>aws-eu-west</span>.</li></ul><p>A <code>BucketClass</code> could have multiple tiers, moving cold data
transparently to a lower tier, but let's keep this simple.</p></div></div><div id=outline-container-headline-8 class=outline-3><h3 id=headline-8>StorageClass</h3><div id=outline-text-headline-8 class=outline-text-3><p>After creating our <code>BucketClass</code> we are now able to define a standard
K8s <code>StorageClass</code>:</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>storage.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StorageClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Provides Mirrored Object Bucket Claims (OBCs) in AWS</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-mirrored-openshift-storage.noobaa.io</span>
</span></span><span style=display:flex><span><span style=color:#f92672>parameters</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>bucketclass</span>: <span style=color:#ae81ff>aws-mirrored-bucket-class</span>
</span></span><span style=display:flex><span><span style=color:#f92672>provisioner</span>: <span style=color:#ae81ff>openshift-storage.noobaa.io/obc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>reclaimPolicy</span>: <span style=color:#ae81ff>Delete</span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumeBindingMode</span>: <span style=color:#ae81ff>Immediate</span></span></span></code></pre></div></div><p>This <code>StorageClass</code> uses our <code>BucketClass</code> <span style=text-decoration:underline>aws-mirrored-bucket-class</span>
as a backend. All buckets created leveraging this <code>StorageClass</code> will
mirror data between <span style=text-decoration:underline>aws-eu-north</span> and <span style=text-decoration:underline>aws-eu-west</span> (see the previous
chapter).</p></div></div><div id=outline-container-headline-9 class=outline-3><h3 id=headline-9>ObjectBucketClaim</h3><div id=outline-text-headline-9 class=outline-text-3><p>Finally we are able to create <code>ObjectBucketClaims</code> for projects
requiring object storage. An <code>ObjectBucketClaim</code> is similar to an
<code>PersistentVolumeClaim</code>. Every time a claim is created the Noobaa
operator will create a corresponding S3 bucket for us.</p><p>Let's start testing this out by creating a new OpenShift project</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>oc new-project obc-test</span></span></code></pre></div></div><p>Now we define a <code>ObjectBucketClaim</code> to create a new bucket for our application:</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>objectbucket.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ObjectBucketClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>noobaa</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-mirrored-claim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>generateBucketName</span>: <span style=color:#ae81ff>aws-mirrored</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>aws-mirrored-openshift-storage.noobaa.io</span></span></span></code></pre></div></div><p>We use the <code>StorageClass</code> created in the previous step. This will create</p><ul><li>a S3 Bucket in the requested <code>StorageClass</code></li><li>a <code>ConfigMap</code> storing access information</li><li>a <code>Secret</code> storing credentials for accessing the S3 Bucket</li></ul><p>For testing we will upload some data via <a href=https://s3tools.org/s3cmd><span style=text-decoration:underline>s3cmd</span></a> and use a pod to monitor
data within the bucket.</p><p>Let's do the upload with <span style=text-decoration:underline>s3cmd</span>, we need the following config file:</p><div class="src src-ini"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[default]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>check_ssl_certificate</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>False</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>check_ssl_hostname</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>False</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>access_key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&lt;access key&gt;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>secret_key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&lt;secret key&gt;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>host_base</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>s3-openshift-storage.apps.ocp.aws.tntinfra.net</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>host_bucket</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>%(bucket).s3-openshift-storage.apps.ocp.aws.tntinfra.net</span></span></span></code></pre></div></div><p>Of course you must change <span style=text-decoration:underline>host-base</span> according to your cluster
name. It's a route in the <span style=text-decoration:underline>openshift-storage</span> namespace:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>oc get route -n openshift-storage s3 -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.spec.host}&#39;</span></span></span></code></pre></div></div><p>You can extract the access and secret key from the
K8s secret via:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>oc extract secret/aws-mirrored-claim --to<span style=color:#f92672>=</span>-</span></span></code></pre></div></div><p>Copy the access key and the secret key to the s3 command config file
(we've called our config <span style=text-decoration:underline>noobaa-s3.cfg</span>). Now we can list all
available buckets via:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ s3cmd ls -c noobaa-s3.cfg
</span></span><span style=display:flex><span>2022-04-22 13:56  s3://aws-mirrored-c1087a17-5c84-4c62-9f36-29081a6cf5a4</span></span></code></pre></div></div><p>Now we are going to upload a sample file:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ s3cmd -c noobaa-s3.cfg put simple-aws-mirrored-obc.yaml s3://aws-mirrored-c1087a17-5c84-4c62-9f36-29081a6cf5a4
</span></span><span style=display:flex><span>upload: <span style=color:#e6db74>&#39;simple-aws-mirrored-obc.yaml&#39;</span> -&gt; <span style=color:#e6db74>&#39;s3://aws-mirrored-c1087a17-5c84-4c62-9f36-29081a6cf5a4/simple-aws-mirrored-obc.yaml&#39;</span>  <span style=color:#f92672>[</span><span style=color:#ae81ff>1</span> of 1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>226</span> of <span style=color:#ae81ff>226</span>   100% in    0s   638.18 B/s  <span style=color:#66d9ef>done</span></span></span></code></pre></div></div><p>We can also list available files via</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>s3cmd -c noobaa-s3.cfg ls s3://aws-mirrored-c1087a17-5c84-4c62-9f36-29081a6cf5a4
</span></span><span style=display:flex><span>2022-04-22 13:57          <span style=color:#ae81ff>226</span>  s3://aws-mirrored-c1087a17-5c84-4c62-9f36-29081a6cf5a4/simple-aws-mirrored-obc.yaml</span></span></code></pre></div></div><p>Our we could use a <code>Pod</code> to list available files from within
OpenShift. Note how we use the <code>ConfigMap</code> and the <code>Secret</code> the Noobaa
operater created for us, when we created the <code>ObjectBucketClaim</code>:</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>batch/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Job</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>s3-test-job</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>s3-pod</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>d3fk/s3cmd:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>s3-pod</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>BUCKET_NAME</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>configMapKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-mirrored-claim</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>BUCKET_NAME</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>BUCKET_HOST</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>configMapKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-mirrored-claim</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>BUCKET_HOST</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>BUCKET_PORT</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>configMapKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-mirrored-claim</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>BUCKET_PORT</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>AWS_ACCESS_KEY_ID</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-mirrored-claim</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>AWS_ACCESS_KEY_ID</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>AWS_SECRET_ACCESS_KEY</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-mirrored-claim</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>AWS_SECRET_ACCESS_KEY</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>/bin/sh</span>
</span></span><span style=display:flex><span>        - -<span style=color:#ae81ff>c</span>
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;s3cmd --host $BUCKET_HOST --host-bucket &#34;%(bucket).$BUCKET_HOST&#34; --no-check-certificate ls s3://$BUCKET_NAME&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Never</span></span></span></code></pre></div></div><p>That's all for now. If time allows we are going to write a follow up blog post on</p><ul><li>Replicating Buckets and</li><li>Functions</li></ul></div></div></div></div><footer class=footline></footer></div></div><div id=navigation-bottom><a class="nav-prev btn btn-default" href=/openshift/2022-08-16-hashicorp-vault/ title="Secrets Management - Vault on OpenShift"><i class="fa fa-chevron-left btn-bottom-prev"></i><span class=btn-bottom-text>Previous:</span> Secrets Management - Vault on OpenShift</a>
<a class="nav-next btn btn-default" href=/openshift/2021-09-25-sealed_secrets/ title="Secure your secrets with Sealed Secrets" style=margin-right:0><i class="fa fa-chevron-right btn-bottom-next"></i><span class=btn-bottom-text>Next:</span> Secure your secrets with Sealed Secrets</a></div><div class=copyright><p>Copyright &copy; 2020 - 2024 Toni Schmidbauer & Thomas Jungbauer</p><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn target=_blank rel="noopener noreferrer">Hugo Learn Theme</i></a> and <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a></p></div></section><script>(function(){$("document").ready(function(){var s=$(".read-progress").waypoint({handler:function(e){e=="down"?($(".read-progress").addClass("position-fixed"),$(".read-progress").css("top",0)):($(".read-progress").removeClass("position-fixed"),$(".read-progress").css("top"))}}),t=$(window).height(),e=$(".post-content").height();$(window).on("scroll",n),$(window).on("resize",function(){t=$(window).height(),e=$(".post-content").height(),n()});function n(){var s=$(this).scrollTop(),o=$(".post-content").offset().top,i=e-(e-(t-(o-s))),n=i/e*100,n=n>100?100:n;$(".read-progress").width(n+"%")}})})()</script><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1714202729></script>
<script src=/js/perfect-scrollbar.min.js?1714202729></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1714202729></script>
<script src=/js/jquery.sticky.js?1714202729></script>
<script src=/js/featherlight.min.js?1714202729></script>
<script src=/js/highlight.pack.js?1714202729></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1714202729></script>
<script src=/js/learn.js?1714202729></script>
<script src=/js/hugo-learn.js?1714202729></script>
<script src=/js/yaub.js?1714202729></script>
<script>window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.getAttribute("id");e.intersectionRatio>0&&(clearActiveStatesInTableOfContents(),document.querySelector(`aside nav li a[href="#${t}"]`).parentElement.classList.add("active"))})});document.querySelectorAll("h1[id],h2[id],h3[id]").forEach(t=>{e.observe(t)})});function clearActiveStatesInTableOfContents(){document.querySelectorAll("aside nav li").forEach(e=>{e.classList.remove("active")})}</script><script type=text/javascript>function scrollTopAnimated(){$("html, body").animate({scrollTop:"0"},500)}</script><script>function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}$(".summary-box").click(function(){return window.location=$(this).find("a").attr("href"),!1})</script></body></html>