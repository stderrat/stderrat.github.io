<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta name=google-site-verification content="yq2Ib3doJVHVlEW2wtHap5WY54JhS2CCvI40y30F0FI">
<meta charset=utf-8>
<meta name=color-scheme content="dark light">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.87.0">
<meta name=description content="Example of an Kubernetes Operator based on Ansible">
<meta name=author content="Toni Schmidbauer & Thomas Jungbauer">
<link rel=icon href=/images/favicon.ico type=image/png>
<link rel=apple-touch-icon sizes=152x152 href=/images/apple-touch-icon-152x152.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-180x180.png>
<link rel=apple-touch-icon sizes=128x128 href=/images/apple-touch-icon-128x128.png>
<link rel=apple-touch-icon sizes=144x144 href=/images/apple-touch-icon-144x144.png>
<link rel=apple-touch-icon sizes=114x114 href=/images/apple-touch-icon-114x114.png>
<link rel=apple-touch-icon sizes=72x72 href=/images/apple-touch-icon-72x72.png>
<link rel=apple-touch-icon href=/images/apple-touch-icon-57x57.png>
<link rel="shortcut icon" href=/images/favicon.ico>
<link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.png>
<link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.png>
<link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.png>
<link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.png>
<link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.png>
<link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.png>
<link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png>
<title>Writing Operator using Ansible :: TechBlog about OpenShift/Ansible/Satellite and much more</title>
<link rel=manifest href=/manifest.json>
<meta name=theme-color content="#317EFB">
<link href=/css/nucleus.min.css?1637052715 rel=stylesheet>
<link href=/css/fontawesome-all.min.css?1637052715 rel=stylesheet>
<link href=/css/font-awesome-animation.min.css?1637052715 rel=stylesheet>
<link href=/css/hybrid.css?1637052715 rel=stylesheet>
<link href=/css/featherlight.min.css?1637052715 rel=stylesheet>
<link href=/css/perfect-scrollbar.min.css?1637052715 rel=stylesheet>
<link href=/css/auto-complete.css?1637052715 rel=stylesheet>
<link href=/css/atom-one-dark-reasonable.css?1637052715 rel=stylesheet>
<link href=/css/theme.min.css?1637052715 rel=stylesheet>
<link href=/css/hugo-theme.css?1637052715 rel=stylesheet>
<link href=/css/theme-yaub.css?1637052715 rel=stylesheet>
<script src=/js/jquery-3.6.0.min.js?1637052715></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}</style>
</head>
<body data-url=/openshift/2021-01-27-writingoperatoransible/>
<button onclick=scrollTopAnimated() id=myBtn class="top-btn button fa fa-arrow-up" title="Go to top"></button>
<nav id=sidebar>
<div id=header-wrapper>
<div id=header>
<a id=logo href=/>
<p class="fa fa-cloud-upload-alt faa-float animated"></p>
<span class=text>YAUB</span>
<p class=logoarea><span class="text small">Yet another Useless Blog</span></p>
</a>
</div>
<div class=searchbox>
<label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span>
</div>
<script type=text/javascript src=/js/lunr.min.js?1637052715></script>
<script type=text/javascript src=/js/auto-complete.js?1637052715></script>
<script type=text/javascript>var baseurl="https://blog.stderr.at/"</script>
<script type=text/javascript src=/js/search.js?1637052715></script>
</div>
<div class=togglemode>
<button id=dark-mode-toggle class="btn-toggle btn-default btn">Toggle Dark-Mode</button>
</div>
<section id=homelinks>
<ul>
<li>
<a class=padding href=/><i class="fas fa-home"></i> Home</a>
</li>
</ul>
</section>
<div class=highlightable>
<ul class=topics>
<li data-nav-id=/openshift/ title=OpenShift class="dd-item
parent">
<a href=/openshift/>
OpenShift
</a>
<ul>
<li data-nav-id=/openshift/2021-09-25-sealed_secrets/ title="Secure your secrets with Sealed Secrets" class=dd-item>
<a href=/openshift/2021-09-25-sealed_secrets/>
Secure your secrets with Sealed Secrets
</a>
</li>
<li data-nav-id=/openshift/2021-02-27-understanding-block-devices/ title="Understanding RWO block device handling in OpenShift" class=dd-item>
<a href=/openshift/2021-02-27-understanding-block-devices/>
Understanding RWO block device handling in OpenShift
</a>
</li>
<li data-nav-id=/openshift/2021-01-27-writingoperatoransible/ title="Writing Operator using Ansible" class="dd-item active">
<a href=/openshift/2021-01-27-writingoperatoransible/>
Writing Operator using Ansible
</a>
</li>
<li data-nav-id=/openshift/2020-12-10-thanos-vs-thanos/ title="Thanos Querier vs Thanos Querier" class=dd-item>
<a href=/openshift/2020-12-10-thanos-vs-thanos/>
Thanos Querier vs Thanos Querier
</a>
</li>
<li data-nav-id=/openshift/2020-08-06-argocd/ title="GitOps - Argo CD" class=dd-item>
<a href=/openshift/2020-08-06-argocd/>
GitOps - Argo CD
</a>
</li>
<li data-nav-id=/openshift/2020-04-16-tekton/ title="OpenShift Pipelines - Tekton Introduction" class=dd-item>
<a href=/openshift/2020-04-16-tekton/>
OpenShift Pipelines - Tekton Introduction
</a>
</li>
<li data-nav-id=/openshift/2020-04-01-oc-commands/ title="Helpful oc / kubectl commands" class=dd-item>
<a href=/openshift/2020-04-01-oc-commands/>
Helpful oc / kubectl commands
</a>
</li>
</ul>
</li>
<li data-nav-id=/day-2/ title="OpenShift Day-2" class=dd-item>
<a href=/day-2/>
OpenShift Day-2
</a>
<ul>
<li data-nav-id=/day-2/labels_environmets/ title="Labels & Environments" class=dd-item>
<a href=/day-2/labels_environmets/>
Labels & Environments
</a>
<ul>
<li data-nav-id=/day-2/labels_environmets/2021-11-12-creatingenvironment/ title="Working with Environments" class=dd-item>
<a href=/day-2/labels_environmets/2021-11-12-creatingenvironment/>
Working with Environments
</a>
</li>
</ul>
</li>
<li data-nav-id=/day-2/pod-placement/ title="Pod Placement" class=dd-item>
<a href=/day-2/pod-placement/>
Pod Placement
</a>
<ul>
<li data-nav-id=/day-2/pod-placement/2021-08-26-podplacement-intro/ title=Introduction class=dd-item>
<a href=/day-2/pod-placement/2021-08-26-podplacement-intro/>
Introduction
</a>
</li>
<li data-nav-id=/day-2/pod-placement/2021-08-29-node-affinity/ title="Node Affinity" class=dd-item>
<a href=/day-2/pod-placement/2021-08-29-node-affinity/>
Node Affinity
</a>
</li>
<li data-nav-id=/day-2/pod-placement/2021-08-27-podplacement/ title=NodeSelector class=dd-item>
<a href=/day-2/pod-placement/2021-08-27-podplacement/>
NodeSelector
</a>
</li>
<li data-nav-id=/day-2/pod-placement/2021-08-28-affinity/ title="Pod Affinity/Anti-Affinity" class=dd-item>
<a href=/day-2/pod-placement/2021-08-28-affinity/>
Pod Affinity/Anti-Affinity
</a>
</li>
<li data-nav-id=/day-2/pod-placement/2021-08-30-taints/ title="Taints and Tolerations" class=dd-item>
<a href=/day-2/pod-placement/2021-08-30-taints/>
Taints and Tolerations
</a>
</li>
<li data-nav-id=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/ title="Topology Spread Constraints" class=dd-item>
<a href=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/>
Topology Spread Constraints
</a>
</li>
<li data-nav-id=/day-2/pod-placement/2021-09-01-descheduler/ title="Using Descheduler" class=dd-item>
<a href=/day-2/pod-placement/2021-09-01-descheduler/>
Using Descheduler
</a>
</li>
</ul>
</li>
</ul>
</li>
<li data-nav-id=/compliance/ title=Compliance class=dd-item>
<a href=/compliance/>
Compliance
</a>
<ul>
<li data-nav-id=/compliance/2021/07/oc-compliance-command-line-plugin/ title="oc compliance command line plugin" class=dd-item>
<a href=/compliance/2021/07/oc-compliance-command-line-plugin/>
oc compliance command line plugin
</a>
</li>
<li data-nav-id=/compliance/2021/07/compliance-operator/ title="Compliance Operator" class=dd-item>
<a href=/compliance/2021/07/compliance-operator/>
Compliance Operator
</a>
</li>
</ul>
</li>
<li data-nav-id=/service-mesh/ title="Service Mesh" class=dd-item>
<a href=/service-mesh/>
Service Mesh
</a>
<ul>
<li data-nav-id=/service-mesh/2020/05/enable-automatic-route-creation/ title="Enable Automatic Route Creation" class=dd-item>
<a href=/service-mesh/2020/05/enable-automatic-route-creation/>
Enable Automatic Route Creation
</a>
</li>
<li data-nav-id=/service-mesh/2020/05/authorization-rbac/ title="Authorization (RBAC)" class=dd-item>
<a href=/service-mesh/2020/05/authorization-rbac/>
Authorization (RBAC)
</a>
</li>
<li data-nav-id=/service-mesh/2020/04/deploy-example-bookinfo-application/ title="Deploy Example Bookinfo Application" class=dd-item>
<a href=/service-mesh/2020/04/deploy-example-bookinfo-application/>
Deploy Example Bookinfo Application
</a>
</li>
<li data-nav-id=/service-mesh/2020/04/service-mesh-1.1-released/ title="Service Mesh 1.1 released" class=dd-item>
<a href=/service-mesh/2020/04/service-mesh-1.1-released/>
Service Mesh 1.1 released
</a>
</li>
<li data-nav-id=/service-mesh/2020/04/authentication-jwt/ title="Authentication JWT" class=dd-item>
<a href=/service-mesh/2020/04/authentication-jwt/>
Authentication JWT
</a>
</li>
<li data-nav-id=/service-mesh/2020/04/mutual-tls-authentication/ title="Mutual TLS Authentication" class=dd-item>
<a href=/service-mesh/2020/04/mutual-tls-authentication/>
Mutual TLS Authentication
</a>
</li>
<li data-nav-id=/service-mesh/2020/04/fault-injection/ title="Fault Injection" class=dd-item>
<a href=/service-mesh/2020/04/fault-injection/>
Fault Injection
</a>
</li>
<li data-nav-id=/service-mesh/2020/04/limit-egress/external-traffic/ title="Limit Egress/External Traffic" class=dd-item>
<a href=/service-mesh/2020/04/limit-egress/external-traffic/>
Limit Egress/External Traffic
</a>
</li>
<li data-nav-id=/service-mesh/2020/04/advanced-routing-example/ title="Advanced Routing Example" class=dd-item>
<a href=/service-mesh/2020/04/advanced-routing-example/>
Advanced Routing Example
</a>
</li>
<li data-nav-id=/service-mesh/2020/04/routing-example/ title="Routing Example" class=dd-item>
<a href=/service-mesh/2020/04/routing-example/>
Routing Example
</a>
</li>
<li data-nav-id=/service-mesh/2020/03/ingress-with-custom-domain/ title="Ingress with custom domain" class=dd-item>
<a href=/service-mesh/2020/03/ingress-with-custom-domain/>
Ingress with custom domain
</a>
</li>
<li data-nav-id=/service-mesh/2020/03/ingress-traffic/ title="Ingress Traffic" class=dd-item>
<a href=/service-mesh/2020/03/ingress-traffic/>
Ingress Traffic
</a>
</li>
<li data-nav-id=/service-mesh/2020/03/deploy-microservices/ title="Deploy Microservices" class=dd-item>
<a href=/service-mesh/2020/03/deploy-microservices/>
Deploy Microservices
</a>
</li>
<li data-nav-id=/service-mesh/2020/03/installation/ title=Installation class=dd-item>
<a href=/service-mesh/2020/03/installation/>
Installation
</a>
</li>
</ul>
</li>
<li data-nav-id=/general/ title=General class=dd-item>
<a href=/general/>
General
</a>
<ul>
<li data-nav-id=/general/2020/05/basic-usage-of-git/ title="Basic usage of git" class=dd-item>
<a href=/general/2020/05/basic-usage-of-git/>
Basic usage of git
</a>
</li>
<li data-nav-id=/general/2020/04/red-hat-satellite-cheat-sheet/ title="Red Hat Satellite Cheat Sheet" class=dd-item>
<a href=/general/2020/04/red-hat-satellite-cheat-sheet/>
Red Hat Satellite Cheat Sheet
</a>
</li>
</ul>
</li>
<li data-nav-id=/ansible/ title=Ansible class=dd-item>
<a href=/ansible/>
Ansible
</a>
<ul>
<li data-nav-id=/ansible/2021/10/automation-controller-ad-ldap-authentication/ title="Automation Controller ad LDAP Authentication" class=dd-item>
<a href=/ansible/2021/10/automation-controller-ad-ldap-authentication/>
Automation Controller ad LDAP Authentication
</a>
</li>
<li data-nav-id=/ansible/2021/07/ansible-tower-and-downloading-collections/ title="Ansible Tower and downloading collections" class=dd-item>
<a href=/ansible/2021/07/ansible-tower-and-downloading-collections/>
Ansible Tower and downloading collections
</a>
</li>
<li data-nav-id=/ansible/2020/04/ansible-azure-resource-manager-example/ title="Ansible - Azure Resource Manager Example" class=dd-item>
<a href=/ansible/2020/04/ansible-azure-resource-manager-example/>
Ansible - Azure Resource Manager Example
</a>
</li>
<li data-nav-id=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/ title="DO410 Ansible and Ansible Tower training notes" class=dd-item>
<a href=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/>
DO410 Ansible and Ansible Tower training notes
</a>
</li>
</ul>
</li>
<li data-nav-id=/azure/ title=Azure class=dd-item>
<a href=/azure/>
Azure
</a>
<ul>
<li data-nav-id=/azure/2021-10-29-private-aro/ title="Stumbling into Azure Part II: Setting up a private ARO cluster" class=dd-item>
<a href=/azure/2021-10-29-private-aro/>
Stumbling into Azure Part II: Setting up a private ARO cluster
</a>
</li>
<li data-nav-id=/azure/2021-10-17-s2s-vpn/ title="Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing" class=dd-item>
<a href=/azure/2021-10-17-s2s-vpn/>
Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing
</a>
</li>
</ul>
</li>
<li data-nav-id=/quay/ title=Quay class=dd-item>
<a href=/quay/>
Quay
</a>
<ul>
<li data-nav-id=/quay/2021-09-07-quay-upgrade-3.4/ title="Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator" class=dd-item>
<a href=/quay/2021-09-07-quay-upgrade-3.4/>
Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator
</a>
</li>
<li data-nav-id=/quay/2020-05-13-quay-tutorial1/ title="Red Hat Quay Registry - Overview and Installation" class=dd-item>
<a href=/quay/2020-05-13-quay-tutorial1/>
Red Hat Quay Registry - Overview and Installation
</a>
</li>
</ul>
</li>
<li data-nav-id=/archive/ title=Archive class=dd-item>
<a href=/archive/>
Archive
</a>
</li>
<li data-nav-id=/legaldisclosure/ title="Legal Disclosure" class=dd-item>
<a href=/legaldisclosure/>
Legal Disclosure
</a>
</li>
<li data-nav-id=/rss/ title="RSS Feeds" class=dd-item>
<a href=/rss/>
RSS Feeds
</a>
</li>
</ul>
<section id=shortcuts>
<h3 class=shortcut-title>More</h3>
<ul>
<li>
<a class=padding href=https://blog.stderr.at/tags><i class="fas fa-tags"></i> Tags</a>
</li>
<li>
<a class=padding href=https://blog.stderr.at/categories><i class="far fa-bookmark"></i> Catagories</a>
</li>
<li>
<a class=padding href=https://www.redhat.com><i class="fab fa-redhat"></i> Red Hat</a>
</li>
</ul>
</section>
<section id=footer>
</section>
</div>
</nav>
<section id=body>
<div id=overlay></div>
<aside id=toc-field class="hidden lg:block tableOfContentContainer">
<header id=TableOfContentsHeader>What's on this Page</header>
<nav id=TableOfContents>
<ul>
<li><a href=#_install_operator_sdk>Install Operator SDK</a></li>
<li><a href=#_creating_the_operator>Creating the Operator</a></li>
<li><a href=#_defining_roles_and_playbook>Defining Roles and Playbook</a></li>
<li><a href=#_operator_permissions>Operator Permissions</a></li>
<li><a href=#_building_and_deploy_the_operator>Building and Deploy the Operator</a></li>
<li><a href=#_using_the_operator>Using the Operator</a></li>
<li><a href=#_updating_operator>Updating Operator</a></li>
<li><a href=#_what_else_references>What Else? - References</a></li>
</ul>
</nav>
<div id=navigation>
<a class=nav-prev href=/openshift/2021-02-27-understanding-block-devices/ title="Understanding RWO block device handling in OpenShift"> <i class="fa fa-chevron-left"></i></a>
<a class=nav-next href=/openshift/2020-12-10-thanos-vs-thanos/ title="Thanos Querier vs Thanos Querier" style=margin-right:0><i class="fa fa-chevron-right"></i></a>
</div>
</aside>
<div class="padding highlightable">
<div>
<div id=top-bar>
<div id=breadcrumbs itemscope itemtype=http://schema.org/BreadcrumbList>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
<span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/> <span itemprop=name>YAUB Yet Another Useless Blog</span><meta itemprop=position content="1"></a></span> > <span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/openshift/> <span itemprop=name>OpenShift</span><meta itemprop=position content="2"></a></span> > Writing Operator using Ansible
</span>
</div>
<div class=progress>
<div class=wrapper>
<nav id=TableOfContents>
<ul>
<li><a href=#_install_operator_sdk>Install Operator SDK</a></li>
<li><a href=#_creating_the_operator>Creating the Operator</a></li>
<li><a href=#_defining_roles_and_playbook>Defining Roles and Playbook</a></li>
<li><a href=#_operator_permissions>Operator Permissions</a></li>
<li><a href=#_building_and_deploy_the_operator>Building and Deploy the Operator</a></li>
<li><a href=#_using_the_operator>Using the Operator</a></li>
<li><a href=#_updating_operator>Updating Operator</a></li>
<li><a href=#_what_else_references>What Else? - References</a></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id=head-tags>
<div class=tags>
<a class=tag-link href=/tags/operator>Operator</a>
<a class=tag-link href=/tags/openshift>OpenShift</a>
<a class=tag-link href=/tags/ocp>OCP</a>
<a class=tag-link href=/tags/kubernetes>Kubernetes</a>
</div>
</div>
<div id=body-inner>
<h1>
Writing Operator using Ansible
</h1>
<p class=tracked>
<time class="f6 mv4 dib tracked" datetime=2021-01-27T00:00:00Z>
<strong>January 27, 2021</strong>
</time>
- By:
Thomas Jungbauer
( Lastmod: 2021-08-14 )
</p>
<div class=paragraph>
<p>This quick post shall explain, without any fancy details, how to write an Operator based on Ansible. It is assumed that you know what purpose an Operator has.</p>
</div>
<div class=paragraph>
<p>As a short summary: Operators are a way to create custom controllers in OpenShift or Kubernetes. It watches for custom resource objects and creates the application based on the parameters in such custom resource object.
Often written in <strong>Go</strong>, the SDK supports <strong>Ansible</strong>, <strong>Helm</strong> and (new) <strong>Java</strong> as well.</p>
</div>
<div class=paragraph>
<p>In this example we will install Gogs, a painless self-hosted Git services.</p>
</div>
<div class=paragraph>
<p>As general prerequisites we have:</p>
</div>
<div class=ulist>
<ul>
<li>
<p>Installed OpenShift 4.6+ cluster (could be Minicube)</p>
</li>
<li>
<p>Possibility to execute Ansible scripts and oc/kubectl commands</p>
</li>
<li>
<p>Commands: make, docker (or podman)</p>
</li>
</ul>
</div>
<hr>
<div class=sect1>
<h2 id=_install_operator_sdk>Install Operator SDK</h2>
<div class=sectionbody>
<div class=paragraph>
<p>As explained at <a href=https://sdk.operatorframework.io/docs/installation/ class=bare>https://sdk.operatorframework.io/docs/installation/</a> the following prerequisites must be met prior installing the SDK at least:</p>
</div>
<div class=ulist>
<ul>
<li>
<p>Docker v17.03+ or podman v1.9.3+ or buildah v1.7+</p>
</li>
<li>
<p>OpenShift CLU v4.6+</p>
</li>
<li>
<p>Kubernetes/OpenShift cluster</p>
</li>
<li>
<p>Access to container registry, for example quay.io</p>
</li>
<li>
<p>Optional: Go v1.13+ (for Operators based on Golang)</p>
</li>
<li>
<p>Ansible v2.9.0+</p>
</li>
</ul>
</div>
<div class=paragraph>
<p>Following the instructions of the SDK documentation, the <strong>operator-sdk</strong> command will be installed.</p>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_creating_the_operator>Creating the Operator</h2>
<div class=sectionbody>
<div class=paragraph>
<p>To begin we create a new folder for the Operator and initialize the Operator project.</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>mkdir gogs-operator
cd gogs-operator

operator-sdk init --plugins=ansible --domain=example.com.at
operator-sdk create api --group gogs --version=v1alpha1 --kind Gogs --generate-playbook</code></pre>
</div>
</div>
<div class=paragraph>
<p>This will create a new project structure with the following parameters:</p>
</div>
<div class=paragraph>
<p><strong>--plugin</strong>: Type of Operator (Ansible or Helm)</p>
</div>
<div class=paragraph>
<p><strong>--domain</strong>: Defines the api endpoint together with group and version.</p>
</div>
<div class=paragraph>
<p><strong>--group</strong>: Usually short product name</p>
</div>
<div class=paragraph>
<p><strong>--version</strong>: Defines version of API endpoint</p>
</div>
<div class=paragraph>
<p>The folder structure which will be created automatically looks as follows:</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>.
|-- Dockerfile
|-- Makefile
|-- PROJECT
|-- config
|   |-- crd
|   |   |-- bases
|   |   |   |-- gogs.example.com.at_gogs.yaml
|   |   |-- kustomization.yaml
|   |-- default
|   |   |-- kustomization.yaml
|   |   |-- manager_auth_proxy_patch.yaml
|   |-- manager
|   |   |-- kustomization.yaml
|   |   |-- manager.yaml
|   |-- prometheus
|   |   |-- kustomization.yaml
|   |   |-- monitor.yaml
|   |-- rbac
|   |   |-- auth_proxy_client_clusterrole.yaml
|   |   |-- auth_proxy_role.yaml
|   |   |-- auth_proxy_role_binding.yaml
|   |   |-- auth_proxy_service.yaml
|   |   |-- gogs_editor_role.yaml
|   |   |-- gogs_viewer_role.yaml
|   |   |-- kustomization.yaml
|   |   |-- leader_election_role.yaml
|   |   |-- leader_election_role_binding.yaml
|   |   |-- role.yaml
|   |   |-- role_binding.yaml
|   |-- samples
|   |   |-- gogs_v1alpha1_gogs.yaml
|   |   |-- kustomization.yaml
|   |-- scorecard
|   |   |-- bases
|   |   |   |-- config.yaml
|   |   |-- kustomization.yaml
|   |   |-- patches
|   |       |-- basic.config.yaml
|   |       |-- olm.config.yaml
|   |-- testing
|       |-- debug_logs_patch.yaml
|       |-- kustomization.yaml
|       |-- manager_image.yaml
|       |-- pull_policy
|           |-- Always.yaml
|           |-- IfNotPresent.yaml
|           |-- Never.yaml
|-- molecule
|   |-- default
|   |   |-- converge.yml
|   |   |-- create.yml
|   |   |-- destroy.yml
|   |   |-- kustomize.yml
|   |   |-- molecule.yml
|   |   |-- prepare.yml
|   |   |-- tasks
|   |   |   |-- gogs_test.yml
|   |   |-- verify.yml
|   |-- kind
|       |-- converge.yml
|       |-- create.yml
|       |-- destroy.yml
|       |-- molecule.yml
|-- playbooks
|   |-- gogs.yml
|-- requirements.yml
|-- roles
|-- watches.yaml</code></pre>
</div>
</div>
<div class=paragraph>
<p>The <strong>watches.yaml</strong> file maps Custom Resources (identified by Group, Version, and Kind [GVK]) to Ansible Roles and Playbooks. It tells the Operator where to find the actual Ansible playbook.</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-yaml data-lang=yaml>---
# Use the &#39;create api&#39; subcommand to add watches to this file.
- version: v1alpha1
  group: gogs.example.com.at
  kind: Gogs
  playbook: playbooks/gogs.yml
# +kubebuilder:scaffold:watch</code></pre>
</div>
</div>
<div class=paragraph>
<p>Other files, especially inside <strong>playbooks</strong> and <strong>roles</strong> are created as placeholders. These files (or folders) are waiting for you to add the Ansible logic.</p>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_defining_roles_and_playbook>Defining Roles and Playbook</h2>
<div class=sectionbody>
<div class=paragraph>
<p>With the folder structure above, a playbook and different roles can be created in order to tell the Operator what it needs to do.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class=icon>
<i class="fa icon-caution" title=Caution></i>
</td>
<td class=content>
Since the Operator will constantly watch for changes, all tasks must be <strong>idempotent</strong>
</td>
</tr>
</tbody></table>
</div>
<div class=paragraph>
<p>In our example we will try to install Gogs, a Git service. It contains a Postgres database system and a webservice.
To use some example roles and not fully start from scratch let’s clone the following repository and copy the folders to our Operator.</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>cd ..
https://github.com/tjungbauer/ansible-operator-roles
cd gogs-operator

# Remove placeholder
rm -Rf roles/

# Copy Postgres deployment role
cp -R ../ansible-operator-roles/roles/postgresql-ocp ./roles

# Copy Gogs Deplyoment role
cp -R ../ansible-operator-roles/roles/gogs-ocp ./roles</code></pre>
</div>
</div>
<div class=paragraph>
<p>When we examine the folder, we see 2 typical Ansible roles. The simple purpose is, to create all required OpenShift objects, like Deployment, Route, Service and so on, fully automated by the Operator.</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>|-- playbooks
|   |-- gogs.yaml
|-- roles
    |-- gogs-ocp
    |   |-- README.adoc
    |   |-- defaults
    |   |   |-- main.yml
    |   |-- meta
    |   |   |-- main.yml
    |   |-- tasks
    |   |   |-- main.yml
    |   |-- templates
    |       |-- config_map.j2
    |       |-- deployment.j2
    |       |-- persistent_volume_claim.j2
    |       |-- route.j2
    |       |-- service.j2
    |       |-- service_account.j2
    |-- postgresql-ocp
        |-- README.adoc
        |-- defaults
        |   |-- main.yml
        |-- meta
        |   |-- main.yml
        |-- tasks
        |   |-- main.yml
        |-- templates
            |-- deployment.j2
            |-- persistent_volume_claim.j2
            |-- secret.j2
            |-- service.j2</code></pre>
</div>
</div>
<div class=paragraph>
<p>Copy (or create) the following playbook under <strong>playbooks/gogs.yaml</strong>. As you can see there are 2 tasks: the first one will create the postgres application, the seconds one the Gogs service.</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-yaml data-lang=yaml>---
# Persistent Gogs deployment playbook.
#
# The Playbook expects the following variables to be set in the CR:
# (Note that Camel case gets converted by the ansible-operator to Snake case)
# - PostgresqlVolumeSize
# - GogsVolumeSize
# - GogsSSL
# The following variables come from the ansible-operator
# - ansible_operator_meta.namespace
# - ansible_operator_meta.name (from the name of the CR)

- hosts: localhost
  gather_facts: no
  tasks:
  - name: Set up PostgreSQL
    include_role:
      name: ../roles/postgresql-ocp <i class=conum data-value=1></i><b>(1)</b>
    vars: <i class=conum data-value=2></i><b>(2)</b>
      _postgresql_namespace: &#34;{{ ansible_operator_meta.namespace }}&#34;
      _postgresql_name: &#34;postgresql-gogs-{{ ansible_operator_meta.name }}&#34;
      _postgresql_database_name: &#34;gogsdb&#34;
      _postgresql_user: &#34;gogsuser&#34;
      _postgresql_password: &#34;gogspassword&#34;
      _postgresql_volume_size: &#34;{{ postgresql_volume_size|d(&#39;4Gi&#39;) }}&#34;
      _postgresql_image: &#34;{{ postgresql_image|d(&#39;registry.redhat.io/rhscl/postgresql-10-rhel7&#39;) }}&#34;
      _postgresql_image_tag: &#34;{{ postgresql_image_tag|d(&#39;latest&#39;) }}&#34;
      _postgresql_size: 1

  - name: Set Gogs Service name to default value
    set_fact:
      gogs_service_name: &#34;gogs-{{ ansible_operator_meta.name }}&#34;
    when:
      gogs_service_name is not defined
  - name: Set up Gogs
    include_role:
      name: ../roles/gogs-ocp <i class=conum data-value=3></i><b>(3)</b>
    vars: <i class=conum data-value=4></i><b>(4)</b>
      _gogs_namespace: &#34;{{ ansible_operator_meta.namespace }}&#34;
      _gogs_name: &#34;{{ gogs_service_name }}&#34;
      _gogs_ssl: &#34;{{ gogs_ssl|d(False)|bool }}&#34;
      _gogs_route: &#34;{{ gogs_route | d(&#39;&#39;) }}&#34;
      _gogs_image_tag: &#34;{{ gogs_image_tag | d(&#39;latest&#39;) }}&#34;
      _gogs_volume_size: &#34;{{ gogs_volume_size|d(&#39;4Gi&#39;) }}&#34;
      _gogs_postgresql_service_name: &#34;postgresql-gogs-{{ ansible_operator_meta.name }}&#34;
      _gogs_postgresql_database_name: gogsdb
      _gogs_postgresql_user: gogsuser
      _gogs_postgresql_password: gogspassword
      _gogs_size: 1</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class=conum data-value=1></i><b>1</b></td>
<td>Path to Postgres Role</td>
</tr>
<tr>
<td><i class=conum data-value=2></i><b>2</b></td>
<td>Parameters for Postgres service</td>
</tr>
<tr>
<td><i class=conum data-value=3></i><b>3</b></td>
<td>Path to Gogs Role</td>
</tr>
<tr>
<td><i class=conum data-value=4></i><b>4</b></td>
<td>Parameters for Gogs service</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_operator_permissions>Operator Permissions</h2>
<div class=sectionbody>
<div class=paragraph>
<p>The Operator will require correct permissions in order to create objects like Routes or Services in OpenShift. The SDK automatically created a default role.yaml which can be modified.
Open the file <strong>config/rbac/role.yaml</strong> and add permissions for:</p>
</div>
<div class="olist arabic">
<ol class=arabic>
<li>
<p>for apiGroups ""</p>
<div class="olist loweralpha">
<ol class=loweralpha type=a>
<li>
<p>services</p>
</li>
<li>
<p>routes</p>
</li>
<li>
<p>peristentvlumeclaims</p>
</li>
<li>
<p>serviceaccounts</p>
</li>
<li>
<p>configmaps</p>
</li>
</ol>
</div>
</li>
<li>
<p>for apiGroups: route.operanshift.io the resource <strong>routes</strong></p>
</li>
</ol>
</div>
<div class=paragraph>
<p>At the end, the role.yaml should look like this:</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-yaml data-lang=yaml>---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: manager-role
rules:
  ##
  ## Base operator rules
  ##
  - apiGroups:
      - &#34;&#34;
    resources:
      - secrets
      - pods
      - pods/exec
      - pods/log
      - services
      - routes
      - configmaps
      - persistentvolumeclaims
      - serviceaccounts
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - apps
    resources:
      - deployments
      - daemonsets
      - replicasets
      - statefulsets
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  ##
  ## Rules for gogs.example.com.at/v1alpha1, Kind: Gogs
  ##
  - apiGroups:
      - gogs.example.com.at
    resources:
      - gogs
      - gogs/status
      - gogs/finalizers
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - route.openshift.io
    resources:
      - routes
    verbs:
      - create
      - update
      - delete
      - get
      - list
      - watch
      - patch
  - apiGroups:
      - route.openshift.io
    resources:
      - routes
    verbs:
      - create
      - update
      - delete
      - get
      - list
      - watch
      - patch</code></pre>
</div>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_building_and_deploy_the_operator>Building and Deploy the Operator</h2>
<div class=sectionbody>
<div class=paragraph>
<p>Now it is time to build the Operator and push it to a repository. In this example a repository was created at quay.io and is called <strong>gogs-operator</strong>.
The SDK will automatically create a Makefile during the initialization, which we will use now.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class=icon>
<i class="fa icon-caution" title=Caution></i>
</td>
<td class=content>
The Makefile is prepared for <em>docker</em>. If you use <strong>podman</strong> some modifications must be done first. Run the command <strong>sed -i 's/docker/podman/g' Makefile</strong> to replace all docker commands inside the Makefile.
</td>
</tr>
</tbody></table>
</div>
<div class=paragraph>
<p>The next commands will <em>build, push, install and deploy</em> the Operator. Before we start we must be logged in to you Registry of choice (i.e. docker login …​) as well as into our OpenShift cluster.
Moreover, it is required that the <strong>IMG</strong> environment variable is exported with the correct value.</p>
</div>
<div class="olist arabic">
<ol class=arabic>
<li>
<p>Build the Operator and push into the registry</p>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash># export IMG, be sure that the correct tag is used
export IMG=quay.io/tjungbau/gogs-operator:v1.0.0

# Build and push into registry
make podman-build podman-push

podman build . -t quay.io/tjungbau/gogs-operator:v1.0.0
STEP 1: FROM quay.io/operator-framework/ansible-operator:v1.3.0
STEP 2: COPY requirements.yml ${HOME}/requirements.yml
--&gt; Using cache 4f84e7064b066c2cac5179b56490a0ef85591170c501ec8a480b617d6e91cff3
STEP 3: RUN ansible-galaxy collection install -r ${HOME}/requirements.yml  &amp;&amp; chmod -R ug+rwx ${HOME}/.ansible
--&gt; Using cache 2a3a5d44451a45a4c38e1c314e8887c6c45f2551cbef87ef0d1ce518c1969c0d
STEP 4: COPY watches.yaml ${HOME}/watches.yaml
--&gt; Using cache 642f8361a7b358b89d2e4e5211c1c7a1e22488c53bba0bf1ba2ba275fd56ee69
STEP 5: COPY roles/ ${HOME}/roles/
--&gt; Using cache 93c1af8782bad84d8b81d2d2294c405caab70e2d01c232440f7eb8e5001746c1
STEP 6: COPY playbooks/ ${HOME}/playbooks/
--&gt; Using cache 1cdeee1456ac67d70d4233b0f9ed8052465aaa2cded6bd8ae962dfcc848e5b92
STEP 7: COMMIT quay.io/tjungbau/gogs-operator:v1.0.0
--&gt; 1cdeee1456a
1cdeee1456ac67d70d4233b0f9ed8052465aaa2cded6bd8ae962dfcc848e5b92
podman push quay.io/tjungbau/gogs-operator:v1.0.0
Getting image source signatures
Copying blob d5ca8c3b3d34 skipped: already exists
Copying blob 4b036ae478b7 skipped: already exists
Copying blob 5cfcd0621ffc skipped: already exists
Copying blob c6f3d1432bd0 skipped: already exists
Copying blob 92538e92de29 skipped: already exists
Copying blob eb7bf34352ca skipped: already exists
Copying blob 80c43a11288f done
Copying blob 803eb2035c9a done
Copying blob 40d943ae1834 done
Copying blob f4d9024614ee done
Copying blob 5143a36c6002 done
Copying blob 5050e1080446 skipped: already exists
Copying config 1cdeee1456 done
Writing manifest to image destination
Copying config 1cdeee1456 [--------------------------------------] 0.0b / 6.2KiB
Writing manifest to image destination
Writing manifest to image destination
Storing signatures</code></pre>
</div>
</div>
</li>
<li>
<p>Install the CRD into OpenShift</p>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash># Install the custom resource definition
make install

/root/projects/gogs-operator/bin/kustomize build config/crd | kubectl apply -f -
customresourcedefinition.apiextensions.k8s.io/gogs.gogs.example.com.at created</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Operator and all required objects into OpenShift</p>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash># Deploy the Operator into OpenShift
make deploy

cd config/manager &amp;&amp; /root/projects/gogs-operator/bin/kustomize edit set image controller=quay.io/tjungbau/gogs-operator:v1.0.0
/root/projects/gogs-operator/bin/kustomize build config/default | kubectl apply -f -
namespace/gogs-operator-system created
customresourcedefinition.apiextensions.k8s.io/gogs.gogs.example.com.at unchanged
role.rbac.authorization.k8s.io/gogs-operator-leader-election-role created
clusterrole.rbac.authorization.k8s.io/gogs-operator-manager-role created
clusterrole.rbac.authorization.k8s.io/gogs-operator-metrics-reader created
clusterrole.rbac.authorization.k8s.io/gogs-operator-proxy-role created
rolebinding.rbac.authorization.k8s.io/gogs-operator-leader-election-rolebinding created
clusterrolebinding.rbac.authorization.k8s.io/gogs-operator-manager-rolebinding created
clusterrolebinding.rbac.authorization.k8s.io/gogs-operator-proxy-rolebinding created
service/gogs-operator-controller-manager-metrics-service created
deployment.apps/gogs-operator-controller-manager created</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class=paragraph>
<p>This will create a new project in OpenShift called <strong>gogs-operator-system</strong>. Here, the Operator is running and waiting that somebody creates a CRD of the kind <strong>Gogs</strong>. Once this happens the Operator will execute the playbooks and therefore create a Postgres and a Gogs pod.</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash># Operator Namespace
oc get pods -n gogs-operator-system
NAME                                               READY   STATUS    RESTARTS   AGE
gogs-operator-controller-manager-6747bb6c6-s8794   2/2     Running   0          6m8s</code></pre>
</div>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_using_the_operator>Using the Operator</h2>
<div class=sectionbody>
<div class=paragraph>
<p>Now we need to create a CRD of the kind <em>Gogs</em>. This will happen in a new project, where the Gogs service shall be hosted.</p>
</div>
<div class="olist arabic">
<ol class=arabic>
<li>
<p>Create a new OpenShift project</p>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>oc new-project gogs</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the sample resource</p>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>cat config/samples/gogs_v1alpha1_gogs.yaml
apiVersion: gogs.example.com.at/v1alpha1
kind: Gogs
metadata:
  name: gogs-sample
spec:
  foo: bar</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the sample resource</p>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>oc apply -f config/samples/gogs_v1alpha1_gogs.yaml -n gogs</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class=paragraph>
<p>This will create two services:</p>
</div>
<div class="olist arabic">
<ol class=arabic>
<li>
<p>postgresql</p>
</li>
<li>
<p>Gogs</p>
</li>
</ol>
</div>
<div class=paragraph>
<p>The Operator will be responsible to roll out all required objects. This includes the Deployments for the container, the Openshift service and the route.</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>oc get all -n gogs
NAME                                              READY   STATUS    RESTARTS   AGE
pod/gogs-gogs-sample-57778fd76-ghg8j              1/1     Running   0          74s
pod/postgresql-gogs-gogs-sample-bbc49b794-mnltb   1/1     Running   0          115s

NAME                                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
service/gogs-gogs-sample              ClusterIP   172.30.47.31    &lt;none&gt;        3000/TCP   80s
service/postgresql-gogs-gogs-sample   ClusterIP   172.30.47.158   &lt;none&gt;        5432/TCP   117s

NAME                                          READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/gogs-gogs-sample              1/1     1            1           74s
deployment.apps/postgresql-gogs-gogs-sample   1/1     1            1           115s

NAME                                                    DESIRED   CURRENT   READY   AGE
replicaset.apps/gogs-gogs-sample-57778fd76              1         1         1       74s
replicaset.apps/postgresql-gogs-gogs-sample-bbc49b794   1         1         1       115s

NAME                                        HOST/PORT                                    PATH   SERVICES           PORT    TERMINATION   WILDCARD
route.route.openshift.io/gogs-gogs-sample   gogs-gogs-sample-gogs.apps.ocp.ispworld.at          gogs-gogs-sample   &lt;all&gt;                 None</code></pre>
</div>
</div>
<div class=paragraph>
<p>At the end, all Pods are alive, ready and are fully controlled by the Operator. We can access the Gogs web interface via the route and start using our own Git service.</p>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_updating_operator>Updating Operator</h2>
<div class=sectionbody>
<div class=paragraph>
<p>While the Operator is running fine now, at some point you might want to do some changes. For example, let’s run the Gog service with a replica of 3.</p>
</div>
<div class=paragraph>
<p>Perform the following actions:</p>
</div>
<div class="olist arabic">
<ol class=arabic>
<li>
<p>Set the variable <strong>_gogs_size</strong> to 3 in playbooks/gogs.yml</p>
</li>
<li>
<p>Build and push the new version</p>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>export IMG=quay.io/tjungbau/gogs-operator:v1.0.8

make podman-build podman-push

podman build . -t quay.io/tjungbau/gogs-operator:v1.0.8
STEP 1: FROM quay.io/operator-framework/ansible-operator:v1.3.0
STEP 2: COPY requirements.yml ${HOME}/requirements.yml
--&gt; Using cache 4f84e7064b066c2cac5179b56490a0ef85591170c501ec8a480b617d6e91cff3
STEP 3: RUN ansible-galaxy collection install -r ${HOME}/requirements.yml  &amp;&amp; chmod -R ug+rwx ${HOME}/.ansible
--&gt; Using cache 2a3a5d44451a45a4c38e1c314e8887c6c45f2551cbef87ef0d1ce518c1969c0d
STEP 4: COPY watches.yaml ${HOME}/watches.yaml
--&gt; Using cache 642f8361a7b358b89d2e4e5211c1c7a1e22488c53bba0bf1ba2ba275fd56ee69
STEP 5: COPY roles/ ${HOME}/roles/
--&gt; Using cache 55785493e215d933ef7a93fe000afa6fbb088d87eeffcdddeea4e7fd1896f5b5
STEP 6: COPY playbooks/ ${HOME}/playbooks/
STEP 7: COMMIT quay.io/tjungbau/gogs-operator:v1.0.8
--&gt; bb9d6a995d0
bb9d6a995d059eab7758f9ac17d3ce12f8759518e231f77d32a4b820e4b14396
podman push quay.io/tjungbau/gogs-operator:v1.0.8
Getting image source signatures
Copying blob 5cfcd0621ffc skipped: already exists
Copying blob d5ca8c3b3d34 skipped: already exists
Copying blob eb7bf34352ca skipped: already exists
Copying blob 4b036ae478b7 skipped: already exists
Copying blob c6f3d1432bd0 skipped: already exists
Copying blob 92538e92de29 skipped: already exists
Copying blob 41e53e538a36 done
Copying blob 5050e1080446 skipped: already exists
Copying blob 40d943ae1834 skipped: already exists
Copying blob 803eb2035c9a skipped: already exists
Copying blob 80c43a11288f skipped: already exists
Copying blob ee0361a14e3b skipped: already exists
Copying config bb9d6a995d done
Writing manifest to image destination
Copying config bb9d6a995d [--------------------------------------] 0.0b / 6.2KiB
Writing manifest to image destination
Writing manifest to image destination
Storing signatures</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the new version</p>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>make deploy

cd config/manager &amp;&amp; /root/projects/gogs-operator/bin/kustomize edit set image controller=quay.io/tjungbau/gogs-operator:v1.0.8
/root/projects/gogs-operator/bin/kustomize build config/default | kubectl apply -f -
namespace/gogs-operator-system unchanged
customresourcedefinition.apiextensions.k8s.io/gogs.gogs.example.com.at unchanged
role.rbac.authorization.k8s.io/gogs-operator-leader-election-role unchanged
clusterrole.rbac.authorization.k8s.io/gogs-operator-manager-role unchanged
clusterrole.rbac.authorization.k8s.io/gogs-operator-metrics-reader unchanged
clusterrole.rbac.authorization.k8s.io/gogs-operator-proxy-role unchanged
rolebinding.rbac.authorization.k8s.io/gogs-operator-leader-election-rolebinding unchanged
clusterrolebinding.rbac.authorization.k8s.io/gogs-operator-manager-rolebinding unchanged
clusterrolebinding.rbac.authorization.k8s.io/gogs-operator-proxy-rolebinding unchanged
service/gogs-operator-controller-manager-metrics-service unchanged
deployment.apps/gogs-operator-controller-manager configured</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class=paragraph>
<p>The Operator will restart with a new version. After a while the changes will take affect and 3 Gogs pods will run.</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>oc get pods -n gogs
NAME                                          READY   STATUS    RESTARTS   AGE
gogs-gogs-sample-57778fd76-4m98m              1/1     Running   0          12m
gogs-gogs-sample-57778fd76-5hrdn              1/1     Running   0          6m23s
gogs-gogs-sample-57778fd76-xgh2f              1/1     Running   0          6m24s
postgresql-gogs-gogs-sample-bbc49b794-z84wt   1/1     Running   0          13m</code></pre>
</div>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_what_else_references>What Else? - References</h2>
<div class=sectionbody>
<div class=paragraph>
<p>Above example is a very quick overview about what can be done. There are many other options. You can create Operators using Go or Helm.</p>
</div>
<div class=paragraph>
<p>The best starting points are the following websites:</p>
</div>
<div class=ulist>
<ul>
<li>
<p><a href=https://redhat-connect.gitbook.io/certified-operator-guide/>Certified Operator Build Guide</a></p>
</li>
<li>
<p><a href=https://sdk.operatorframework.io/docs/>Operator SDK Documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
<footer class=footline>
</footer>
</div>
</div>
<div id=navigation-bottom>
<a class="nav-prev btn btn-default" href=/openshift/2021-02-27-understanding-block-devices/ title="Understanding RWO block device handling in OpenShift"> <i class="fa fa-chevron-left btn-bottom-prev"></i><span class=btn-bottom-text>Previous: </span> Understanding RWO block device handling in OpenShift</a>
<a class="nav-next btn btn-default" href=/openshift/2020-12-10-thanos-vs-thanos/ title="Thanos Querier vs Thanos Querier" style=margin-right:0><i class="fa fa-chevron-right btn-bottom-next"></i><span class=btn-bottom-text>Next:</span> Thanos Querier vs Thanos Querier</a>
</div>
<div class=copyright>
<p>Copyright &copy; 2020 - 2021 Toni Schmidbauer & Thomas Jungbauer</p>
<p>Built with <a href=https://github.com/matcornic/hugo-theme-learn target=_blank rel="noopener noreferrer">Hugo Learn Theme</i></a> and <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a></p>
</div>
</section>
<div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div>
</div>
<script src=/js/clipboard.min.js?1637052721></script>
<script src=/js/perfect-scrollbar.min.js?1637052721></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1637052721></script>
<script src=/js/jquery.sticky.js?1637052721></script>
<script src=/js/featherlight.min.js?1637052721></script>
<script src=/js/highlight.pack.js?1637052721></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=/js/modernizr.custom-3.6.0.js?1637052721></script>
<script src=/js/learn.js?1637052721></script>
<script src=/js/hugo-learn.js?1637052721></script>
<script src=/js/yaub.js?1637052721></script>
<script>window.addEventListener('DOMContentLoaded',()=>{const a=new IntersectionObserver(a=>{a.forEach(a=>{const b=a.target.getAttribute('id');a.intersectionRatio>0&&(clearActiveStatesInTableOfContents(),document.querySelector(`aside nav li a[href="#${b}"]`).parentElement.classList.add('active'))})});document.querySelectorAll('h1[id],h2[id],h3[id],h4[id]').forEach(b=>{a.observe(b)})});function clearActiveStatesInTableOfContents(){document.querySelectorAll('aside nav li').forEach(a=>{a.classList.remove('active')})}</script>
<script type=text/javascript>function scrollTopAnimated(){$("html, body").animate({scrollTop:"0"},500)}</script>
<script>function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}$(".summary-box").click(function(){return window.location=$(this).find("a").attr("href"),!1})</script>
<script>const btn=document.querySelector(".btn-toggle"),prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)"),currentTheme=localStorage.getItem("theme");currentTheme=="dark"?document.body.classList.toggle("dark-theme"):currentTheme=="light"&&document.body.classList.toggle("light-theme"),btn.addEventListener("click",function(){var a;prefersDarkScheme.matches?(document.body.classList.toggle("light-theme"),a=document.body.classList.contains("light-theme")?"light":"dark"):(document.body.classList.toggle("dark-theme"),a=document.body.classList.contains("dark-theme")?"dark":"light"),localStorage.setItem("theme",a)})</script>
</body>
</html>