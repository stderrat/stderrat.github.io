<!doctype html><html lang=en class="js csstransforms3d"><head><meta name=google-site-verification content="yq2Ib3doJVHVlEW2wtHap5WY54JhS2CCvI40y30F0FI"><meta charset=utf-8><meta name=color-scheme content="dark light"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.101.0"><meta name=description content="TechBlog about OpenShift/Ansible/Satellite and much more"><meta name=author content="Toni Schmidbauer & Thomas Jungbauer"><meta name=keywords content><link rel=canonical href=https://blog.stderr.at/openshift/2023-10-23-openshift-falco/><link rel=icon href=/images/favicon.ico type=image/png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-180x180.png><link rel=apple-touch-icon sizes=128x128 href=/images/apple-touch-icon-128x128.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-touch-icon-72x72.png><link rel=apple-touch-icon href=/images/apple-touch-icon-57x57.png><link rel="shortcut icon" href=/images/favicon.ico><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><title>Setting up Falco on OpenShift 4.12 :: TechBlog about OpenShift/Ansible/Satellite and much more</title><link rel=manifest href=/manifest.json><meta name=theme-color content="#317EFB"><link href=/css/nucleus.min.css?1704004883 rel=stylesheet><link href=/css/fontawesome-all.min.css?1704004883 rel=stylesheet><link href=/css/font-awesome-animation.min.css?1704004883 rel=stylesheet><link href=/css/hybrid.css?1704004883 rel=stylesheet><link href=/css/featherlight.min.css?1704004883 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1704004883 rel=stylesheet><link href=/css/auto-complete.css?1704004883 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1704004883 rel=stylesheet><link href=/css/theme.min.css?1704004883 rel=stylesheet><link href=/css/hugo-theme.css?1704004883 rel=stylesheet><link href=/css/theme-yaub.css?1704004883 rel=stylesheet><script src=/js/jquery-3.6.0.min.js?1704004883></script>
<script src=/js/jquery.waypoints.min.js?1704004883></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/openshift/2023-10-23-openshift-falco/><button onclick=scrollTopAnimated() id=myBtn class="top-btn button fa fa-arrow-up" title="Go to top"></button>
<span class=read-progress></span><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><p class="fa fa-cloud-upload-alt faa-float animated"></p><span class=text>YAUB</span><p class=logoarea><span class="text small">Yet another Useless Blog</span></p></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1704004883></script>
<script type=text/javascript src=/js/auto-complete.js?1704004883></script>
<script type=text/javascript>var baseurl="https://blog.stderr.at/"</script><script type=text/javascript src=/js/search.js?1704004883></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/gitopscollection/ title="GitOps Episodes" class=dd-item><a href=/gitopscollection/>GitOps Episodes</a><ul><li data-nav-id=/gitopscollection/2023-12-28-gitops-repostructure/ title="GitOps - Choosing the right Git repository structure" class=dd-item><a href=/gitopscollection/2023-12-28-gitops-repostructure/>GitOps - Choosing the right Git repository structure</a></li><li data-nav-id=/gitopscollection/2023-12-11-gitops-intro/ title="Introducing the GitOps Approach" class=dd-item><a href=/gitopscollection/2023-12-11-gitops-intro/>Introducing the GitOps Approach</a></li></ul></li><li data-nav-id=/openshift/ title=OpenShift class="dd-item
parent"><a href=/openshift/>OpenShift</a><ul><li data-nav-id=/openshift/2023-11-26-running-falco/ title="Running Falco on OpenShift 4.12" class=dd-item><a href=/openshift/2023-11-26-running-falco/>Running Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023-11-03-quay-deployment-with-gitops/ title="Quay Deployment and Configuration using GitOps" class=dd-item><a href=/openshift/2023-11-03-quay-deployment-with-gitops/>Quay Deployment and Configuration using GitOps</a></li><li data-nav-id=/openshift/2023-10-23-openshift-falco/ title="Setting up Falco on OpenShift 4.12" class="dd-item active"><a href=/openshift/2023-10-23-openshift-falco/>Setting up Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023-10-18-force-machineconfig-rollout/ title="How to force a MachineConfig rollout" class=dd-item><a href=/openshift/2023-10-18-force-machineconfig-rollout/>How to force a MachineConfig rollout</a></li><li data-nav-id=/openshift/2023-03-20-operator-installation-with-argocd/ title="Operator installation with Argo CD" class=dd-item><a href=/openshift/2023-03-20-operator-installation-with-argocd/>Operator installation with Argo CD</a></li><li data-nav-id=/openshift/2023-02-16-ssl-certificate-management/ title="SSL Certificate Management for OpenShift on AWS" class=dd-item><a href=/openshift/2023-02-16-ssl-certificate-management/>SSL Certificate Management for OpenShift on AWS</a></li><li data-nav-id=/openshift/2022-11-04-argocd-and-serversideapply/ title="Using ServerSideApply with ArgoCD" class=dd-item><a href=/openshift/2022-11-04-argocd-and-serversideapply/>Using ServerSideApply with ArgoCD</a></li><li data-nav-id=/openshift/2022-08-16-hashicorp-vault/ title="Secrets Management - Vault on OpenShift" class=dd-item><a href=/openshift/2022-08-16-hashicorp-vault/>Secrets Management - Vault on OpenShift</a></li><li data-nav-id=/openshift/2022-04-22-multi-cloud-gateway/ title="Overview of Red Hat's Multi Cloud Gateway (Noobaa)" class=dd-item><a href=/openshift/2022-04-22-multi-cloud-gateway/>Overview of Red Hat's Multi Cloud Gateway (Noobaa)</a></li><li data-nav-id=/openshift/2021-09-25-sealed_secrets/ title="Secure your secrets with Sealed Secrets" class=dd-item><a href=/openshift/2021-09-25-sealed_secrets/>Secure your secrets with Sealed Secrets</a></li><li data-nav-id=/openshift/2021-02-27-understanding-block-devices/ title="Understanding RWO block device handling in OpenShift" class=dd-item><a href=/openshift/2021-02-27-understanding-block-devices/>Understanding RWO block device handling in OpenShift</a></li><li data-nav-id=/openshift/2021-01-27-writingoperatoransible/ title="Writing Operator using Ansible" class=dd-item><a href=/openshift/2021-01-27-writingoperatoransible/>Writing Operator using Ansible</a></li><li data-nav-id=/openshift/2020-12-10-thanos-vs-thanos/ title="Thanos Querier vs Thanos Querier" class=dd-item><a href=/openshift/2020-12-10-thanos-vs-thanos/>Thanos Querier vs Thanos Querier</a></li><li data-nav-id=/openshift/2020-08-06-argocd/ title="GitOps - Argo CD" class=dd-item><a href=/openshift/2020-08-06-argocd/>GitOps - Argo CD</a></li><li data-nav-id=/openshift/2020-04-16-tekton/ title="OpenShift Pipelines - Tekton Introduction" class=dd-item><a href=/openshift/2020-04-16-tekton/>OpenShift Pipelines - Tekton Introduction</a></li><li data-nav-id=/openshift/2020-04-01-oc-commands/ title="Helpful oc / kubectl commands" class=dd-item><a href=/openshift/2020-04-01-oc-commands/>Helpful oc / kubectl commands</a></li></ul></li><li data-nav-id=/day-2/ title="OpenShift Day-2" class=dd-item><a href=/day-2/>OpenShift Day-2</a><ul><li data-nav-id=/day-2/etcd/ title=etcd class=dd-item><a href=/day-2/etcd/>etcd</a><ul><li data-nav-id=/day-2/etcd/2022-01-29-automatedetcdbackup/ title="Automated ETCD Backup" class=dd-item><a href=/day-2/etcd/2022-01-29-automatedetcdbackup/>Automated ETCD Backup</a></li></ul></li><li data-nav-id=/day-2/labels_environmets/ title="Labels & Environments" class=dd-item><a href=/day-2/labels_environmets/>Labels & Environments</a><ul><li data-nav-id=/day-2/labels_environmets/2022-01-12-creatingenvironment/ title="Working with Environments" class=dd-item><a href=/day-2/labels_environmets/2022-01-12-creatingenvironment/>Working with Environments</a></li></ul></li><li data-nav-id=/day-2/pod-placement/ title="Pod Placement" class=dd-item><a href=/day-2/pod-placement/>Pod Placement</a><ul><li data-nav-id=/day-2/pod-placement/2021-08-26-podplacement-intro/ title=Introduction class=dd-item><a href=/day-2/pod-placement/2021-08-26-podplacement-intro/>Introduction</a></li><li data-nav-id=/day-2/pod-placement/2021-08-29-node-affinity/ title="Node Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-29-node-affinity/>Node Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-27-podplacement/ title=NodeSelector class=dd-item><a href=/day-2/pod-placement/2021-08-27-podplacement/>NodeSelector</a></li><li data-nav-id=/day-2/pod-placement/2021-08-28-affinity/ title="Pod Affinity/Anti-Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-28-affinity/>Pod Affinity/Anti-Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-30-taints/ title="Taints and Tolerations" class=dd-item><a href=/day-2/pod-placement/2021-08-30-taints/>Taints and Tolerations</a></li><li data-nav-id=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/ title="Topology Spread Constraints" class=dd-item><a href=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/>Topology Spread Constraints</a></li><li data-nav-id=/day-2/pod-placement/2021-09-01-descheduler/ title="Using Descheduler" class=dd-item><a href=/day-2/pod-placement/2021-09-01-descheduler/>Using Descheduler</a></li></ul></li></ul></li><li data-nav-id=/securesupplychain/ title="Secure Supply Chain" class=dd-item><a href=/securesupplychain/>Secure Supply Chain</a><ul><li data-nav-id=/securesupplychain/2023-06-15-securesupplychain-intro/ title="Introduction to a Secure Supply Chain" class=dd-item><a href=/securesupplychain/2023-06-15-securesupplychain-intro/>Introduction to a Secure Supply Chain</a></li><li data-nav-id=/securesupplychain/2023-06-16-securesupplychain-step1/ title="Step 1 - Listen to Events" class=dd-item><a href=/securesupplychain/2023-06-16-securesupplychain-step1/>Step 1 - Listen to Events</a></li><li data-nav-id=/securesupplychain/2023-06-17-securesupplychain-step2/ title="Step 2 - Pipelines" class=dd-item><a href=/securesupplychain/2023-06-17-securesupplychain-step2/>Step 2 - Pipelines</a></li><li data-nav-id=/securesupplychain/2023-06-18-securesupplychain-step3/ title="Step 3 - SonarQube" class=dd-item><a href=/securesupplychain/2023-06-18-securesupplychain-step3/>Step 3 - SonarQube</a></li><li data-nav-id=/securesupplychain/2023-06-19-securesupplychain-step4/ title="Step 4 - Verify Git Commit" class=dd-item><a href=/securesupplychain/2023-06-19-securesupplychain-step4/>Step 4 - Verify Git Commit</a></li><li data-nav-id=/securesupplychain/2023-06-20-securesupplychain-step5/ title="Step 5 - Build and Sign Image" class=dd-item><a href=/securesupplychain/2023-06-20-securesupplychain-step5/>Step 5 - Build and Sign Image</a></li><li data-nav-id=/securesupplychain/2023-06-21-securesupplychain-step6/ title="Step 6 - Scanning with ACS" class=dd-item><a href=/securesupplychain/2023-06-21-securesupplychain-step6/>Step 6 - Scanning with ACS</a></li><li data-nav-id=/securesupplychain/2023-06-22-securesupplychain-step7/ title="Step 7 - Generating a SBOM" class=dd-item><a href=/securesupplychain/2023-06-22-securesupplychain-step7/>Step 7 - Generating a SBOM</a></li><li data-nav-id=/securesupplychain/2023-06-23-securesupplychain-step8/ title="Step 8 - Updating Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-23-securesupplychain-step8/>Step 8 - Updating Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-24-securesupplychain-step9/ title="Step 9 - Linting Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-24-securesupplychain-step9/>Step 9 - Linting Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-25-securesupplychain-step10/ title="Step 10 - The Example Application" class=dd-item><a href=/securesupplychain/2023-06-25-securesupplychain-step10/>Step 10 - The Example Application</a></li><li data-nav-id=/securesupplychain/2023-06-26-securesupplychain-step11/ title="Step 11 - ACS Deployment Check" class=dd-item><a href=/securesupplychain/2023-06-26-securesupplychain-step11/>Step 11 - ACS Deployment Check</a></li><li data-nav-id=/securesupplychain/2023-06-27-securesupplychain-step12/ title="Step 12 - Verify TLog Signature" class=dd-item><a href=/securesupplychain/2023-06-27-securesupplychain-step12/>Step 12 - Verify TLog Signature</a></li><li data-nav-id=/securesupplychain/2023-06-28-securesupplychain-step13/ title="Step 13 - Bring it to Production" class=dd-item><a href=/securesupplychain/2023-06-28-securesupplychain-step13/>Step 13 - Bring it to Production</a></li></ul></li><li data-nav-id=/compliance/ title=Compliance class=dd-item><a href=/compliance/>Compliance</a><ul><li data-nav-id=/compliance/2021/07/oc-compliance-command-line-plugin/ title="oc compliance command line plugin" class=dd-item><a href=/compliance/2021/07/oc-compliance-command-line-plugin/>oc compliance command line plugin</a></li><li data-nav-id=/compliance/2021/07/compliance-operator/ title="Compliance Operator" class=dd-item><a href=/compliance/2021/07/compliance-operator/>Compliance Operator</a></li></ul></li><li data-nav-id=/service-mesh/ title="Service Mesh" class=dd-item><a href=/service-mesh/>Service Mesh</a><ul><li data-nav-id=/service-mesh/2020/05/enable-automatic-route-creation/ title="Enable Automatic Route Creation" class=dd-item><a href=/service-mesh/2020/05/enable-automatic-route-creation/>Enable Automatic Route Creation</a></li><li data-nav-id=/service-mesh/2020/05/authorization-rbac/ title="Authorization (RBAC)" class=dd-item><a href=/service-mesh/2020/05/authorization-rbac/>Authorization (RBAC)</a></li><li data-nav-id=/service-mesh/2020/04/deploy-example-bookinfo-application/ title="Deploy Example Bookinfo Application" class=dd-item><a href=/service-mesh/2020/04/deploy-example-bookinfo-application/>Deploy Example Bookinfo Application</a></li><li data-nav-id=/service-mesh/2020/04/service-mesh-1.1-released/ title="Service Mesh 1.1 released" class=dd-item><a href=/service-mesh/2020/04/service-mesh-1.1-released/>Service Mesh 1.1 released</a></li><li data-nav-id=/service-mesh/2020/04/authentication-jwt/ title="Authentication JWT" class=dd-item><a href=/service-mesh/2020/04/authentication-jwt/>Authentication JWT</a></li><li data-nav-id=/service-mesh/2020/04/mutual-tls-authentication/ title="Mutual TLS Authentication" class=dd-item><a href=/service-mesh/2020/04/mutual-tls-authentication/>Mutual TLS Authentication</a></li><li data-nav-id=/service-mesh/2020/04/fault-injection/ title="Fault Injection" class=dd-item><a href=/service-mesh/2020/04/fault-injection/>Fault Injection</a></li><li data-nav-id=/service-mesh/2020/04/limit-egress/external-traffic/ title="Limit Egress/External Traffic" class=dd-item><a href=/service-mesh/2020/04/limit-egress/external-traffic/>Limit Egress/External Traffic</a></li><li data-nav-id=/service-mesh/2020/04/advanced-routing-example/ title="Advanced Routing Example" class=dd-item><a href=/service-mesh/2020/04/advanced-routing-example/>Advanced Routing Example</a></li><li data-nav-id=/service-mesh/2020/04/routing-example/ title="Routing Example" class=dd-item><a href=/service-mesh/2020/04/routing-example/>Routing Example</a></li><li data-nav-id=/service-mesh/2020/03/ingress-with-custom-domain/ title="Ingress with custom domain" class=dd-item><a href=/service-mesh/2020/03/ingress-with-custom-domain/>Ingress with custom domain</a></li><li data-nav-id=/service-mesh/2020/03/ingress-traffic/ title="Ingress Traffic" class=dd-item><a href=/service-mesh/2020/03/ingress-traffic/>Ingress Traffic</a></li><li data-nav-id=/service-mesh/2020/03/deploy-microservices/ title="Deploy Microservices" class=dd-item><a href=/service-mesh/2020/03/deploy-microservices/>Deploy Microservices</a></li><li data-nav-id=/service-mesh/2020/03/installation/ title=Installation class=dd-item><a href=/service-mesh/2020/03/installation/>Installation</a></li></ul></li><li data-nav-id=/general/ title=General class=dd-item><a href=/general/>General</a><ul><li data-nav-id=/general/2020/05/basic-usage-of-git/ title="Basic usage of git" class=dd-item><a href=/general/2020/05/basic-usage-of-git/>Basic usage of git</a></li><li data-nav-id=/general/2020/04/red-hat-satellite-cheat-sheet/ title="Red Hat Satellite Cheat Sheet" class=dd-item><a href=/general/2020/04/red-hat-satellite-cheat-sheet/>Red Hat Satellite Cheat Sheet</a></li></ul></li><li data-nav-id=/ansible/ title=Ansible class=dd-item><a href=/ansible/>Ansible</a><ul><li data-nav-id=/ansible/2021/11/ansible-style-guide/ title="Ansible Style Guide" class=dd-item><a href=/ansible/2021/11/ansible-style-guide/>Ansible Style Guide</a></li><li data-nav-id=/ansible/2021/10/automation-controller-and-ldap-authentication/ title="Automation Controller and LDAP Authentication" class=dd-item><a href=/ansible/2021/10/automation-controller-and-ldap-authentication/>Automation Controller and LDAP Authentication</a></li><li data-nav-id=/ansible/2021/07/ansible-tower-and-downloading-collections/ title="Ansible Tower and downloading collections" class=dd-item><a href=/ansible/2021/07/ansible-tower-and-downloading-collections/>Ansible Tower and downloading collections</a></li><li data-nav-id=/ansible/2020/04/ansible-azure-resource-manager-example/ title="Ansible - Azure Resource Manager Example" class=dd-item><a href=/ansible/2020/04/ansible-azure-resource-manager-example/>Ansible - Azure Resource Manager Example</a></li><li data-nav-id=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/ title="DO410 Ansible and Ansible Tower training notes" class=dd-item><a href=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/>DO410 Ansible and Ansible Tower training notes</a></li></ul></li><li data-nav-id=/acs/ title="Advanced Cluster Security" class=dd-item><a href=/acs/>Advanced Cluster Security</a><ul><li data-nav-id=/acs/2021-12-11-acsauth/ title="Advanced Cluster Security - Authentication" class=dd-item><a href=/acs/2021-12-11-acsauth/>Advanced Cluster Security - Authentication</a></li></ul></li><li data-nav-id=/azure/ title=Azure class=dd-item><a href=/azure/>Azure</a><ul><li data-nav-id=/azure/2021-10-29-private-aro/ title="Stumbling into Azure Part II: Setting up a private ARO cluster" class=dd-item><a href=/azure/2021-10-29-private-aro/>Stumbling into Azure Part II: Setting up a private ARO cluster</a></li><li data-nav-id=/azure/2021-10-17-s2s-vpn/ title="Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing" class=dd-item><a href=/azure/2021-10-17-s2s-vpn/>Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing</a></li></ul></li><li data-nav-id=/java/ title=Java class=dd-item><a href=/java/>Java</a><ul><li data-nav-id=/java/2022-02-25-jpa-disconnected-entity/ title="Adventures in Java Land: JPA disconnected entities" class=dd-item><a href=/java/2022-02-25-jpa-disconnected-entity/>Adventures in Java Land: JPA disconnected entities</a></li></ul></li><li data-nav-id=/quay/ title=Quay class=dd-item><a href=/quay/>Quay</a><ul><li data-nav-id=/quay/2021-09-07-quay-upgrade-3.4/ title="Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator" class=dd-item><a href=/quay/2021-09-07-quay-upgrade-3.4/>Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator</a></li><li data-nav-id=/quay/2020-05-13-quay-tutorial1/ title="Red Hat Quay Registry - Overview and Installation" class=dd-item><a href=/quay/2020-05-13-quay-tutorial1/>Red Hat Quay Registry - Overview and Installation</a></li></ul></li><li data-nav-id=/legaldisclosure/ title="Legal Disclosure" class=dd-item><a href=/legaldisclosure/>Legal Disclosure</a></li><li data-nav-id=/rss/ title="RSS Feeds" class=dd-item><a href=/rss/>RSS Feeds</a></li></ul><section id=shortcuts><h3 class=shortcut-title>More</h3><ul><li><a class=padding href=https://blog.stderr.at/tags><i class='fas fa-tags'></i> Tags</a></li><li><a class=padding href=https://blog.stderr.at/categories><i class='far fa-bookmark'></i> Catagories</a></li><li><a class=padding href=https://blog.stderr.at/archive><i class='fas fa-box'></i> Archive</a></li><li><a class=padding href=https://charts.stderr.at/><i class='fas fa-book'></i> Helm Charts</a></li><li><a class=padding href=https://www.redhat.com><i class='fab fa-redhat'></i> Red Hat</a></li></ul></section><section id=footer></section></div></nav><section id=body class=post-content><div id=overlay></div><aside id=toc-field class="hidden lg:block tableOfContentContainer"><header id=TableOfContentsHeader>What's on this Page</header><nav id=TableOfContents><ul><li><a href=#headline-1>First Try</a><ul><li><a href=#headline-2>Summary of problems</a></li></ul></li><li><a href=#headline-3>Fixing the Falco daemonset</a><ul><li><a href=#headline-4>UPDATE</a></li></ul></li><li><a href=#headline-5>Fixing falco-sidekick and falco-sidekick-ui</a></li><li><a href=#headline-6>Testing Falco</a><ul><li><a href=#headline-7>Creating an event</a></li></ul></li></ul></nav><div id=navigation><a class=nav-prev href=/openshift/2023-11-03-quay-deployment-with-gitops/ title="Quay Deployment and Configuration using GitOps"><i class="fa fa-chevron-left"></i></a>
<a class=nav-next href=/openshift/2023-10-18-force-machineconfig-rollout/ title="How to force a MachineConfig rollout" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></aside><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://schema.org/BreadcrumbList><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/><span itemprop=name>YAUB Yet Another Useless Blog</span><meta itemprop=position content="1"></a></span>> <span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/openshift/><span itemprop=name>OpenShift</span><meta itemprop=position content="2"></a></span>> Setting up Falco on OpenShift 4.12</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#headline-1>First Try</a><ul><li><a href=#headline-2>Summary of problems</a></li></ul></li><li><a href=#headline-3>Fixing the Falco daemonset</a><ul><li><a href=#headline-4>UPDATE</a></li></ul></li><li><a href=#headline-5>Fixing falco-sidekick and falco-sidekick-ui</a></li><li><a href=#headline-6>Testing Falco</a><ul><li><a href=#headline-7>Creating an event</a></li></ul></li></ul></nav></div></div><div class=social><a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2023-10-23-openshift-falco%2f" class="facebook no-highlight" aria-label="share on Facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-facebook" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a href="https://twitter.com/intent/tweet?hashtags=codingnconcepts&url=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2023-10-23-openshift-falco%2f&text=Setting%20up%20Falco%20on%20OpenShift%204.12" class="twitter no-highlight" aria-label="share on Twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5.0-78.8 35.3-78.8 78.8.0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3C20 26 16.1 39.6 16.1 54c0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1.0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4.0-12.6-.4-18.8-1.1C34.9 299 76.3 312 120.8 312c144.9.0 224.1-120 224.1-224.1.0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg></div></div></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2023-10-23-openshift-falco%2f&source=https%3a%2f%2fblog.stderr.at%2fopenshift%2f2023-10-23-openshift-falco%2f&title=Setting%20up%20Falco%20on%20OpenShift%204.12&summary=Setting%20up%20Falco%20on%20OpenShift%204.12" class="linkedin no-highlight" aria-label="share on Linkedin"><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg></div></div></a><a href="whatsapp://send?text=Setting%20up%20Falco%20on%20OpenShift%204.12%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0a%3cnil%3e%0a%0ahttps%3a%2f%2fblog.stderr.at%2fopenshift%2f2023-10-23-openshift-falco%2f%0a" class="whatsapp no-highlight" aria-label="share on Whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-whatsapp" width="24" height="24" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a><a href="mailto:?subject=TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more - Setting%20up%20Falco%20on%20OpenShift%204.12.&body=Setting%20up%20Falco%20on%20OpenShift%204.12%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0a%3cnil%3e%0a%0ahttps%3a%2f%2fblog.stderr.at%2fopenshift%2f2023-10-23-openshift-falco%2f%0a" class="email no-highlight" aria-label="share on Email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg></div></div></a></div></div></div><div id=head-tags></div><div id=body-inner><h1>Setting up Falco on OpenShift 4.12</h1><p class=tracked><time class="f6 mv4 dib tracked" datetime=2023-10-23T00:00:00Z><strong>October 23, 2023</strong></time>
- By:
Toni Schmidbauer
( Lastmod: 2023-11-13 ) - <span class=readtime><strong>9 min read</strong></span></p><p><a href=https://falco.org/>Falco</a> is a security tool to monitor kernel events like system calls to
provide real-time alerts. In this post I'll document the steps taken
to get Open Source <a href=https://falco.org/>Falco</a> running on an OpenShift 4.12 cluster.</p><p><a href=https://blog.stderr.at/openshift/2023-10-23-openshift-falco/#headline-4>UPDATE</a>: Use the <code>falco-driver-loader-legacy</code> image for OpenShift 4.12 deployments.</p><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>First Try</h2><div id=outline-text-headline-1 class=outline-text-2><p>We will use the <a href=https://falcosecurity.github.io/charts>Falco Helm chart</a> version 3.8.0 for our first try of setting up Falco on our OpenShift cluster.</p><p>This is our values file:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>driver:
</span></span><span style=display:flex><span>  kind: ebpf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>falco:
</span></span><span style=display:flex><span>  json_output: true
</span></span><span style=display:flex><span>  json_include_output_property: true
</span></span><span style=display:flex><span>  log_syslog: false
</span></span><span style=display:flex><span>  log_level: info
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>falcosidekick:
</span></span><span style=display:flex><span>  enabled: true
</span></span><span style=display:flex><span>  webui:
</span></span><span style=display:flex><span>    enabled: true</span></span></code></pre></div></div><p>We would like to use the eBPF driver to monitor kernel events, enable
falco sidekick, which is used to route events and the falco sidekick
UI for easier testing.</p><p>Because of reasons we leverage kustomize to render the helm chart. The
final kustomize config is <a href=https://github.com/tosmi-gitops/openshift-gitops/tree/main/components/apps/falco/base>here</a> (after fixing all problems mentioned
below).</p><p>So after deploying the chart via ArgoCD (another story), we have the following pods:</p><div class="src src-bash"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc get pods -n falco
</span></span><span style=display:flex><span>NAME                             READY   STATUS                  RESTARTS      AGE
</span></span><span style=display:flex><span>falco-4cc8j                      0/2     Init:CrashLoopBackOff   <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>95s ago<span style=color:#f92672>)</span>   4m31s
</span></span><span style=display:flex><span>falco-bx87j                      0/2     Init:CrashLoopBackOff   <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>75s ago<span style=color:#f92672>)</span>   4m29s
</span></span><span style=display:flex><span>falco-ds9w6                      0/2     Init:CrashLoopBackOff   <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>99s ago<span style=color:#f92672>)</span>   4m30s
</span></span><span style=display:flex><span>falco-falcosidekick-ui-redis-0   1/1     Running                 <span style=color:#ae81ff>0</span>             4m28s
</span></span><span style=display:flex><span>falco-gxznz                      0/2     Init:CrashLoopBackOff   <span style=color:#ae81ff>3</span> <span style=color:#f92672>(</span>14s ago<span style=color:#f92672>)</span>   4m30s
</span></span><span style=display:flex><span>falco-vtnk5                      0/2     Init:CrashLoopBackOff   <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>98s ago<span style=color:#f92672>)</span>   4m29s
</span></span><span style=display:flex><span>falco-wbn2k                      0/2     Init:CrashLoopBackOff   <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>80s ago<span style=color:#f92672>)</span>   4m29s</span></span></code></pre></div></div><p>hm, not so good. Seems like some <code>initContainers</code> are failing.</p><p>Let's check the <code>falco-driver-loader</code> initContainer:</p><div class="src src-bash"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>* Setting up /usr/src links from host
</span></span><span style=display:flex><span>* Running falco-driver-loader <span style=color:#66d9ef>for</span>: falco version<span style=color:#f92672>=</span>0.36.1, driver version<span style=color:#f92672>=</span>6.0.1+driver, arch<span style=color:#f92672>=</span>x86_64, kernel release<span style=color:#f92672>=</span>4.18.0-372.73.1.el8_6.x86_64, kernel version<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>* Running falco-driver-loader with: driver<span style=color:#f92672>=</span>bpf, compile<span style=color:#f92672>=</span>yes, download<span style=color:#f92672>=</span>yes
</span></span><span style=display:flex><span>* Mounting debugfs
</span></span><span style=display:flex><span>mount: /sys/kernel/debug: permission denied.
</span></span><span style=display:flex><span>       dmesg<span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> may have more information after failed mount system call.
</span></span><span style=display:flex><span>* Filename <span style=color:#e6db74>&#39;falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o&#39;</span> is composed of:
</span></span><span style=display:flex><span> - driver name: falco
</span></span><span style=display:flex><span> - target identifier: rhcos
</span></span><span style=display:flex><span> - kernel release: 4.18.0-372.73.1.el8_6.x86_64
</span></span><span style=display:flex><span> - kernel version: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>* Trying to download a prebuilt eBPF probe from https://download.falco.org/driver/6.0.1%2Bdriver/x86_64/falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o
</span></span><span style=display:flex><span>curl: <span style=color:#f92672>(</span>22<span style=color:#f92672>)</span> The requested URL returned error: <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span>Unable to find a prebuilt falco eBPF probe
</span></span><span style=display:flex><span>* Trying to compile the eBPF probe <span style=color:#f92672>(</span>falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>expr: syntax error: unexpected argument <span style=color:#e6db74>&#39;1&#39;</span>
</span></span><span style=display:flex><span>make<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: *** /lib/modules/4.18.0-372.73.1.el8_6.x86_64/build: No such file or directory.  Stop.
</span></span><span style=display:flex><span>make: *** <span style=color:#f92672>[</span>Makefile:38: all<span style=color:#f92672>]</span> Error <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>mv: cannot stat <span style=color:#e6db74>&#39;/usr/src/falco-6.0.1+driver/bpf/probe.o&#39;</span>: No such file or directory
</span></span><span style=display:flex><span>Unable to load the falco eBPF probe</span></span></code></pre></div></div><p>Seems to be an issue with a missing directory <span style=text-decoration:underline>/lib/modules/4.18.0-372.73.1.el8_6.x86_64/build</span>.</p><p>And we told the helm chart to enable <code>falco-sidekick</code> and
<code>falco-sidekick-ui</code>, but where are they?</p><p>Let's check the events with <code>oc get events</code> as well, and what do we see?</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>8s          Warning   FailedCreate             replicaset/falco-falcosidekick-7cfbbbf89f      Error creating: pods <span style=color:#e6db74>&#34;falco-falcosidekick-7cfbbbf89f-&#34;</span> is forbidden: unable to validate against any security context constraint: <span style=color:#f92672>[</span>provider <span style=color:#e6db74>&#34;anyuid&#34;</span>: Forbidden: not usable by user or serviceaccount, provider restricted-v2: .spec.securityContext.fsGroup: Invalid value: <span style=color:#f92672>[]</span>int64<span style=color:#f92672>{</span>1234<span style=color:#f92672>}</span>: <span style=color:#ae81ff>1234</span> is not an allowed group, provider restricted-v2: .containers<span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>.runAsUser: Invalid value: 1234: must be in the ranges: <span style=color:#f92672>[</span>1000730000, 1000739999<span style=color:#f92672>]</span>, provider <span style=color:#e6db74>&#34;restricted&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;nonroot-v2&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;nonroot&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;hostmount-anyuid&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;machine-api-termination-handler&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;hostnetwork-v2&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;hostnetwork&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;hostaccess&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;falco&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;node-exporter&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;privileged&#34;</span>: Forbidden: not usable by user or serviceaccount<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>6s          Warning   FailedCreate             replicaset/falco-falcosidekick-ui-76885bd484   Error creating: pods <span style=color:#e6db74>&#34;falco-falcosidekick-ui-76885bd484-&#34;</span> is forbidden: unable to validate against any security context constraint: <span style=color:#f92672>[</span>provider <span style=color:#e6db74>&#34;anyuid&#34;</span>: Forbidden: not usable by user or serviceaccount, provider restricted-v2: .spec.securityContext.fsGroup: Invalid value: <span style=color:#f92672>[]</span>int64<span style=color:#f92672>{</span>1234<span style=color:#f92672>}</span>: <span style=color:#ae81ff>1234</span> is not an allowed group, provider restricted-v2: .containers<span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>.runAsUser: Invalid value: 1234: must be in the ranges: <span style=color:#f92672>[</span>1000730000, 1000739999<span style=color:#f92672>]</span>, provider <span style=color:#e6db74>&#34;restricted&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;nonroot-v2&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;nonroot&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;hostmount-anyuid&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;machine-api-termination-handler&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;hostnetwork-v2&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;hostnetwork&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;hostaccess&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;falco&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;node-exporter&#34;</span>: Forbidden: not usable by user or serviceaccount, provider <span style=color:#e6db74>&#34;privileged&#34;</span>: Forbidden: not usable by user or serviceaccount<span style=color:#f92672>]</span></span></span></code></pre></div></div><p>Looks like a problem with OpenShifts Security Context constraints (SCC's).</p><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Summary of problems</h3><div id=outline-text-headline-2 class=outline-text-3><ul><li>The falco <code>DaemonSet</code> fails to start pods because there is an issue with a missing directory</li><li>Falco Sidekick and Falco Sidekick UI fails to start because of
Security Context Constraint (SCC) issues</li></ul></div></div></div></div><div id=outline-container-headline-3 class=outline-2><h2 id=headline-3>Fixing the Falco daemonset</h2><div id=outline-text-headline-3 class=outline-text-2><p>Falco tries to download a pre-compiled eBPF probe, fails and then
tries to compile that probe for our host OS kernel. This fails with the message:</p><div class="src src-bash"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: *** /lib/modules/4.18.0-372.73.1.el8_6.x86_64/build: No such file or directory.  Stop.</span></span></code></pre></div></div><p>As far as we know there are no kernel sources installed on RHCOS nodes
in OpenShift. After a little bit of searching the interweb we found
the following issue comment on Github:</p><p><a href=https://github.com/falcosecurity/falco/issues/1505#issuecomment-754745960>OpenShift under vsphere: Download failed, consider compiling your own falco module and loading it or getting in touch with the Falco community</a></p><p>So we need to enable the <code>kernel-devel</code> extension, the official docs are
<a href=https://docs.openshift.com/container-platform/4.12/post_installation_configuration/machine-configuration-tasks.html#rhcos-add-extensions_post-install-machine-configuration-tasks>here</a>. It does not mention <code>kernel-devel</code>, but there's a <a href=https://access.redhat.com/solutions/6972423>knowledge base
article</a> mentioning <code>kernel-devel</code>, so let's give it a try.</p><p>We deploy two <code>MachineConfigs</code>, one for <a href=https://github.com/tosmi-gitops/openshift-gitops/blob/main/components/apps/falco/base/worker-machineconfig.yaml>worker</a> and one for <a href=https://github.com/tosmi-gitops/openshift-gitops/blob/main/components/apps/falco/base/master-machineconfig.yaml>master</a> nodes
to rollout the extension, the worker configuration looks like this:</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>machineconfiguration.openshift.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>MachineConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>machineconfiguration.openshift.io/role</span>: <span style=color:#ae81ff>worker</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>99</span>-<span style=color:#ae81ff>worker-kernel-devel-extensions</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>extensions</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>kernel-devel</span></span></span></code></pre></div></div><p>See also our Kustomize configuration <a href=https://github.com/tosmi-gitops/openshift-gitops/blob/main/components/apps/falco/base/kustomization.yaml>here</a>.</p><p>As soon as we apply our <code>MachineConfigs</code>, OpenShift starts the rollout via MaschineConfigPool's:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>$ oc get mcp
</span></span><span style=display:flex><span>NAME     CONFIG                                             UPDATED   UPDATING   DEGRADED   MACHINECOUNT   READYMACHINECOUNT   UPDATEDMACHINECOUNT   DEGRADEDMACHINECOUNT   AGE
</span></span><span style=display:flex><span>master   rendered-master-ce464ff45cc049fce3e8a63e36a4ee9e   False     True       False      3              0                   0                     0                      13d
</span></span><span style=display:flex><span>worker   rendered-worker-a0f8f0d915ef01ba4a1ab3047b6c863d   False     True       False      3              0                   0                     0                      13d</span></span></code></pre></div></div><p>When the rollout is done, let's restart all Falco <code>DaemonSet</code> pods:</p><div class="src src-bash"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc delete pods -l app.kubernetes.io/name<span style=color:#f92672>=</span>falco</span></span></code></pre></div></div><p>And check the status:</p><div class="src src-bash"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc get pods
</span></span><span style=display:flex><span>NAME                             READY   STATUS                  RESTARTS     AGE
</span></span><span style=display:flex><span>falco-5wfnk                      0/2     Init:Error              <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>3s ago<span style=color:#f92672>)</span>   7s
</span></span><span style=display:flex><span>falco-66fxw                      0/2     Init:0/2                <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>2s ago<span style=color:#f92672>)</span>   6s
</span></span><span style=display:flex><span>falco-6fbc7                      0/2     Init:CrashLoopBackOff   <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>2s ago<span style=color:#f92672>)</span>   8s
</span></span><span style=display:flex><span>falco-8h8n4                      0/2     Init:0/2                <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>2s ago<span style=color:#f92672>)</span>   6s
</span></span><span style=display:flex><span>falco-falcosidekick-ui-redis-0   1/1     Running                 <span style=color:#ae81ff>0</span>            18m
</span></span><span style=display:flex><span>falco-nhld2                      0/2     Init:CrashLoopBackOff   <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>2s ago<span style=color:#f92672>)</span>   6s
</span></span><span style=display:flex><span>falco-xqv4b                      0/2     Init:CrashLoopBackOff   <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>3s ago<span style=color:#f92672>)</span>   8s</span></span></code></pre></div></div><p>still, the <code>initContainers</code> fail. Lets check the log again</p><div class="src src-bash"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc logs -c falco-driver-loader falco-5wfnk
</span></span><span style=display:flex><span>* Setting up /usr/src links from host
</span></span><span style=display:flex><span>* Running falco-driver-loader <span style=color:#66d9ef>for</span>: falco version<span style=color:#f92672>=</span>0.36.1, driver version<span style=color:#f92672>=</span>6.0.1+driver, arch<span style=color:#f92672>=</span>x86_64, kernel release<span style=color:#f92672>=</span>4.18.0-372.73.1.el8_6.x86_64, kernel version<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>* Running falco-driver-loader with: driver<span style=color:#f92672>=</span>bpf, compile<span style=color:#f92672>=</span>yes, download<span style=color:#f92672>=</span>yes
</span></span><span style=display:flex><span>* Mounting debugfs
</span></span><span style=display:flex><span>mount: /sys/kernel/debug: permission denied.
</span></span><span style=display:flex><span>       dmesg<span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> may have more information after failed mount system call.
</span></span><span style=display:flex><span>* Filename <span style=color:#e6db74>&#39;falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o&#39;</span> is composed of:
</span></span><span style=display:flex><span> - driver name: falco
</span></span><span style=display:flex><span> - target identifier: rhcos
</span></span><span style=display:flex><span> - kernel release: 4.18.0-372.73.1.el8_6.x86_64
</span></span><span style=display:flex><span> - kernel version: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>* Trying to download a prebuilt eBPF probe from https://download.falco.org/driver/6.0.1%2Bdriver/x86_64/falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o
</span></span><span style=display:flex><span>curl: <span style=color:#f92672>(</span>22<span style=color:#f92672>)</span> The requested URL returned error: <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span>Unable to find a prebuilt falco eBPF probe
</span></span><span style=display:flex><span>* Trying to compile the eBPF probe <span style=color:#f92672>(</span>falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Makefile:1005: *** <span style=color:#e6db74>&#34;Cannot generate ORC metadata for CONFIG_UNWINDER_ORC=y, please install libelf-dev, libelf-devel or elfutils-libelf-devel&#34;</span>.  Stop.
</span></span><span style=display:flex><span>make: *** <span style=color:#f92672>[</span>Makefile:38: all<span style=color:#f92672>]</span> Error <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>mv: cannot stat <span style=color:#e6db74>&#39;/usr/src/falco-6.0.1+driver/bpf/probe.o&#39;</span>: No such file or directory
</span></span><span style=display:flex><span>Unable to load the falco eBPF probe</span></span></code></pre></div></div><p>So this time we get another error, the culprit is the following line</p><div class="src src-bash"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Makefile:1005: *** <span style=color:#e6db74>&#34;Cannot generate ORC metadata for CONFIG_UNWINDER_ORC=y, please install libelf-dev, libelf-devel or elfutils-libelf-devel&#34;</span>.  Stop.</span></span></code></pre></div></div><p>Back to searching the interweb only reveals an old <a href=https://github.com/falcosecurity/falco/issues/376>issue</a>, that should
be fixed already.</p><p>So as a quick hack we <a href=https://github.com/tosmi/playground/blob/master/openshift/falco/custom-falco-driver-loader/Dockerfile>modified</a> the <code>falco-driver-loader</code> image to
contain <code>libelf-dev</code> and pushed to image to <a href="https://quay.io/repository/tosmi/falco-driver-loader?tab=tags">quay</a>.</p><p>We then modified our falco helm configuration to use the updated image:</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>driver</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ebpf</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>loader</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>initContainer</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>registry</span>: <span style=color:#ae81ff>quay.io</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>tosmi/falco-driver-loader</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>tag</span>: <span style=color:#ae81ff>0.36.1</span>-<span style=color:#ae81ff>libelf-dev</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>falco</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>json_output</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>json_include_output_property</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>log_syslog</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>log_level</span>: <span style=color:#ae81ff>info</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>falcosidekick</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>webui</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span></span></span></code></pre></div></div><p>Note the updated <code>diver.loader.initContainer</code> section.</p><p>Let's check the our pods again:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ oc get pods
</span></span><span style=display:flex><span>NAME                                  READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>falco-2ssgx                           2/2     Running   <span style=color:#ae81ff>0</span>          66s
</span></span><span style=display:flex><span>falco-5hqgg                           1/2     Running   <span style=color:#ae81ff>0</span>          66s
</span></span><span style=display:flex><span>falco-82kq9                           2/2     Running   <span style=color:#ae81ff>0</span>          65s
</span></span><span style=display:flex><span>falco-99zxw                           2/2     Running   <span style=color:#ae81ff>0</span>          65s
</span></span><span style=display:flex><span>falco-falcosidekick-test-connection   0/1     Error     <span style=color:#ae81ff>0</span>          67s
</span></span><span style=display:flex><span>falco-falcosidekick-ui-redis-0        1/1     Running   <span style=color:#ae81ff>0</span>          31m
</span></span><span style=display:flex><span>falco-slx5k                           2/2     Running   <span style=color:#ae81ff>0</span>          65s
</span></span><span style=display:flex><span>falco-tzm8d                           2/2     Running   <span style=color:#ae81ff>0</span>          65s</span></span></code></pre></div></div><p>Success! This time the <code>DaemonSet</code> pods started successfully. Just note
that you have to be patient. The first start took about 1-2 minutes to
complete.</p><p>Let's check the logs of one <code>DaemonSet</code> pod just to sure:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>oc logs -c falco-driver-loader falco-2ssgx
</span></span><span style=display:flex><span>* Setting up /usr/src links from host
</span></span><span style=display:flex><span>* Running falco-driver-loader <span style=color:#66d9ef>for</span>: falco version<span style=color:#f92672>=</span>0.36.1, driver version<span style=color:#f92672>=</span>6.0.1+driver, arch<span style=color:#f92672>=</span>x86_64, kernel release<span style=color:#f92672>=</span>4.18.0-372.73.1.el8_6.x86_64, kernel version<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>* Running falco-driver-loader with: driver<span style=color:#f92672>=</span>bpf, compile<span style=color:#f92672>=</span>yes, download<span style=color:#f92672>=</span>yes
</span></span><span style=display:flex><span>* Mounting debugfs
</span></span><span style=display:flex><span>mount: /sys/kernel/debug: permission denied.
</span></span><span style=display:flex><span>       dmesg<span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> may have more information after failed mount system call.
</span></span><span style=display:flex><span>* Filename <span style=color:#e6db74>&#39;falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o&#39;</span> is composed of:
</span></span><span style=display:flex><span> - driver name: falco
</span></span><span style=display:flex><span> - target identifier: rhcos
</span></span><span style=display:flex><span> - kernel release: 4.18.0-372.73.1.el8_6.x86_64
</span></span><span style=display:flex><span> - kernel version: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>* Trying to download a prebuilt eBPF probe from https://download.falco.org/driver/6.0.1%2Bdriver/x86_64/falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o
</span></span><span style=display:flex><span>curl: <span style=color:#f92672>(</span>22<span style=color:#f92672>)</span> The requested URL returned error: <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span>Unable to find a prebuilt falco eBPF probe
</span></span><span style=display:flex><span>* Trying to compile the eBPF probe <span style=color:#f92672>(</span>falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>* eBPF probe located in /root/.falco/6.0.1+driver/x86_64/falco_rhcos_4.18.0-372.73.1.el8_6.x86_64_1.o
</span></span><span style=display:flex><span>* Success: eBPF probe symlinked to /root/.falco/falco-bpf.o</span></span></code></pre></div></div><p>Especially the line</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>* Success: eBPF probe symlinked to /root/.falco/falco-bpf.o</span></span></code></pre></div></div><p>looks promising. So up to the next problem, getting falco-sidekick and falco-sidekick-ui running.</p><p>We also <a href=https://github.com/falcosecurity/falco/issues/2884>opened a bug</a> report upstream to get feedback from the
developers on this issue.</p><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>UPDATE</h3><div id=outline-text-headline-4 class=outline-text-3><p><a href=https://github.com/Andreagit97>Andreagit97</a> was so nice mentioning in the issue above that
actually there is an image with libelf-dev available,
<a href=https://hub.docker.com/r/falcosecurity/falco-driver-loader-legacy>falco-driver-loader-legacy</a>. We can confirm that this image fixes the
problem mentioned above.</p><p>So this is our final falco helm chart values.yaml:</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>driver</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ebpf</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>loader</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>initContainer</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>falcosecurity/falco-driver-loader-legacy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>falco</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>json_output</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>json_include_output_property</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>log_syslog</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>log_level</span>: <span style=color:#ae81ff>info</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>falcosidekick</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>webui</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span></span></span></code></pre></div></div></div></div></div></div><div id=outline-container-headline-5 class=outline-2><h2 id=headline-5>Fixing falco-sidekick and falco-sidekick-ui</h2><div id=outline-text-headline-5 class=outline-text-2><p>Remember pod startup actually failed because of the following event (check with <code>oc get events</code>):</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>.spec.securityContext.fsGroup: Invalid value: []int64{1234}: 1234 is not an allowed group</span></span></code></pre></div></div><p>It seems the sidekick pods want to run with a specific UID. The
default OpenShift Security Context Constraint (SCC) <code>restricted</code>
prohibits this.</p><p>Lets confirm our suspicion:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ oc get deploy -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.spec.template.spec.securityContext}{&#34;\n&#34;}&#39;</span> falco-falcosidekick
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;fsGroup&#34;</span>:1234,<span style=color:#e6db74>&#34;runAsUser&#34;</span>:1234<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>$ oc get deploy -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.spec.template.spec.securityContext}{&#34;\n&#34;}&#39;</span> falco-falcosidekick-ui
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;fsGroup&#34;</span>:1234,<span style=color:#e6db74>&#34;runAsUser&#34;</span>:1234<span style=color:#f92672>}</span></span></span></code></pre></div></div><p>Bingo! <code>securityContext</code> is set to 1234 for both deployments. There is
another SCC that we could leverage, <code>nonroot</code>, which basically allows any
UID expect 0. We just need to get the <code>ServiceAccount</code> that
falco-sidekick and falco-sidekick-ui are actually using:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ oc get deploy -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.spec.template.spec.serviceAccount}{&#34;\n&#34;}&#39;</span> falco-falcosidekick
</span></span><span style=display:flex><span>falco-falcosidekick
</span></span><span style=display:flex><span>$ oc get deploy -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.spec.template.spec.serviceAccount}{&#34;\n&#34;}&#39;</span> falco-falcosidekick-ui
</span></span><span style=display:flex><span>falco-falcosidekick-ui</span></span></code></pre></div></div><p>So falco-sidekick uses <code>falco-sidekick</code> as <code>ServiceAccount</code> and falco-sidekick-ui <code>falco-sidekick-ui</code>. Lets
grant both <code>ServiceAccounts</code> access to the <code>nonroot</code> SCC.</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>kind: ClusterRoleBinding
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: falco-falcosidekick-scc:nonroot
</span></span><span style=display:flex><span>roleRef:
</span></span><span style=display:flex><span>  apiGroup: rbac.authorization.k8s.io
</span></span><span style=display:flex><span>  kind: ClusterRole
</span></span><span style=display:flex><span>  name: system:openshift:scc:nonroot
</span></span><span style=display:flex><span>subjects:
</span></span><span style=display:flex><span>- kind: ServiceAccount
</span></span><span style=display:flex><span>  name: falco-falcosidekick
</span></span><span style=display:flex><span>  namespace: falco
</span></span><span style=display:flex><span>- kind: ServiceAccount
</span></span><span style=display:flex><span>  name: falco-falcosidekick-ui
</span></span><span style=display:flex><span>  namespace: falco</span></span></code></pre></div></div><p>We've already added this <a href=https://github.com/tosmi-gitops/openshift-gitops/blob/main/components/apps/falco/base/falcosidekick-any-uid-scc.yaml>file</a> to our <a href=https://github.com/tosmi-gitops/openshift-gitops/blob/main/components/apps/falco/base/falcosidekick-any-uid-scc.yaml#L19>Kustomize</a> configuration.</p><p>Let's trigger a redeployment by deleting the <code>ReplicaSets</code> of both deployments, they will be re-created automatically:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ oc delete rs -l app.kubernetes.io/name<span style=color:#f92672>=</span>falcosidekick
</span></span><span style=display:flex><span>$ oc delete rs -l app.kubernetes.io/name<span style=color:#f92672>=</span>falcosidekick-ui</span></span></code></pre></div></div><p>Finally let's confirm everything is up and running:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ oc get deploy,ds,pods
</span></span><span style=display:flex><span>NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>deployment.apps/falco-falcosidekick      2/2     <span style=color:#ae81ff>2</span>            <span style=color:#ae81ff>2</span>           5d
</span></span><span style=display:flex><span>deployment.apps/falco-falcosidekick-ui   2/2     <span style=color:#ae81ff>2</span>            <span style=color:#ae81ff>2</span>           5d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                   DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
</span></span><span style=display:flex><span>daemonset.apps/falco   <span style=color:#ae81ff>6</span>         <span style=color:#ae81ff>6</span>         <span style=color:#ae81ff>6</span>       <span style=color:#ae81ff>6</span>            <span style=color:#ae81ff>6</span>           &lt;none&gt;          6d2h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                          READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>pod/falco-2ssgx                               2/2     Running   <span style=color:#ae81ff>0</span>          21m
</span></span><span style=display:flex><span>pod/falco-5hqgg                               2/2     Running   <span style=color:#ae81ff>0</span>          21m
</span></span><span style=display:flex><span>pod/falco-82kq9                               2/2     Running   <span style=color:#ae81ff>0</span>          21m
</span></span><span style=display:flex><span>pod/falco-99zxw                               2/2     Running   <span style=color:#ae81ff>0</span>          21m
</span></span><span style=display:flex><span>pod/falco-falcosidekick-7cfbbbf89f-qxwxs      1/1     Running   <span style=color:#ae81ff>0</span>          118s
</span></span><span style=display:flex><span>pod/falco-falcosidekick-7cfbbbf89f-rz5lj      1/1     Running   <span style=color:#ae81ff>0</span>          118s
</span></span><span style=display:flex><span>pod/falco-falcosidekick-ui-76885bd484-p7lqm   1/1     Running   <span style=color:#ae81ff>0</span>          2m18s
</span></span><span style=display:flex><span>pod/falco-falcosidekick-ui-76885bd484-sfgh4   1/1     Running   <span style=color:#ae81ff>0</span>          2m18s
</span></span><span style=display:flex><span>pod/falco-falcosidekick-ui-redis-0            1/1     Running   <span style=color:#ae81ff>0</span>          51m
</span></span><span style=display:flex><span>pod/falco-slx5k                               2/2     Running   <span style=color:#ae81ff>0</span>          21m
</span></span><span style=display:flex><span>pod/falco-tzm8d                               2/2     Running   <span style=color:#ae81ff>0</span>          21m</span></span></code></pre></div></div></div></div><div id=outline-container-headline-6 class=outline-2><h2 id=headline-6>Testing Falco</h2><div id=outline-text-headline-6 class=outline-text-2><p>Now that everything seems to be running, lets do a quick test. First
we will try to access the Falco Sidekick user interface.</p><p>Falco will not deploy a route for the UI automatically, instead we've
created a <a href=https://github.com/tosmi-gitops/openshift-gitops/tree/main/components/apps/falco/overlays/sidekick-ui-route>Kustomize overlay</a> with a custom route:</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>route.openshift.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Route</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>falco-falcosidekick-ui</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>falco</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>: <span style=color:#ae81ff>falcosidekick-ui.apps.hub.aws.tntinfra.net</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>termination</span>: <span style=color:#ae81ff>edge</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>to</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>falco-falcosidekick-ui</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>wildcardPolicy</span>: <span style=color:#ae81ff>None</span></span></span></code></pre></div></div><p>After deploying the <code>Route</code> we can access the Falco UI with the hostname
specified in the route object. The default username seems to be
<span style=text-decoration:underline>admin/admin</span> which is kind of strange for a security tool, maybe that's
the reason Falco does not expose the UI per default.</p><p><img src=/OpenShift/images/falco/falco-ui.png alt=/OpenShift/images/falco/falco-ui.png title=/OpenShift/images/falco/falco-ui.png></p><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Creating an event</h3><div id=outline-text-headline-7 class=outline-text-3><p>As a last test let's try to trigger an event. We open a shell to one
of the falco <code>DaemonSet</code> pods and execute a suspicious command:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ oc rsh falco-2ssgx
</span></span><span style=display:flex><span>Defaulted container <span style=color:#e6db74>&#34;falco&#34;</span> out of: falco, falcoctl-artifact-follow, falco-driver-loader <span style=color:#f92672>(</span>init<span style=color:#f92672>)</span>, falcoctl-artif# cat /etc/shadow
</span></span><span style=display:flex><span>root:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>daemon:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>bin:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>sys:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>sync:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>games:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>man:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>lp:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>mail:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>news:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>uucp:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>proxy:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>www-data:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>backup:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>list:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>irc:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>_apt:*:19639:0:99999:7:::
</span></span><span style=display:flex><span>nobody:*:19639:0:99999:7:::
</span></span><span style=display:flex><span><span style=color:#75715e>#</span></span></span></code></pre></div></div><p>and we can see an event with priority <strong>Warning</strong> in the Falco ui.</p><p><img src=/OpenShift/images/falco/falco-cat-etc-shadow.png alt=/OpenShift/images/falco/falco-cat-etc-shadow.png title=/OpenShift/images/falco/falco-cat-etc-shadow.png></p><p>That's it, seems like Falco is successfully running on OpenShift 4.12.</p></div></div></div></div><footer class=footline></footer></div></div><div id=navigation-bottom><a class="nav-prev btn btn-default" href=/openshift/2023-11-03-quay-deployment-with-gitops/ title="Quay Deployment and Configuration using GitOps"><i class="fa fa-chevron-left btn-bottom-prev"></i><span class=btn-bottom-text>Previous:</span> Quay Deployment and Configuration using GitOps</a>
<a class="nav-next btn btn-default" href=/openshift/2023-10-18-force-machineconfig-rollout/ title="How to force a MachineConfig rollout" style=margin-right:0><i class="fa fa-chevron-right btn-bottom-next"></i><span class=btn-bottom-text>Next:</span> How to force a MachineConfig rollout</a></div><div class=copyright><p>Copyright &copy; 2020 - 2023 Toni Schmidbauer & Thomas Jungbauer</p><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn target=_blank rel="noopener noreferrer">Hugo Learn Theme</i></a> and <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a></p></div></section><script>(function(){$("document").ready(function(){var s=$(".read-progress").waypoint({handler:function(e){e=="down"?($(".read-progress").addClass("position-fixed"),$(".read-progress").css("top",0)):($(".read-progress").removeClass("position-fixed"),$(".read-progress").css("top"))}}),t=$(window).height(),e=$(".post-content").height();$(window).on("scroll",n),$(window).on("resize",function(){t=$(window).height(),e=$(".post-content").height(),n()});function n(){var s=$(this).scrollTop(),o=$(".post-content").offset().top,i=e-(e-(t-(o-s))),n=i/e*100,n=n>100?100:n;$(".read-progress").width(n+"%")}})})()</script><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1704004884></script>
<script src=/js/perfect-scrollbar.min.js?1704004884></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1704004884></script>
<script src=/js/jquery.sticky.js?1704004884></script>
<script src=/js/featherlight.min.js?1704004884></script>
<script src=/js/highlight.pack.js?1704004884></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1704004884></script>
<script src=/js/learn.js?1704004884></script>
<script src=/js/hugo-learn.js?1704004884></script>
<script src=/js/yaub.js?1704004884></script>
<script>window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.getAttribute("id");e.intersectionRatio>0&&(clearActiveStatesInTableOfContents(),document.querySelector(`aside nav li a[href="#${t}"]`).parentElement.classList.add("active"))})});document.querySelectorAll("h1[id],h2[id],h3[id]").forEach(t=>{e.observe(t)})});function clearActiveStatesInTableOfContents(){document.querySelectorAll("aside nav li").forEach(e=>{e.classList.remove("active")})}</script><script type=text/javascript>function scrollTopAnimated(){$("html, body").animate({scrollTop:"0"},500)}</script><script>function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}$(".summary-box").click(function(){return window.location=$(this).find("a").attr("href"),!1})</script></body></html>