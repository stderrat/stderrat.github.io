<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Azure on TechBlog about OpenShift/Ansible/Satellite and much more</title><link>https://blog.stderr.at/tags/azure/</link><description>TechBlog about OpenShift/Ansible/Satellite and much more</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Toni Schmidbauer &amp; Thomas Jungbauer</copyright><lastBuildDate>Mon, 27 Apr 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.stderr.at/tags/azure/index.xml" rel="self" type="application/rss+xml"/><item><title>Ansible</title><link>https://blog.stderr.at/ansible/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.stderr.at/ansible/</guid><description/></item><item><title>Azure</title><link>https://blog.stderr.at/azure/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.stderr.at/azure/</guid><description/></item><item><title>Ansible - Azure Resource Manager Example</title><link>https://blog.stderr.at/ansible/2020/04/ansible-azure-resource-manager-example/</link><pubDate>Mon, 27 Apr 2020 00:00:00 +0000</pubDate><guid>https://blog.stderr.at/ansible/2020/04/ansible-azure-resource-manager-example/</guid><description>&lt;div class="paragraph">
&lt;p>Using Ansible Resource Manager with an ARM template and a simple Ansible playbook to deploy a Virtual Machine with Disk, virtual network, public IP and so on.&lt;/p>
&lt;/div>
&lt;div class="sect1">
&lt;h2 id="_introduction">Introduction&lt;/h2>
&lt;div class="sectionbody">
&lt;div class="paragraph">
&lt;p>&lt;em>Source: [&lt;a href="#source_1">1&lt;/a>]&lt;/em>&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>In order to deploy a Virtual Machine and all depended resources using the Azure Resource Manager (ARM) template with Ansible, you will need three things:&lt;/p>
&lt;/div>
&lt;div class="ulist">
&lt;ul>
&lt;li>
&lt;p>The ARM Template&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The parameters you want to use&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The Ansible playbook&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;div class="paragraph">
&lt;p>All can be found below.
Store them and simply call:&lt;/p>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="content">
&lt;pre class="highlight">&lt;code class="language-bash" data-lang="bash">ansible-playbook Azure/create_azure_deployment.yml&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="admonitionblock note">
&lt;table>
&lt;tbody>&lt;tr>
&lt;td class="icon">
&lt;i class="fa icon-note" title="Note">&lt;/i>
&lt;/td>
&lt;td class="content">
it will take several minutes, until everything has been deployment in Azure.
&lt;/td>
&lt;/tr>
&lt;/tbody>&lt;/table>
&lt;/div>
&lt;div class="admonitionblock note">
&lt;table>
&lt;tbody>&lt;tr>
&lt;td class="icon">
&lt;i class="fa icon-note" title="Note">&lt;/i>
&lt;/td>
&lt;td class="content">
Instead of using a json file locally you can upload the template file (as well as a parameters file) to a version control system and use it from there.
&lt;/td>
&lt;/tr>
&lt;/tbody>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect1">
&lt;h2 id="_additional_resources">Additional Resources&lt;/h2>
&lt;div class="sectionbody">
&lt;div class="sect2">
&lt;h3 id="_ansible_playbook_create_azure_deplyoment_yml">Ansible Playbook: Create-Azure-Deplyoment.yml&lt;/h3>
&lt;div class="listingblock">
&lt;div class="content">
&lt;pre class="highlight">&lt;code class="language-yaml" data-lang="yaml">---
- name: Get facts of a VM
hosts: localhost
connection: local
become: false
gather_facts: false
tasks:
#- name: Destroy Azure Deploy
# azure_rm_deployment:
# resource_group: tju-ResourceGroup
# name: tju-testDeployment
# state: absent
- name: Create Azure Resource Group deployment
azure_rm_deployment:
state: present
resource_group_name: tju-ResourceGroup
name: tju-testDeployment
#template_link: &amp;#39;&amp;lt;YOUR RAW Github template file&amp;gt;&amp;#39;
#parameters_link: &amp;#39;&amp;lt;YOUR RAW Github parameters file&amp;gt;&amp;#39;
template: &amp;#34;{{ lookup(&amp;#39;file&amp;#39;, &amp;#39;ResourceManagerTemplate.json&amp;#39;) }}&amp;#34;
parameters:
projectName:
value: tjuProject
location:
value: &amp;#34;East US&amp;#34;
adminUsername:
value: tjungbauer
adminPublicKey:
value: &amp;#34;{{ lookup(&amp;#39;file&amp;#39;, &amp;#39;/Users/tjungbauer/.ssh/id_rsa.pub&amp;#39;) }}&amp;#34;
operatingSystem:
value: CentOS
operatingSystemPublisher:
value: OpenLogic
operatingSystemSKU:
value: &amp;#39;7.1&amp;#39;
vmSize:
value: Standard_D2s_v3
register: azure
- name: Add new instance to host group
add_host:
hostname: &amp;#34;{{ item[&amp;#39;ips&amp;#39;][0].public_ip }}&amp;#34;
groupname: azure_vms
loop: &amp;#34;{{ azure.deployment.instances }}&amp;#34;&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect2">
&lt;h3 id="_resourcemanagertemplate_json">ResourceManagerTemplate.json&lt;/h3>
&lt;div class="listingblock">
&lt;div class="content">
&lt;pre class="highlight">&lt;code class="language-json" data-lang="json">{
&amp;#34;$schema&amp;#34;: &amp;#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&amp;#34;,
&amp;#34;contentVersion&amp;#34;: &amp;#34;1.0.0.0&amp;#34;,
&amp;#34;parameters&amp;#34;: {
&amp;#34;projectName&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;description&amp;#34;: &amp;#34;Specifies a name for generating resource names.&amp;#34;
}
},
&amp;#34;location&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;,
&amp;#34;defaultValue&amp;#34;: &amp;#34;[resourceGroup().location]&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;description&amp;#34;: &amp;#34;Specifies the location for all resources.&amp;#34;
}
},
&amp;#34;adminUsername&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;description&amp;#34;: &amp;#34;Specifies a username for the Virtual Machine.&amp;#34;
}
},
&amp;#34;adminPublicKey&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;description&amp;#34;: &amp;#34;Specifies the SSH rsa public key file as a string. Use \&amp;#34;ssh-keygen -t rsa -b 2048\&amp;#34; to generate your SSH key pairs.&amp;#34;
}
},
&amp;#34;operatingSystem&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;description&amp;#34;: &amp;#34;Specifies the Operating System. i.e. CentOS&amp;#34;
}
},
&amp;#34;operatingSystemPublisher&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;description&amp;#34;: &amp;#34;Specifies the publisher. i.e. OpenLogic&amp;#34;
}
},
&amp;#34;operatingSystemSKU&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;description&amp;#34;: &amp;#34;Specifies the version of the OS. i.e. 7.1&amp;#34;
}
},
&amp;#34;vmSize&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;description&amp;#34;: &amp;#34;Specifies the the VM size. i.e. Standard_D2s_v3&amp;#34;
}
}
},
&amp;#34;variables&amp;#34;: {
&amp;#34;vNetName&amp;#34;: &amp;#34;[concat(parameters(&amp;#39;projectName&amp;#39;), &amp;#39;-vnet&amp;#39;)]&amp;#34;,
&amp;#34;vNetAddressPrefixes&amp;#34;: &amp;#34;10.0.0.0/16&amp;#34;,
&amp;#34;vNetSubnetName&amp;#34;: &amp;#34;default&amp;#34;,
&amp;#34;vNetSubnetAddressPrefix&amp;#34;: &amp;#34;10.0.0.0/24&amp;#34;,
&amp;#34;vmName&amp;#34;: &amp;#34;[concat(parameters(&amp;#39;projectName&amp;#39;), &amp;#39;-vm&amp;#39;)]&amp;#34;,
&amp;#34;publicIPAddressName&amp;#34;: &amp;#34;[concat(parameters(&amp;#39;projectName&amp;#39;), &amp;#39;-ip&amp;#39;)]&amp;#34;,
&amp;#34;networkInterfaceName&amp;#34;: &amp;#34;[concat(parameters(&amp;#39;projectName&amp;#39;), &amp;#39;-nic&amp;#39;)]&amp;#34;,
&amp;#34;networkSecurityGroupName&amp;#34;: &amp;#34;[concat(parameters(&amp;#39;projectName&amp;#39;), &amp;#39;-nsg&amp;#39;)]&amp;#34;,
&amp;#34;networkSecurityGroupName2&amp;#34;: &amp;#34;[concat(variables(&amp;#39;vNetSubnetName&amp;#39;), &amp;#39;-nsg&amp;#39;)]&amp;#34;
},
&amp;#34;resources&amp;#34;: [
{
&amp;#34;type&amp;#34;: &amp;#34;Microsoft.Network/networkSecurityGroups&amp;#34;,
&amp;#34;apiVersion&amp;#34;: &amp;#34;2018-11-01&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;[variables(&amp;#39;networkSecurityGroupName&amp;#39;)]&amp;#34;,
&amp;#34;location&amp;#34;: &amp;#34;[parameters(&amp;#39;location&amp;#39;)]&amp;#34;,
&amp;#34;properties&amp;#34;: {
&amp;#34;securityRules&amp;#34;: [
{
&amp;#34;name&amp;#34;: &amp;#34;ssh_rule&amp;#34;,
&amp;#34;properties&amp;#34;: {
&amp;#34;description&amp;#34;: &amp;#34;Locks inbound down to ssh default port 22.&amp;#34;,
&amp;#34;protocol&amp;#34;: &amp;#34;Tcp&amp;#34;,
&amp;#34;sourcePortRange&amp;#34;: &amp;#34;*&amp;#34;,
&amp;#34;destinationPortRange&amp;#34;: &amp;#34;22&amp;#34;,
&amp;#34;sourceAddressPrefix&amp;#34;: &amp;#34;*&amp;#34;,
&amp;#34;destinationAddressPrefix&amp;#34;: &amp;#34;*&amp;#34;,
&amp;#34;access&amp;#34;: &amp;#34;Allow&amp;#34;,
&amp;#34;priority&amp;#34;: 123,
&amp;#34;direction&amp;#34;: &amp;#34;Inbound&amp;#34;
}
}
]
}
},
{
&amp;#34;type&amp;#34;: &amp;#34;Microsoft.Network/publicIPAddresses&amp;#34;,
&amp;#34;apiVersion&amp;#34;: &amp;#34;2018-11-01&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;[variables(&amp;#39;publicIPAddressName&amp;#39;)]&amp;#34;,
&amp;#34;location&amp;#34;: &amp;#34;[parameters(&amp;#39;location&amp;#39;)]&amp;#34;,
&amp;#34;properties&amp;#34;: {
&amp;#34;publicIPAllocationMethod&amp;#34;: &amp;#34;Dynamic&amp;#34;
},
&amp;#34;sku&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;Basic&amp;#34;
}
},
{
&amp;#34;comments&amp;#34;: &amp;#34;Simple Network Security Group for subnet [variables(&amp;#39;vNetSubnetName&amp;#39;)]&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;Microsoft.Network/networkSecurityGroups&amp;#34;,
&amp;#34;apiVersion&amp;#34;: &amp;#34;2019-08-01&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;[variables(&amp;#39;networkSecurityGroupName2&amp;#39;)]&amp;#34;,
&amp;#34;location&amp;#34;: &amp;#34;[parameters(&amp;#39;location&amp;#39;)]&amp;#34;,
&amp;#34;properties&amp;#34;: {
&amp;#34;securityRules&amp;#34;: [
{
&amp;#34;name&amp;#34;: &amp;#34;default-allow-22&amp;#34;,
&amp;#34;properties&amp;#34;: {
&amp;#34;priority&amp;#34;: 1000,
&amp;#34;access&amp;#34;: &amp;#34;Allow&amp;#34;,
&amp;#34;direction&amp;#34;: &amp;#34;Inbound&amp;#34;,
&amp;#34;destinationPortRange&amp;#34;: &amp;#34;22&amp;#34;,
&amp;#34;protocol&amp;#34;: &amp;#34;Tcp&amp;#34;,
&amp;#34;sourceAddressPrefix&amp;#34;: &amp;#34;*&amp;#34;,
&amp;#34;sourcePortRange&amp;#34;: &amp;#34;*&amp;#34;,
&amp;#34;destinationAddressPrefix&amp;#34;: &amp;#34;*&amp;#34;
}
}
]
}
},
{
&amp;#34;type&amp;#34;: &amp;#34;Microsoft.Network/virtualNetworks&amp;#34;,
&amp;#34;apiVersion&amp;#34;: &amp;#34;2018-11-01&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;[variables(&amp;#39;vNetName&amp;#39;)]&amp;#34;,
&amp;#34;location&amp;#34;: &amp;#34;[parameters(&amp;#39;location&amp;#39;)]&amp;#34;,
&amp;#34;dependsOn&amp;#34;: [
&amp;#34;[resourceId(&amp;#39;Microsoft.Network/networkSecurityGroups&amp;#39;, variables(&amp;#39;networkSecurityGroupName2&amp;#39;))]&amp;#34;
],
&amp;#34;properties&amp;#34;: {
&amp;#34;addressSpace&amp;#34;: {
&amp;#34;addressPrefixes&amp;#34;: [
&amp;#34;[variables(&amp;#39;vNetAddressPrefixes&amp;#39;)]&amp;#34;
]
},
&amp;#34;subnets&amp;#34;: [
{
&amp;#34;name&amp;#34;: &amp;#34;[variables(&amp;#39;vNetSubnetName&amp;#39;)]&amp;#34;,
&amp;#34;properties&amp;#34;: {
&amp;#34;addressPrefix&amp;#34;: &amp;#34;[variables(&amp;#39;vNetSubnetAddressPrefix&amp;#39;)]&amp;#34;,
&amp;#34;networkSecurityGroup&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;[resourceId(&amp;#39;Microsoft.Network/networkSecurityGroups&amp;#39;, variables(&amp;#39;networkSecurityGroupName2&amp;#39;))]&amp;#34;
}
}
}
]
}
},
{
&amp;#34;type&amp;#34;: &amp;#34;Microsoft.Network/networkInterfaces&amp;#34;,
&amp;#34;apiVersion&amp;#34;: &amp;#34;2018-11-01&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;[variables(&amp;#39;networkInterfaceName&amp;#39;)]&amp;#34;,
&amp;#34;location&amp;#34;: &amp;#34;[parameters(&amp;#39;location&amp;#39;)]&amp;#34;,
&amp;#34;dependsOn&amp;#34;: [
&amp;#34;[resourceId(&amp;#39;Microsoft.Network/publicIPAddresses&amp;#39;, variables(&amp;#39;publicIPAddressName&amp;#39;))]&amp;#34;,
&amp;#34;[resourceId(&amp;#39;Microsoft.Network/virtualNetworks&amp;#39;, variables(&amp;#39;vNetName&amp;#39;))]&amp;#34;,
&amp;#34;[resourceId(&amp;#39;Microsoft.Network/networkSecurityGroups&amp;#39;, variables(&amp;#39;networkSecurityGroupName&amp;#39;))]&amp;#34;
],
&amp;#34;properties&amp;#34;: {
&amp;#34;ipConfigurations&amp;#34;: [
{
&amp;#34;name&amp;#34;: &amp;#34;ipconfig1&amp;#34;,
&amp;#34;properties&amp;#34;: {
&amp;#34;privateIPAllocationMethod&amp;#34;: &amp;#34;Dynamic&amp;#34;,
&amp;#34;publicIPAddress&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;[resourceId(&amp;#39;Microsoft.Network/publicIPAddresses&amp;#39;, variables(&amp;#39;publicIPAddressName&amp;#39;))]&amp;#34;
},
&amp;#34;subnet&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;[resourceId(&amp;#39;Microsoft.Network/virtualNetworks/subnets&amp;#39;, variables(&amp;#39;vNetName&amp;#39;), variables(&amp;#39;vNetSubnetName&amp;#39;))]&amp;#34;
}
}
}
]
}
},
{
&amp;#34;type&amp;#34;: &amp;#34;Microsoft.Compute/virtualMachines&amp;#34;,
&amp;#34;apiVersion&amp;#34;: &amp;#34;2018-10-01&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;[variables(&amp;#39;vmName&amp;#39;)]&amp;#34;,
&amp;#34;location&amp;#34;: &amp;#34;[parameters(&amp;#39;location&amp;#39;)]&amp;#34;,
&amp;#34;dependsOn&amp;#34;: [
&amp;#34;[resourceId(&amp;#39;Microsoft.Network/networkInterfaces&amp;#39;, variables(&amp;#39;networkInterfaceName&amp;#39;))]&amp;#34;
],
&amp;#34;properties&amp;#34;: {
&amp;#34;hardwareProfile&amp;#34;: {
&amp;#34;vmSize&amp;#34;: &amp;#34;[parameters(&amp;#39;vmSize&amp;#39;)]&amp;#34;
},
&amp;#34;osProfile&amp;#34;: {
&amp;#34;computerName&amp;#34;: &amp;#34;[variables(&amp;#39;vmName&amp;#39;)]&amp;#34;,
&amp;#34;adminUsername&amp;#34;: &amp;#34;[parameters(&amp;#39;adminUsername&amp;#39;)]&amp;#34;,
&amp;#34;linuxConfiguration&amp;#34;: {
&amp;#34;disablePasswordAuthentication&amp;#34;: true,
&amp;#34;ssh&amp;#34;: {
&amp;#34;publicKeys&amp;#34;: [
{
&amp;#34;path&amp;#34;: &amp;#34;[concat(&amp;#39;/home/&amp;#39;, parameters(&amp;#39;adminUsername&amp;#39;), &amp;#39;/.ssh/authorized_keys&amp;#39;)]&amp;#34;,
&amp;#34;keyData&amp;#34;: &amp;#34;[parameters(&amp;#39;adminPublicKey&amp;#39;)]&amp;#34;
}
]
}
}
},
&amp;#34;storageProfile&amp;#34;: {
&amp;#34;imageReference&amp;#34;: {
&amp;#34;publisher&amp;#34;: &amp;#34;[parameters(&amp;#39;operatingSystemPublisher&amp;#39;)]&amp;#34;,
&amp;#34;offer&amp;#34;: &amp;#34;[parameters(&amp;#39;operatingSystem&amp;#39;)]&amp;#34;,
&amp;#34;sku&amp;#34;: &amp;#34;[parameters(&amp;#39;operatingSystemSKU&amp;#39;)]&amp;#34;,
&amp;#34;version&amp;#34;: &amp;#34;latest&amp;#34;
},
&amp;#34;osDisk&amp;#34;: {
&amp;#34;createOption&amp;#34;: &amp;#34;fromImage&amp;#34;
}
},
&amp;#34;networkProfile&amp;#34;: {
&amp;#34;networkInterfaces&amp;#34;: [
{
&amp;#34;id&amp;#34;: &amp;#34;[resourceId(&amp;#39;Microsoft.Network/networkInterfaces&amp;#39;, variables(&amp;#39;networkInterfaceName&amp;#39;))]&amp;#34;
}
]
}
}
}
],
&amp;#34;outputs&amp;#34;: {
&amp;#34;adminUsername&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;,
&amp;#34;value&amp;#34;: &amp;#34;[parameters(&amp;#39;adminUsername&amp;#39;)]&amp;#34;
}
}
}&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect1">
&lt;h2 id="_sources">Sources&lt;/h2>
&lt;div class="sectionbody">
&lt;div class="ulist">
&lt;ul>
&lt;li>
&lt;p>&lt;a id="source_1">&lt;/a>[1]: &lt;a href="https://docs.ansible.com/ansible/latest/modules/azure_rm_deployment_module.html" target="_blank" rel="noopener">azure_rm_deployment â€“ Create or destroy Azure Resource Manager template deployments&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/div>
&lt;/div></description></item><item><title>YAUB Yet Another Useless Blog</title><link>https://blog.stderr.at/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.stderr.at/</guid><description>
&lt;h1 class="blog-title gradient-header">Welcome to Yet Another Useless Blog&lt;/h1>
&lt;p>Well we hope the articles here are not totally useless :)&lt;/p>
&lt;p>Who are we, you might ask.
We (Thomas Jungbauer and Toni Schmidbauer) are two old IT guys, working in the business since more than 20 years. At the moment we are architects at Red Hat Austria, mainly responsible helping customers with OpenShift or Ansible architectures. &lt;/p>
&lt;p>The articles in this blog shall help to easily test and understand specific issues so they can be reproduced and tested. We simply wrote down what we saw in the field and of what we thought it might be helpful, so no frustrating searches in documentations or manual testing is required. &lt;/p>
&lt;p>If you have any question, please feel free to send us an e-mail or create a &lt;a href="https://github.com/stderrat/stderrat.github.io/issues" >GitHub issue&lt;/a>&lt;/p></description></item></channel></rss>