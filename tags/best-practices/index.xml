<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Best Practices on TechBlog about OpenShift/Ansible/Satellite and much more</title><link>https://blog.stderr.at/tags/best-practices/</link><description>TechBlog about OpenShift/Ansible/Satellite and much more</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Toni Schmidbauer &amp; Thomas Jungbauer</copyright><lastBuildDate>Tue, 30 Nov 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.stderr.at/tags/best-practices/index.xml" rel="self" type="application/rss+xml"/><item><title>Ansible Style Guide</title><link>https://blog.stderr.at/ansible/2021/11/ansible-style-guide/</link><pubDate>Tue, 30 Nov 2021 00:00:00 +0000</pubDate><guid>https://blog.stderr.at/ansible/2021/11/ansible-style-guide/</guid><description>&lt;div class="paragraph"&gt;
&lt;p&gt;You should always follow the &lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" rel="noopener"&gt;Best Practices&lt;/a&gt; and &lt;a href="https://ansible-lint.readthedocs.io/en/latest/" target="_blank" rel="noopener"&gt;Ansible Lint&lt;/a&gt; rules defined by the Ansible documentation when developing playbooks.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Although very basic, the &lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" rel="noopener"&gt;Best Practices&lt;/a&gt; document gives a few guidelines to be able to carry out well-structured playbooks and roles, it contains recommendations that evolve with the project, so it is recommended to review it regularly. It is advisable to review the organization of content in Ansible.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;The &lt;a href="https://ansible-lint.readthedocs.io/en/latest/" target="_blank" rel="noopener"&gt;Ansible Lint&lt;/a&gt; documentation shows us through this tool the syntax rules that will be checked in the testing of roles and playbooks, the rules that will be checked are indicated in this document in their respective section.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="admonitionblock warning"&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class="icon"&gt;
&lt;i class="fa icon-warning" title="Warning"&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class="content"&gt;
This style guide is meant as a base of playbook development. It is not the ultimate truth. Always verify and apply appropriate company rules. There are many additional references available, such as: &lt;a href="https://github.com/whitecloud/ansible-styleguide" class="bare"&gt;https://github.com/whitecloud/ansible-styleguide&lt;/a&gt; or &lt;a href="https://github.com/redhat-cop/automation-good-practices" class="bare"&gt;https://github.com/redhat-cop/automation-good-practices&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_general_recommendations"&gt;General Recommendations&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="ulist"&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Treat your Ansible content like code: Any playbook, role, inventory or collection should be versionized using Git or a similar tool.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Iterate: start with basic playbook and refactor later&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Use multiple Git repositories: on per role/collection, separate inventory from other repositories&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Use human-meaningful names in inventory files&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;group hosts in inventory files&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;use a consistent &lt;a href="#_directory_structure"&gt;Directory Structure&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_optimize_playbook_execution"&gt;Optimize Playbook Execution&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="olist arabic"&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;
&lt;p&gt;Disable facts gathering if it is not required.&lt;/p&gt;
&lt;div class="olist loweralpha"&gt;
&lt;ol class="loweralpha" type="a"&gt;
&lt;li&gt;
&lt;p&gt;Try not to use: &lt;code&gt;ansible_facts[‘hostname’]&lt;/code&gt; (or ‘nodename’)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Try to use &lt;code&gt;inventory_hostname&lt;/code&gt; and &lt;code&gt;inventory_hostname_short&lt;/code&gt; instead&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It is possible to selectively gather facts (&lt;code&gt;gather_subnet&lt;/code&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Consider caching facts&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Increase Parallelism&lt;/p&gt;
&lt;div class="olist loweralpha"&gt;
&lt;ol class="loweralpha" type="a"&gt;
&lt;li&gt;
&lt;p&gt;Ansible runs 1st task on every host, then 2nd task on every host …&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Use “forks” (default is 5) to control how many connections can be active (load will increase, try first with conservative values)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;While testing forks analize &lt;a href="#_enable_cpu_and_memory_profiling"&gt;Enable CPU and Memory Profiling&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If you use the module &amp;#34;copy&amp;#34; for large files: do not use “copy” module. Use “synchronize” module instead (based on rsync)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Use lists when ever a modules support it (i.e. yum)
Instead of&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;tasks:
- name: Ensure the packages are installed
yum:
name: &amp;#34;{{ item }}&amp;#34;
state: present
loop:
- httpd
- mod_ssl
- httpd-tools
- mariadb-server
- mariadb
- php
- php-mysqlnd&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;use&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;tasks:
- name: Ensure the packages are installed
yum:
state: present
name:
- httpd
- mod_ssl
- httpd-tools
- mariadb-server
- mariadb
- php
- php-mysqlnd&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="olist arabic"&gt;
&lt;ol class="arabic" start="5"&gt;
&lt;li&gt;
&lt;p&gt;Optimize SSH Connections&lt;/p&gt;
&lt;div class="olist loweralpha"&gt;
&lt;ol class="loweralpha" type="a"&gt;
&lt;li&gt;
&lt;p&gt;in &lt;em&gt;ansible.cfg&lt;/em&gt; set&lt;/p&gt;
&lt;div class="olist lowerroman"&gt;
&lt;ol class="lowerroman" type="i"&gt;
&lt;li&gt;
&lt;p&gt;ControlMaster&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ControlPersist&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;PreferredAuthentications&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Enabling &lt;strong&gt;Pipelining&lt;/strong&gt;&lt;/p&gt;
&lt;div class="olist loweralpha"&gt;
&lt;ol class="loweralpha" type="a"&gt;
&lt;li&gt;
&lt;p&gt;Not enabled by default&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;reduces number of SSH operations&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;requires to disable &lt;strong&gt;requiertty&lt;/strong&gt; in sudo options&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_name_tasks_and_plays"&gt;Name Tasks and Plays&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Every task or play should be explicitly named in a way that the purpose is easily understood and can be referred to if the playbook has to be restarted from a certain task.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;For example the following is hard to read and debug:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-bash" data-lang="bash"&gt;PLAY [localhost]
********************************
TASK [include_vars]
********************************
ok: [localhost]
TASK [yum]
********************************
ok: [localhost]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;While with naming it is easier to follow what is happening:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-bash" data-lang="bash"&gt;PLAY [Create a new virtual machine]
********************************
TASK [Include vmware-credentials]
********************************
ok: [localhost]
TASK [Install required packages with yum]
********************************
ok: [localhost]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
# set another variable
- set_fact:
my_second_var: &amp;#34;{{ my_var }}&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: set another variable
set_fact:
my_second_var: &amp;#34;{{ my_var }}&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Better understanding what is currently happening in a play and better possibility to debug.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_variables_in_task_names"&gt;Variables in Task Names&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Include as much information as necessary to explain the purpose of a task. Make usage of variables inside a task name to create dynamic output messages.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;#bad
- name: &amp;#39;Change status&amp;#39;
service:
enabled: true
name: &amp;#39;httpd&amp;#39;
state: &amp;#39;{{ state }}&amp;#39;
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;#good
- name: &amp;#39;Change status of httpd to {{ state }}&amp;#39;
service:
enabled: true
name: &amp;#39;httpd&amp;#39;
state: &amp;#39;{{ state }}&amp;#39;
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
This will help to easily understand log outputs of playbooks.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_omitting_unnecessary_information"&gt;Omitting Unnecessary Information&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;While name tasks in a playbook, &lt;strong&gt;do not&lt;/strong&gt; include the name of the role which is currently executed, since Ansible will do this automatically.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Avoiding the same output twice on the console will prevent confusions.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_names"&gt;Names&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;All the newly created Ansible roles should follow the name convention using dashes if necessary:
&lt;code&gt;[company]-[action]-[function/technology]&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
lvm&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
mycompany-setup-lvm&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
If using roles from Ansible Galaxy, it will keep consistency about which roles are created internally.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_use_modules_instead_of_command_or_shell"&gt;Use Modules instead of command or shell&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Before using the &lt;code&gt;command&lt;/code&gt; or &lt;code&gt;shell&lt;/code&gt; module, verify if there is already a module available which can avoid the usage of raw shell command.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name: install httpd
tasks:
- command: &amp;#34;yum install httpd&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: install packages
tasks:
- name: &amp;#39;install httpd&amp;#39;
yum:
name: &amp;#39;httpd&amp;#39;
state: &amp;#39;present&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
While raw command could be seen as a security risk in general, another reason to avoid them is the loss of immutability of the ansible playbooks or roles. Ansible cannot verify if a command has been already executed before or not and will therefore execute it every time the playbook is running.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_documenting_a_taskplay"&gt;Documenting a Task/Play&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Every playbook, role or task should start with a documentation &lt;em&gt;why&lt;/em&gt; this code has been written and what it does and should include an example usage if applicable. The comment should be followed by &lt;code&gt;---`&lt;/code&gt; with no blank lines around it, to indicate the actual start of the yaml definition&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;#bad
- name: &amp;#39;Change httpd status&amp;#39;
service:
enabled: true
name: &amp;#39;httpd&amp;#39;
state: &amp;#39;{{ state }}&amp;#39;
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;#good
# Example usage: ansible-playbook -e state=started playbook.yml
# This playbook changes the state of the httpd daemon
---
- name: &amp;#39;Change httpd status&amp;#39;
service:
enabled: true
name: &amp;#39;httpd&amp;#39;
state: &amp;#39;{{ state }}&amp;#39;
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
This common programmatic practice helps to quickly understand the purpose and usage of a playbook or role.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Yamllint &lt;a href="https://yamllint.readthedocs.io/en/stable/rules.html#module-yamllint.rules.document_start" target="_blank" rel="noopener"&gt;document-start rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_end_a_file"&gt;End a File&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Files should be ended with a newline.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
This is common Unix best practice which avoids any prompt misalignment when printing files in a terminal.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Yamllint &lt;a href="https://yamllint.readthedocs.io/en/stable/rules.html#module-yamllint.rules.new_line_at_end_of_file" target="_blank" rel="noopener"&gt;new-line-at-end-of-file rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_quotes"&gt;Quotes&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Strings should be quoted, while quotes for booleans (e.g. true/false) or integers (i.g. 42) should be avoided.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Do &lt;strong&gt;NOT&lt;/strong&gt; quote:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="ulist"&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;hosts: targets (e.g. hosts: databases rather than hosts: ‘databases’)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;include_tasks: and include_roles: target file names&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;task and role names&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;registered variables&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;number values&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;boolean values&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="admonitionblock note"&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class="icon"&gt;
&lt;i class="fa icon-note" title="Note"&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class="content"&gt;
It is possible to use single or double quotes. In this document single quotes are used, as it seems to be more common. Double quotes are often seen in European countries, especially German speaking countries. The most important thing is to stick to one style.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name: &amp;#39;start robot named my-robot&amp;#39;
service:
name: my-robot
state: started
enabled: true
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: &amp;#39;start robot named my-robot&amp;#39;
service:
name: &amp;#39;my-robot&amp;#39;
state: &amp;#39;started&amp;#39;
enabled: true
become: true
# double quotes w/ nested single quotes
- name: &amp;#39;start all robots&amp;#39;
service:
name: &amp;#39;{{ item[&amp;#34;robot_name&amp;#34;] }}&amp;#39;
state: &amp;#39;started&amp;#39;
enabled: true
with_items: &amp;#39;{{ robots }}&amp;#39;
become: true
# double quotes to escape characters
- name &amp;#39;print some text on two lines&amp;#39;
debug:
msg: &amp;#34;This text is on\ntwo lines&amp;#34;
# folded scalar style
- name: &amp;#39;robot infos&amp;#39;
debug:
msg: &amp;gt;
Robot {{ item[&amp;#39;robot_name&amp;#39;] }} is {{ item[&amp;#39;status&amp;#39;] }} and in {{ item[&amp;#39;az&amp;#39;] }}
availability zone with a {{ item[&amp;#39;curiosity_quotient&amp;#39;] }} curiosity quotient.
with_items: robots
# folded scalar when the string has nested quotes already
- name: &amp;#39;print some text&amp;#39;
debug:
msg: &amp;gt;
&amp;#34;I haven&amp;#39;t the slightest idea,&amp;#34; said the Hatter.
# do not quote booleans/numbers
- name: &amp;#39;download google homepage&amp;#39;
get_url:
dest: &amp;#39;/tmp&amp;#39;
timeout: 60
url: &amp;#39;https://google.com&amp;#39;
validate_certs: true
# variables example 1
- name: &amp;#39;set a variable&amp;#39;
set_fact:
my_var: &amp;#39;test&amp;#39;
# variables example 2
- name: &amp;#39;print my_var&amp;#39;
debug:
var: my_var
when: ansible_os_family == &amp;#39;Darwin&amp;#39;
# variables example 3
- name: &amp;#39;set another variable&amp;#39;
set_fact:
my_second_var: &amp;#39;{{ my_var }}&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Yamllint &lt;a href="https://yamllint.readthedocs.io/en/stable/rules.html#module-yamllint.rules.quoted_strings" target="_blank" rel="noopener"&gt;quoted-strings rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_sudo"&gt;Sudo&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Use the new become syntax when designating that a task needs to be run with sudo privileges&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;#bad
- name: &amp;#39;template client.json to /etc/sensu/conf.d/&amp;#39;
template:
dest: &amp;#39;/etc/sensu/conf.d/client.json&amp;#39;
src: &amp;#39;client.json.j2&amp;#39;
sudo: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: &amp;#39;template client.json to /etc/sensu/conf.d/&amp;#39;
template:
dest: &amp;#39;/etc/sensu/conf.d/client.json&amp;#39;
src: &amp;#39;client.json.j2&amp;#39;
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Using sudo was deprecated at &lt;a href="https://docs.ansible.com/ansible/latest/user_guide/become.html"&gt;Ansible version 1.9.1&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Ansible-lint &lt;a href="https://docs.ansible.com/ansible-lint/rules/default_rules.html" target="_blank" rel="noopener"&gt;E103 rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_hosts_declarations"&gt;Hosts Declarations&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Host sections be defined in such a way that it follows this general order:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="olist arabic"&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;
&lt;p&gt;host declaration&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;host options in alphabetical order&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;pre_tasks&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;roles&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;tasks&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# example
- hosts: &amp;#39;webservers&amp;#39;
remote_user: &amp;#39;centos&amp;#39;
vars:
tomcat_state: &amp;#39;started&amp;#39;
pre_tasks:
- name: &amp;#39;set the timezone to America/Boise&amp;#39;
lineinfile:
dest: &amp;#39;/etc/environment&amp;#39;
line: &amp;#39;TZ=America/Boise&amp;#39;
state: &amp;#39;present&amp;#39;
become: true
roles:
- { role: &amp;#39;tomcat&amp;#39;, tags: &amp;#39;tomcat&amp;#39; }
tasks:
- name: &amp;#39;start the tomcat service&amp;#39;
service:
name: &amp;#39;tomcat&amp;#39;
state: &amp;#39;{{ tomcat_state }}&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
A global definition about the order of these items, will create an easy and consistent human readable code.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_tasks_declarations"&gt;Tasks Declarations&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;A task should be defined in such a way that it follows this general order:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="olist arabic"&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;
&lt;p&gt;task name&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;tags&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;task map declaration (e.g. service:)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;task parameters in alphabetical order (remember to always use multi-line map syntax)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;loop operators (e.g. with_items)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;task options in alphabetical order (e.g. become, ignore_errors, register)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# example
- name: &amp;#39;create some ec2 instances&amp;#39;
tags: &amp;#39;ec2&amp;#39;
ec2:
assign_public_ip: true
image: &amp;#39;ami-c7d092f7&amp;#39;
instance_tags:
Name: &amp;#39;{{ item }}&amp;#39;
key_name: &amp;#39;my_key&amp;#39;
with_items: &amp;#39;{{ instance_names }}&amp;#39;
ignore_errors: true
register: ec2_output
when: ansible_os_family == &amp;#39;Darwin&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
A global definition about the order of these items, will create an easy and consistent human readable code.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_include_declaration"&gt;Include Declaration&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;For include statements, make sure to quote filenames and only use blank lines between include statements if they are multi-line (e.g. they have tags).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- include: other_file.yml
- include: &amp;#39;second_file.yml&amp;#39;
- include: third_file.yml tags=third&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- include: &amp;#39;other_file.yml&amp;#39;
- include: &amp;#39;second_file.yml&amp;#39;
- include: &amp;#39;third_file.yml&amp;#39;
tags: &amp;#39;third&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Using such syntax, will create an easy and consistent human readable code.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_booleans"&gt;Booleans&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Use true/false instead of yes/no (or 1/0).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name: &amp;#39;start httpd&amp;#39;
service:
name: &amp;#39;httpd&amp;#39;
state: &amp;#39;restarted&amp;#39;
enabled: 1
become: &amp;#39;yes&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: &amp;#39;start httpd&amp;#39;
service:
name: &amp;#39;httpd&amp;#39;
state: &amp;#39;restarted&amp;#39;
enabled: true
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Ansible can read boolean values in many different ways, like: True/False, true/false, yes/no, 1/0. It makes sense to stick to one option, which is then equally used in any playbook or role. It is recommended to use true/false since Java and Javascript are using the same values for boolean values.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Yamllint &lt;a href="https://yamllint.readthedocs.io/en/stable/rules.html#module-yamllint.rules.truthy" target="_blank" rel="noopener"&gt;truthy rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Required config: &lt;code&gt;truthy: {allowed-values: [&amp;#34;true&amp;#34;, &amp;#34;false&amp;#34;]}`&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_key_value_pairs"&gt;Key Value Pairs&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Only one space should be used after the colon, when defining key/value pairs.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name : &amp;#39;start httpd&amp;#39;
service:
name : &amp;#39;httpd&amp;#39;
state : &amp;#39;restarted&amp;#39;
enabled : true
become : true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: &amp;#39;start httpd&amp;#39;
service:
name: &amp;#39;httpd&amp;#39;
state: &amp;#39;restarted&amp;#39;
enabled: true
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
It increases human readability and reduces changeset collisions for version control.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Yamllint &lt;a href="https://yamllint.readthedocs.io/en/stable/rules.html#module-yamllint.rules.colons" target="_blank" rel="noopener"&gt;colons rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Required config: &lt;code&gt;colons: {max-spaces-before: 0, max-spaces-after: 1}&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_using_map_syntax"&gt;Using Map Syntax&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong&gt;Always use the map syntax&lt;/strong&gt; for better readability.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name: &amp;#39;create conf.d directory&amp;#39;
file: &amp;#39;path=/etc/httpd/conf.d/ state=directory mode=0755 owner=httpd group=httpd&amp;#39;
become: true
- name: &amp;#39;copy mod_ssl.conf to /etc/httpd/conf.d&amp;#39;
copy: &amp;#39;dest=/etc/httpd/conf.d/ src=mod_ssl.conf&amp;#39;
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: &amp;#39;create conf.d directory&amp;#39;
file:
group: &amp;#39;httpd&amp;#39;
mode: &amp;#39;0755&amp;#39;
owner: &amp;#39;httpd&amp;#39;
path: &amp;#39;/etc/httpd/conf.d&amp;#39;
state: &amp;#39;directory&amp;#39;
become: true
- name: &amp;#39;copy mod_ssl.conf to /etc/httpd/conf.d&amp;#39;
copy:
dest: &amp;#39;/etc/httpd/conf.d/&amp;#39;
src: &amp;#39;mod_ssl.conf&amp;#39;
become: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
It increases human readability and reduces changeset collisions for version control.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_spacing"&gt;Spacing&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;You should have blank lines between two host blocks, between two task blocks, and between host and include blocks. When indenting, you should use 2 spaces to represent sub-maps, and multi-line maps should start with a &lt;code&gt;-&lt;/code&gt;. For a more in-depth example of how spacing (and other things) please take a look at the example below&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# Example: ansible-playbook --ask-become-pass --ask-vault-pass style.yml
#
# This is a sample Ansible script to showcase all of our style decisions.
# Pay close attention to things like spacing, where we use quotes, etc.
# The only thing you can ignore is where comments are, except this first comment:
# It&amp;#39;s generally a good idea to include some good information like sample usage
# at the beginning of your file, so that someone can run head on the script
# to see what they should do.
#
# A good rule of thumb on quoting is to quote anything that represents a value
# that does not represent either a primitive type, or something within the
# playbook; e.g. do not quote integers, booleans, variable names, boolean logic
# Variable names still need to be quoted when they are module parameters for
# Ansible to properly resolve them.
# You should also always have single quotes around the outer string, and
# double quotes on the inside.
# If for some reason this is not possible or it would require escaping quotes
# (which you should avoid if you can), use the scalar string operator (shown
# in this playbook).
#
# Directory structure style:
# Your directory structure should match the structure described by the Ansible
# developers: http://docs.ansible.com/ansible/playbooks_best_practices.html
#
# ---
#
# - include: &amp;#39;role_name.yml&amp;#39;
# become: true # only if every task in the role requires super user
#
# The self-named yml file contains all of the actual role tasks.
#
# Header comments are followed by blank line, then --- to signify start of YAML,
# then another blank line, then the script.
---
- hosts: &amp;#39;localhost&amp;#39;
tasks:
- name: &amp;#39;fail if someone tries to run this&amp;#39;
fail:
msg: &amp;#39;this playbook was not meant to actually be ran. just inspect the source!&amp;#39;
- include: &amp;#39;first_include.yml&amp;#39; # quote filenames
- include: &amp;#39;second_include.yml&amp;#39; # no blank line needed between includes without tags
- include: &amp;#39;third_include.yml&amp;#39; # includes with tags should have blank lines between
tags: &amp;#39;third_include&amp;#39;
- include: &amp;#39;fourth_include.yml&amp;#39;
tags: &amp;#39;fourth_include&amp;#39;
- hosts: &amp;#39;tag_environment_samplefruit&amp;#39;
remote_user: &amp;#39;centos&amp;#39; # options in alphabetical order
vars:
sample_str: &amp;#39;dood&amp;#39; # use snake_case for variable names
sample_bool: true # do not quote booleans or integers
sample_int: 42
vars_files:
- &amp;#39;group_vars/secrets.yml&amp;#39;
pre_tasks: # then pre_tasks, roles, tasks
- name: &amp;#39;this runs a command that involves both single and double quotes&amp;#39;
command: &amp;gt;
echo &amp;#34;I can&amp;#39;t even&amp;#34;
args:
chdir: &amp;#39;/tmp&amp;#39;
- name: &amp;#39;this command just involves double quotes&amp;#39;
command: &amp;#39;echo &amp;#34;Hey man&amp;#34;&amp;#39;
roles:
- { role: &amp;#39;sample_role&amp;#39;, tags: &amp;#39;sample_role&amp;#39; } # use this format for role listing
tasks:
- name: &amp;#39;get list of directory permissions in /tmp&amp;#39;
command: &amp;#39;ls -l /tmp&amp;#39;
register: tmp_listing # do not quote variable names when registering
# A task should be defined in the following order:
# name
# tags
# module
# module arguments, alphabetical
# loop operator (e.g. with_items, with_fileglob)
# other options, alphabetical (e.g. become, ignore_errors, when)
- name: &amp;#39;a more complicated task to show where everything goes: touch all items from /tmp&amp;#39;
tags: &amp;#39;debug&amp;#39; # tags go immediately after name
file:
path: &amp;#39;{{ item }}&amp;#39; # use path for single file actions, dest/src for multi file actions
state: &amp;#39;touch&amp;#39; # arguments go in alphabetical order
with_items: tmp_listing.stdout_lines # loop things go immediately after module
# the rest of the task options are in alphabetical order
become: true # try to keep become only on the tasks that need it. If every task in a host uses become, then move it up to the host options
ignore_errors: true
when: ansible_os_family == &amp;#39;Darwin&amp;#39; and tmp_listing.stdout_lines | length &amp;gt; 1
- name: &amp;#39;some modules can have maps in their maps (woah man)&amp;#39;
ec2:
assign_public_ip: true
group: [&amp;#39;wca_ssh&amp;#39;, &amp;#39;wca_tomcat&amp;#39;]
image: &amp;#39;ami-c7d092f7&amp;#39;
instance_tags:
Name: &amp;#39;instance&amp;#39;
service_tomcat: &amp;#39;&amp;#39;
key_name: &amp;#39;ops&amp;#39;
- hosts: &amp;#39;tag_environment_secondfruit&amp;#39;
tasks:
- name: &amp;#39;this task has multiple tags&amp;#39;
tags: [&amp;#39;tagme&amp;#39;, &amp;#39;tagmetoo&amp;#39;]
set_fact:
mr_fact: &amp;#39;w&amp;#39;
- name: &amp;#39;perform an action&amp;#39;
action: ec2_facts
delegate_to: &amp;#39;localhost&amp;#39;
# newline at end of file&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
This produces nice looking code that is easy to read.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Yamllint &lt;a href="https://yamllint.readthedocs.io/en/stable/rules.html#module-yamllint.rules.empty_lines" target="_blank" rel="noopener"&gt;empty-lines rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_variable_names"&gt;Variable Names&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Names of variables should be as expressive as possible. &lt;a href="https://en.wikipedia.org/wiki/Snake_case" target="_blank" rel="noopener"&gt;&lt;strong&gt;snake_case&lt;/strong&gt;&lt;/a&gt; for names will help to make the code human readable. The prefix should contain the name of the role.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name: &amp;#39;set some facts&amp;#39;
set_fact:
myBoolean: true
int: 20
MY_STRING: &amp;#39;test&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: &amp;#39;set some facts&amp;#39;
set_fact:
rolename_my_boolean: true
rolename_my_int: 20
rolename_my_string: &amp;#39;test&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Ansible uses snake_case for module names so it makes sense to extend this convention to variable names. Perfixing the variable with the role name, makes it immediately obvious where it is used.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_jinja_variables"&gt;Jinja Variables&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Use spaces around Jinja variable names to increase readability.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name: set some facts
set_fact:
my_new_var: &amp;#34;{{my_old_var}}&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: set some facts
set_fact:
my_new_var: &amp;#34;{{ my_old_var }}&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
A proper definition for how to create Jinja variables produces consistent and easily readable code.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Ansible-lint &lt;a href="https://ansible-lint.readthedocs.io/en/latest/default_rules.html#variables-should-have-spaces-before-and-after-var-name" target="_blank" rel="noopener"&gt;E206 rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_comparing"&gt;Comparing&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Do not compare to literal True/False.&lt;br/&gt;
Use &lt;code&gt;when: var&lt;/code&gt; rather than &lt;code&gt;when: var == True&lt;/code&gt; (or conversely &lt;code&gt;when: not var&lt;/code&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Do not compare it to empty strings.&lt;br/&gt;
Use &lt;code&gt;when: var&lt;/code&gt; rather than &lt;code&gt;when: var != &amp;#34;&amp;#34;&lt;/code&gt; (or conversely &lt;code&gt;when: not var&lt;/code&gt; rather than &lt;code&gt;when: var == &amp;#34;&amp;#34;&lt;/code&gt;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name: validate required variables
fail:
msg: &amp;#34;No value specified for &amp;#39;{{ item }}&amp;#39;&amp;#34;
when: (vars[item] is undefined) or (vars[item] is defined and vars[item] | trim == &amp;#34;&amp;#34;)
with_items: &amp;#34;{{ appd_required_variables }}&amp;#34;
- name: Create an user and add to the global group
include_tasks: user.yml
when:
- username is defined
- username != &amp;#34;&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: Validate required variables
fail:
msg: &amp;#34;No value specified for &amp;#39;{{ item }}&amp;#39;&amp;#34;
when: (vars[item] is undefined) or (vars[item] is defined and not vars[item] | trim == &amp;#34;&amp;#34;)
with_items: &amp;#34;{{ appd_required_variables }}&amp;#34;
- name: Create an user and add to the global group
include_tasks: user.yml
when:
- username is defined
- username&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Avoid code complexity using quotes and standardize the way literals and empty strings are used&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Ansible-lint &lt;a href="https://ansible-lint.readthedocs.io/en/latest/default_rules.html#don-t-compare-to-literal-true-false" target="_blank" rel="noopener"&gt;E601 rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_delegation"&gt;Delegation&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Do not use local_action, use delegate_to: localhost&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name: Send summary mail
local_action:
module: mail
subject: &amp;#34;Summary Mail&amp;#34;
to: &amp;#34;{{ mail_recipient }}&amp;#34;
body: &amp;#34;{{ mail_body }}&amp;#34;
run_once: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: Send summary mail
mail:
subject: &amp;#34;Summary Mail&amp;#34;
to: &amp;#34;{{ mail_recipient }}&amp;#34;
body: &amp;#34;{{ mail_body }}&amp;#34;
delegate_to: localhost
run_once: true&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Avoid complexity, standardization, flexibility and code readability. The module and its parameters are easy to read and can be delegated even to a third party server.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Ansible-lint &lt;a href="https://ansible-lint.readthedocs.io/en/latest/default_rules.html#do-not-use-local-action-use-delegate-to-localhost" target="_blank" rel="noopener"&gt;E504 rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_playbook_file_extension"&gt;Playbook File Extension&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;All Ansible Yaml files should have a .yml extension (and NOT .YML, .yaml etc).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
~/tasks.yaml&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
~/tasks.yml&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Ansible tooling (like ansible-galaxy init) creates files with a .yml extension. Also, the Ansible documentation website references files with a .yml extension several times. Because of this, it is normal in the Ansible community to use a .yml extension for all Ansible YAML files.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Lint rule&lt;/strong&gt;&lt;br/&gt;
Ansible-lint &lt;a href="https://ansible-lint.readthedocs.io/en/latest/default_rules.html#use-yml-or-yaml-playbook-extension" target="_blank" rel="noopener"&gt;E205 rule&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_template_file_extension"&gt;Template File Extension&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;All Ansible Template files should have a .j2 extension.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
~/template.conf&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
~/template.conf.j2&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Ansible Template files will usually have the .j2 extension, which denotes the Jinja2 templating engine used.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_vaults"&gt;Vaults&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;All Ansible Vault files should have a .vault extension (and NOT .yml, .YML, .yaml etc).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
~/secrets.yml&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
~/secrets.vault&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
It is easier to control unencrypted files automatically for the specific .vault extension.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_debug_and_comments"&gt;Debug and Comments&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Do not overuse debug and comments in final code as much as possible. Use task and role names to explain what the task or role does. Use the verbose option under ansible for debugging purposes. If debug is used, assign a verbosity option. This will display the message only on certain debugging levels.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# bad
- name: print my_var
debug:
var: my_var
when: ansible_os_family == &amp;#34;Darwin&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;# good
- name: print my_var
debug:
var: my_var
verbosity: 2
when: ansible_os_family == &amp;#34;Darwin&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
It will keep clean code and consistency avoiding extra debug and comments. Extra debug will spend extra time when running the playbook or role.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_use_modules_copy_or_templates_instead_of_linefile_or_blockfile"&gt;Use Modules copy or templates instead of linefile or blockfile&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Instead of using the modules &lt;em&gt;linefile&lt;/em&gt; and &lt;em&gt;blockfile&lt;/em&gt;, which manage changes inside a file, it should be tried to use the modules &lt;code&gt;copy&lt;/code&gt; or &lt;code&gt;template&lt;/code&gt; instead, which will manage the whole file. For better future proof template should be preferred over copy.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
When using linefile/blockfile only a single line or a part of a file is managed. It is not easy to remember which part exactly is managed and which is not. Using the template module the whole file is managed by Ansible and there is no confusion about different parts of a file.
Moreover, regular expressions can be avoided, which are often used using linefile.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_use_module_synchronize_instead_of_copy_for_large_files"&gt;Use Module synchronize Instead of copy for Large Files&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Copying large files takes significantly longer than syncing it. The &lt;code&gt;synchronize&lt;/code&gt; modules which are based on rsync can increase the time moving large files from one node to another (or even on the same node).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_do_not_show_sensitive_data_in_ansible_output"&gt;Do not Show Sensitive Data in Ansible Output&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;When using the template module and there are passwords or other sensitive data in the file, use the &lt;code&gt;no_log&lt;/code&gt; option to hide this information.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
For obvious reasons the output of sensitive data on the screen (and logfile) should be prohibited.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_use_block_module"&gt;Use Block-Module&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Block can help to organize the code and can enable rollbacks.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;- block:
copy:
src: critical.conf
dest: /etc/critical/crit.conf
service:
name: critical
state: restarted
rescue:
command: shutdown -h now&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&lt;strong class="big"&gt;Reason&lt;/strong&gt;&lt;br/&gt;
Using blocks groups critical tasks together and allows better management when a single task of this block fails.&lt;/p&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_enable_cpu_and_memory_profiling"&gt;Enable CPU and Memory Profiling&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Enabling profiling is extremely useful when testing forks or to analyse memory and cpu consumption in general. It will present a summary of used CPU/memory for the whole play and per task.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;To enable it:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="olist arabic"&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;
&lt;p&gt;Create a new &lt;strong&gt;control group&lt;/strong&gt; - which is required for CPU and memory profiling&lt;/p&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-bash" data-lang="bash"&gt;cgcreate -a root:root -t root:root -g cpuacct,memory,pids:ansible_profile&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Configure &lt;em&gt;ansible.cfg&lt;/em&gt;&lt;/p&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-ini" data-lang="ini"&gt;callback_whitelist=cgroup_perf_recap
[callback_cgroup_perf_recap]
control_group=ansible_profile&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Execute the playbook using &lt;em&gt;cgexec&lt;/em&gt;&lt;/p&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-bash" data-lang="bash"&gt;cgexec -g cpuacct,memory,pids:ansible_profile ansible-playbook x.yaml&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Analyse the usage&lt;/p&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-bash" data-lang="bash"&gt;Memory Execution Maximum: 11146.29MB
cpu Execution Maximum: 112.08%
pids Execution Maximum: 35.00
memory:
lab : creating network (b42e9945-0dc7-20b1-09d1-00000000000a): 11097.35MB …..&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_enable_task_and_role_profiling"&gt;Enable Task and Role Profiling&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;The following can be enabled as well, to help debugging playbooks and roles:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-ini" data-lang="ini"&gt; [defaults]
callback_whitelist = profile_tasks, profile_role, timer&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;Timer: duration of playbook execution (activated by default)
profile_tasks/role: displays execution time per tasks/role&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;This will generate an output like the following:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="imageblock"&gt;
&lt;div class="content"&gt;
&lt;img src="https://blog.stderr.at/ansible/images/profiling.png" alt="Profiling"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_directory_structure"&gt;Directory Structure&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;A consistent directory structure is important to easily understand all playbooks and roles which are written. Ansible knows many different folder structures, any can be used. However, it is important to stick to one structure.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;The following is an example. Not all folders are usually used and working with collections will change such structure a little bit.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre class="highlight"&gt;&lt;code class="language-bash" data-lang="bash"&gt;.
├── ansible.cfg
├── ansible_modules
├── group_vars
│ ├── webservers
│ └── all
├── hosts
│ ├── webserver01
│ └── webserver02
├── host_vars
├── modules
├── playbooks
│ └── ansible-cmdb.yml
└── roles
├── requirements.yml
├── galaxy
└── dev-sec.ssh-hardening
└── auditd
├── files
│ ├── auditd.conf
│ ├── audit.yml
├── handlers
│ └── main.yml
├── meta
│ └── main.yml
└── tasks
└── main.yml&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item></channel></rss>