<!doctype html><html lang=en class="js csstransforms3d"><head><meta name=google-site-verification content="yq2Ib3doJVHVlEW2wtHap5WY54JhS2CCvI40y30F0FI"><meta charset=utf-8><meta name=color-scheme content="dark light"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.101.0"><meta name=description content="Create ETCD backups using cronjobs"><meta name=author content="Toni Schmidbauer & Thomas Jungbauer"><meta name=keywords content="OCP,Day-2,OpenShift,etcd"><link rel=canonical href=https://blog.stderr.at/day-2/etcd/2022-01-29-automatedetcdbackup/><link rel=icon href=/images/favicon.ico type=image/png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-180x180.png><link rel=apple-touch-icon sizes=128x128 href=/images/apple-touch-icon-128x128.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-touch-icon-72x72.png><link rel=apple-touch-icon href=/images/apple-touch-icon-57x57.png><link rel="shortcut icon" href=/images/favicon.ico><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><title>Automated ETCD Backup :: TechBlog about OpenShift/Ansible/Satellite and much more</title><link rel=manifest href=/manifest.json><meta name=theme-color content="#317EFB"><link href=/css/nucleus.min.css?1714928447 rel=stylesheet><link href=/css/fontawesome-all.min.css?1714928447 rel=stylesheet><link href=/css/font-awesome-animation.min.css?1714928447 rel=stylesheet><link href=/css/hybrid.css?1714928447 rel=stylesheet><link href=/css/featherlight.min.css?1714928447 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1714928447 rel=stylesheet><link href=/css/auto-complete.css?1714928447 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1714928447 rel=stylesheet><link href=/css/theme.min.css?1714928447 rel=stylesheet><link href=/css/hugo-theme.css?1714928447 rel=stylesheet><link href=/css/theme-yaub.css?1714928447 rel=stylesheet><script src=/js/jquery-3.7.1.min.js?1714928447></script>
<script src=/js/jquery.waypoints.min.js?1714928447></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/day-2/etcd/2022-01-29-automatedetcdbackup/><button onclick=scrollTopAnimated() id=myBtn class="top-btn button fa fa-arrow-up" title="Go to top"></button>
<span class=read-progress></span><nav id=sidebar><div id=header-wrapper><div id=header><svg class="logo" width="200" height="100" viewBox="0 0 200 136.34417133812047"><defs id="SvgjsDefs3490"/><g id="SvgjsG3491" featurekey="symbolFeature-0" transform="matrix(0.8888888888888888,0,0,0.8888888888888888,55.55511135525174,-24.034717135959202)" fill="#d2d2d2"><g xmlns="http://www.w3.org/2000/svg"><g><g><g><path fill="#d2d2d2" d="M75.195 72.96c-.619.0-1.241-.21-1.75-.64-1.146-.967-1.291-2.681-.324-3.827L88.73 50 73.122 31.507c-.967-1.146-.822-2.859.324-3.827 1.146-.968 2.859-.823 3.827.323L94.36 48.248c.854 1.012.854 2.492.0 3.503L77.272 71.995C76.735 72.632 75.968 72.96 75.195 72.96z"/></g></g></g><g><g><g><path fill="#d2d2d2" d="M24.805 72.96c-.772.0-1.539-.328-2.076-.964L5.641 51.752c-.854-1.012-.854-2.492.0-3.503l17.088-20.245c.967-1.146 2.681-1.291 3.827-.324 1.146.967 1.291 2.681.324 3.827L11.269 50.001l15.609 18.492c.967 1.146.823 2.859-.323 3.827C26.045 72.749 25.423 72.96 24.805 72.96z"/></g></g></g><g><path fill="#d2d2d2" d="M37.325 72.96c-.492.0-.99-.134-1.438-.414-1.271-.796-1.657-2.471-.861-3.742L60.37 28.315c.796-1.271 2.472-1.656 3.743-.861 1.271.796 1.657 2.471.861 3.742L39.63 71.685C39.115 72.508 38.23 72.96 37.325 72.96z"/></g></g></g><g id="SvgjsG3492" featurekey="nameFeature-0" transform="matrix(1.6473784183020483,0,0,1.6473784183020483,0.5930603781937029,42.15399158589206)" fill="#d2d2d2"><path d="m6.72 11.44 6.68 11.28 6.64-11.28h7l-10.6 17.6V40h-6.28V28.88l-10.52-17.44h7.08zm38.535.0L55.935 40h-6.52l-2.16-6.36h-10.68L34.335 40h-6.36l10.84-28.56h6.44zM41.935 18.48l-3.72 10.48h7.4l-3.6-10.48h-.08zm27.175-7.04-39062e-9 17.88c0 2.1067.47332 3.6467 1.42 4.62s2.4334 1.46 4.46 1.46c2.1867.0 3.72-.48668 4.6-1.46s1.32-2.5133 1.32-4.62V11.44h6.28v17.88c0 3.5733-1.02 6.36-3.06 8.36s-5.0868 3-9.14 3c-4.1332.0-7.1932-1-9.18-3s-2.98-4.7868-2.98-8.36V11.44h6.28zm41.495.0c6.0532.0 9.08 2.3466 9.08 7.04.0 2.6933-1.2933 4.6932-3.88 6 1.76.50668 3.0733 1.3934 3.94 2.66s1.3 2.7934 1.3 4.58c0 2.56-.92668 4.58-2.78 6.06s-4.2868 2.22-7.3 2.22h-13.84V11.44h13.48zM109.80499999999999 23c2.5333.0 3.8-1.1333 3.8-3.4.0-2.1867-1.4133-3.28-4.24-3.28h-5.96V23h6.4zm.359999999999999 12.12c3.0667.0 4.6-1.2533 4.6-3.76.0-2.72-1.4933-4.08-4.48-4.08h-6.88v7.84h6.76z"/></g></svg><div class=inline-flex><span class="animate-typewriter overflow-hidden whitespace-nowrap">Yet another useless blog<span class="ml-2 -translate-y-2 animate-blink">_</span></span></div></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1714928447></script>
<script type=text/javascript src=/js/auto-complete.js?1714928447></script>
<script type=text/javascript>var baseurl="https://blog.stderr.at/"</script><script type=text/javascript src=/js/search.js?1714928447></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/gitopscollection/ title="GitOps Episodes" class=dd-item><a href=/gitopscollection/>GitOps Episodes</a><ul><li data-nav-id=/gitopscollection/2024-04-25-installing-compliance-operator/ title="Setup & Configure Compliance Operator using GitOps" class=dd-item><a href=/gitopscollection/2024-04-25-installing-compliance-operator/>Setup & Configure Compliance Operator using GitOps</a></li><li data-nav-id=/gitopscollection/2024-04-02-configure_app_of_apps/ title="Configure App-of-Apps" class=dd-item><a href=/gitopscollection/2024-04-02-configure_app_of_apps/>Configure App-of-Apps</a></li><li data-nav-id=/gitopscollection/2024-02-02-setup-argocd/ title="Setup OpenShift GitOps/Argo CD" class=dd-item><a href=/gitopscollection/2024-02-02-setup-argocd/>Setup OpenShift GitOps/Argo CD</a></li><li data-nav-id=/gitopscollection/2023-12-28-gitops-repostructure/ title="GitOps - Choosing the right Git repository structure" class=dd-item><a href=/gitopscollection/2023-12-28-gitops-repostructure/>GitOps - Choosing the right Git repository structure</a></li><li data-nav-id=/gitopscollection/2023-12-11-gitops-intro/ title="Introducing the GitOps Approach" class=dd-item><a href=/gitopscollection/2023-12-11-gitops-intro/>Introducing the GitOps Approach</a></li></ul></li><li data-nav-id=/openshift/ title=OpenShift class=dd-item><a href=/openshift/>OpenShift</a><ul><li data-nav-id=/openshift/2024-02-12-bucket-data-retention/ title="OpenShift Data Foundation - Noobaa Bucket Data Retention (Lifecycle)" class=dd-item><a href=/openshift/2024-02-12-bucket-data-retention/>OpenShift Data Foundation - Noobaa Bucket Data Retention (Lifecycle)</a></li><li data-nav-id=/openshift/2023-11-26-running-falco/ title="Running Falco on OpenShift 4.12" class=dd-item><a href=/openshift/2023-11-26-running-falco/>Running Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023-11-03-quay-deployment-with-gitops/ title="Quay Deployment and Configuration using GitOps" class=dd-item><a href=/openshift/2023-11-03-quay-deployment-with-gitops/>Quay Deployment and Configuration using GitOps</a></li><li data-nav-id=/openshift/2023-10-23-openshift-falco/ title="Setting up Falco on OpenShift 4.12" class=dd-item><a href=/openshift/2023-10-23-openshift-falco/>Setting up Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023-10-18-force-machineconfig-rollout/ title="How to force a MachineConfig rollout" class=dd-item><a href=/openshift/2023-10-18-force-machineconfig-rollout/>How to force a MachineConfig rollout</a></li><li data-nav-id=/openshift/2023-03-20-operator-installation-with-argocd/ title="Operator installation with Argo CD" class=dd-item><a href=/openshift/2023-03-20-operator-installation-with-argocd/>Operator installation with Argo CD</a></li><li data-nav-id=/openshift/2023-02-16-ssl-certificate-management/ title="SSL Certificate Management for OpenShift on AWS" class=dd-item><a href=/openshift/2023-02-16-ssl-certificate-management/>SSL Certificate Management for OpenShift on AWS</a></li><li data-nav-id=/openshift/2022-11-04-argocd-and-serversideapply/ title="Using ServerSideApply with ArgoCD" class=dd-item><a href=/openshift/2022-11-04-argocd-and-serversideapply/>Using ServerSideApply with ArgoCD</a></li><li data-nav-id=/openshift/2022-08-16-hashicorp-vault/ title="Secrets Management - Vault on OpenShift" class=dd-item><a href=/openshift/2022-08-16-hashicorp-vault/>Secrets Management - Vault on OpenShift</a></li><li data-nav-id=/openshift/2022-04-22-multi-cloud-gateway/ title="Overview of Red Hat's Multi Cloud Gateway (Noobaa)" class=dd-item><a href=/openshift/2022-04-22-multi-cloud-gateway/>Overview of Red Hat's Multi Cloud Gateway (Noobaa)</a></li><li data-nav-id=/openshift/2021-09-25-sealed_secrets/ title="Secure your secrets with Sealed Secrets" class=dd-item><a href=/openshift/2021-09-25-sealed_secrets/>Secure your secrets with Sealed Secrets</a></li><li data-nav-id=/openshift/2021-02-27-understanding-block-devices/ title="Understanding RWO block device handling in OpenShift" class=dd-item><a href=/openshift/2021-02-27-understanding-block-devices/>Understanding RWO block device handling in OpenShift</a></li><li data-nav-id=/openshift/2021-01-27-writingoperatoransible/ title="Writing Operator using Ansible" class=dd-item><a href=/openshift/2021-01-27-writingoperatoransible/>Writing Operator using Ansible</a></li><li data-nav-id=/openshift/2020-12-10-thanos-vs-thanos/ title="Thanos Querier vs Thanos Querier" class=dd-item><a href=/openshift/2020-12-10-thanos-vs-thanos/>Thanos Querier vs Thanos Querier</a></li><li data-nav-id=/openshift/2020-08-06-argocd/ title="GitOps - Argo CD" class=dd-item><a href=/openshift/2020-08-06-argocd/>GitOps - Argo CD</a></li><li data-nav-id=/openshift/2020-04-16-tekton/ title="OpenShift Pipelines - Tekton Introduction" class=dd-item><a href=/openshift/2020-04-16-tekton/>OpenShift Pipelines - Tekton Introduction</a></li><li data-nav-id=/openshift/2020-04-01-oc-commands/ title="Helpful oc / kubectl commands" class=dd-item><a href=/openshift/2020-04-01-oc-commands/>Helpful oc / kubectl commands</a></li></ul></li><li data-nav-id=/day-2/ title="OpenShift Day-2" class="dd-item
parent"><a href=/day-2/>OpenShift Day-2</a><ul><li data-nav-id=/day-2/etcd/ title=etcd class="dd-item
parent"><a href=/day-2/etcd/>etcd</a><ul><li data-nav-id=/day-2/etcd/2022-01-29-automatedetcdbackup/ title="Automated ETCD Backup" class="dd-item active"><a href=/day-2/etcd/2022-01-29-automatedetcdbackup/>Automated ETCD Backup</a></li></ul></li><li data-nav-id=/day-2/labels_environmets/ title="Labels & Environments" class=dd-item><a href=/day-2/labels_environmets/>Labels & Environments</a><ul><li data-nav-id=/day-2/labels_environmets/2022-01-12-creatingenvironment/ title="Working with Environments" class=dd-item><a href=/day-2/labels_environmets/2022-01-12-creatingenvironment/>Working with Environments</a></li></ul></li><li data-nav-id=/day-2/pod-placement/ title="Pod Placement" class=dd-item><a href=/day-2/pod-placement/>Pod Placement</a><ul><li data-nav-id=/day-2/pod-placement/2021-08-26-podplacement-intro/ title=Introduction class=dd-item><a href=/day-2/pod-placement/2021-08-26-podplacement-intro/>Introduction</a></li><li data-nav-id=/day-2/pod-placement/2021-08-29-node-affinity/ title="Node Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-29-node-affinity/>Node Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-27-podplacement/ title=NodeSelector class=dd-item><a href=/day-2/pod-placement/2021-08-27-podplacement/>NodeSelector</a></li><li data-nav-id=/day-2/pod-placement/2021-08-28-affinity/ title="Pod Affinity/Anti-Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-28-affinity/>Pod Affinity/Anti-Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-30-taints/ title="Taints and Tolerations" class=dd-item><a href=/day-2/pod-placement/2021-08-30-taints/>Taints and Tolerations</a></li><li data-nav-id=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/ title="Topology Spread Constraints" class=dd-item><a href=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/>Topology Spread Constraints</a></li><li data-nav-id=/day-2/pod-placement/2021-09-01-descheduler/ title="Using Descheduler" class=dd-item><a href=/day-2/pod-placement/2021-09-01-descheduler/>Using Descheduler</a></li></ul></li></ul></li><li data-nav-id=/securesupplychain/ title="Secure Supply Chain" class=dd-item><a href=/securesupplychain/>Secure Supply Chain</a><ul><li data-nav-id=/securesupplychain/2023-06-15-securesupplychain-intro/ title="Introduction to a Secure Supply Chain" class=dd-item><a href=/securesupplychain/2023-06-15-securesupplychain-intro/>Introduction to a Secure Supply Chain</a></li><li data-nav-id=/securesupplychain/2023-06-16-securesupplychain-step1/ title="Step 1 - Listen to Events" class=dd-item><a href=/securesupplychain/2023-06-16-securesupplychain-step1/>Step 1 - Listen to Events</a></li><li data-nav-id=/securesupplychain/2023-06-17-securesupplychain-step2/ title="Step 2 - Pipelines" class=dd-item><a href=/securesupplychain/2023-06-17-securesupplychain-step2/>Step 2 - Pipelines</a></li><li data-nav-id=/securesupplychain/2023-06-18-securesupplychain-step3/ title="Step 3 - SonarQube" class=dd-item><a href=/securesupplychain/2023-06-18-securesupplychain-step3/>Step 3 - SonarQube</a></li><li data-nav-id=/securesupplychain/2023-06-19-securesupplychain-step4/ title="Step 4 - Verify Git Commit" class=dd-item><a href=/securesupplychain/2023-06-19-securesupplychain-step4/>Step 4 - Verify Git Commit</a></li><li data-nav-id=/securesupplychain/2023-06-20-securesupplychain-step5/ title="Step 5 - Build and Sign Image" class=dd-item><a href=/securesupplychain/2023-06-20-securesupplychain-step5/>Step 5 - Build and Sign Image</a></li><li data-nav-id=/securesupplychain/2023-06-21-securesupplychain-step6/ title="Step 6 - Scanning with ACS" class=dd-item><a href=/securesupplychain/2023-06-21-securesupplychain-step6/>Step 6 - Scanning with ACS</a></li><li data-nav-id=/securesupplychain/2023-06-22-securesupplychain-step7/ title="Step 7 - Generating a SBOM" class=dd-item><a href=/securesupplychain/2023-06-22-securesupplychain-step7/>Step 7 - Generating a SBOM</a></li><li data-nav-id=/securesupplychain/2023-06-23-securesupplychain-step8/ title="Step 8 - Updating Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-23-securesupplychain-step8/>Step 8 - Updating Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-24-securesupplychain-step9/ title="Step 9 - Linting Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-24-securesupplychain-step9/>Step 9 - Linting Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-25-securesupplychain-step10/ title="Step 10 - The Example Application" class=dd-item><a href=/securesupplychain/2023-06-25-securesupplychain-step10/>Step 10 - The Example Application</a></li><li data-nav-id=/securesupplychain/2023-06-26-securesupplychain-step11/ title="Step 11 - ACS Deployment Check" class=dd-item><a href=/securesupplychain/2023-06-26-securesupplychain-step11/>Step 11 - ACS Deployment Check</a></li><li data-nav-id=/securesupplychain/2023-06-27-securesupplychain-step12/ title="Step 12 - Verify TLog Signature" class=dd-item><a href=/securesupplychain/2023-06-27-securesupplychain-step12/>Step 12 - Verify TLog Signature</a></li><li data-nav-id=/securesupplychain/2023-06-28-securesupplychain-step13/ title="Step 13 - Bring it to Production" class=dd-item><a href=/securesupplychain/2023-06-28-securesupplychain-step13/>Step 13 - Bring it to Production</a></li></ul></li><li data-nav-id=/compliance/ title=Compliance class=dd-item><a href=/compliance/>Compliance</a><ul><li data-nav-id=/compliance/2021/07/oc-compliance-command-line-plugin/ title="oc compliance command line plugin" class=dd-item><a href=/compliance/2021/07/oc-compliance-command-line-plugin/>oc compliance command line plugin</a></li><li data-nav-id=/compliance/2021/07/compliance-operator/ title="Compliance Operator" class=dd-item><a href=/compliance/2021/07/compliance-operator/>Compliance Operator</a></li></ul></li><li data-nav-id=/service-mesh/ title="Service Mesh" class=dd-item><a href=/service-mesh/>Service Mesh</a><ul><li data-nav-id=/service-mesh/2020/05/enable-automatic-route-creation/ title="Enable Automatic Route Creation" class=dd-item><a href=/service-mesh/2020/05/enable-automatic-route-creation/>Enable Automatic Route Creation</a></li><li data-nav-id=/service-mesh/2020/05/authorization-rbac/ title="Authorization (RBAC)" class=dd-item><a href=/service-mesh/2020/05/authorization-rbac/>Authorization (RBAC)</a></li><li data-nav-id=/service-mesh/2020/04/deploy-example-bookinfo-application/ title="Deploy Example Bookinfo Application" class=dd-item><a href=/service-mesh/2020/04/deploy-example-bookinfo-application/>Deploy Example Bookinfo Application</a></li><li data-nav-id=/service-mesh/2020/04/service-mesh-1.1-released/ title="Service Mesh 1.1 released" class=dd-item><a href=/service-mesh/2020/04/service-mesh-1.1-released/>Service Mesh 1.1 released</a></li><li data-nav-id=/service-mesh/2020/04/authentication-jwt/ title="Authentication JWT" class=dd-item><a href=/service-mesh/2020/04/authentication-jwt/>Authentication JWT</a></li><li data-nav-id=/service-mesh/2020/04/mutual-tls-authentication/ title="Mutual TLS Authentication" class=dd-item><a href=/service-mesh/2020/04/mutual-tls-authentication/>Mutual TLS Authentication</a></li><li data-nav-id=/service-mesh/2020/04/fault-injection/ title="Fault Injection" class=dd-item><a href=/service-mesh/2020/04/fault-injection/>Fault Injection</a></li><li data-nav-id=/service-mesh/2020/04/limit-egress/external-traffic/ title="Limit Egress/External Traffic" class=dd-item><a href=/service-mesh/2020/04/limit-egress/external-traffic/>Limit Egress/External Traffic</a></li><li data-nav-id=/service-mesh/2020/04/advanced-routing-example/ title="Advanced Routing Example" class=dd-item><a href=/service-mesh/2020/04/advanced-routing-example/>Advanced Routing Example</a></li><li data-nav-id=/service-mesh/2020/04/routing-example/ title="Routing Example" class=dd-item><a href=/service-mesh/2020/04/routing-example/>Routing Example</a></li><li data-nav-id=/service-mesh/2020/03/ingress-with-custom-domain/ title="Ingress with custom domain" class=dd-item><a href=/service-mesh/2020/03/ingress-with-custom-domain/>Ingress with custom domain</a></li><li data-nav-id=/service-mesh/2020/03/ingress-traffic/ title="Ingress Traffic" class=dd-item><a href=/service-mesh/2020/03/ingress-traffic/>Ingress Traffic</a></li><li data-nav-id=/service-mesh/2020/03/deploy-microservices/ title="Deploy Microservices" class=dd-item><a href=/service-mesh/2020/03/deploy-microservices/>Deploy Microservices</a></li><li data-nav-id=/service-mesh/2020/03/installation/ title=Installation class=dd-item><a href=/service-mesh/2020/03/installation/>Installation</a></li></ul></li><li data-nav-id=/general/ title=General class=dd-item><a href=/general/>General</a><ul><li data-nav-id=/general/2020/05/basic-usage-of-git/ title="Basic usage of git" class=dd-item><a href=/general/2020/05/basic-usage-of-git/>Basic usage of git</a></li><li data-nav-id=/general/2020/04/red-hat-satellite-cheat-sheet/ title="Red Hat Satellite Cheat Sheet" class=dd-item><a href=/general/2020/04/red-hat-satellite-cheat-sheet/>Red Hat Satellite Cheat Sheet</a></li></ul></li><li data-nav-id=/ansible/ title=Ansible class=dd-item><a href=/ansible/>Ansible</a><ul><li data-nav-id=/ansible/2021/11/ansible-style-guide/ title="Ansible Style Guide" class=dd-item><a href=/ansible/2021/11/ansible-style-guide/>Ansible Style Guide</a></li><li data-nav-id=/ansible/2021/10/automation-controller-and-ldap-authentication/ title="Automation Controller and LDAP Authentication" class=dd-item><a href=/ansible/2021/10/automation-controller-and-ldap-authentication/>Automation Controller and LDAP Authentication</a></li><li data-nav-id=/ansible/2021/07/ansible-tower-and-downloading-collections/ title="Ansible Tower and downloading collections" class=dd-item><a href=/ansible/2021/07/ansible-tower-and-downloading-collections/>Ansible Tower and downloading collections</a></li><li data-nav-id=/ansible/2020/04/ansible-azure-resource-manager-example/ title="Ansible - Azure Resource Manager Example" class=dd-item><a href=/ansible/2020/04/ansible-azure-resource-manager-example/>Ansible - Azure Resource Manager Example</a></li><li data-nav-id=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/ title="DO410 Ansible and Ansible Tower training notes" class=dd-item><a href=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/>DO410 Ansible and Ansible Tower training notes</a></li></ul></li><li data-nav-id=/acs/ title="Advanced Cluster Security" class=dd-item><a href=/acs/>Advanced Cluster Security</a><ul><li data-nav-id=/acs/2021-12-11-acsauth/ title="Advanced Cluster Security - Authentication" class=dd-item><a href=/acs/2021-12-11-acsauth/>Advanced Cluster Security - Authentication</a></li></ul></li><li data-nav-id=/azure/ title=Azure class=dd-item><a href=/azure/>Azure</a><ul><li data-nav-id=/azure/2021-10-29-private-aro/ title="Stumbling into Azure Part II: Setting up a private ARO cluster" class=dd-item><a href=/azure/2021-10-29-private-aro/>Stumbling into Azure Part II: Setting up a private ARO cluster</a></li><li data-nav-id=/azure/2021-10-17-s2s-vpn/ title="Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing" class=dd-item><a href=/azure/2021-10-17-s2s-vpn/>Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing</a></li></ul></li><li data-nav-id=/java/ title=Java class=dd-item><a href=/java/>Java</a><ul><li data-nav-id=/java/2022-02-25-jpa-disconnected-entity/ title="Adventures in Java Land: JPA disconnected entities" class=dd-item><a href=/java/2022-02-25-jpa-disconnected-entity/>Adventures in Java Land: JPA disconnected entities</a></li></ul></li><li data-nav-id=/quay/ title=Quay class=dd-item><a href=/quay/>Quay</a><ul><li data-nav-id=/quay/2021-09-07-quay-upgrade-3.4/ title="Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator" class=dd-item><a href=/quay/2021-09-07-quay-upgrade-3.4/>Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator</a></li><li data-nav-id=/quay/2020-05-13-quay-tutorial1/ title="Red Hat Quay Registry - Overview and Installation" class=dd-item><a href=/quay/2020-05-13-quay-tutorial1/>Red Hat Quay Registry - Overview and Installation</a></li></ul></li><li data-nav-id=/legaldisclosure/ title="Legal Disclosure" class=dd-item><a href=/legaldisclosure/>Legal Disclosure</a></li><li data-nav-id=/rss/ title="RSS Feeds" class=dd-item><a href=/rss/>RSS Feeds</a></li></ul><section id=shortcuts><h3 class=shortcut-title>More</h3><ul><li><a class=padding href=https://blog.stderr.at/tags><i class='fas fa-tags'></i> Tags</a></li><li><a class=padding href=https://blog.stderr.at/categories><i class='far fa-bookmark'></i> Catagories</a></li><li><a class=padding href=https://blog.stderr.at/archive><i class='fas fa-box'></i> Archive</a></li><li><a class=padding href=https://charts.stderr.at/><i class='fas fa-book'></i> Helm Charts</a></li><li><a class=padding href=https://blog.stderr.at/authors><i class='fa-solid fa-pen'></i> Authors</a></li><li><a class=padding href=https://www.redhat.com><i class='fab fa-redhat'></i> Red Hat</a></li></ul></section><section id=footer></section></div></nav><section id=body class=post-content><div id=overlay></div><aside id=toc-field class="hidden lg:block tableOfContentContainer"><header id=TableOfContentsHeader>What's on this Page</header><nav id=TableOfContents><ul><li><a href=#_prerequisites>Prerequisites</a></li><li><a href=#_configure_project_cronjob>Configure Project & Cronjob</a></li><li><a href=#_start_a_job>Start a Job</a></li><li><a href=#_verifying_the_backup>Verifying the Backup</a></li></ul></nav><div id=navigation><a class=nav-prev href=/day-2/etcd/ title=etcd><i class="fa fa-chevron-left"></i></a>
<a class=nav-next href=/day-2/labels_environmets/ title="Labels & Environments" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></aside><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://schema.org/BreadcrumbList><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/><span itemprop=name>YAUB Yet Another Useless Blog</span><meta itemprop=position content="1"></a></span>> <span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/day-2/><span itemprop=name>OpenShift Day-2</span><meta itemprop=position content="2"></a></span>> <span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/day-2/etcd/><span itemprop=name>etcd</span><meta itemprop=position content="3"></a></span>> Automated ETCD Backup</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#_prerequisites>Prerequisites</a></li><li><a href=#_configure_project_cronjob>Configure Project & Cronjob</a></li><li><a href=#_start_a_job>Start a Job</a></li><li><a href=#_verifying_the_backup>Verifying the Backup</a></li></ul></nav></div></div><div class=social><a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.stderr.at%2fday-2%2fetcd%2f2022-01-29-automatedetcdbackup%2f" class="facebook no-highlight" aria-label="share on Facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-facebook" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a href="https://twitter.com/intent/tweet?hashtags=codingnconcepts&url=https%3a%2f%2fblog.stderr.at%2fday-2%2fetcd%2f2022-01-29-automatedetcdbackup%2f&text=Automated%20ETCD%20Backup" class="twitter no-highlight" aria-label="share on Twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-x" xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 30 30"><path d="M26.37 26l-8.795-12.822.015.012L25.52 4h-2.65l-6.46 7.48L11.28 4H4.33l8.211 11.971L12.54 15.97 3.88 26h2.65l7.182-8.322L19.42 26h6.95zM10.23 6l12.34 18h-2.1L8.12 6h2.11z"/></svg></div></div></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.stderr.at%2fday-2%2fetcd%2f2022-01-29-automatedetcdbackup%2f&source=https%3a%2f%2fblog.stderr.at%2fday-2%2fetcd%2f2022-01-29-automatedetcdbackup%2f&title=Automated%20ETCD%20Backup&summary=Automated%20ETCD%20Backup" class="linkedin no-highlight" aria-label="share on Linkedin"><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg></div></div></a><a href="whatsapp://send?text=Automated%20ETCD%20Backup%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0aCreate%20ETCD%20backups%20using%20cronjobs%0a%0ahttps%3a%2f%2fblog.stderr.at%2fday-2%2fetcd%2f2022-01-29-automatedetcdbackup%2f%0a" class="whatsapp no-highlight" aria-label="share on Whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-whatsapp" width="24" height="24" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a><a href="mailto:?subject=TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more - Automated%20ETCD%20Backup.&body=Automated%20ETCD%20Backup%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0aCreate%20ETCD%20backups%20using%20cronjobs%0a%0ahttps%3a%2f%2fblog.stderr.at%2fday-2%2fetcd%2f2022-01-29-automatedetcdbackup%2f%0a" class="email no-highlight" aria-label="share on Email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg></div></div></a></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=/tags/ocp>OCP</a>
<a class=tag-link href=/tags/day-2>Day-2</a>
<a class=tag-link href=/tags/openshift>OpenShift</a>
<a class=tag-link href=/tags/etcd>etcd</a></div></div><div id=body-inner><h1>Automated ETCD Backup</h1><div class="catagories tracked"><a id=textElement class="category-link no-highlight" href=/categories/openshift>OpenShift</a>
<a id=textElement class="category-link no-highlight" href=/categories/security>Security</a></div><p class=tracked><time class="f6 mv4 dib tracked" datetime=2022-01-29T00:00:00Z><strong>January 29, 2022</strong></time>
<span class=divider>-</span>
<span class=author><a href=/authors/thomas-jungbauer><img class=avatar src=/img/authors/thomas-jungbauer.png alt="Thomas Jungbauer">
Thomas Jungbauer</a>
( Lastmod: 2024-05-05 )</span>
<span class=divider>-</span>
<span class=readtime><strong>4 min read</strong></span></p><div class=paragraph><p>Securing ETCD is one of the major Day-2 tasks for a Kubernetes cluster. This article will explain how to create a backup using OpenShift Cronjob.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content>There is absolutely no warranty. Verify your backups regularly and perform restore tests.</td></tr></tbody></table></div><div class=sect1><h2 id=_prerequisites>Prerequisites</h2><div class=sectionbody><div class=paragraph><p>The following is required:</p></div><div class=ulist><ul><li><p>OpenShift Cluster 4.x</p></li><li><p>Integrated Storage, might be NFS or anything. Best practice would be a RWX enabled storage.</p></li></ul></div></div></div><div class=sect1><h2 id=_configure_project_cronjob>Configure Project & Cronjob</h2><div class=sectionbody><div class=paragraph><p>Create the following objects in OpenShift. This fill create:</p></div><div class="olist arabic"><ol class=arabic><li><p>A Project called <code>ocp-etcd-backup</code></p></li><li><p>A PersistentVolumeClaim to store the backups. <strong>Change to your appropriate StorageClass and accessMode</strong></p></li><li><p>A ServiceAccount called <code>openshift-backup</code></p></li><li><p>A dedicated ClusterRole which is able to start (debug pods)</p></li><li><p>A ClusterRoleBinding between the created ServiceAccount and the customer ClusterRole</p></li><li><p>A 2nd ClusterRoleBinding, which gives our ServiceAccount the permission to start privileged containers. This is required to start a debug pod on a control plane node.</p></li><li><p>A CronJob which performs the backup …​ see Callouts for inline explanations.</p></li></ol></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>A helm chart, which would create these objects below, can be found at: <a href=https://github.com/tjungbauer/ocp-auto-backup class=bare>https://github.com/tjungbauer/ocp-auto-backup</a>. This is probably a better way to manage the variables via the values.yaml file.</td></tr></tbody></table></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>kind: Namespace
apiVersion: v1
metadata:
  name: ocp-etcd-backup
  annotations:
    openshift.io/description: Openshift Backup Automation Tool
    openshift.io/display-name: Backup ETCD Automation
    openshift.io/node-selector: &#39;&#39;
spec: {}
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: etcd-backup-pvc
  namespace: ocp-etcd-backup
spec:
  accessModes:
    - ReadWriteOnce <i class=conum data-value=1></i><b>(1)</b>
  resources:
    requests:
      storage: 100Gi
  storageClassName: gp2
  volumeMode: Filesystem
---
kind: ServiceAccount
apiVersion: v1
metadata:
  name: openshift-backup
  namespace: ocp-etcd-backup
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-etcd-backup
rules:
- apiGroups: [&#34;&#34;]
  resources:
     - &#34;nodes&#34;
  verbs: [&#34;get&#34;, &#34;list&#34;]
- apiGroups: [&#34;&#34;]
  resources:
     - &#34;pods&#34;
     - &#34;pods/log&#34;
  verbs: [&#34;get&#34;, &#34;list&#34;, &#34;create&#34;, &#34;delete&#34;, &#34;watch&#34;]
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: openshift-backup
subjects:
  - kind: ServiceAccount
    name: openshift-backup
    namespace: ocp-etcd-backup
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-etcd-backup
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: etcd-backup-scc-privileged
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:openshift:scc:privileged
subjects:
- kind: ServiceAccount
  name: openshift-backup
  namespace: ocp-etcd-backup
---
kind: CronJob
apiVersion: batch/v1
metadata:
  name: cronjob-etcd-backup
  namespace: ocp-etcd-backup
  labels:
    purpose: etcd-backup
spec:
  schedule: &#39;*/5 * * * *&#39; <i class=conum data-value=2></i><b>(2)</b>
  startingDeadlineSeconds: 200
  concurrencyPolicy: Forbid
  suspend: false
  jobTemplate:
    metadata:
      creationTimestamp: null
    spec:
      backoffLimit: 0
      template:
        metadata:
          creationTimestamp: null
        spec:
          nodeSelector:
            node-role.kubernetes.io/master: &#39;&#39; <i class=conum data-value=3></i><b>(3)</b>
          restartPolicy: Never
          activeDeadlineSeconds: 200
          serviceAccountName: openshift-backup
          schedulerName: default-scheduler
          hostNetwork: true
          terminationGracePeriodSeconds: 30
          securityContext: {}
          containers:
            - resources:
                requests:
                  cpu: 300m
                  memory: 250Mi
              terminationMessagePath: /dev/termination-log
              name: etcd-backup
              command: <i class=conum data-value=4></i><b>(4)</b>
                - /bin/bash
                - &#39;-c&#39;
                - &gt;-
                  oc get no -l node-role.kubernetes.io/master --no-headers -o
                  name | grep `hostname` | head -n 1 | xargs -I {} -- oc debug
                  {} -- bash -c &#39;chroot /host sudo -E
                  /usr/local/bin/cluster-backup.sh /home/core/backup&#39; ; echo
                  &#39;Moving Local Master Backups to target directory (from
                  /home/core/backup to mounted PVC)&#39;; mv /home/core/backup/*
                  /etcd-backup/; echo &#39;Deleting files older than 30 days&#39; ; find
                  /etcd-backup/ -type f  -mtime +30 -exec rm {} \;
              securityContext:
                privileged: true
                runAsUser: 0
              imagePullPolicy: IfNotPresent
              volumeMounts:
                - name: temp-backup
                  mountPath: /home/core/backup <i class=conum data-value=5></i><b>(5)</b>
                - name: etcd-backup
                  mountPath: /etcd-backup <i class=conum data-value=6></i><b>(6)</b>
              terminationMessagePolicy: FallbackToLogsOnError
              image: registry.redhat.io/openshift4/ose-cli
          serviceAccount: openshift-backup
          volumes:
            - name: temp-backup
              hostPath:
                path: /home/core/backup
                type: &#39;&#39;
            - name: etcd-backup
              persistentVolumeClaim:
                claimName: etcd-backup-pvc
          dnsPolicy: ClusterFirst
          tolerations:
            - operator: Exists
              effect: NoSchedule
            - operator: Exists
              effect: NoExecute
  successfulJobsHistoryLimit: 5
  failedJobsHistoryLimit: 5</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>RWO is used here, since I have no other available storage on my test cluster.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>How often shall the job be executed. Here, every 5 minutes.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Bind the job to "Master" nodes.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Command to be executed…​ It fetches the actual local master nodename and starts a debugging Pod there. The backup script is called and moves the backup to /home/core/backup which is a folder on the control plane itself. The move command will move the backups from the local folder to the actual backup target volume. Finally, it will remove backups older than 30 days.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Mounted /home/core/backup on the master nodes, here the command will store the backups before they are moved</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>Target destination for the etcd backup on the mounted PVC</td></tr></tbody></table></div></div></div><div class=sect1><h2 id=_start_a_job>Start a Job</h2><div class=sectionbody><div class=paragraph><p>If you do not want to wait until the CronJob is triggered, you can manually start the Job using the following commands:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc create job backup --from=cronjob/cronjob-etcd-backup -n ocp-etcd-backup</code></pre></div></div><div class=paragraph><p>This will start a Pod which will do the backup:</p></div><div class=listingblock><div class=content><pre class=highlight><code>Starting pod/ip-10-0-196-187us-east-2computeinternal-debug ...
To use host binaries, run `chroot /host`
found latest kube-apiserver: /etc/kubernetes/static-pod-resources/kube-apiserver-pod-15
found latest kube-controller-manager: /etc/kubernetes/static-pod-resources/kube-controller-manager-pod-10
found latest kube-scheduler: /etc/kubernetes/static-pod-resources/kube-scheduler-pod-9
found latest etcd: /etc/kubernetes/static-pod-resources/etcd-pod-3
etcdctl is already installed
{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:1638199790.980932,&#34;caller&#34;:&#34;snapshot/v3_snapshot.go:119&#34;,&#34;msg&#34;:&#34;created temporary db file&#34;,&#34;path&#34;:&#34;/home/core/backup/snapshot_2021-11-29_152949.db.part&#34;}
{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:&#34;2021-11-29T15:29:50.991Z&#34;,&#34;caller&#34;:&#34;clientv3/maintenance.go:200&#34;,&#34;msg&#34;:&#34;opened snapshot stream; downloading&#34;}
{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:1638199790.9912837,&#34;caller&#34;:&#34;snapshot/v3_snapshot.go:127&#34;,&#34;msg&#34;:&#34;fetching snapshot&#34;,&#34;endpoint&#34;:&#34;https://10.0.196.187:2379&#34;}
{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:&#34;2021-11-29T15:29:53.306Z&#34;,&#34;caller&#34;:&#34;clientv3/maintenance.go:208&#34;,&#34;msg&#34;:&#34;completed snapshot read; closing&#34;}
Snapshot saved at /home/core/backup/snapshot_2021-11-29_152949.db
{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:1638199793.3482974,&#34;caller&#34;:&#34;snapshot/v3_snapshot.go:142&#34;,&#34;msg&#34;:&#34;fetched snapshot&#34;,&#34;endpoint&#34;:&#34;https://10.0.196.187:2379&#34;,&#34;size&#34;:&#34;180 MB&#34;,&#34;took&#34;:2.367303503}
{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:1638199793.348459,&#34;caller&#34;:&#34;snapshot/v3_snapshot.go:152&#34;,&#34;msg&#34;:&#34;saved&#34;,&#34;path&#34;:&#34;/home/core/backup/snapshot_2021-11-29_152949.db&#34;}
{&#34;hash&#34;:1180914745,&#34;revision&#34;:10182252,&#34;totalKey&#34;:19360,&#34;totalSize&#34;:179896320}
snapshot db and kube resources are successfully saved to /home/core/backup

Removing debug pod ...
Moving Local Master Backups to target directory (from /home/core/backup to mounted PVC)</code></pre></div></div></div></div><div class=sect1><h2 id=_verifying_the_backup>Verifying the Backup</h2><div class=sectionbody><div class=paragraph><p>Let’s start a dummy Pod which can access the PVC to verify if the backup is really there.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>apiVersion: v1
kind: Pod
metadata:
  name: verify-etcd-backup
spec:
  containers:
  - name: verify-etcd-backup
    image: registry.access.redhat.com/ubi8/ubi
    command: [&#34;sleep&#34;, &#34;3000&#34;]
    volumeMounts:
    - name: etcd-backup
      mountPath: /etcd-backup
  volumes:
  - name: etcd-backup
    persistentVolumeClaim:
      claimName: etcd-backup-pvc</code></pre></div></div><div class=paragraph><p>Logging into that Pod will show the available backups stored at /etcd-backup which is the mounted PVC.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>oc rsh -n ocp-etcd-backup verify-etcd-backup ls -la etcd-backup
total 1406196
drwxr-xr-x. 3 root root      4096 Nov 29 17:00 .
dr-xr-xr-x. 1 root root        25 Nov 29 17:06 ..
drwx------. 2 root root     16384 Nov 29 15:21 lost+found
-rw-------. 1 root root 179896352 Nov 29 15:21 snapshot_2021-11-29_152150.db
-rw-------. 1 root root 179896352 Nov 29 15:29 snapshot_2021-11-29_152949.db
-rw-------. 1 root root 179896352 Nov 29 15:32 snapshot_2021-11-29_153159.db
-rw-------. 1 root root 179896352 Nov 29 15:36 snapshot_2021-11-29_153618.db
-rw-------. 1 root root 179896352 Nov 29 15:55 snapshot_2021-11-29_155513.db
-rw-------. 1 root root 179896352 Nov 29 16:00 snapshot_2021-11-29_160020.db
-rw-------. 1 root root 179896352 Nov 29 16:55 snapshot_2021-11-29_165521.db
-rw-------. 1 root root 179896352 Nov 29 17:00 snapshot_2021-11-29_170020.db
-rw-------. 1 root root     89875 Nov 29 15:21 static_kuberesources_2021-11-29_152150.tar.gz
-rw-------. 1 root root     89875 Nov 29 15:29 static_kuberesources_2021-11-29_152949.tar.gz
-rw-------. 1 root root     89875 Nov 29 15:32 static_kuberesources_2021-11-29_153159.tar.gz
-rw-------. 1 root root     89875 Nov 29 15:36 static_kuberesources_2021-11-29_153618.tar.gz
-rw-------. 1 root root     89875 Nov 29 15:55 static_kuberesources_2021-11-29_155513.tar.gz
-rw-------. 1 root root     89875 Nov 29 16:00 static_kuberesources_2021-11-29_160020.tar.gz
-rw-------. 1 root root     89875 Nov 29 16:55 static_kuberesources_2021-11-29_165521.tar.gz
-rw-------. 1 root root     89875 Nov 29 17:00 static_kuberesources_2021-11-29_170020.tar.gz</code></pre></div></div></div></div><footer class=footline></footer></div></div><div id=navigation-bottom><a class="nav-prev btn btn-default" href=/day-2/etcd/ title=etcd><i class="fa fa-chevron-left btn-bottom-prev"></i><span class=btn-bottom-text>Previous:</span> etcd</a>
<a class="nav-next btn btn-default" href=/day-2/labels_environmets/ title="Labels & Environments" style=margin-right:0><i class="fa fa-chevron-right btn-bottom-next"></i><span class=btn-bottom-text>Next:</span> Labels & Environments</a></div><div class=copyright><p>Copyright &copy; 2020 - 2024 Toni Schmidbauer & Thomas Jungbauer</p></div></section><script>(function(){$("document").ready(function(){var s=$(".read-progress").waypoint({handler:function(e){e=="down"?($(".read-progress").addClass("position-fixed"),$(".read-progress").css("top",0)):($(".read-progress").removeClass("position-fixed"),$(".read-progress").css("top"))}}),t=$(window).height(),e=$(".post-content").height();$(window).on("scroll",n),$(window).on("resize",function(){t=$(window).height(),e=$(".post-content").height(),n()});function n(){var s=$(this).scrollTop(),o=$(".post-content").offset().top,i=e-(e-(t-(o-s))),n=i/e*100,n=n>100?100:n;$(".read-progress").width(n+"%")}})})()</script><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1714928452></script>
<script src=/js/perfect-scrollbar.min.js?1714928452></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1714928452></script>
<script src=/js/jquery.sticky.js?1714928452></script>
<script src=/js/featherlight.min.js?1714928452></script>
<script src=/js/highlight.pack.js?1714928452></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1714928452></script>
<script src=/js/learn.js?1714928452></script>
<script src=/js/hugo-learn.js?1714928452></script>
<script src=/js/yaub.js?1714928452></script>
<script>window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.getAttribute("id");e.intersectionRatio>0&&(clearActiveStatesInTableOfContents(),document.querySelector(`aside nav li a[href="#${t}"]`).parentElement.classList.add("active"))})});document.querySelectorAll("h1[id],h2[id],h3[id]").forEach(t=>{e.observe(t)})});function clearActiveStatesInTableOfContents(){document.querySelectorAll("aside nav li").forEach(e=>{e.classList.remove("active")})}</script><script type=text/javascript>function scrollTopAnimated(){$("html, body").animate({scrollTop:"0"},500)}</script><script>function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll("a.category-link");e.forEach(function(e){var t=e.textContent.trim().toLowerCase();t==="openshift"&&e.classList.add("openshift"),t==="compliance"&&e.classList.add("compliance"),t==="service mesh"&&e.classList.add("mesh"),t==="security"&&e.classList.add("security"),t==="other"&&e.classList.add("other"),t==="ansible"&&e.classList.add("ansible"),t==="supply chain"&&e.classList.add("cicd"),t==="gitops"&&e.classList.add("gitops"),t==="advanced cluster security"&&e.classList.add("acs")})})</script></body></html>