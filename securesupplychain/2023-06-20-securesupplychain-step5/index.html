<!doctype html><html lang=en class="js csstransforms3d"><head><meta name=google-site-verification content="yq2Ib3doJVHVlEW2wtHap5WY54JhS2CCvI40y30F0FI"><meta charset=utf-8><meta name=color-scheme content="dark light"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.101.0"><meta name=description content="Step 5 Secure Supply Chain"><meta name=author content="Toni Schmidbauer & Thomas Jungbauer"><link rel=icon href=/images/favicon.ico type=image/png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-180x180.png><link rel=apple-touch-icon sizes=128x128 href=/images/apple-touch-icon-128x128.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-touch-icon-72x72.png><link rel=apple-touch-icon href=/images/apple-touch-icon-57x57.png><link rel="shortcut icon" href=/images/favicon.ico><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><title>Step 5 - Build and Sign Image :: TechBlog about OpenShift/Ansible/Satellite and much more</title><link rel=manifest href=/manifest.json><meta name=theme-color content="#317EFB"><link href=/css/nucleus.min.css?1688565377 rel=stylesheet><link href=/css/fontawesome-all.min.css?1688565377 rel=stylesheet><link href=/css/font-awesome-animation.min.css?1688565377 rel=stylesheet><link href=/css/hybrid.css?1688565377 rel=stylesheet><link href=/css/featherlight.min.css?1688565377 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1688565377 rel=stylesheet><link href=/css/auto-complete.css?1688565377 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1688565377 rel=stylesheet><link href=/css/theme.min.css?1688565377 rel=stylesheet><link href=/css/hugo-theme.css?1688565377 rel=stylesheet><link href=/css/theme-yaub.css?1688565377 rel=stylesheet><script src=/js/jquery-3.6.0.min.js?1688565377></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/securesupplychain/2023-06-20-securesupplychain-step5/><button onclick=scrollTopAnimated() id=myBtn class="top-btn button fa fa-arrow-up" title="Go to top"></button><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><p class="fa fa-cloud-upload-alt faa-float animated"></p><span class=text>YAUB</span><p class=logoarea><span class="text small">Yet another Useless Blog</span></p></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1688565377></script>
<script type=text/javascript src=/js/auto-complete.js?1688565377></script>
<script type=text/javascript>var baseurl="https://blog.stderr.at/"</script><script type=text/javascript src=/js/search.js?1688565377></script></div><div class=togglemode><button id=dark-mode-toggle class="btn-toggle btn-default btn">Toggle Dark-Mode</button></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/openshift/ title=OpenShift class=dd-item><a href=/openshift/>OpenShift</a><ul><li data-nav-id=/openshift/2023-03-20-operator-installation-with-argocd/ title="Operator installation with Argo CD" class=dd-item><a href=/openshift/2023-03-20-operator-installation-with-argocd/>Operator installation with Argo CD</a></li><li data-nav-id=/openshift/2023-16-02-ssl-certificate-management/ title="SSL Certificate Management for OpenShift on AWS" class=dd-item><a href=/openshift/2023-16-02-ssl-certificate-management/>SSL Certificate Management for OpenShift on AWS</a></li><li data-nav-id=/openshift/2022-11-04-argocd-and-serversideapply/ title="Using ServerSideApply with ArgoCD" class=dd-item><a href=/openshift/2022-11-04-argocd-and-serversideapply/>Using ServerSideApply with ArgoCD</a></li><li data-nav-id=/openshift/2022-08-16-hashicorp-vault/ title="Secrets Management - Vault on OpenShift" class=dd-item><a href=/openshift/2022-08-16-hashicorp-vault/>Secrets Management - Vault on OpenShift</a></li><li data-nav-id=/openshift/2022-04-22-multi-cloud-gateway/ title="Overview of Red Hat's Multi Cloud Gateway (Noobaa)" class=dd-item><a href=/openshift/2022-04-22-multi-cloud-gateway/>Overview of Red Hat's Multi Cloud Gateway (Noobaa)</a></li><li data-nav-id=/openshift/2021-09-25-sealed_secrets/ title="Secure your secrets with Sealed Secrets" class=dd-item><a href=/openshift/2021-09-25-sealed_secrets/>Secure your secrets with Sealed Secrets</a></li><li data-nav-id=/openshift/2021-02-27-understanding-block-devices/ title="Understanding RWO block device handling in OpenShift" class=dd-item><a href=/openshift/2021-02-27-understanding-block-devices/>Understanding RWO block device handling in OpenShift</a></li><li data-nav-id=/openshift/2021-01-27-writingoperatoransible/ title="Writing Operator using Ansible" class=dd-item><a href=/openshift/2021-01-27-writingoperatoransible/>Writing Operator using Ansible</a></li><li data-nav-id=/openshift/2020-12-10-thanos-vs-thanos/ title="Thanos Querier vs Thanos Querier" class=dd-item><a href=/openshift/2020-12-10-thanos-vs-thanos/>Thanos Querier vs Thanos Querier</a></li><li data-nav-id=/openshift/2020-08-06-argocd/ title="GitOps - Argo CD" class=dd-item><a href=/openshift/2020-08-06-argocd/>GitOps - Argo CD</a></li><li data-nav-id=/openshift/2020-04-16-tekton/ title="OpenShift Pipelines - Tekton Introduction" class=dd-item><a href=/openshift/2020-04-16-tekton/>OpenShift Pipelines - Tekton Introduction</a></li><li data-nav-id=/openshift/2020-04-01-oc-commands/ title="Helpful oc / kubectl commands" class=dd-item><a href=/openshift/2020-04-01-oc-commands/>Helpful oc / kubectl commands</a></li></ul></li><li data-nav-id=/day-2/ title="OpenShift Day-2" class=dd-item><a href=/day-2/>OpenShift Day-2</a><ul><li data-nav-id=/day-2/etcd/ title=etcd class=dd-item><a href=/day-2/etcd/>etcd</a><ul><li data-nav-id=/day-2/etcd/2022-01-29-automatedetcdbackup/ title="Automated ETCD Backup" class=dd-item><a href=/day-2/etcd/2022-01-29-automatedetcdbackup/>Automated ETCD Backup</a></li></ul></li><li data-nav-id=/day-2/labels_environmets/ title="Labels & Environments" class=dd-item><a href=/day-2/labels_environmets/>Labels & Environments</a><ul><li data-nav-id=/day-2/labels_environmets/2022-01-12-creatingenvironment/ title="Working with Environments" class=dd-item><a href=/day-2/labels_environmets/2022-01-12-creatingenvironment/>Working with Environments</a></li></ul></li><li data-nav-id=/day-2/pod-placement/ title="Pod Placement" class=dd-item><a href=/day-2/pod-placement/>Pod Placement</a><ul><li data-nav-id=/day-2/pod-placement/2021-08-26-podplacement-intro/ title=Introduction class=dd-item><a href=/day-2/pod-placement/2021-08-26-podplacement-intro/>Introduction</a></li><li data-nav-id=/day-2/pod-placement/2021-08-29-node-affinity/ title="Node Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-29-node-affinity/>Node Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-27-podplacement/ title=NodeSelector class=dd-item><a href=/day-2/pod-placement/2021-08-27-podplacement/>NodeSelector</a></li><li data-nav-id=/day-2/pod-placement/2021-08-28-affinity/ title="Pod Affinity/Anti-Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-28-affinity/>Pod Affinity/Anti-Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-30-taints/ title="Taints and Tolerations" class=dd-item><a href=/day-2/pod-placement/2021-08-30-taints/>Taints and Tolerations</a></li><li data-nav-id=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/ title="Topology Spread Constraints" class=dd-item><a href=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/>Topology Spread Constraints</a></li><li data-nav-id=/day-2/pod-placement/2021-09-01-descheduler/ title="Using Descheduler" class=dd-item><a href=/day-2/pod-placement/2021-09-01-descheduler/>Using Descheduler</a></li></ul></li></ul></li><li data-nav-id=/securesupplychain/ title="Secure Supply Chain" class="dd-item
parent"><a href=/securesupplychain/>Secure Supply Chain</a><ul><li data-nav-id=/securesupplychain/2023-06-15-securesupplychain-intro/ title="Introduction to a Secure Supply Chain" class=dd-item><a href=/securesupplychain/2023-06-15-securesupplychain-intro/>Introduction to a Secure Supply Chain</a></li><li data-nav-id=/securesupplychain/2023-06-16-securesupplychain-step1/ title="Step 1 - Listen to Events" class=dd-item><a href=/securesupplychain/2023-06-16-securesupplychain-step1/>Step 1 - Listen to Events</a></li><li data-nav-id=/securesupplychain/2023-06-17-securesupplychain-step2/ title="Step 2 - Pipelines" class=dd-item><a href=/securesupplychain/2023-06-17-securesupplychain-step2/>Step 2 - Pipelines</a></li><li data-nav-id=/securesupplychain/2023-06-18-securesupplychain-step3/ title="Step 3 - SonarQube" class=dd-item><a href=/securesupplychain/2023-06-18-securesupplychain-step3/>Step 3 - SonarQube</a></li><li data-nav-id=/securesupplychain/2023-06-19-securesupplychain-step4/ title="Step 4 - Verify Git Commit" class=dd-item><a href=/securesupplychain/2023-06-19-securesupplychain-step4/>Step 4 - Verify Git Commit</a></li><li data-nav-id=/securesupplychain/2023-06-20-securesupplychain-step5/ title="Step 5 - Build and Sign Image" class="dd-item active"><a href=/securesupplychain/2023-06-20-securesupplychain-step5/>Step 5 - Build and Sign Image</a></li><li data-nav-id=/securesupplychain/2023-06-21-securesupplychain-step6/ title="Step 6 - Scanning with ACS" class=dd-item><a href=/securesupplychain/2023-06-21-securesupplychain-step6/>Step 6 - Scanning with ACS</a></li><li data-nav-id=/securesupplychain/2023-06-22-securesupplychain-step7/ title="Step 7 - Generating a SBOM" class=dd-item><a href=/securesupplychain/2023-06-22-securesupplychain-step7/>Step 7 - Generating a SBOM</a></li><li data-nav-id=/securesupplychain/2023-06-23-securesupplychain-step8/ title="Step 8 - Updating Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-23-securesupplychain-step8/>Step 8 - Updating Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-24-securesupplychain-step9/ title="Step 9 - Linting Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-24-securesupplychain-step9/>Step 9 - Linting Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-25-securesupplychain-step10/ title="Step 10 - The Example Application" class=dd-item><a href=/securesupplychain/2023-06-25-securesupplychain-step10/>Step 10 - The Example Application</a></li><li data-nav-id=/securesupplychain/2023-06-26-securesupplychain-step11/ title="Step 11 - ACS Deployment Check" class=dd-item><a href=/securesupplychain/2023-06-26-securesupplychain-step11/>Step 11 - ACS Deployment Check</a></li><li data-nav-id=/securesupplychain/2023-06-27-securesupplychain-step12/ title="Step 12 - Verify TLog Signature" class=dd-item><a href=/securesupplychain/2023-06-27-securesupplychain-step12/>Step 12 - Verify TLog Signature</a></li><li data-nav-id=/securesupplychain/2023-06-28-securesupplychain-step13/ title="Step 13 - Bring it to Production" class=dd-item><a href=/securesupplychain/2023-06-28-securesupplychain-step13/>Step 13 - Bring it to Production</a></li></ul></li><li data-nav-id=/compliance/ title=Compliance class=dd-item><a href=/compliance/>Compliance</a><ul><li data-nav-id=/compliance/2021/07/oc-compliance-command-line-plugin/ title="oc compliance command line plugin" class=dd-item><a href=/compliance/2021/07/oc-compliance-command-line-plugin/>oc compliance command line plugin</a></li><li data-nav-id=/compliance/2021/07/compliance-operator/ title="Compliance Operator" class=dd-item><a href=/compliance/2021/07/compliance-operator/>Compliance Operator</a></li></ul></li><li data-nav-id=/service-mesh/ title="Service Mesh" class=dd-item><a href=/service-mesh/>Service Mesh</a><ul><li data-nav-id=/service-mesh/2020/05/enable-automatic-route-creation/ title="Enable Automatic Route Creation" class=dd-item><a href=/service-mesh/2020/05/enable-automatic-route-creation/>Enable Automatic Route Creation</a></li><li data-nav-id=/service-mesh/2020/05/authorization-rbac/ title="Authorization (RBAC)" class=dd-item><a href=/service-mesh/2020/05/authorization-rbac/>Authorization (RBAC)</a></li><li data-nav-id=/service-mesh/2020/04/deploy-example-bookinfo-application/ title="Deploy Example Bookinfo Application" class=dd-item><a href=/service-mesh/2020/04/deploy-example-bookinfo-application/>Deploy Example Bookinfo Application</a></li><li data-nav-id=/service-mesh/2020/04/service-mesh-1.1-released/ title="Service Mesh 1.1 released" class=dd-item><a href=/service-mesh/2020/04/service-mesh-1.1-released/>Service Mesh 1.1 released</a></li><li data-nav-id=/service-mesh/2020/04/authentication-jwt/ title="Authentication JWT" class=dd-item><a href=/service-mesh/2020/04/authentication-jwt/>Authentication JWT</a></li><li data-nav-id=/service-mesh/2020/04/mutual-tls-authentication/ title="Mutual TLS Authentication" class=dd-item><a href=/service-mesh/2020/04/mutual-tls-authentication/>Mutual TLS Authentication</a></li><li data-nav-id=/service-mesh/2020/04/fault-injection/ title="Fault Injection" class=dd-item><a href=/service-mesh/2020/04/fault-injection/>Fault Injection</a></li><li data-nav-id=/service-mesh/2020/04/limit-egress/external-traffic/ title="Limit Egress/External Traffic" class=dd-item><a href=/service-mesh/2020/04/limit-egress/external-traffic/>Limit Egress/External Traffic</a></li><li data-nav-id=/service-mesh/2020/04/advanced-routing-example/ title="Advanced Routing Example" class=dd-item><a href=/service-mesh/2020/04/advanced-routing-example/>Advanced Routing Example</a></li><li data-nav-id=/service-mesh/2020/04/routing-example/ title="Routing Example" class=dd-item><a href=/service-mesh/2020/04/routing-example/>Routing Example</a></li><li data-nav-id=/service-mesh/2020/03/ingress-with-custom-domain/ title="Ingress with custom domain" class=dd-item><a href=/service-mesh/2020/03/ingress-with-custom-domain/>Ingress with custom domain</a></li><li data-nav-id=/service-mesh/2020/03/ingress-traffic/ title="Ingress Traffic" class=dd-item><a href=/service-mesh/2020/03/ingress-traffic/>Ingress Traffic</a></li><li data-nav-id=/service-mesh/2020/03/deploy-microservices/ title="Deploy Microservices" class=dd-item><a href=/service-mesh/2020/03/deploy-microservices/>Deploy Microservices</a></li><li data-nav-id=/service-mesh/2020/03/installation/ title=Installation class=dd-item><a href=/service-mesh/2020/03/installation/>Installation</a></li></ul></li><li data-nav-id=/general/ title=General class=dd-item><a href=/general/>General</a><ul><li data-nav-id=/general/2020/05/basic-usage-of-git/ title="Basic usage of git" class=dd-item><a href=/general/2020/05/basic-usage-of-git/>Basic usage of git</a></li><li data-nav-id=/general/2020/04/red-hat-satellite-cheat-sheet/ title="Red Hat Satellite Cheat Sheet" class=dd-item><a href=/general/2020/04/red-hat-satellite-cheat-sheet/>Red Hat Satellite Cheat Sheet</a></li></ul></li><li data-nav-id=/ansible/ title=Ansible class=dd-item><a href=/ansible/>Ansible</a><ul><li data-nav-id=/ansible/2021/11/ansible-style-guide/ title="Ansible Style Guide" class=dd-item><a href=/ansible/2021/11/ansible-style-guide/>Ansible Style Guide</a></li><li data-nav-id=/ansible/2021/10/automation-controller-and-ldap-authentication/ title="Automation Controller and LDAP Authentication" class=dd-item><a href=/ansible/2021/10/automation-controller-and-ldap-authentication/>Automation Controller and LDAP Authentication</a></li><li data-nav-id=/ansible/2021/07/ansible-tower-and-downloading-collections/ title="Ansible Tower and downloading collections" class=dd-item><a href=/ansible/2021/07/ansible-tower-and-downloading-collections/>Ansible Tower and downloading collections</a></li><li data-nav-id=/ansible/2020/04/ansible-azure-resource-manager-example/ title="Ansible - Azure Resource Manager Example" class=dd-item><a href=/ansible/2020/04/ansible-azure-resource-manager-example/>Ansible - Azure Resource Manager Example</a></li><li data-nav-id=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/ title="DO410 Ansible and Ansible Tower training notes" class=dd-item><a href=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/>DO410 Ansible and Ansible Tower training notes</a></li></ul></li><li data-nav-id=/acs/ title="Advanced Cluster Security" class=dd-item><a href=/acs/>Advanced Cluster Security</a><ul><li data-nav-id=/acs/2021-12-11-acsauth/ title="Advanced Cluster Security - Authentication" class=dd-item><a href=/acs/2021-12-11-acsauth/>Advanced Cluster Security - Authentication</a></li></ul></li><li data-nav-id=/azure/ title=Azure class=dd-item><a href=/azure/>Azure</a><ul><li data-nav-id=/azure/2021-10-29-private-aro/ title="Stumbling into Azure Part II: Setting up a private ARO cluster" class=dd-item><a href=/azure/2021-10-29-private-aro/>Stumbling into Azure Part II: Setting up a private ARO cluster</a></li><li data-nav-id=/azure/2021-10-17-s2s-vpn/ title="Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing" class=dd-item><a href=/azure/2021-10-17-s2s-vpn/>Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing</a></li></ul></li><li data-nav-id=/java/ title=Java class=dd-item><a href=/java/>Java</a><ul><li data-nav-id=/java/2022-02-25-jpa-disconnected-entity/ title="Adventures in Java Land: JPA disconnected entities" class=dd-item><a href=/java/2022-02-25-jpa-disconnected-entity/>Adventures in Java Land: JPA disconnected entities</a></li></ul></li><li data-nav-id=/quay/ title=Quay class=dd-item><a href=/quay/>Quay</a><ul><li data-nav-id=/quay/2021-09-07-quay-upgrade-3.4/ title="Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator" class=dd-item><a href=/quay/2021-09-07-quay-upgrade-3.4/>Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator</a></li><li data-nav-id=/quay/2020-05-13-quay-tutorial1/ title="Red Hat Quay Registry - Overview and Installation" class=dd-item><a href=/quay/2020-05-13-quay-tutorial1/>Red Hat Quay Registry - Overview and Installation</a></li></ul></li><li data-nav-id=/archive/ title=Archive class=dd-item><a href=/archive/>Archive</a></li><li data-nav-id=/legaldisclosure/ title="Legal Disclosure" class=dd-item><a href=/legaldisclosure/>Legal Disclosure</a></li><li data-nav-id=/rss/ title="RSS Feeds" class=dd-item><a href=/rss/>RSS Feeds</a></li></ul><section id=shortcuts><h3 class=shortcut-title>More</h3><ul><li><a class=padding href=https://blog.stderr.at/tags><i class='fas fa-tags'></i> Tags</a></li><li><a class=padding href=https://blog.stderr.at/categories><i class='far fa-bookmark'></i> Catagories</a></li><li><a class=padding href=https://charts.stderr.at/><i class='fas fa-book'></i> Helm Charts</a></li><li><a class=padding href=https://www.redhat.com><i class='fab fa-redhat'></i> Red Hat</a></li></ul></section><section id=footer></section></div></nav><section id=body><div id=overlay></div><aside id=toc-field class="hidden lg:block tableOfContentContainer"><header id=TableOfContentsHeader>What's on this Page</header><nav id=TableOfContents><ul><li><a href=#_goals>Goals</a></li><li><a href=#_prerequisites>Prerequisites</a></li><li><a href=#_steps>Steps</a></li><li><a href=#_prepare_tekton_for_image_signing>Prepare Tekton for Image Signing</a></li><li><a href=#_cosign_signing_the_image>CoSign - Signing the Image</a></li><li><a href=#_rekor>Rekor</a></li><li><a href=#_summary>Summary</a></li></ul></nav><div id=navigation><a class=nav-prev href=/securesupplychain/2023-06-19-securesupplychain-step4/ title="Step 4 - Verify Git Commit"><i class="fa fa-chevron-left"></i></a>
<a class=nav-next href=/securesupplychain/2023-06-21-securesupplychain-step6/ title="Step 6 - Scanning with ACS" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></aside><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://schema.org/BreadcrumbList><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/><span itemprop=name>YAUB Yet Another Useless Blog</span><meta itemprop=position content="1"></a></span>> <span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/securesupplychain/><span itemprop=name>Secure Supply Chain</span><meta itemprop=position content="2"></a></span>> Step 5 - Build and Sign Image</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#_goals>Goals</a></li><li><a href=#_prerequisites>Prerequisites</a></li><li><a href=#_steps>Steps</a></li><li><a href=#_prepare_tekton_for_image_signing>Prepare Tekton for Image Signing</a></li><li><a href=#_cosign_signing_the_image>CoSign - Signing the Image</a></li><li><a href=#_rekor>Rekor</a></li><li><a href=#_summary>Summary</a></li></ul></nav></div></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=/tags/ocp>OCP</a>
<a class=tag-link href=/tags/tekton>Tekton</a>
<a class=tag-link href=/tags/openshift>OpenShift</a>
<a class=tag-link href=/tags/pipleines>Pipleines</a>
<a class=tag-link href=/tags/ci/cd>CI/CD</a>
<a class=tag-link href=/tags/supply-chain>Supply Chain</a></div></div><div id=body-inner><h1>Step 5 - Build and Sign Image</h1><p class=tracked><time class="f6 mv4 dib tracked" datetime=2023-06-28T00:00:00Z><strong>June 28, 2023</strong></time>
- By:
Thomas Jungbauer
( Lastmod: 2023-07-04 )</p><div class=paragraph><p>Finally, after pulling and checking the code, we are going to create the image. During this process the image will be signed and uploaded to the public registry <a href=https://quay.io target=_blank rel=noopener>Quay.io</a>.</p></div><div class=sect1><h2 id=_goals>Goals</h2><div class=sectionbody><div class=paragraph><p>The goals of this step are:</p></div><div class=ulist><ul><li><p>Build the image</p></li><li><p>Sign the image</p></li><li><p>Upload it Quay.io</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>You can use any registry you like.</td></tr></tbody></table></div></div></div><div class=sect1><h2 id=_prerequisites>Prerequisites</h2><div class=sectionbody><div class=ulist><ul><li><p>You need to have an account in Quay.io and create a repository there.</p></li></ul></div><div class=paragraph><p>I have created the repository <a href=https://quay.io/repository/tjungbau/secure-supply-chain-demo class=bare>https://quay.io/repository/tjungbau/secure-supply-chain-demo</a> which will contain the images and the signatures.</p></div></div></div><div class=sect1><h2 id=_steps>Steps</h2><div class=sectionbody><div class="olist arabic"><ol class=arabic><li><p>Create a Robot account in Quay.io and get the authentication json. Go to "Account Settings > Robot Accounts" and create a new account.</p><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step5-quay_robot_account.png?width=600px" alt="Quay Robot Account"></div><div class=title>Figure 1. Quay Robot Account</div></div></li><li><p>Allow this account WRITE permissions to the repository</p><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step5-quay_robot_account_perms.png?width=600px" alt="Quay Robot Account Permissions"></div><div class=title>Figure 2. Quay Robot Account Permissions</div></div></li><li><p>Select the just-created account and go to Kubernetes Secret.</p><div class=paragraph><p>Here you can view or download the Secret. It should look like the following:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>apiVersion: v1
kind: Secret
metadata:
  name: tjungbau-secure-supply-chain-demo-pull-secret
data:
  .dockerconfigjson: &lt;SECURE&gt;
type: kubernetes.io/dockerconfigjson</code></pre></div></div><div class=paragraph><p>Copy the content and store it in your <strong>ci</strong> Namespace.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>The name will be probably different in other examples.</td></tr></tbody></table></div></li><li><p>To be able for the ServiceAccount, which is executing the Pipelines, to use this Secret, we need to modify the ServiceAccount object.</p><div class=paragraph><p>In our case the ServiceAccount is called <strong>pipeline</strong>. Modify it and add the following lines:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>secrets:
...
  - name: tjungbau-secure-supply-chain-demo-pull-secret <i class=conum data-value=1></i><b>(1)</b>
imagePullSecrets:
  - name: tjungbau-secure-supply-chain-demo-pull-secret <i class=conum data-value=2></i><b>(2)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Use your appropriate name for the secret</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Use your appropriate name for the secret, required to be able to sign the image</td></tr></tbody></table></div></li><li><p>Update the Pipeline object and add the following block</p><div class=paragraph><p>This time we do not need to add a Task object, because we are using a ClusterTask "buildah" that takes care of the building process. As workspace "shared-data" is used again, which has all the source code stored:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>    - name: build-sign-image
      params:
        - name: TLSVERIFY
          value: $(params.TLSVERIFY)
        - name: BUILD_EXTRA_ARGS
          value: &gt;-
            --label=io.openshift.build.commit.author=&#39;$(params.COMMIT_AUTHOR)&#39;
            --label=io.openshift.build.commit.date=&#39;$(params.COMMIT_DATE)&#39;
            --label=io.openshift.build.commit.id=&#39;$(params.COMMIT_SHA)&#39;
            --label=io.openshift.build.commit.message=&#39;$(params.COMMIT_MESSAGE)&#39;
            --label=io.openshift.build.commit.ref=&#39;$(params.GIT_REF)&#39;
            --ulimit=nofile=4096:4096
        - name: IMAGE
          value: &#39;$(params.IMAGE_REPO):$(params.IMAGE_TAG)&#39;
      retries: 1
      runAfter:
        - scan-source
        - verify-commit-signature
      taskRef:
        kind: ClusterTask
        name: buildah
      workspaces:
        - name: source
          workspace: shared-data</code></pre></div></div></li><li><p>Update the TriggerBinding <strong>globex-ui</strong> and define the URL for your registry respectively for your image repository</p><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>spec:
  parameters:
    - name: imageRepo
      value: quay.io/tjungbau/secure-supply-chain-demo</code></pre></div></div></li></ol></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>With this configuration, we could already build the image and push it into the registry. However, we also would like to sign it.</td></tr></tbody></table></div></div></div><div class=sect1><h2 id=_prepare_tekton_for_image_signing>Prepare Tekton for Image Signing</h2><div class=sectionbody><div class=paragraph><p>To automatically sign images, we use <a href=https://github.com/tektoncd/chains target=_blank rel=noopener>TektonChains</a> which is a controller that allows you to manage your supply chain security by signing TaskRuns and/or OCI images. Once the build-Task has pushed the images to Quay, Tekton will detect this event (by monitoring specific values of Task results) and then creates and pushes the signature for that image.</p></div><div class=paragraph><p>By default, Tekton Chains observes all task run executions. When the task runs complete, Tekton Chains signs and stores all artefacts.</p></div><div class=paragraph><p>Tekton Chain is part of OpenShift Pipelines and has the following main features:</p></div><div class=ulist><ul><li><p>You can sign task runs, task run results, and OCI registry images with cryptographic keys that are generated by tools such as cosign and skopeo.</p></li><li><p>You can use attestation formats such as <a href=https://github.com/in-toto/attestation/tree/v0.1.0/spec target=_blank rel=noopener>in-toto</a>.</p></li><li><p>You can securely store signatures and signed artefacts using OCI repository as a storage backend.</p></li></ul></div><div class=paragraph><p>In our case, we will use <a href=https://docs.sigstore.dev/cosign/overview/ target=_blank rel=noopener>CoSign</a> for signing the images and <a href=https://docs.sigstore.dev/rekor/overview/ target=_blank rel=noopener>Rekor</a> for the attestation.</p></div><div class=paragraph><p>To activate image signing add the following to the TektonConfig object by removing the "chain{}" entry.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>  chain:
    artifacts.oci.storage: oci <i class=conum data-value=1></i><b>(1)</b>
    artifacts.taskrun.format: in-toto <i class=conum data-value=2></i><b>(2)</b>
    artifacts.taskrun.storage: oci <i class=conum data-value=3></i><b>(3)</b>
    transparency.enabled: true <i class=conum data-value=4></i><b>(4)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>The storage backend for storing OCI signatures.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The format for storing TaskRun payloads. Can be in-toto or slsa/v1.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>The storage backend for TaskRun signatures. Multiple can be defined.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Enable or disable automatic binary transparency uploads. The URL for uploading binary transparency attestations is <a href=https://rekor.sigstore.dev class=bare>https://rekor.sigstore.dev</a> by default.</td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>More details can be found at <a href=https://docs.openshift.com/container-platform/4.13/cicd/pipelines/using-tekton-chains-for-openshift-pipelines-supply-chain-security.html class=bare>https://docs.openshift.com/container-platform/4.13/cicd/pipelines/using-tekton-chains-for-openshift-pipelines-supply-chain-security.html</a></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=_cosign_signing_the_image>CoSign - Signing the Image</h2><div class=sectionbody><div class=paragraph><p>We will use <a href=https://github.com/sigstore/cosign target=_blank rel=noopener>CoSign</a> to sign our image. To do so we need to download the cosign binary and generate a key pair:</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>Be sure that you are logged into the OpenShift cluster.</td></tr></tbody></table></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>cosign generate-key-pair k8s://openshift-pipelines/signing-secrets</code></pre></div></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>Enter password for private key:
Enter password for private key again:
Successfully created secret signing-secrets in namespace openshift-pipelines

oc get secrets signing-secrets -n openshift-pipelines
NAME              TYPE     DATA   AGE
signing-secrets   Opaque   3      46h</code></pre></div></div><div class=paragraph><p>Cosign will ask you to enter a password and will then create a Kubernetes secret in the Namespace openshift-pipelines.</p></div><div class=paragraph><p>When OpenShift Pipelines now execute a Task that is pushing an image, this Secret will be used to sign the image.</p></div><div class=paragraph><p>Let’s update our source code. The image will be built and pushed into Quay. The small black shield indicates that this image has been signed.</p></div><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step5-signed_image.png?width=600px" alt="Quay Signed Image"></div><div class=title>Figure 3. Quay Signed Image</div></div><div class=paragraph><p>Besides the actual image the files: *.sig and *.att can be seen. The first one is the signature, the second one shows metadata about the attestation retrieved from Rekor which can be compared with the Rekor URL.</p></div></div></div><div class=sect1><h2 id=_rekor>Rekor</h2><div class=sectionbody><div class=paragraph><p><em>Rekor’s goals are to provide an immutable tamper resistant ledger of metadata generated within a software projects supply chain. Rekor will enable software maintainers and build systems to record signed metadata to an immutable record. Other parties can then query said metadata to enable them to make informed decisions on trust and non-repudiation of an object’s lifecycle. For more details visit the sigstore website.</em></p></div><div class=paragraph><p><em>The Rekor project provides a restful API based server for validation and a transparency log for storage. A CLI application is available to make and verify entries, query the transparency log for inclusion proof, integrity verification of the transparency log or retrieval of entries by either public key or artifact.</em> <a href=https://github.com/sigstore/rekor target=_blank rel=noopener>Rekor Git</a></p></div><div class=paragraph><p>An important feature of Tekton Chains is that it integrates seamlessly with an application called <strong>Rekor</strong>. The configuration <code>transparency.enabled: true</code> enables the call to the Rekor API that can be found by default at: <a href=https://rekor.sigstore.dev class=bare>https://rekor.sigstore.dev</a>. This will create a transparency log which can be used for verification purposes later.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>Of course, it would be possible to install your own server. Learn in the official <a href=https://docs.sigstore.dev/rekor/installation/ target=_blank rel=noopener>Docs</a> how this can be achieved.</td></tr></tbody></table></div><div class=paragraph><p>This means every time our build-Tasks successfully completes a URL to the transparency logs will be attached to the Task.</p></div><div class=paragraph><p>After our PipelineRuns were successful, we can verify if the image has an entry in the Rekor transparency log. This is important to ensure that the image went through a valid signing process. At a later step (before we create the pull request for the production update) we will verify if the log exists.</p></div><div class=paragraph><p>The following annotations should have been added to the TaskRun secure-supply-chain-XXX-build-sign-image automatically:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>metadata:
  annotations:
    chains.tekton.dev/signed: &#39;true&#39;
    chains.tekton.dev/transparency: &#39;https://rekor.sigstore.dev/api/v1/log/entries?logIndex=25593495&#39;</code></pre></div></div><div class=paragraph><p>This created the following transparency logs:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-json data-lang=json>{
  &#34;24296fb24b8ad77a7ae84f4b950336d1872a066aeb9463dfbc231a7d3b73dd040dd5faefb3c013a7&#34;: {
    &#34;body&#34;: &#34;eyJhcGlWZXJzaW9uIjoiMC4wLjEiLCJraW5kIjoiaGFzaGVkcmVrb3JkIiwic3BlYyI6eyJkYXRhIjp7Imhhc2giOnsiYWxnb3JpdGhtIjoic2hhMjU2IiwidmFsdWUiOiJmYzE2ODM3Mzc1ODUyNjc0MTQ4MjIyMDJhMWU2Y2RkZDkxNWI4NWUzYzhhNDVhZmI0YzEyYmE2YmNhMGNmNDQyIn19LCJzaWduYXR1cmUiOnsiY29udGVudCI6Ik1FWUNJUUNRMnlnU2ZGTllHS2pzbXRIYjVielAwdlRNMFgyNHVlNXlKbjJxdWFWSyt3SWhBSmhoSWpweEFybDJERjFsVmpMT0ZzVnRhMzJmbXJXRmxXWkdRQ015b2xrayIsInB1YmxpY0tleSI6eyJjb250ZW50IjoiTFMwdExTMUNSVWRKVGlCUVZVSk1TVU1nUzBWWkxTMHRMUzBLVFVacmQwVjNXVWhMYjFwSmVtb3dRMEZSV1VsTGIxcEplbW93UkVGUlkwUlJaMEZGVEc0clduaENNMHNyS3pWSk1pOWlNWFJqVFVKcVZXODRjWGx6YVFwNlQzUlpVbGRQUTBwTVRWQlNWVGR4WTFJeVMyWlZZazAzYlVwUlNtbHZjbXR6VW1KUmNHMTBTekV4WjJNM1pIVkZObGg0WmxOdlpWUkJQVDBLTFMwdExTMUZUa1FnVUZWQ1RFbERJRXRGV1MwdExTMHRDZz09In19fX0=&#34;,
    &#34;integratedTime&#34;: 1688060588,
    &#34;logID&#34;: &#34;c0d23d6ad406973f9559f3ba2d1ca01f84147d8ffc5b8445c224f98b9591801d&#34;,
    &#34;logIndex&#34;: 25593495,
    &#34;verification&#34;: {
      &#34;inclusionProof&#34;: {
        &#34;checkpoint&#34;: &#34;rekor.sigstore.dev - 2605736670972794746\n21430853\n10sx5mwekx2c8jltWbt0WeJu+tNM9FOBNQoyPiC3CPQ=\nTimestamp: 1688061275289390813\n\n— rekor.sigstore.dev wNI9ajBFAiEAyzFYKKghB+RQsbMIIzjywdA9vFjsusQoMWMUJPRjw3ECIDVeYSGKn7zwXWxGLhQlIGAI1Ca0Gu7ZuLJ64xR3SrY0\n&#34;,
        &#34;hashes&#34;: [
          &#34;5cc5dba1f5f420acc9ed049c77b04c4fdd66cf6ef1ebd46b66e26039bb9ba06c&#34;,
          &#34;3041520c9fec6177225063053503f6d20b09e86b72968b737e3211a233dab6ce&#34;,
          &#34;ddb57132bba122df920d4816af7ac02bef03aec533cc7b45f8552ce19c023d10&#34;,
          &#34;8a510da356706a0a822daf3c3a935176d3634c6e0cce6830fe90a8771a3bc83d&#34;,
          &#34;7d254234192620827306cc5024ffb8ae699bfe2725c8e6aa13757f5471d416d4&#34;,
          &#34;648a4e45da960f4ad286dfa22ae93721c9ba82ee05edd5a7134d9b19e35735e0&#34;,
          &#34;9dcf0f21690ec420bffbc1d10c383b7d3dc568d26bd8fd9e8771abb01f5976dc&#34;,
          &#34;86575ffec011d78ad393e7af267693c0c59360e2299b308369951d8362032733&#34;,
          &#34;0088ef1f6ec1e992fa6c91837287f2bd7eea238e5af7467e21e6df0dc8efe516&#34;,
          &#34;b149d95903a4e554ac1c381f1afff31bb62b6e12b6b2fc95f36b8e198e1a42cd&#34;,
          &#34;de73a694862cebd660ef1cecdd1bb66e273ab0651ca939bf7fa6f5f567bafe93&#34;,
          &#34;a3c84734ddae3102952584443dea70e3dec2cc085af7cf0ba3530751966861ec&#34;,
          &#34;0be5c7bbcf481d1efcfc63a27fce447cf6345f7bb3155cf5de39de592c16d52d&#34;,
          &#34;f597f4bae8df3d6fc6eebfe3eabd7d393e08781f6f16b42398eca8512398fff1&#34;,
          &#34;4e35fcb3c0a59e7f329994002b38db35f5d511f499ba009e10b31f5d27563607&#34;,
          &#34;47044b7ac3aab820e44f0010538d7de71e17a11f4140cbbe9eeb37f78b77cc7d&#34;,
          &#34;eee63677e2591eefe06ab537d6dd1b4060770682744c8287879b5dcd3365a5b2&#34;,
          &#34;ff41aa21106dbe03996b4335dd158c7ffafd144e45022193de19b2b9136c3e42&#34;,
          &#34;e6ebdeef2e23335d8d7049ba5a0049a90593efdfe9c1b4548946b44a19d7214f&#34;,
          &#34;dd51e840e892d70093ad7e1db1e2dea3d50334c7345d360e444d22fc49ed9f5e&#34;,
          &#34;ad712c98424de0f1284d4f144b8a95b5d22c181d4c0a246518e7a9a220bdf643&#34;
        ],
        &#34;logIndex&#34;: 21430064,
        &#34;rootHash&#34;: &#34;d74b31e66c1e931d9cf2396d59bb7459e26efad34cf45381350a323e20b708f4&#34;,
        &#34;treeSize&#34;: 21430853
      },
      &#34;signedEntryTimestamp&#34;: &#34;MEYCIQDqmqb4k95FjiBNogOAmjTskkIPaGslgvrSND4pQdUALwIhAMt85yLsa5Ei+3NsmJ906/T9Hx1YZDDHQfHlTEYqqcaE&#34;
    }
  }
}</code></pre></div></div></div></div><div class=sect1><h2 id=_summary>Summary</h2><div class=sectionbody><div class=paragraph><p>Finally, we have a signed image uploaded to Quay. In addition, a transparency log has been created. Now let us add some security checks in the next steps.</p></div></div></div><footer class=footline></footer></div></div><div id=navigation-bottom><a class="nav-prev btn btn-default" href=/securesupplychain/2023-06-19-securesupplychain-step4/ title="Step 4 - Verify Git Commit"><i class="fa fa-chevron-left btn-bottom-prev"></i><span class=btn-bottom-text>Previous:</span> Step 4 - Verify Git Commit</a>
<a class="nav-next btn btn-default" href=/securesupplychain/2023-06-21-securesupplychain-step6/ title="Step 6 - Scanning with ACS" style=margin-right:0><i class="fa fa-chevron-right btn-bottom-next"></i><span class=btn-bottom-text>Next:</span> Step 6 - Scanning with ACS</a></div><div class=copyright><p>Copyright &copy; 2020 - 2023 Toni Schmidbauer & Thomas Jungbauer</p><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn target=_blank rel="noopener noreferrer">Hugo Learn Theme</i></a> and <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a></p></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1688565381></script>
<script src=/js/perfect-scrollbar.min.js?1688565381></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1688565381></script>
<script src=/js/jquery.sticky.js?1688565381></script>
<script src=/js/featherlight.min.js?1688565381></script>
<script src=/js/highlight.pack.js?1688565381></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1688565381></script>
<script src=/js/learn.js?1688565381></script>
<script src=/js/hugo-learn.js?1688565381></script>
<script src=/js/yaub.js?1688565381></script>
<script>window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.getAttribute("id");e.intersectionRatio>0&&(clearActiveStatesInTableOfContents(),document.querySelector(`aside nav li a[href="#${t}"]`).parentElement.classList.add("active"))})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function clearActiveStatesInTableOfContents(){document.querySelectorAll("aside nav li").forEach(e=>{e.classList.remove("active")})}</script><script type=text/javascript>function scrollTopAnimated(){$("html, body").animate({scrollTop:"0"},500)}</script><script>function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}$(".summary-box").click(function(){return window.location=$(this).find("a").attr("href"),!1})</script><script>const btn=document.querySelector(".btn-toggle"),prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)"),currentTheme=localStorage.getItem("theme");currentTheme=="dark"?document.body.classList.toggle("dark-theme"):currentTheme=="light"&&document.body.classList.toggle("light-theme"),btn.addEventListener("click",function(){if(prefersDarkScheme.matches){document.body.classList.toggle("light-theme");var e=document.body.classList.contains("light-theme")?"light":"dark"}else document.body.classList.toggle("dark-theme"),e=document.body.classList.contains("dark-theme")?"dark":"light";localStorage.setItem("theme",e)})</script></body></html>