<!doctype html><html lang=en class="js csstransforms3d"><head><meta name=google-site-verification content="yq2Ib3doJVHVlEW2wtHap5WY54JhS2CCvI40y30F0FI"><meta charset=utf-8><meta name=color-scheme content="dark light"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.101.0"><meta name=description content="Step 6 Secure Supply Chain"><meta name=author content="Toni Schmidbauer & Thomas Jungbauer"><meta name=keywords content="OCP,Tekton,OpenShift,Pipleines,CI/CD,Supply Chain,ACS,Advanced Cluster Security"><link rel=canonical href=https://blog.stderr.at/securesupplychain/2023-06-21-securesupplychain-step6/><link rel=icon href=/images/favicon.ico type=image/png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-180x180.png><link rel=apple-touch-icon sizes=128x128 href=/images/apple-touch-icon-128x128.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-touch-icon-72x72.png><link rel=apple-touch-icon href=/images/apple-touch-icon-57x57.png><link rel="shortcut icon" href=/images/favicon.ico><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><title>Step 6 - Scanning with ACS :: TechBlog about OpenShift/Ansible/Satellite and much more</title><link rel=manifest href=/manifest.json><meta name=theme-color content="#317EFB"><link href=/css/nucleus.min.css?1701071075 rel=stylesheet><link href=/css/fontawesome-all.min.css?1701071075 rel=stylesheet><link href=/css/font-awesome-animation.min.css?1701071075 rel=stylesheet><link href=/css/hybrid.css?1701071075 rel=stylesheet><link href=/css/featherlight.min.css?1701071075 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1701071075 rel=stylesheet><link href=/css/auto-complete.css?1701071075 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1701071075 rel=stylesheet><link href=/css/theme.min.css?1701071075 rel=stylesheet><link href=/css/hugo-theme.css?1701071075 rel=stylesheet><link href=/css/theme-yaub.css?1701071075 rel=stylesheet><script src=/js/jquery-3.6.0.min.js?1701071075></script>
<script src=/js/jquery.waypoints.min.js?1701071075></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/securesupplychain/2023-06-21-securesupplychain-step6/><button onclick=scrollTopAnimated() id=myBtn class="top-btn button fa fa-arrow-up" title="Go to top"></button>
<span class=read-progress></span><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><p class="fa fa-cloud-upload-alt faa-float animated"></p><span class=text>YAUB</span><p class=logoarea><span class="text small">Yet another Useless Blog</span></p></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1701071075></script>
<script type=text/javascript src=/js/auto-complete.js?1701071075></script>
<script type=text/javascript>var baseurl="https://blog.stderr.at/"</script><script type=text/javascript src=/js/search.js?1701071075></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/openshift/ title=OpenShift class=dd-item><a href=/openshift/>OpenShift</a><ul><li data-nav-id=/openshift/2023-11-13-running-falco/ title="Running Falco on OpenShift 4.12
Running Falco on OpenShift 4.12" class=dd-item><a href=/openshift/2023-11-13-running-falco/>Running Falco on OpenShift 4.12
Running Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023-11-03-quay-deployment-with-gitops/ title="Quay Deployment and Configuration using GitOps" class=dd-item><a href=/openshift/2023-11-03-quay-deployment-with-gitops/>Quay Deployment and Configuration using GitOps</a></li><li data-nav-id=/openshift/2023-10-23-openshift-falco/ title="Setting up Falco on OpenShift 4.12" class=dd-item><a href=/openshift/2023-10-23-openshift-falco/>Setting up Falco on OpenShift 4.12</a></li><li data-nav-id=/openshift/2023-10-18-force-machineconfig-rollout/ title="How to force a MachineConfig rollout" class=dd-item><a href=/openshift/2023-10-18-force-machineconfig-rollout/>How to force a MachineConfig rollout</a></li><li data-nav-id=/openshift/2023-03-20-operator-installation-with-argocd/ title="Operator installation with Argo CD" class=dd-item><a href=/openshift/2023-03-20-operator-installation-with-argocd/>Operator installation with Argo CD</a></li><li data-nav-id=/openshift/2023-02-16-ssl-certificate-management/ title="SSL Certificate Management for OpenShift on AWS" class=dd-item><a href=/openshift/2023-02-16-ssl-certificate-management/>SSL Certificate Management for OpenShift on AWS</a></li><li data-nav-id=/openshift/2022-11-04-argocd-and-serversideapply/ title="Using ServerSideApply with ArgoCD" class=dd-item><a href=/openshift/2022-11-04-argocd-and-serversideapply/>Using ServerSideApply with ArgoCD</a></li><li data-nav-id=/openshift/2022-08-16-hashicorp-vault/ title="Secrets Management - Vault on OpenShift" class=dd-item><a href=/openshift/2022-08-16-hashicorp-vault/>Secrets Management - Vault on OpenShift</a></li><li data-nav-id=/openshift/2022-04-22-multi-cloud-gateway/ title="Overview of Red Hat's Multi Cloud Gateway (Noobaa)" class=dd-item><a href=/openshift/2022-04-22-multi-cloud-gateway/>Overview of Red Hat's Multi Cloud Gateway (Noobaa)</a></li><li data-nav-id=/openshift/2021-09-25-sealed_secrets/ title="Secure your secrets with Sealed Secrets" class=dd-item><a href=/openshift/2021-09-25-sealed_secrets/>Secure your secrets with Sealed Secrets</a></li><li data-nav-id=/openshift/2021-02-27-understanding-block-devices/ title="Understanding RWO block device handling in OpenShift" class=dd-item><a href=/openshift/2021-02-27-understanding-block-devices/>Understanding RWO block device handling in OpenShift</a></li><li data-nav-id=/openshift/2021-01-27-writingoperatoransible/ title="Writing Operator using Ansible" class=dd-item><a href=/openshift/2021-01-27-writingoperatoransible/>Writing Operator using Ansible</a></li><li data-nav-id=/openshift/2020-12-10-thanos-vs-thanos/ title="Thanos Querier vs Thanos Querier" class=dd-item><a href=/openshift/2020-12-10-thanos-vs-thanos/>Thanos Querier vs Thanos Querier</a></li><li data-nav-id=/openshift/2020-08-06-argocd/ title="GitOps - Argo CD" class=dd-item><a href=/openshift/2020-08-06-argocd/>GitOps - Argo CD</a></li><li data-nav-id=/openshift/2020-04-16-tekton/ title="OpenShift Pipelines - Tekton Introduction" class=dd-item><a href=/openshift/2020-04-16-tekton/>OpenShift Pipelines - Tekton Introduction</a></li><li data-nav-id=/openshift/2020-04-01-oc-commands/ title="Helpful oc / kubectl commands" class=dd-item><a href=/openshift/2020-04-01-oc-commands/>Helpful oc / kubectl commands</a></li></ul></li><li data-nav-id=/day-2/ title="OpenShift Day-2" class=dd-item><a href=/day-2/>OpenShift Day-2</a><ul><li data-nav-id=/day-2/etcd/ title=etcd class=dd-item><a href=/day-2/etcd/>etcd</a><ul><li data-nav-id=/day-2/etcd/2022-01-29-automatedetcdbackup/ title="Automated ETCD Backup" class=dd-item><a href=/day-2/etcd/2022-01-29-automatedetcdbackup/>Automated ETCD Backup</a></li></ul></li><li data-nav-id=/day-2/labels_environmets/ title="Labels & Environments" class=dd-item><a href=/day-2/labels_environmets/>Labels & Environments</a><ul><li data-nav-id=/day-2/labels_environmets/2022-01-12-creatingenvironment/ title="Working with Environments" class=dd-item><a href=/day-2/labels_environmets/2022-01-12-creatingenvironment/>Working with Environments</a></li></ul></li><li data-nav-id=/day-2/pod-placement/ title="Pod Placement" class=dd-item><a href=/day-2/pod-placement/>Pod Placement</a><ul><li data-nav-id=/day-2/pod-placement/2021-08-26-podplacement-intro/ title=Introduction class=dd-item><a href=/day-2/pod-placement/2021-08-26-podplacement-intro/>Introduction</a></li><li data-nav-id=/day-2/pod-placement/2021-08-29-node-affinity/ title="Node Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-29-node-affinity/>Node Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-27-podplacement/ title=NodeSelector class=dd-item><a href=/day-2/pod-placement/2021-08-27-podplacement/>NodeSelector</a></li><li data-nav-id=/day-2/pod-placement/2021-08-28-affinity/ title="Pod Affinity/Anti-Affinity" class=dd-item><a href=/day-2/pod-placement/2021-08-28-affinity/>Pod Affinity/Anti-Affinity</a></li><li data-nav-id=/day-2/pod-placement/2021-08-30-taints/ title="Taints and Tolerations" class=dd-item><a href=/day-2/pod-placement/2021-08-30-taints/>Taints and Tolerations</a></li><li data-nav-id=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/ title="Topology Spread Constraints" class=dd-item><a href=/day-2/pod-placement/2021-08-31-topologyspreadcontraints/>Topology Spread Constraints</a></li><li data-nav-id=/day-2/pod-placement/2021-09-01-descheduler/ title="Using Descheduler" class=dd-item><a href=/day-2/pod-placement/2021-09-01-descheduler/>Using Descheduler</a></li></ul></li></ul></li><li data-nav-id=/securesupplychain/ title="Secure Supply Chain" class="dd-item
parent"><a href=/securesupplychain/>Secure Supply Chain</a><ul><li data-nav-id=/securesupplychain/2023-06-15-securesupplychain-intro/ title="Introduction to a Secure Supply Chain" class=dd-item><a href=/securesupplychain/2023-06-15-securesupplychain-intro/>Introduction to a Secure Supply Chain</a></li><li data-nav-id=/securesupplychain/2023-06-16-securesupplychain-step1/ title="Step 1 - Listen to Events" class=dd-item><a href=/securesupplychain/2023-06-16-securesupplychain-step1/>Step 1 - Listen to Events</a></li><li data-nav-id=/securesupplychain/2023-06-17-securesupplychain-step2/ title="Step 2 - Pipelines" class=dd-item><a href=/securesupplychain/2023-06-17-securesupplychain-step2/>Step 2 - Pipelines</a></li><li data-nav-id=/securesupplychain/2023-06-18-securesupplychain-step3/ title="Step 3 - SonarQube" class=dd-item><a href=/securesupplychain/2023-06-18-securesupplychain-step3/>Step 3 - SonarQube</a></li><li data-nav-id=/securesupplychain/2023-06-19-securesupplychain-step4/ title="Step 4 - Verify Git Commit" class=dd-item><a href=/securesupplychain/2023-06-19-securesupplychain-step4/>Step 4 - Verify Git Commit</a></li><li data-nav-id=/securesupplychain/2023-06-20-securesupplychain-step5/ title="Step 5 - Build and Sign Image" class=dd-item><a href=/securesupplychain/2023-06-20-securesupplychain-step5/>Step 5 - Build and Sign Image</a></li><li data-nav-id=/securesupplychain/2023-06-21-securesupplychain-step6/ title="Step 6 - Scanning with ACS" class="dd-item active"><a href=/securesupplychain/2023-06-21-securesupplychain-step6/>Step 6 - Scanning with ACS</a></li><li data-nav-id=/securesupplychain/2023-06-22-securesupplychain-step7/ title="Step 7 - Generating a SBOM" class=dd-item><a href=/securesupplychain/2023-06-22-securesupplychain-step7/>Step 7 - Generating a SBOM</a></li><li data-nav-id=/securesupplychain/2023-06-23-securesupplychain-step8/ title="Step 8 - Updating Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-23-securesupplychain-step8/>Step 8 - Updating Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-24-securesupplychain-step9/ title="Step 9 - Linting Kubernetes Manifests" class=dd-item><a href=/securesupplychain/2023-06-24-securesupplychain-step9/>Step 9 - Linting Kubernetes Manifests</a></li><li data-nav-id=/securesupplychain/2023-06-25-securesupplychain-step10/ title="Step 10 - The Example Application" class=dd-item><a href=/securesupplychain/2023-06-25-securesupplychain-step10/>Step 10 - The Example Application</a></li><li data-nav-id=/securesupplychain/2023-06-26-securesupplychain-step11/ title="Step 11 - ACS Deployment Check" class=dd-item><a href=/securesupplychain/2023-06-26-securesupplychain-step11/>Step 11 - ACS Deployment Check</a></li><li data-nav-id=/securesupplychain/2023-06-27-securesupplychain-step12/ title="Step 12 - Verify TLog Signature" class=dd-item><a href=/securesupplychain/2023-06-27-securesupplychain-step12/>Step 12 - Verify TLog Signature</a></li><li data-nav-id=/securesupplychain/2023-06-28-securesupplychain-step13/ title="Step 13 - Bring it to Production" class=dd-item><a href=/securesupplychain/2023-06-28-securesupplychain-step13/>Step 13 - Bring it to Production</a></li></ul></li><li data-nav-id=/compliance/ title=Compliance class=dd-item><a href=/compliance/>Compliance</a><ul><li data-nav-id=/compliance/2021/07/oc-compliance-command-line-plugin/ title="oc compliance command line plugin" class=dd-item><a href=/compliance/2021/07/oc-compliance-command-line-plugin/>oc compliance command line plugin</a></li><li data-nav-id=/compliance/2021/07/compliance-operator/ title="Compliance Operator" class=dd-item><a href=/compliance/2021/07/compliance-operator/>Compliance Operator</a></li></ul></li><li data-nav-id=/service-mesh/ title="Service Mesh" class=dd-item><a href=/service-mesh/>Service Mesh</a><ul><li data-nav-id=/service-mesh/2020/05/enable-automatic-route-creation/ title="Enable Automatic Route Creation" class=dd-item><a href=/service-mesh/2020/05/enable-automatic-route-creation/>Enable Automatic Route Creation</a></li><li data-nav-id=/service-mesh/2020/05/authorization-rbac/ title="Authorization (RBAC)" class=dd-item><a href=/service-mesh/2020/05/authorization-rbac/>Authorization (RBAC)</a></li><li data-nav-id=/service-mesh/2020/04/deploy-example-bookinfo-application/ title="Deploy Example Bookinfo Application" class=dd-item><a href=/service-mesh/2020/04/deploy-example-bookinfo-application/>Deploy Example Bookinfo Application</a></li><li data-nav-id=/service-mesh/2020/04/service-mesh-1.1-released/ title="Service Mesh 1.1 released" class=dd-item><a href=/service-mesh/2020/04/service-mesh-1.1-released/>Service Mesh 1.1 released</a></li><li data-nav-id=/service-mesh/2020/04/authentication-jwt/ title="Authentication JWT" class=dd-item><a href=/service-mesh/2020/04/authentication-jwt/>Authentication JWT</a></li><li data-nav-id=/service-mesh/2020/04/mutual-tls-authentication/ title="Mutual TLS Authentication" class=dd-item><a href=/service-mesh/2020/04/mutual-tls-authentication/>Mutual TLS Authentication</a></li><li data-nav-id=/service-mesh/2020/04/fault-injection/ title="Fault Injection" class=dd-item><a href=/service-mesh/2020/04/fault-injection/>Fault Injection</a></li><li data-nav-id=/service-mesh/2020/04/limit-egress/external-traffic/ title="Limit Egress/External Traffic" class=dd-item><a href=/service-mesh/2020/04/limit-egress/external-traffic/>Limit Egress/External Traffic</a></li><li data-nav-id=/service-mesh/2020/04/advanced-routing-example/ title="Advanced Routing Example" class=dd-item><a href=/service-mesh/2020/04/advanced-routing-example/>Advanced Routing Example</a></li><li data-nav-id=/service-mesh/2020/04/routing-example/ title="Routing Example" class=dd-item><a href=/service-mesh/2020/04/routing-example/>Routing Example</a></li><li data-nav-id=/service-mesh/2020/03/ingress-with-custom-domain/ title="Ingress with custom domain" class=dd-item><a href=/service-mesh/2020/03/ingress-with-custom-domain/>Ingress with custom domain</a></li><li data-nav-id=/service-mesh/2020/03/ingress-traffic/ title="Ingress Traffic" class=dd-item><a href=/service-mesh/2020/03/ingress-traffic/>Ingress Traffic</a></li><li data-nav-id=/service-mesh/2020/03/deploy-microservices/ title="Deploy Microservices" class=dd-item><a href=/service-mesh/2020/03/deploy-microservices/>Deploy Microservices</a></li><li data-nav-id=/service-mesh/2020/03/installation/ title=Installation class=dd-item><a href=/service-mesh/2020/03/installation/>Installation</a></li></ul></li><li data-nav-id=/general/ title=General class=dd-item><a href=/general/>General</a><ul><li data-nav-id=/general/2020/05/basic-usage-of-git/ title="Basic usage of git" class=dd-item><a href=/general/2020/05/basic-usage-of-git/>Basic usage of git</a></li><li data-nav-id=/general/2020/04/red-hat-satellite-cheat-sheet/ title="Red Hat Satellite Cheat Sheet" class=dd-item><a href=/general/2020/04/red-hat-satellite-cheat-sheet/>Red Hat Satellite Cheat Sheet</a></li></ul></li><li data-nav-id=/ansible/ title=Ansible class=dd-item><a href=/ansible/>Ansible</a><ul><li data-nav-id=/ansible/2021/11/ansible-style-guide/ title="Ansible Style Guide" class=dd-item><a href=/ansible/2021/11/ansible-style-guide/>Ansible Style Guide</a></li><li data-nav-id=/ansible/2021/10/automation-controller-and-ldap-authentication/ title="Automation Controller and LDAP Authentication" class=dd-item><a href=/ansible/2021/10/automation-controller-and-ldap-authentication/>Automation Controller and LDAP Authentication</a></li><li data-nav-id=/ansible/2021/07/ansible-tower-and-downloading-collections/ title="Ansible Tower and downloading collections" class=dd-item><a href=/ansible/2021/07/ansible-tower-and-downloading-collections/>Ansible Tower and downloading collections</a></li><li data-nav-id=/ansible/2020/04/ansible-azure-resource-manager-example/ title="Ansible - Azure Resource Manager Example" class=dd-item><a href=/ansible/2020/04/ansible-azure-resource-manager-example/>Ansible - Azure Resource Manager Example</a></li><li data-nav-id=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/ title="DO410 Ansible and Ansible Tower training notes" class=dd-item><a href=/ansible/2020/04/do410-ansible-and-ansible-tower-training-notes/>DO410 Ansible and Ansible Tower training notes</a></li></ul></li><li data-nav-id=/acs/ title="Advanced Cluster Security" class=dd-item><a href=/acs/>Advanced Cluster Security</a><ul><li data-nav-id=/acs/2021-12-11-acsauth/ title="Advanced Cluster Security - Authentication" class=dd-item><a href=/acs/2021-12-11-acsauth/>Advanced Cluster Security - Authentication</a></li></ul></li><li data-nav-id=/azure/ title=Azure class=dd-item><a href=/azure/>Azure</a><ul><li data-nav-id=/azure/2021-10-29-private-aro/ title="Stumbling into Azure Part II: Setting up a private ARO cluster" class=dd-item><a href=/azure/2021-10-29-private-aro/>Stumbling into Azure Part II: Setting up a private ARO cluster</a></li><li data-nav-id=/azure/2021-10-17-s2s-vpn/ title="Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing" class=dd-item><a href=/azure/2021-10-17-s2s-vpn/>Stumbling into Azure Part I: Building a site-to-site VPN tunnel for testing</a></li></ul></li><li data-nav-id=/java/ title=Java class=dd-item><a href=/java/>Java</a><ul><li data-nav-id=/java/2022-02-25-jpa-disconnected-entity/ title="Adventures in Java Land: JPA disconnected entities" class=dd-item><a href=/java/2022-02-25-jpa-disconnected-entity/>Adventures in Java Land: JPA disconnected entities</a></li></ul></li><li data-nav-id=/quay/ title=Quay class=dd-item><a href=/quay/>Quay</a><ul><li data-nav-id=/quay/2021-09-07-quay-upgrade-3.4/ title="Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator" class=dd-item><a href=/quay/2021-09-07-quay-upgrade-3.4/>Stumbling into Quay: Upgrading from 3.3 to 3.4 with the quay-operator</a></li><li data-nav-id=/quay/2020-05-13-quay-tutorial1/ title="Red Hat Quay Registry - Overview and Installation" class=dd-item><a href=/quay/2020-05-13-quay-tutorial1/>Red Hat Quay Registry - Overview and Installation</a></li></ul></li><li data-nav-id=/legaldisclosure/ title="Legal Disclosure" class=dd-item><a href=/legaldisclosure/>Legal Disclosure</a></li><li data-nav-id=/rss/ title="RSS Feeds" class=dd-item><a href=/rss/>RSS Feeds</a></li></ul><section id=shortcuts><h3 class=shortcut-title>More</h3><ul><li><a class=padding href=https://blog.stderr.at/tags><i class='fas fa-tags'></i> Tags</a></li><li><a class=padding href=https://blog.stderr.at/categories><i class='far fa-bookmark'></i> Catagories</a></li><li><a class=padding href=https://blog.stderr.at/archive><i class='fas fa-box'></i> Archive</a></li><li><a class=padding href=https://charts.stderr.at/><i class='fas fa-book'></i> Helm Charts</a></li><li><a class=padding href=https://www.redhat.com><i class='fab fa-redhat'></i> Red Hat</a></li></ul></section><section id=footer></section></div></nav><section id=body class=post-content><div id=overlay></div><aside id=toc-field class="hidden lg:block tableOfContentContainer"><header id=TableOfContentsHeader>What's on this Page</header><nav id=TableOfContents><ul><li><a href=#_goals>Goals</a></li><li><a href=#_install_advanced_cluster_security_acs>Install Advanced Cluster Security (ACS)</a><ul><li><a href=#_configure_acs_integration>Configure ACS Integration</a></li><li><a href=#_generate_authentication_token>Generate Authentication Token</a></li><li><a href=#_integrate_cosign_with_acs>Integrate CoSign with ACS</a></li><li><a href=#_create_a_custom_policy_that_verifies_the_signature>Create a Custom Policy that verifies the Signature</a></li></ul></li><li><a href=#_prepare_the_pipeline_tasks>Prepare the Pipeline Tasks</a><ul><li><a href=#_task_acs_image_scan>Task acs-image-scan</a></li><li><a href=#_task_image_check>Task Image Check</a></li></ul></li><li><a href=#_extend_the_pipeline>Extend the Pipeline</a></li><li><a href=#_execute_the_pipeline>Execute the Pipeline</a></li><li><a href=#_summary>Summary</a></li></ul></nav><div id=navigation><a class=nav-prev href=/securesupplychain/2023-06-20-securesupplychain-step5/ title="Step 5 - Build and Sign Image"><i class="fa fa-chevron-left"></i></a>
<a class=nav-next href=/securesupplychain/2023-06-22-securesupplychain-step7/ title="Step 7 - Generating a SBOM" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></aside><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://schema.org/BreadcrumbList><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/><span itemprop=name>YAUB Yet Another Useless Blog</span><meta itemprop=position content="1"></a></span>> <span itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a itemprop=item href=/securesupplychain/><span itemprop=name>Secure Supply Chain</span><meta itemprop=position content="2"></a></span>> Step 6 - Scanning with ACS</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#_goals>Goals</a></li><li><a href=#_install_advanced_cluster_security_acs>Install Advanced Cluster Security (ACS)</a><ul><li><a href=#_configure_acs_integration>Configure ACS Integration</a></li><li><a href=#_generate_authentication_token>Generate Authentication Token</a></li><li><a href=#_integrate_cosign_with_acs>Integrate CoSign with ACS</a></li><li><a href=#_create_a_custom_policy_that_verifies_the_signature>Create a Custom Policy that verifies the Signature</a></li></ul></li><li><a href=#_prepare_the_pipeline_tasks>Prepare the Pipeline Tasks</a><ul><li><a href=#_task_acs_image_scan>Task acs-image-scan</a></li><li><a href=#_task_image_check>Task Image Check</a></li></ul></li><li><a href=#_extend_the_pipeline>Extend the Pipeline</a></li><li><a href=#_execute_the_pipeline>Execute the Pipeline</a></li><li><a href=#_summary>Summary</a></li></ul></nav></div></div><div class=social><a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.stderr.at%2fsecuresupplychain%2f2023-06-21-securesupplychain-step6%2f" class="facebook no-highlight" aria-label="share on Facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-facebook" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a href="https://twitter.com/intent/tweet?hashtags=codingnconcepts&url=https%3a%2f%2fblog.stderr.at%2fsecuresupplychain%2f2023-06-21-securesupplychain-step6%2f&text=Step%206%20-%20Scanning%20with%20ACS" class="twitter no-highlight" aria-label="share on Twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5.0-78.8 35.3-78.8 78.8.0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3C20 26 16.1 39.6 16.1 54c0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1.0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4.0-12.6-.4-18.8-1.1C34.9 299 76.3 312 120.8 312c144.9.0 224.1-120 224.1-224.1.0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg></div></div></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.stderr.at%2fsecuresupplychain%2f2023-06-21-securesupplychain-step6%2f&source=https%3a%2f%2fblog.stderr.at%2fsecuresupplychain%2f2023-06-21-securesupplychain-step6%2f&title=Step%206%20-%20Scanning%20with%20ACS&summary=Step%206%20-%20Scanning%20with%20ACS" class="linkedin no-highlight" aria-label="share on Linkedin"><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg></div></div></a><a href="whatsapp://send?text=Step%206%20-%20Scanning%20with%20ACS%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0aStep%206%20Secure%20Supply%20Chain%0a%0ahttps%3a%2f%2fblog.stderr.at%2fsecuresupplychain%2f2023-06-21-securesupplychain-step6%2f%0a" class="whatsapp no-highlight" aria-label="share on Whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-whatsapp" width="24" height="24" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a><a href="mailto:?subject=TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more - Step%206%20-%20Scanning%20with%20ACS.&body=Step%206%20-%20Scanning%20with%20ACS%2c%20by%20TechBlog%20about%20OpenShift%2fAnsible%2fSatellite%20and%20much%20more%0aStep%206%20Secure%20Supply%20Chain%0a%0ahttps%3a%2f%2fblog.stderr.at%2fsecuresupplychain%2f2023-06-21-securesupplychain-step6%2f%0a" class="email no-highlight" aria-label="share on Email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg class="icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg></div></div></a></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=/tags/ocp>OCP</a>
<a class=tag-link href=/tags/tekton>Tekton</a>
<a class=tag-link href=/tags/openshift>OpenShift</a>
<a class=tag-link href=/tags/pipleines>Pipleines</a>
<a class=tag-link href=/tags/ci/cd>CI/CD</a>
<a class=tag-link href=/tags/supply-chain>Supply Chain</a>
<a class=tag-link href=/tags/acs>ACS</a>
<a class=tag-link href=/tags/advanced-cluster-security>Advanced Cluster Security</a></div></div><div id=body-inner><h1>Step 6 - Scanning with ACS</h1><p class=tracked><time class="f6 mv4 dib tracked" datetime=2023-06-28T00:00:00Z><strong>June 28, 2023</strong></time>
- By:
Thomas Jungbauer
( Lastmod: 2023-07-23 ) - <span class=readtime><strong>8 min read</strong></span></p><div class=paragraph><p>In this step we will install <strong>Advanced Cluster Security</strong> (ACS) and create 2 new steps in our Pipeline to scan the image for vulnerabilities and security policy. A custom security policy, configured in ACS, will verify if the image is signed.</p></div><div class=sect1><h2 id=_goals>Goals</h2><div class=sectionbody><div class=paragraph><p>The goals of this step are:</p></div><div class=ulist><ul><li><p>Install ACS.</p></li><li><p>Create a custom security policy into ACS.</p></li><li><p>Configure CoSign integration in ACS.</p></li><li><p>Create a step in the Pipeline to perform an image scan (vulnerabilities).</p></li><li><p>Create a step in the Pipeline to perform an image check (security policies).</p></li></ul></div></div></div><div class=sect1><h2 id=_install_advanced_cluster_security_acs>Install Advanced Cluster Security (ACS)</h2><div class=sectionbody><div class=paragraph><p>We will install ACS on our cluster which will be called <strong>local-cluster</strong> inside ACS.</p></div><div class=paragraph><p>The deployment will happen via Argo CD (OpenShift GitOps) that will use the following Helm Chart: <a href=https://github.com/tjungbauer/helm-charts/tree/main/charts/rhacs-full-stack target=_blank rel=noopener>RHACS</a></p></div><div class=paragraph><p>The Argo CD Application will trigger the deployment which will take several minutes.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content>The deployment will install a minimal version of ACS and tries to limit the required resources and replicas. For production environments, you probably want to increase the settings.</td></tr></tbody></table></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: in-cluster-init-rhacs
  namespace: openshift-gitops
spec:
  destination:
    namespace: default
    server: &#39;https://kubernetes.default.svc&#39; <i class=conum data-value=1></i><b>(1)</b>
  info:
    - name: Description
      value: &gt;-
        Initialize Red Hat Advanced Cluster Security and deploy Central and
        SecuredCluster
  project: in-cluster
  source:
    path: charts/rhacs-full-stack <i class=conum data-value=2></i><b>(2)</b>
    repoURL: &#39;https://github.com/tjungbauer/helm-charts&#39; <i class=conum data-value=3></i><b>(3)</b>
    targetRevision: main</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Installing on the local cluster.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Path to the Helm chart.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>URL to the Helm chart repository.</td></tr></tbody></table></div><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step6-sync_acs.png?width=400px" alt="Syncing ACS Deployment Application"></div><div class=title>Figure 1. Syncing ACS Deployment Application</div></div><div class=paragraph><p>This GitOps Application will start a full-stack ACS deployment. It does (in this exact order):</p></div><div class="olist arabic"><ol class=arabic><li><p>Installs the ACS Operator into rhacs-operator</p></li><li><p>Verifies if the Operator is ready</p></li><li><p>Creates the Namespace stackrox</p></li><li><p>Adds a ConsoleLink in the upper right action menu of OpenShift</p><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step6-acs_consolelink.png?width=220px" alt="ACS ConsoleLine"></div><div class=title>Figure 2. ACS ConsoleLink</div></div></li><li><p>Creates the Central custom resource with minimum resources</p></li><li><p>Creates an init-bundle to add the first (local) cluster</p></li><li><p>Adds the custom resource SecureCluster to install the rest of the ACS components</p></li><li><p>And finally, runs a basic configuration that enables authentication via OpenShift and provides the <strong>kubeadmin</strong> user admin privileges. This can be disabled in the values file if you prefer not to configure this, or if kubeadmin does not exist anymore in your cluster.</p></li></ol></div><div class=paragraph><p>The whole process will take a while and uses syncwaves and hooks.</p></div><div class=sect2><h3 id=_configure_acs_integration>Configure ACS Integration</h3></div><div class=sect2><h3 id=_generate_authentication_token>Generate Authentication Token</h3><div class="olist arabic"><ol class=arabic><li><p>Create an authentication Token in ACS</p><div class=paragraph><p>Go to <code>"Platform Configuration > Integrations > API Token"</code></p></div><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step6-acs_token.png?width=440px" alt="ACS Generate Token"></div><div class=title>Figure 3. ACS Generate Token</div></div><div class=paragraph><p>Generate a new Token with at least <strong>Continuous Integration</strong> privileges and save the created Token.</p></div></li><li><p>Back in OpenShift, a Secret must be created with the key <strong>rox_api_token</strong></p><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>kind: Secret
apiVersion: v1
metadata:
  name: stackrox-secret
  namespace: ci
data:
  rox_api_token: &lt;base 64 Token&gt; <i class=conum data-value=1></i><b>(1)</b>
type: Opaque</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Base64 decoded ACS Token.</td></tr></tbody></table></div></li><li><p>Create a 2nd Secret that contains the ACS endpoint and its port:</p><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>kind: Secret
apiVersion: v1
metadata:
  name: stackrox-endpoint
  namespace: ci
stringData:
  rox_central_endpoint: central-stackrox.apps.ocp.aws.ispworld.at:443 <i class=conum data-value=1></i><b>(1)</b>
type: Opaque</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>The endpoint URL of my example cluster. Note: the port MUST be added here.</td></tr></tbody></table></div></li></ol></div></div><div class=sect2><h3 id=_integrate_cosign_with_acs>Integrate CoSign with ACS</h3><div class="olist arabic"><ol class=arabic><li><p>Configure CoSign Integration</p><div class=paragraph><p>During <a href=/openshift/securesupplychain/step5/ target=_blank rel=noopener>Step 5</a> we have created a CoSign key pair to sign our images. To integrate with ACS, we need to retrieve the <strong>public key</strong>. In OpenShift, open the Secret signing-secrets in the Namespace openshift-pipelines and extract the key cosign.pub.</p></div><div class=paragraph><p>It will look something like tjis:</p></div><div class=listingblock><div class=content><pre class=highlight><code>-----BEGIN PUBLIC KEY-----
key...
-----END PUBLIC KEY-----</code></pre></div></div></li><li><p>In ACS, go to <code>"Platform Configuration > Integrations > Signature"</code> and create a new CoSign integration.</p><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step6-acs_cosign.png?width=440px" alt="ACS CoSign Integration"></div><div class=title>Figure 4. ACS CoSign Integration</div></div><div class=paragraph><p>Enter a name and the public key and activate this integration</p></div><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step6-acs_cosign_int.png?width=600px" alt="ACS Create CoSign Integration"></div><div class=title>Figure 5. ACS Create CoSign Integration</div></div><div class=paragraph><p>This will enable ACS to verify the CoSign signature of the image.</p></div></li></ol></div></div><div class=sect2><h3 id=_create_a_custom_policy_that_verifies_the_signature>Create a Custom Policy that verifies the Signature</h3><div class=paragraph><p>Create a custom security policy, that verifies if our image has been signed or not.</p></div><div class=paragraph><p>To be sure that every image is correctly signed, we create a custom security policy that verifies this signature using our CoSign integration. This policy can be configured as <strong>inform</strong> or <strong>enforce</strong>. Enforce means that the pipeline will fail (during the Task acs-image-check) if the image signature cannot be checked.</p></div><div class=paragraph><p>Let’s create our policy by hand for this time. However, it is also possible to export/import rules. The important part here is that link to the CoSign integration is valid, otherwise ACS cannot verify the signature.</p></div><div class="olist arabic"><ol class=arabic><li><p>Open <code>"Platform Configuration > Policy > and click the button Create Policy"</code></p></li><li><p>Name: <strong>Trusted Signature Policy</strong></p></li><li><p>Severity: <strong>High</strong></p></li><li><p>Categories: <strong>Security Best Practices</strong></p></li><li><p>Click <strong>Next</strong></p></li><li><p>Lifecycle stage: check <strong>Build</strong> and <strong>Deploy</strong></p></li><li><p>Response method: <strong>Inform and enforce</strong> > This will make the Task in the Pipeline fail when the signature cannot be verified.</p></li><li><p>Configure enforcement behavior:</p><div class="olist loweralpha"><ol class=loweralpha type=a><li><p>Activate: <strong>Enforce on Build</strong> > Only fail for build lifecycles.</p></li><li><p>Leave Deployment disabled for now. A good practice would be to enable it, but for other steps in this series, it will be required to keep it disabled for now.</p></li><li><p>Leave Runtime disabled.</p></li></ol></div></li><li><p>Click <strong>Next</strong></p></li><li><p>As policy criteria find "Image Registry > Image signature" and drag and drop it to the policy section</p><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step6-acs_policy_criteria.png?width=600px" alt="ACS Policy Criteria"></div><div class=title>Figure 6. ACS Policy Criteria</div></div></li><li><p>Click on <strong>Select</strong> and select the CoSign integration</p><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step6-acs_assign_cosign.png?width=600px" alt="ACS Assign CoSign integration to policy"></div><div class=title>Figure 7. ACS Assign CoSign integration to policy</div></div></li><li><p>Click <strong>Next</strong></p></li><li><p>Leave the Policy scope for now and click <strong>Next</strong></p></li><li><p>Review the Policy and <strong>Save</strong> it.</p></li></ol></div></div></div></div><div class=sect1><h2 id=_prepare_the_pipeline_tasks>Prepare the Pipeline Tasks</h2><div class=sectionbody><div class=paragraph><p>Now, finally, after all these preparations we are going to integrate ACS into our Pipeline. For this, we will create 2 tasks:</p></div><div class="olist arabic"><ol class=arabic><li><p><strong>acs-image-scan</strong>: Will scan the image for vulnerabilities</p></li><li><p><strong>acs-image-check</strong>: Will verify if the image would violate any security policy, especially the custom policy we have created.</p></li></ol></div><div class=paragraph><p>Both checks will use the <strong>roxctl</strong> command line tool.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>It is recommended to add these two Tasks to any Pipeline system you are using when you have ACS installed to leverage the full potential of ACS. It does not matter if you are using Tekton, Jenkins or something else. You can find examples of integrations at the Git repository: <a href=https://github.com/stackrox/contributions/ class=bare>https://github.com/stackrox/contributions/</a>.</td></tr></tbody></table></div><div class=sect2><h3 id=_task_acs_image_scan>Task acs-image-scan</h3><div class=paragraph><p>To scan for vulnerabilities, create the following Task. It leverages the command line tool <strong>roxctl</strong> which can also be used on your local machine to perform such scans manually.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: acs-image-scan
  namespace: ci
spec:
  description: &gt;-
    Scan an image with StackRox/RHACS. This tasks allows you to check an
    image against vulnerabilities.
  params:
    - description: |
        Secret containing the address:port tuple for StackRox Central)
        (example - rox.stackrox.io:443)
      name: rox_central_endpoint
      type: string
    - description: Secret containing the StackRox API token with CI permissions
      name: rox_api_token
      type: string
    - description: |
        Full name of image to scan (example -- gcr.io/rox/sample:5.0-rc1)
      name: image
      type: string
    - default: &#39;false&#39;
      description: |
        When set to `&#34;true&#34;`, skip verifying the TLS certs of the Central
        endpoint.  Defaults to `&#34;false&#34;`.
      name: insecure-skip-tls-verify
      type: string
  results:
    - description: Output of `roxctl image check`
      name: check_output
      type: string
  steps:
    - env: <i class=conum data-value=1></i><b>(1)</b>
        - name: ROX_API_TOKEN
          valueFrom:
            secretKeyRef:
              key: rox_api_token
              name: $(params.rox_api_token)
        - name: ROX_CENTRAL_ENDPOINT
          valueFrom:
            secretKeyRef:
              key: rox_central_endpoint
              name: $(params.rox_central_endpoint)
      image: &gt;-
        registry.access.redhat.com/ubi9@sha256:089bd3b82a78ac45c0eed231bb58bfb43bfcd0560d9bba240fc6355502c92976
      name: rox-image-scan
      resources: {}
      script: | <i class=conum data-value=2></i><b>(2)</b>
        #!/usr/bin/env bash

        set +x

        curl -s -k -L -H &#34;Authorization: Bearer $ROX_API_TOKEN&#34; \
          &#34;https://$ROX_CENTRAL_ENDPOINT/api/cli/download/roxctl-linux&#34; \
          --output ./roxctl  \
          &gt; /dev/null

        chmod +x ./roxctl  &gt; /dev/null

        if [ &#34;$(params.insecure-skip-tls-verify)&#34; = &#34;true&#34; ]; then

          export ROX_INSECURE_CLIENT_SKIP_TLS_VERIFY=true

        fi

        ./roxctl image scan -e &#34;$ROX_CENTRAL_ENDPOINT&#34; --image &#34;$(params.image)&#34; <i class=conum data-value=3></i><b>(3)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Token end endpoint which we defined as Secrets</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Script that downloads and executes the CLI <strong>roxctl</strong></td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Calling "<em>roxctl image scan</em>"</td></tr></tbody></table></div></div><div class=sect2><h3 id=_task_image_check>Task Image Check</h3><div class=paragraph><p>To verify the policies that are configured in ACS we create the Task <strong>acs-image-check</strong>.
We will use the command line tool roxctl again.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>ACS comes with several (80+) build-in policies. Some of them are activated, but none of them configured to enforce a policy. Except, the policy <strong>Trusted Signature Policy</strong> we have created above.</td></tr></tbody></table></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: acs-image-check
  namespace: ci
spec:
  description: &gt;-
    Policy check an image with StackRox/RHACS This tasks allows you to check an
    image against build-time policies and apply enforcement to fail builds. It&#39;s
    a companion to the stackrox-image-scan task, which returns full
    vulnerability scan results for an image.
  params:
    - description: |
        Secret containing the address:port tuple for StackRox Central)
        (example - rox.stackrox.io:443)
      name: rox_central_endpoint
      type: string
    - description: Secret containing the StackRox API token with CI permissions
      name: rox_api_token
      type: string
    - description: |
        Full name of image to scan (example -- gcr.io/rox/sample:5.0-rc1)
      name: image
      type: string
    - default: &#39;false&#39;
      description: |
        When set to `&#34;true&#34;`, skip verifying the TLS certs of the Central
        endpoint.  Defaults to `&#34;false&#34;`.
      name: insecure-skip-tls-verify
      type: string
  results:
    - description: Output of `roxctl image check`
      name: check_output
      type: string
  steps:
    - env: <i class=conum data-value=1></i><b>(1)</b>
        - name: ROX_API_TOKEN
          valueFrom:
            secretKeyRef:
              key: rox_api_token
              name: $(params.rox_api_token)
        - name: ROX_CENTRAL_ENDPOINT
          valueFrom:
            secretKeyRef:
              key: rox_central_endpoint
              name: $(params.rox_central_endpoint)
      image: &gt;-
        registry.access.redhat.com/ubi9@sha256:089bd3b82a78ac45c0eed231bb58bfb43bfcd0560d9bba240fc6355502c92976
      name: rox-image-check
      resources: {}
      script: |
        #!/usr/bin/env bash <i class=conum data-value=2></i><b>(2)</b>

        set +x

        curl -s -k -L -H &#34;Authorization: Bearer $ROX_API_TOKEN&#34; \
          &#34;https://$ROX_CENTRAL_ENDPOINT/api/cli/download/roxctl-linux&#34; \
          --output ./roxctl  \
          &gt; /dev/null

        chmod +x ./roxctl  &gt; /dev/null

        if [ &#34;$(params.insecure-skip-tls-verify)&#34; = &#34;true&#34; ]; then

          export ROX_INSECURE_CLIENT_SKIP_TLS_VERIFY=true

        fi

        ./roxctl image check -e &#34;$ROX_CENTRAL_ENDPOINT&#34; --image &#34;$(params.image)&#34; <i class=conum data-value=3></i><b>(3)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Token end endpoint which we defined as Secrets</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Script that downloads and executes the CLI <strong>roxctl</strong></td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Calling "<em>roxctl image check</em>"</td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=_extend_the_pipeline>Extend the Pipeline</h2><div class=sectionbody><div class=paragraph><p>Now it is time to extend our Pipeline with the two tasks. Add the following blocks to the Pipeline <strong>secure-supply-chain</strong>:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yml data-lang=yml>    - name: acs-image-scan <i class=conum data-value=1></i><b>(1)</b>
      params: <i class=conum data-value=2></i><b>(2)</b>
        - name: rox_central_endpoint
          value: stackrox-endpoint
        - name: rox_api_token
          value: stackrox-secret
        - name: image
          value: &#39;$(params.IMAGE_REPO):$(params.IMAGE_TAG)&#39;
        - name: insecure-skip-tls-verify <i class=conum data-value=3></i><b>(3)</b>
          value: &#39;true&#39;
      runAfter: <i class=conum data-value=4></i><b>(4)</b>
        - build-sign-image
      taskRef:
        kind: Task
        name: acs-image-scan
    - name: acs-image-check <i class=conum data-value=5></i><b>(5)</b>
      params: <i class=conum data-value=6></i><b>(6)</b>
        - name: rox_central_endpoint
          value: stackrox-endpoint
        - name: rox_api_token
          value: stackrox-secret
        - name: image
          value: &#39;$(params.IMAGE_REPO):$(params.IMAGE_TAG)&#39;
        - name: insecure-skip-tls-verify <i class=conum data-value=7></i><b>(7)</b>
          value: &#39;true&#39;
      runAfter:
        - build-sign-image <i class=conum data-value=8></i><b>(8)</b>
      taskRef:
        kind: Task
        name: acs-image-check</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Scanning for vulnerabilities</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Provide parameters to the Task</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Set to 'false' if you have valid certificates.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Run after the Task "build-sign-image"</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Scanning security policies</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>Provide parameters to the Task</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>Set to 'false' if you have valid certificates.</td></tr><tr><td><i class=conum data-value=8></i><b>8</b></td><td>Run after the Task "build-sign-image"</td></tr></tbody></table></div><div class=paragraph><p>The Pipeline will now look like this:</p></div><div class=imageblock><div class=content><img src=/SecureSupplyChain/images/step6-pipeline.png alt="Pipeline Details"></div><div class=title>Figure 8. Pipeline Details</div></div></div></div><div class=sect1><h2 id=_execute_the_pipeline>Execute the Pipeline</h2><div class=sectionbody><div class=paragraph><p>Let’s trigger another PipelineRun by updating the <strong>README.md</strong> of our source code.
While the previous Tasks should run successfully, let’s monitor our two ACS tasks. However, now the Pipeline is running quite long already. This means it is time for a coffee.</p></div><div class=paragraph><p>Still here? Good, eventually our two ACS tasks have finished successfully.</p></div><div class=paragraph><p>The Task <strong>image-scan</strong> is looking for vulnerabilities and did not find any high-severity issues.</p></div><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step6-acs_scan.png?width=600px" alt="ACS Image Scan Result"></div><div class=title>Figure 9. ACS Image Scan Result</div></div><div class=paragraph><p>The Task <strong>image-check</strong> verified the security policies. You can see in the Logs that the <strong>*Trusted Signature Policy</strong> was not violated. Another might be shown, but since all other policies are configured to notify only (instead of "enforce"), the whole Task will end successfully. This is good enough for our first tests. The important bit is that the image has been signed.</p></div><div class=imageblock><div class=content><img src="/SecureSupplyChain/images/step6-acs_check.png?width=600px" alt="ACS Image Check Result"></div><div class=title>Figure 10. ACS Image Check Result</div></div></div></div><div class=sect1><h2 id=_summary>Summary</h2><div class=sectionbody><div class=paragraph><p>Now we have integrated ACS and are using its powers to scan images for vulnerabilities and check them against security policies. Two Tasks have been created that are executed after the image has been built and are leveraging ACS’s command line tool <strong>roxctl</strong></p></div><div class=paragraph><p>Whenever vulnerabilities are found, or security policies are violated (if the policy is set to <strong>enforce</strong>) the Pipeline will fail.</p></div><div class=paragraph><p>Such tasks should be built in any pipeline you are creating, independently of using ACS or any other security verification tool.</p></div><div class=paragraph><p>In the next step, we will create a Task that creates a Software Bill of Material (SBOM) for us.</p></div></div></div><footer class=footline></footer></div></div><div id=navigation-bottom><a class="nav-prev btn btn-default" href=/securesupplychain/2023-06-20-securesupplychain-step5/ title="Step 5 - Build and Sign Image"><i class="fa fa-chevron-left btn-bottom-prev"></i><span class=btn-bottom-text>Previous:</span> Step 5 - Build and Sign Image</a>
<a class="nav-next btn btn-default" href=/securesupplychain/2023-06-22-securesupplychain-step7/ title="Step 7 - Generating a SBOM" style=margin-right:0><i class="fa fa-chevron-right btn-bottom-next"></i><span class=btn-bottom-text>Next:</span> Step 7 - Generating a SBOM</a></div><div class=copyright><p>Copyright &copy; 2020 - 2023 Toni Schmidbauer & Thomas Jungbauer</p><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn target=_blank rel="noopener noreferrer">Hugo Learn Theme</i></a> and <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a></p></div></section><script>(function(){$("document").ready(function(){var s=$(".read-progress").waypoint({handler:function(e){e=="down"?($(".read-progress").addClass("position-fixed"),$(".read-progress").css("top",0)):($(".read-progress").removeClass("position-fixed"),$(".read-progress").css("top"))}}),t=$(window).height(),e=$(".post-content").height();$(window).on("scroll",n),$(window).on("resize",function(){t=$(window).height(),e=$(".post-content").height(),n()});function n(){var s=$(this).scrollTop(),o=$(".post-content").offset().top,i=e-(e-(t-(o-s))),n=i/e*100,n=n>100?100:n;$(".read-progress").width(n+"%")}})})()</script><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1701071080></script>
<script src=/js/perfect-scrollbar.min.js?1701071080></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1701071080></script>
<script src=/js/jquery.sticky.js?1701071080></script>
<script src=/js/featherlight.min.js?1701071080></script>
<script src=/js/highlight.pack.js?1701071080></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1701071080></script>
<script src=/js/learn.js?1701071080></script>
<script src=/js/hugo-learn.js?1701071080></script>
<script src=/js/yaub.js?1701071080></script>
<script>window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.getAttribute("id");e.intersectionRatio>0&&(clearActiveStatesInTableOfContents(),document.querySelector(`aside nav li a[href="#${t}"]`).parentElement.classList.add("active"))})});document.querySelectorAll("h1[id],h2[id],h3[id]").forEach(t=>{e.observe(t)})});function clearActiveStatesInTableOfContents(){document.querySelectorAll("aside nav li").forEach(e=>{e.classList.remove("active")})}</script><script type=text/javascript>function scrollTopAnimated(){$("html, body").animate({scrollTop:"0"},500)}</script><script>function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}$(".summary-box").click(function(){return window.location=$(this).find("a").attr("href"),!1})</script></body></html>